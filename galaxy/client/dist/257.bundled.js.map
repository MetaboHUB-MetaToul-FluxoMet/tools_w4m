{"version":3,"file":"257.bundled.js","mappings":"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GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJxlB,GAAI,QACJylB,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,SAGRC,aAAc,CACV,EAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,EAAU,IACV,IAAU,IACV,EAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,EAAU,IACV,IAAU,KACV,IAAU,KACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,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","sources":["webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/log.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/validate.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/options.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/dataType.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/graph.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/logger.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/type.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/parser.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/csl.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/csl.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/deepCopy.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/fetchFile.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/fetchId.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/stack.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/register.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/grammar.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/util/translator.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/chain.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/data.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/register.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/input/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/set.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/output/label.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/sort.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/output.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/get.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/async.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/Cite/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/dict.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/config.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugins/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/input/empty.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/input/json.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/input/jquery.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/input/html.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/output/json.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/input/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/core/lib-mjs/plugin-common/output/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/date/lib/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/date/lib/input.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/date/lib/output.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/name/lib/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/name/lib/input.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/name/lib/output.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/constants.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/file.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/bibtxt.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/config.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/mapping/shared.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/mapping/biblatex.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/mapping/bibtex.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/mapping/crossref.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/mapping/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/name.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/value.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/entries.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/input/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/output/value.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/output/entries.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/output/bibtex.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/output/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/output/bibtxt.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-bibtex/lib-mjs/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/locales.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/styles.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/engines.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/bibliography.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/citation.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/index.js","webpack://@galaxyproject/galaxy-client/./node_modules/@citation-js/plugin-csl/lib-mjs/attr.js","webpack://@galaxyproject/galaxy-client/./node_modules/citeproc/citeproc_commonjs.js"],"sourcesContent":["function currentVersion() {\n  return this.log.length;\n}\nfunction retrieveVersion(versnum = 1) {\n  if (versnum <= 0 || versnum > this.currentVersion()) {\n    return null;\n  } else {\n    const [data, options] = this.log[versnum - 1];\n    const image = new this.constructor(JSON.parse(data), JSON.parse(options));\n    image.log = this.log.slice(0, versnum);\n    return image;\n  }\n}\nfunction undo(number = 1) {\n  return this.retrieveVersion(this.currentVersion() - number);\n}\nfunction retrieveLastVersion() {\n  return this.retrieveVersion(this.currentVersion());\n}\nfunction save() {\n  this.log.push([JSON.stringify(this.data), JSON.stringify(this._options)]);\n  return this;\n}\nexport { currentVersion, retrieveVersion, retrieveLastVersion, undo, save };","const formats = ['real', 'string'];\nconst types = ['json', 'html', 'string', 'rtf'];\nconst styles = ['csl', 'bibtex', 'bibtxt', 'citation-*', 'ris', 'ndjson'];\nconst wrapperTypes = ['string', 'function'];\nexport function validateOutputOptions(options) {\n  if (typeof options !== 'object') {\n    throw new TypeError('Options not an object!');\n  }\n  const {\n    format,\n    type,\n    style,\n    lang,\n    append,\n    prepend\n  } = options;\n  if (format && !formats.includes(format)) {\n    throw new TypeError(`Option format (\"${format}\") should be one of: ${formats}`);\n  } else if (type && !types.includes(type)) {\n    throw new TypeError(`Option type (\"${type}\") should be one of: ${types}`);\n  } else if (style && !styles.includes(style) && !/^citation/.test(style)) {\n    throw new TypeError(`Option style (\"${style}\") should be one of: ${styles}`);\n  } else if (lang && typeof lang !== 'string') {\n    throw new TypeError(`Option lang should be a string, but is a ${typeof lang}`);\n  } else if (prepend && !wrapperTypes.includes(typeof prepend)) {\n    throw new TypeError(`Option prepend should be a string or a function, but is a ${typeof prepend}`);\n  } else if (append && !wrapperTypes.includes(typeof append)) {\n    throw new TypeError(`Option append should be a string or a function, but is a ${typeof append}`);\n  }\n  if (/^citation/.test(style) && type === 'json') {\n    throw new Error(`Combination type/style of json/citation-* is not valid: ${type}/${style}`);\n  }\n  return true;\n}\nexport function validateOptions(options) {\n  if (typeof options !== 'object') {\n    throw new TypeError('Options should be an object');\n  }\n  if (options.output) {\n    validateOutputOptions(options.output);\n  } else if (options.maxChainLength && typeof options.maxChainLength !== 'number') {\n    throw new TypeError('Option maxChainLength should be a number');\n  } else if (options.forceType && typeof options.forceType !== 'string') {\n    throw new TypeError('Option forceType should be a string');\n  } else if (options.generateGraph != null && typeof options.generateGraph !== 'boolean') {\n    throw new TypeError('Option generateGraph should be a boolean');\n  } else if (options.strict != null && typeof options.strict !== 'boolean') {\n    throw new TypeError('Option strict should be a boolean');\n  } else if (options.target != null && typeof options.target !== 'string') {\n    throw new TypeError('Option target should be a boolean');\n  }\n  return true;\n}","import { validateOutputOptions as validate } from './validate.js';\nconst defaultOptions = {\n  format: 'real',\n  type: 'json',\n  style: 'csl',\n  lang: 'en-US'\n};\nfunction options(options, log) {\n  validate(options);\n  if (log) {\n    this.save();\n  }\n  Object.assign(this._options, options);\n  return this;\n}\nexport { options, defaultOptions };","export function typeOf(thing) {\n  switch (thing) {\n    case undefined:\n      return 'Undefined';\n    case null:\n      return 'Null';\n    default:\n      return thing.constructor.name;\n  }\n}\nexport function dataTypeOf(thing) {\n  switch (typeof thing) {\n    case 'string':\n      return 'String';\n    case 'object':\n      if (Array.isArray(thing)) {\n        return 'Array';\n      } else if (typeOf(thing) === 'Object') {\n        return 'SimpleObject';\n      } else if (typeOf(thing) !== 'Null') {\n        return 'ComplexObject';\n      }\n    default:\n      return 'Primitive';\n  }\n}","export function applyGraph(entry, graph) {\n  if (entry._graph) {\n    const index = graph.findIndex(({\n      type\n    }) => type === '@else/list+object');\n    if (index !== -1) {\n      graph.splice(index + 1, 0, ...entry._graph.slice(0, -1));\n    }\n  }\n  entry._graph = graph;\n  return entry;\n}\nexport function removeGraph(entry) {\n  delete entry._graph;\n  return entry;\n}","const logger = {\n  _output(level, scope, msg) {\n    this._log.push(scope, msg);\n    if (this._levels.indexOf(level) < this._levels.indexOf(this.level)) {\n      return;\n    }\n    this._console.log(scope, ...msg);\n  },\n  _console: null,\n  _log: [],\n  _levels: ['http', 'debug', 'unmapped', 'info', 'warn', 'error', 'silent'],\n  level: 'silent'\n};\nfor (const level of logger._levels) {\n  logger[level] = (scope, ...msg) => logger._output(level, scope, msg);\n}\nif (typeof console.Console === 'function') {\n  logger._console = new console.Console(process.stderr);\n} else {\n  logger._console = console;\n}\nexport default logger;","import logger from '../../logger.js';\nimport { dataTypeOf } from './dataType.js';\nconst types = {};\nconst dataTypes = {};\nconst unregExts = {};\nfunction parseNativeTypes(input, dataType) {\n  switch (dataType) {\n    case 'Array':\n      if (input.length === 0 || input.every(entry => type(entry) === '@csl/object')) {\n        return '@csl/list+object';\n      } else {\n        return '@else/list+object';\n      }\n    case 'SimpleObject':\n    case 'ComplexObject':\n      return '@csl/object';\n    default:\n      return '@invalid';\n  }\n}\nfunction matchType(typeList = [], data) {\n  for (const type of typeList) {\n    if (types[type].predicate(data)) {\n      return matchType(types[type].extensions, data) || type;\n    }\n  }\n}\nexport function type(input) {\n  const dataType = dataTypeOf(input);\n  if (dataType === 'Array' && input.length === 0) {\n    return parseNativeTypes(input, dataType);\n  }\n  const match = matchType(dataTypes[dataType], input);\n  return match || parseNativeTypes(input, dataType);\n}\nexport function addTypeParser(format, {\n  dataType,\n  predicate,\n  extends: extend\n}) {\n  let extensions = [];\n  if (format in unregExts) {\n    extensions = unregExts[format];\n    delete unregExts[format];\n    logger.debug('[core]', `Subclasses \"${extensions}\" finally registered to parent type \"${format}\"`);\n  }\n  const object = {\n    predicate,\n    extensions\n  };\n  types[format] = object;\n  if (extend) {\n    const parentTypeParser = types[extend];\n    if (parentTypeParser) {\n      parentTypeParser.extensions.push(format);\n    } else {\n      if (!unregExts[extend]) {\n        unregExts[extend] = [];\n      }\n      unregExts[extend].push(format);\n      logger.debug('[core]', `Subclass \"${format}\" is waiting on parent type \"${extend}\"`);\n    }\n  } else {\n    const typeList = dataTypes[dataType] || (dataTypes[dataType] = []);\n    typeList.push(format);\n  }\n}\nexport function hasTypeParser(type) {\n  return Object.prototype.hasOwnProperty.call(types, type);\n}\nexport function removeTypeParser(type) {\n  delete types[type];\n  const typeLists = [...Object.keys(dataTypes).map(key => dataTypes[key]), ...Object.keys(types).map(type => types[type].extensions).filter(list => list.length > 0)];\n  typeLists.forEach(typeList => {\n    const index = typeList.indexOf(type);\n    if (index > -1) {\n      typeList.splice(index, 1);\n    }\n  });\n}\nexport function listTypeParser() {\n  return Object.keys(types);\n}\nexport function treeTypeParser() {\n  const attachNode = name => ({\n    name,\n    children: types[name].extensions.map(attachNode)\n  });\n  return {\n    name: 'Type tree',\n    children: Object.keys(dataTypes).map(name => ({\n      name,\n      children: dataTypes[name].map(attachNode)\n    }))\n  };\n}\nexport const typeMatcher = /^(?:@(.+?))(?:\\/(?:(.+?)\\+)?(?:(.+)))?$/;","function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { type, typeMatcher } from './type.js';\nclass TypeParser {\n  constructor(data) {\n    _defineProperty(this, \"validDataTypes\", ['String', 'Array', 'SimpleObject', 'ComplexObject', 'Primitive']);\n    this.data = data;\n  }\n  validateDataType() {\n    const dataType = this.data.dataType;\n    if (dataType && !this.validDataTypes.includes(dataType)) {\n      throw new RangeError(`dataType was ${dataType}; expected one of ${this.validDataTypes}`);\n    }\n  }\n  validateParseType() {\n    const predicate = this.data.predicate;\n    if (predicate && !(predicate instanceof RegExp || typeof predicate === 'function')) {\n      throw new TypeError(`predicate was ${typeof predicate}; expected RegExp or function`);\n    }\n  }\n  validateTokenList() {\n    const tokenList = this.data.tokenList;\n    if (tokenList && typeof tokenList !== 'object') {\n      throw new TypeError(`tokenList was ${typeof tokenList}; expected object or RegExp`);\n    }\n  }\n  validatePropertyConstraint() {\n    const propertyConstraint = this.data.propertyConstraint;\n    if (propertyConstraint && typeof propertyConstraint !== 'object') {\n      throw new TypeError(`propertyConstraint was ${typeof propertyConstraint}; expected array or object`);\n    }\n  }\n  validateElementConstraint() {\n    const elementConstraint = this.data.elementConstraint;\n    if (elementConstraint && typeof elementConstraint !== 'string') {\n      throw new TypeError(`elementConstraint was ${typeof elementConstraint}; expected string`);\n    }\n  }\n  validateExtends() {\n    const extend = this.data.extends;\n    if (extend && typeof extend !== 'string') {\n      throw new TypeError(`extends was ${typeof extend}; expected string`);\n    }\n  }\n  validate() {\n    if (this.data === null || typeof this.data !== 'object') {\n      throw new TypeError(`typeParser was ${typeof this.data}; expected object`);\n    }\n    this.validateDataType();\n    this.validateParseType();\n    this.validateTokenList();\n    this.validatePropertyConstraint();\n    this.validateElementConstraint();\n    this.validateExtends();\n  }\n  parseTokenList() {\n    let tokenList = this.data.tokenList;\n    if (!tokenList) {\n      return [];\n    } else if (tokenList instanceof RegExp) {\n      tokenList = {\n        token: tokenList\n      };\n    }\n    const {\n      token,\n      split = /\\s+/,\n      trim = true,\n      every = true\n    } = tokenList;\n    const trimInput = input => trim ? input.trim() : input;\n    const testTokens = every ? 'every' : 'some';\n    const predicate = input => trimInput(input).split(split)[testTokens](part => token.test(part));\n    return [predicate];\n  }\n  parsePropertyConstraint() {\n    const constraints = [].concat(this.data.propertyConstraint || []);\n    return constraints.map(({\n      props,\n      match,\n      value\n    }) => {\n      props = [].concat(props);\n      switch (match) {\n        case 'any':\n        case 'some':\n          return input => props.some(prop => prop in input && (!value || value(input[prop])));\n        case 'none':\n          return input => !props.some(prop => prop in input && (!value || value(input[prop])));\n        case 'every':\n        default:\n          return input => props.every(prop => prop in input && (!value || value(input[prop])));\n      }\n    });\n  }\n  parseElementConstraint() {\n    const constraint = this.data.elementConstraint;\n    return !constraint ? [] : [input => input.every(entry => type(entry) === constraint)];\n  }\n  parsePredicate() {\n    if (this.data.predicate instanceof RegExp) {\n      return [this.data.predicate.test.bind(this.data.predicate)];\n    } else if (this.data.predicate) {\n      return [this.data.predicate];\n    } else {\n      return [];\n    }\n  }\n  getCombinedPredicate() {\n    const predicates = [...this.parsePredicate(), ...this.parseTokenList(), ...this.parsePropertyConstraint(), ...this.parseElementConstraint()];\n    if (predicates.length === 0) {\n      return () => true;\n    } else if (predicates.length === 1) {\n      return predicates[0];\n    } else {\n      return input => predicates.every(predicate => predicate(input));\n    }\n  }\n  getDataType() {\n    if (this.data.dataType) {\n      return this.data.dataType;\n    } else if (this.data.predicate instanceof RegExp) {\n      return 'String';\n    } else if (this.data.tokenList) {\n      return 'String';\n    } else if (this.data.elementConstraint) {\n      return 'Array';\n    } else {\n      return 'Primitive';\n    }\n  }\n  get dataType() {\n    return this.getDataType();\n  }\n  get predicate() {\n    return this.getCombinedPredicate();\n  }\n  get extends() {\n    return this.data.extends;\n  }\n}\nclass DataParser {\n  constructor(parser, {\n    async\n  } = {}) {\n    this.parser = parser;\n    this.async = async;\n  }\n  validate() {\n    const parser = this.parser;\n    if (typeof parser !== 'function') {\n      throw new TypeError(`parser was ${typeof parser}; expected function`);\n    }\n  }\n}\nclass FormatParser {\n  constructor(format, parsers = {}) {\n    this.format = format;\n    if (parsers.parseType) {\n      this.typeParser = new TypeParser(parsers.parseType);\n    }\n    if (parsers.parse) {\n      this.dataParser = new DataParser(parsers.parse, {\n        async: false\n      });\n    }\n    if (parsers.parseAsync) {\n      this.asyncDataParser = new DataParser(parsers.parseAsync, {\n        async: true\n      });\n    }\n  }\n  validateFormat() {\n    const format = this.format;\n    if (!typeMatcher.test(format)) {\n      throw new TypeError(`format name was \"${format}\"; didn't match expected pattern`);\n    }\n  }\n  validate() {\n    this.validateFormat();\n    if (this.typeParser) {\n      this.typeParser.validate();\n    }\n    if (this.dataParser) {\n      this.dataParser.validate();\n    }\n    if (this.asyncDataParser) {\n      this.asyncDataParser.validate();\n    }\n  }\n}\nexport { TypeParser, DataParser, FormatParser };","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { parse as parseName } from '@citation-js/name';\nconst NAME = 1;\nconst NAME_LIST = 2;\nconst DATE = 3;\nconst TYPE = 4;\nconst entryTypes = {\n  article: true,\n  'article-journal': true,\n  'article-magazine': true,\n  'article-newspaper': true,\n  bill: true,\n  book: true,\n  broadcast: true,\n  chapter: true,\n  classic: true,\n  collection: true,\n  dataset: true,\n  document: true,\n  entry: true,\n  'entry-dictionary': true,\n  'entry-encyclopedia': true,\n  event: true,\n  figure: true,\n  graphic: true,\n  hearing: true,\n  interview: true,\n  legal_case: true,\n  legislation: true,\n  manuscript: true,\n  map: true,\n  motion_picture: true,\n  musical_score: true,\n  pamphlet: true,\n  'paper-conference': true,\n  patent: true,\n  performance: true,\n  periodical: true,\n  personal_communication: true,\n  post: true,\n  'post-weblog': true,\n  regulation: true,\n  report: true,\n  review: true,\n  'review-book': true,\n  software: true,\n  song: true,\n  speech: true,\n  standard: true,\n  thesis: true,\n  treaty: true,\n  webpage: true,\n  'journal-article': 'article-journal',\n  'book-chapter': 'chapter',\n  'posted-content': 'manuscript',\n  'proceedings-article': 'paper-conference'\n};\nconst fieldTypes = {\n  author: NAME_LIST,\n  chair: NAME_LIST,\n  'collection-editor': NAME_LIST,\n  compiler: NAME_LIST,\n  composer: NAME_LIST,\n  'container-author': NAME_LIST,\n  contributor: NAME_LIST,\n  curator: NAME_LIST,\n  director: NAME_LIST,\n  editor: NAME_LIST,\n  'editorial-director': NAME_LIST,\n  'executive-producer': NAME_LIST,\n  guest: NAME_LIST,\n  host: NAME_LIST,\n  interviewer: NAME_LIST,\n  illustrator: NAME_LIST,\n  narrator: NAME_LIST,\n  organizer: NAME_LIST,\n  'original-author': NAME_LIST,\n  performer: NAME_LIST,\n  producer: NAME_LIST,\n  'reviewed-author': NAME_LIST,\n  recipient: NAME_LIST,\n  'script-writer': NAME_LIST,\n  'series-creator': NAME_LIST,\n  translator: NAME_LIST,\n  accessed: DATE,\n  'available-date': DATE,\n  container: DATE,\n  'event-date': DATE,\n  issued: DATE,\n  'original-date': DATE,\n  submitted: DATE,\n  type: TYPE,\n  categories: 'object',\n  custom: 'object',\n  id: ['string', 'number'],\n  language: 'string',\n  journalAbbreviation: 'string',\n  shortTitle: 'string',\n  abstract: 'string',\n  annote: 'string',\n  archive: 'string',\n  archive_collection: 'string',\n  archive_location: 'string',\n  'archive-place': 'string',\n  authority: 'string',\n  'call-number': 'string',\n  'chapter-number': 'string',\n  'citation-number': 'string',\n  'citation-key': 'string',\n  'citation-label': 'string',\n  'collection-number': 'string',\n  'collection-title': 'string',\n  'container-title': 'string',\n  'container-title-short': 'string',\n  dimensions: 'string',\n  division: 'string',\n  DOI: 'string',\n  edition: ['string', 'number'],\n  event: 'string',\n  'event-title': 'string',\n  'event-place': 'string',\n  'first-reference-note-number': 'string',\n  genre: 'string',\n  ISBN: 'string',\n  ISSN: 'string',\n  issue: ['string', 'number'],\n  jurisdiction: 'string',\n  keyword: 'string',\n  locator: 'string',\n  medium: 'string',\n  note: 'string',\n  number: ['string', 'number'],\n  'number-of-pages': 'string',\n  'number-of-volumes': ['string', 'number'],\n  'original-publisher': 'string',\n  'original-publisher-place': 'string',\n  'original-title': 'string',\n  page: 'string',\n  'page-first': 'string',\n  'part-number': ['string', 'number'],\n  'part-title': 'string',\n  PMCID: 'string',\n  PMID: 'string',\n  printing: 'string',\n  publisher: 'string',\n  'publisher-place': 'string',\n  references: 'string',\n  'reviewed-title': 'string',\n  'reviewed-genre': 'string',\n  scale: 'string',\n  section: 'string',\n  source: 'string',\n  status: 'string',\n  supplement: ['string', 'number'],\n  title: 'string',\n  'title-short': 'string',\n  URL: 'string',\n  version: 'string',\n  volume: ['string', 'number'],\n  'volume-title': 'string',\n  'volume-title-short': 'string',\n  'year-suffix': 'string'\n};\nfunction correctName(name, bestGuessConversions) {\n  if (typeof name === 'object' && name !== null && (name.literal || name.given || name.family)) {\n    return name;\n  } else if (!bestGuessConversions) {\n    return undefined;\n  } else if (typeof name === 'string') {\n    return parseName(name);\n  }\n}\nfunction correctNameList(nameList, bestGuessConversions) {\n  if (nameList instanceof Array) {\n    const names = nameList.map(name => correctName(name, bestGuessConversions)).filter(Boolean);\n    return names.length ? names : undefined;\n  }\n}\nfunction correctDateParts(dateParts, bestGuessConversions) {\n  if (dateParts.every(part => typeof part === 'number')) {\n    return dateParts;\n  } else if (!bestGuessConversions || dateParts.some(part => isNaN(parseInt(part)))) {\n    return undefined;\n  } else {\n    return dateParts.map(part => parseInt(part));\n  }\n}\nfunction correctDate(date, bestGuessConversions) {\n  const dp = 'date-parts';\n  if (typeof date !== 'object' || date === null) {\n    return undefined;\n  } else if (date[dp] instanceof Array && date[dp].every(part => part instanceof Array)) {\n    const range = date[dp].map(dateParts => correctDateParts(dateParts, bestGuessConversions)).filter(Boolean);\n    return range.length ? _objectSpread(_objectSpread({}, date), {}, {\n      'date-parts': range\n    }) : undefined;\n  } else if (date instanceof Array && date.every(part => part[dp] instanceof Array)) {\n    const range = date.map(dateParts => correctDateParts(dateParts[dp], bestGuessConversions)).filter(Boolean);\n    return range.length ? {\n      'date-parts': range\n    } : undefined;\n  } else if (date[dp] instanceof Array) {\n    const dateParts = correctDateParts(date[dp], bestGuessConversions);\n    return dateParts && {\n      'date-parts': [dateParts]\n    };\n  } else if ('literal' in date || 'raw' in date) {\n    return date;\n  }\n}\nfunction correctType(type, bestGuessConversions) {\n  type = correctField('language', type, bestGuessConversions);\n  if (entryTypes[type] === true) {\n    return type;\n  } else if (bestGuessConversions && type in entryTypes) {\n    return entryTypes[type];\n  } else {\n    return undefined;\n  }\n}\nfunction correctField(fieldName, value, bestGuessConversions) {\n  const fieldType = [].concat(fieldTypes[fieldName]);\n  switch (fieldTypes[fieldName]) {\n    case NAME:\n      return correctName(value, bestGuessConversions);\n    case NAME_LIST:\n      return correctNameList(value, bestGuessConversions);\n    case DATE:\n      return correctDate(value, bestGuessConversions);\n    case TYPE:\n      return correctType(value, bestGuessConversions);\n  }\n  if (bestGuessConversions) {\n    if (typeof value === 'string' && fieldType.includes('number') && !fieldType.includes('string') && !isNaN(+value)) {\n      return parseFloat(value);\n    } else if (typeof value === 'number' && fieldType.includes('string') && !fieldType.includes('number')) {\n      return value.toString();\n    } else if (Array.isArray(value) && value.length) {\n      return correctField(fieldName, value[0], bestGuessConversions);\n    }\n  }\n  if (fieldType.includes(typeof value)) {\n    return value;\n  }\n}\nfunction parseCsl(data, bestGuessConversions = true) {\n  return data.map(function (entry) {\n    const clean = {};\n    for (const field in entry) {\n      const correction = correctField(field, entry[field], bestGuessConversions);\n      if (correction !== undefined) {\n        clean[field] = correction;\n      }\n    }\n    return clean;\n  });\n}\nexport { parseCsl as clean };","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nexport function upgradeCsl(item) {\n  if (Array.isArray(item)) {\n    return item.map(upgradeCsl);\n  }\n  item = _objectSpread({}, item);\n  if ('event' in item) {\n    item['event-title'] = item.event;\n    delete item.event;\n  }\n  if (item.type === 'book' && 'version' in item) {\n    item.type = 'software';\n  }\n  return item;\n}\nexport function downgradeCsl(item) {\n  if (Array.isArray(item)) {\n    return item.map(downgradeCsl);\n  }\n  item = _objectSpread({}, item);\n  if ('event-title' in item) {\n    item.event = item['event-title'];\n    delete item['event-title'];\n  }\n  if (item.type === 'software') {\n    item.type = 'book';\n  }\n  return item;\n}","export function deepCopy(value, seen = new Set()) {\n  if (typeof value !== 'object' || value === null || value.constructor !== Object && value.constructor !== Array) {\n    return value;\n  }\n  if (seen.has(value)) {\n    throw new TypeError('Recursively copying circular structure');\n  }\n  seen.add(value);\n  let copy;\n  if (value.constructor === Array) {\n    copy = value.map(value => deepCopy(value, seen));\n  } else {\n    const object = {};\n    for (const key in value) {\n      object[key] = deepCopy(value[key], seen);\n    }\n    copy = object;\n  }\n  seen.delete(value);\n  return copy;\n}\nexport default deepCopy;","import syncFetch from 'sync-fetch';\nimport fetchPolyfill from 'fetch-ponyfill';\nimport logger from '../logger.js';\nimport pkg from '../../package.json';\nconst {\n  fetch,\n  Headers\n} = fetchPolyfill();\nconst corsEnabled = typeof location !== 'undefined' && typeof document !== 'undefined';\nlet userAgent = corsEnabled ? '' : `Citation.js/${pkg.version} Node.js/${process.version}`;\nfunction normaliseHeaders(headers) {\n  const result = {};\n  const entries = headers instanceof Headers || headers instanceof syncFetch.Headers ? Array.from(headers) : Object.entries(headers);\n  for (const [name, header] of entries) {\n    result[name.toLowerCase()] = header.toString();\n  }\n  return result;\n}\nfunction parseOpts(opts = {}) {\n  const reqOpts = {\n    headers: {\n      accept: '*/*'\n    },\n    method: 'GET',\n    checkContentType: opts.checkContentType\n  };\n  if (userAgent && !corsEnabled) {\n    reqOpts.headers['user-agent'] = userAgent;\n  }\n  if (opts.body) {\n    reqOpts.method = 'POST';\n    const isJson = typeof opts.body !== 'string';\n    reqOpts.body = isJson ? JSON.stringify(opts.body) : opts.body;\n    reqOpts.headers['content-type'] = isJson ? 'application/json' : 'text/plain';\n  }\n  if (opts.headers) {\n    Object.assign(reqOpts.headers, normaliseHeaders(opts.headers));\n  }\n  return reqOpts;\n}\nfunction sameType(request, response) {\n  if (!request.accept || request.accept === '*/*' || !response['content-type']) {\n    return true;\n  }\n  const [a, b] = response['content-type'].split(';')[0].trim().split('/');\n  return request.accept.split(',').map(type => type.split(';')[0].trim().split('/')).some(([c, d]) => (c === a || c === '*') && (d === b || d === '*'));\n}\nfunction checkResponse(response, opts) {\n  const {\n    status,\n    headers\n  } = response;\n  let error;\n  if (status >= 400) {\n    error = new Error(`Server responded with status code ${status}`);\n  } else if (opts.checkContentType === true && !sameType(opts.headers, normaliseHeaders(headers))) {\n    error = new Error(`Server responded with content-type ${headers.get('content-type')}`);\n  }\n  if (error) {\n    error.status = status;\n    error.headers = headers;\n    error.body = response.body;\n    throw error;\n  }\n  return response;\n}\nexport function fetchFile(url, opts) {\n  const reqOpts = parseOpts(opts);\n  logger.http('[core]', reqOpts.method, url, reqOpts);\n  const response = checkResponse(syncFetch(url, reqOpts), reqOpts);\n  return response.text();\n}\nexport async function fetchFileAsync(url, opts) {\n  const reqOpts = parseOpts(opts);\n  logger.http('[core]', reqOpts.method, url, reqOpts);\n  return fetch(url, reqOpts).then(response => checkResponse(response, reqOpts)).then(response => response.text());\n}\nexport function setUserAgent(newUserAgent) {\n  userAgent = newUserAgent;\n}\nexport default fetchFile;","function fetchId(list, prefix) {\n  let id;\n  while (id === undefined || list.includes(id)) {\n    id = `${prefix}${Math.random().toString().slice(2)}`;\n  }\n  return id;\n}\nexport default fetchId;","class TokenStack {\n  constructor(array) {\n    this.stack = array;\n    this.index = 0;\n    this.current = this.stack[this.index];\n  }\n  static getPatternText(pattern) {\n    return `\"${pattern instanceof RegExp ? pattern.source : pattern}\"`;\n  }\n  static getMatchCallback(pattern) {\n    if (Array.isArray(pattern)) {\n      const matches = pattern.map(TokenStack.getMatchCallback);\n      return token => matches.some(matchCallback => matchCallback(token));\n    } else if (pattern instanceof Function) {\n      return pattern;\n    } else if (pattern instanceof RegExp) {\n      return token => pattern.test(token);\n    } else {\n      return token => pattern === token;\n    }\n  }\n  tokensLeft() {\n    return this.stack.length - this.index;\n  }\n  matches(pattern) {\n    return TokenStack.getMatchCallback(pattern)(this.current, this.index, this.stack);\n  }\n  matchesSequence(sequence) {\n    const part = this.stack.slice(this.index, this.index + sequence.length).join('');\n    return typeof sequence === 'string' ? part === sequence : sequence.every((pattern, index) => TokenStack.getMatchCallback(pattern)(part[index]));\n  }\n  consumeToken(pattern = /^[\\s\\S]$/, {\n    inverse = false,\n    spaced = true\n  } = {}) {\n    if (spaced) {\n      this.consumeWhitespace();\n    }\n    const token = this.current;\n    const match = TokenStack.getMatchCallback(pattern)(token, this.index, this.stack);\n    if (match) {\n      this.current = this.stack[++this.index];\n    } else {\n      throw new SyntaxError(`Unexpected token at index ${this.index}: Expected ${TokenStack.getPatternText(pattern)}, got \"${token}\"`);\n    }\n    if (spaced) {\n      this.consumeWhitespace();\n    }\n    return token;\n  }\n  consumeWhitespace(pattern = /^\\s$/, {\n    optional = true\n  } = {}) {\n    return this.consume(pattern, {\n      min: +!optional\n    });\n  }\n  consumeN(length) {\n    if (this.tokensLeft() < length) {\n      throw new SyntaxError('Not enough tokens left');\n    }\n    const start = this.index;\n    while (length--) {\n      this.current = this.stack[++this.index];\n    }\n    return this.stack.slice(start, this.index).join('');\n  }\n  consumeSequence(sequence) {\n    if (this.matchesSequence(sequence)) {\n      return this.consumeN(sequence.length);\n    } else {\n      throw new SyntaxError(`Expected \"${sequence}\", got \"${this.consumeN(sequence.length)}\"`);\n    }\n  }\n  consume(pattern = /^[\\s\\S]$/, {\n    min = 0,\n    max = Infinity,\n    inverse = false,\n    tokenMap,\n    tokenFilter\n  } = {}) {\n    const start = this.index;\n    const match = TokenStack.getMatchCallback(pattern);\n    while (match(this.current, this.index, this.stack) !== inverse) {\n      this.current = this.stack[++this.index];\n    }\n    let consumed = this.stack.slice(start, this.index);\n    if (consumed.length < min) {\n      throw new SyntaxError(`Not enough ${TokenStack.getPatternText(pattern)}`);\n    } else if (consumed.length > max) {\n      throw new SyntaxError(`Too many ${TokenStack.getPatternText(pattern)}`);\n    }\n    if (tokenMap) {\n      consumed = consumed.map(tokenMap);\n    }\n    if (tokenFilter) {\n      consumed = consumed.filter(tokenFilter);\n    }\n    return consumed.join('');\n  }\n}\nexport default TokenStack;","class Register {\n  constructor(data = {}) {\n    this.data = data;\n  }\n  set(key, value) {\n    this.data[key] = value;\n    return this;\n  }\n  add(...args) {\n    return this.set(...args);\n  }\n  delete(key) {\n    delete this.data[key];\n    return this;\n  }\n  remove(...args) {\n    return this.delete(...args);\n  }\n  get(key) {\n    return this.data[key];\n  }\n  has(key) {\n    return Object.prototype.hasOwnProperty.call(this.data, key);\n  }\n  list() {\n    return Object.keys(this.data);\n  }\n}\nexport default Register;","import { deepCopy } from './deepCopy.js';\nclass Grammar {\n  constructor(rules, state) {\n    this.rules = rules;\n    this.defaultState = state;\n    this.mainRule = Object.keys(rules)[0];\n    this.log = [];\n  }\n  parse(iterator, mainRule) {\n    this.lexer = iterator;\n    this.token = this.lexer.next();\n    this.state = deepCopy(this.defaultState);\n    this.log = [];\n    return this.consumeRule(mainRule || this.mainRule);\n  }\n  matchEndOfFile() {\n    return !this.token;\n  }\n  matchToken(type) {\n    return this.token && type === this.token.type;\n  }\n  consumeToken(type, optional) {\n    const token = this.token;\n    if (!type || token && token.type === type) {\n      this.token = this.lexer.next();\n      return token;\n    } else if (optional) {\n      return undefined;\n    } else {\n      const got = token ? `\"${token.type}\"` : 'EOF';\n      const error = new SyntaxError(this.lexer.formatError(token, `expected \"${type}\", got ${got}`));\n      error.message += ` (${this.log.join('->')})`;\n      throw error;\n    }\n  }\n  consumeRule(rule) {\n    this.log.push(rule);\n    const result = this.rules[rule].call(this);\n    this.log.pop();\n    return result;\n  }\n}\nexport { Grammar };","function createConditionEval(condition) {\n  return function conditionEval(input) {\n    if (typeof condition === 'boolean') {\n      return condition;\n    }\n    return Object.keys(condition).every(prop => {\n      const value = condition[prop];\n      if (value === true) {\n        return prop in input;\n      } else if (value === false) {\n        return !(prop in input);\n      } else if (typeof value === 'function') {\n        return value(input[prop]);\n      } else if (Array.isArray(value)) {\n        return value.includes(input[prop]);\n      } else {\n        return input[prop] === value;\n      }\n    });\n  };\n}\nfunction parsePropStatement(prop, toSource) {\n  let inputProp;\n  let outputProp;\n  let convert;\n  let condition;\n  if (typeof prop === 'string') {\n    inputProp = outputProp = prop;\n  } else if (prop) {\n    inputProp = toSource ? prop.target : prop.source;\n    outputProp = toSource ? prop.source : prop.target;\n    if (prop.convert) {\n      convert = toSource ? prop.convert.toSource : prop.convert.toTarget;\n    }\n    if (prop.when) {\n      condition = toSource ? prop.when.target : prop.when.source;\n      if (condition != null) {\n        condition = createConditionEval(condition);\n      }\n    }\n  } else {\n    return null;\n  }\n  inputProp = [].concat(inputProp).filter(Boolean);\n  outputProp = [].concat(outputProp).filter(Boolean);\n  return {\n    inputProp,\n    outputProp,\n    convert,\n    condition\n  };\n}\nfunction createConverter(props, toSource) {\n  toSource = toSource === Translator.CONVERT_TO_SOURCE;\n  props = props.map(prop => parsePropStatement(prop, toSource)).filter(Boolean);\n  return function converter(input) {\n    const output = {};\n    for (const {\n      inputProp,\n      outputProp,\n      convert,\n      condition\n    } of props) {\n      if (outputProp.length === 0) {\n        continue;\n      } else if (condition && !condition(input)) {\n        continue;\n      } else if (inputProp.length !== 0 && inputProp.every(prop => !(prop in input))) {\n        continue;\n      }\n      let outputData = inputProp.map(prop => input[prop]);\n      if (convert) {\n        try {\n          const converted = convert.apply(input, outputData);\n          outputData = outputProp.length === 1 ? [converted] : converted;\n        } catch (cause) {\n          throw new Error(`Failed to convert ${inputProp} to ${outputProp}`, {\n            cause\n          });\n        }\n      }\n      outputProp.forEach((prop, index) => {\n        const value = outputData[index];\n        if (value !== undefined) {\n          output[prop] = value;\n        }\n      });\n    }\n    return output;\n  };\n}\nclass Translator {\n  constructor(props) {\n    this.convertToSource = createConverter(props, Translator.CONVERT_TO_SOURCE);\n    this.convertToTarget = createConverter(props, Translator.CONVERT_TO_TARGET);\n  }\n}\nTranslator.CONVERT_TO_SOURCE = Symbol('convert to source');\nTranslator.CONVERT_TO_TARGET = Symbol('convert to target');\nexport { Translator };","import { deepCopy, upgradeCsl } from '../../util/index.js';\nimport logger from '../../logger.js';\nimport { get as getTypeInfo } from './register.js';\nimport { type as parseType } from './type.js';\nimport { data as parseData, dataAsync as parseDataAsync } from './data.js';\nimport { applyGraph, removeGraph } from './graph.js';\nfunction prepareParseGraph(graph) {\n  return graph.reduce((array, next) => {\n    const last = array[array.length - 1];\n    if (last && last.type === next.type) {\n      last.count = last.count + 1 || 2;\n    } else {\n      array.push(next);\n    }\n    return array;\n  }, []).map(element => (element.count > 1 ? element.count + 'x ' : '') + element.type).join(' -> ');\n}\nclass ChainParser {\n  constructor(input, options = {}) {\n    this.options = Object.assign({\n      generateGraph: true,\n      forceType: parseType(input),\n      maxChainLength: 10,\n      strict: true,\n      target: '@csl/list+object'\n    }, options);\n    this.type = this.options.forceType;\n    this.data = typeof input === 'object' ? deepCopy(input) : input;\n    this.graph = [{\n      type: this.type,\n      data: input\n    }];\n    this.iteration = 0;\n  }\n  iterate() {\n    if (this.iteration !== 0) {\n      const typeInfo = getTypeInfo(this.type);\n      if (typeInfo && typeInfo.outputs) {\n        this.type = typeInfo.outputs;\n      } else {\n        this.type = parseType(this.data);\n      }\n      this.graph.push({\n        type: this.type\n      });\n    }\n    if (this.error || this.type === this.options.target) {\n      return false;\n    } else if (this.iteration >= this.options.maxChainLength) {\n      this.error = new RangeError(`Max. number of parsing iterations reached (${prepareParseGraph(this.graph)})`);\n      return false;\n    } else {\n      this.iteration++;\n      return true;\n    }\n  }\n  end() {\n    if (this.error) {\n      logger.error('[core]', this.error.message);\n      if (this.options.strict !== false) {\n        throw this.error;\n      } else {\n        return [];\n      }\n    } else if (this.options.target === '@csl/list+object') {\n      return upgradeCsl(this.data).map(this.options.generateGraph ? entry => applyGraph(entry, this.graph) : removeGraph);\n    } else {\n      return this.data;\n    }\n  }\n}\nexport const chain = (...args) => {\n  const chain = new ChainParser(...args);\n  while (chain.iterate()) {\n    try {\n      chain.data = parseData(chain.data, chain.type);\n    } catch (e) {\n      chain.error = e;\n    }\n  }\n  return chain.end();\n};\nexport const chainLink = input => {\n  const type = parseType(input);\n  const output = type.match(/array|object/) ? deepCopy(input) : input;\n  return parseData(output, type);\n};\nexport const chainAsync = async (...args) => {\n  const chain = new ChainParser(...args);\n  while (chain.iterate()) {\n    chain.data = await parseDataAsync(chain.data, chain.type).catch(e => {\n      chain.error = e;\n    });\n  }\n  return chain.end();\n};\nexport const chainLinkAsync = async input => {\n  const type = parseType(input);\n  const output = type.match(/array|object/) ? deepCopy(input) : input;\n  return parseDataAsync(output, type);\n};","import { chain, chainAsync } from './chain.js';\nconst parsers = {};\nconst asyncParsers = {};\nconst nativeParsers = {\n  '@csl/object': input => [input],\n  '@csl/list+object': input => input,\n  '@else/list+object': input => input.map(chain).flat(),\n  '@invalid': () => {\n    throw new Error('This format is not supported or recognized');\n  }\n};\nconst nativeAsyncParsers = {\n  '@else/list+object': async input => (await Promise.all(input.map(chainAsync))).flat()\n};\nexport function data(input, type) {\n  if (typeof parsers[type] === 'function') {\n    return parsers[type](input);\n  } else if (typeof nativeParsers[type] === 'function') {\n    return nativeParsers[type](input);\n  } else {\n    throw new TypeError(`No synchronous parser found for ${type}`);\n  }\n}\nexport async function dataAsync(input, type) {\n  if (typeof asyncParsers[type] === 'function') {\n    return asyncParsers[type](input);\n  } else if (typeof nativeAsyncParsers[type] === 'function') {\n    return nativeAsyncParsers[type](input);\n  } else if (hasDataParser(type, false)) {\n    return data(input, type);\n  } else {\n    throw new TypeError(`No parser found for ${type}`);\n  }\n}\nexport function addDataParser(format, {\n  parser,\n  async\n}) {\n  if (async) {\n    asyncParsers[format] = parser;\n  } else {\n    parsers[format] = parser;\n  }\n}\nexport function hasDataParser(type, async) {\n  return async ? asyncParsers[type] || nativeAsyncParsers[type] : parsers[type] || nativeParsers[type];\n}\nexport function removeDataParser(type, async) {\n  delete (async ? asyncParsers : parsers)[type];\n}\nexport function listDataParser(async) {\n  return Object.keys(async ? asyncParsers : parsers);\n}","import { FormatParser } from './parser.js';\nimport { addTypeParser, removeTypeParser } from './type.js';\nimport { addDataParser, removeDataParser } from './data.js';\nconst formats = {};\nexport function add(format, parsers) {\n  const formatParser = new FormatParser(format, parsers);\n  formatParser.validate();\n  const index = formats[format] || (formats[format] = {});\n  if (formatParser.typeParser) {\n    addTypeParser(format, formatParser.typeParser);\n    index.type = true;\n  }\n  if (formatParser.dataParser) {\n    addDataParser(format, formatParser.dataParser);\n    index.data = true;\n  }\n  if (formatParser.asyncDataParser) {\n    addDataParser(format, formatParser.asyncDataParser);\n    index.asyncData = true;\n  }\n  if (parsers.outputs) {\n    index.outputs = parsers.outputs;\n  }\n}\nexport function get(format) {\n  return formats[format];\n}\nexport function remove(format) {\n  const index = formats[format];\n  if (!index) {\n    return;\n  }\n  if (index.type) {\n    removeTypeParser(format);\n  }\n  if (index.data) {\n    removeDataParser(format);\n  }\n  if (index.asyncData) {\n    removeDataParser(format, true);\n  }\n  delete formats[format];\n}\nexport function has(format) {\n  return format in formats;\n}\nexport function list() {\n  return Object.keys(formats);\n}","import * as dataType from './dataType.js';\nimport * as graph from './graph.js';\nimport * as parser from './parser.js';\nimport * as csl from './csl.js';\nexport const util = Object.assign({}, dataType, graph, parser, csl);\nexport * from './register';\nexport * from './chain';\nexport * from './type';\nexport * from './data';","import { chain as parseInput, chainAsync as parseInputAsync } from '../plugins/input/index.js';\nimport fetchId from '../util/fetchId.js';\nfunction add(data, options = {}, log = false) {\n  if (options === true || log === true) {\n    this.save();\n  }\n  this.data.push(...parseInput(data, options));\n  this.data.filter(entry => !Object.prototype.hasOwnProperty.call(entry, 'id')).forEach(entry => {\n    entry.id = fetchId(this.getIds(), 'temp_id_');\n  });\n  return this;\n}\nasync function addAsync(data, options = {}, log = false) {\n  if (options === true || log === true) {\n    this.save();\n  }\n  this.data.push(...(await parseInputAsync(data, options)));\n  this.data.filter(entry => !Object.prototype.hasOwnProperty.call(entry, 'id')).forEach(entry => {\n    entry.id = fetchId(this.getIds(), 'temp_id_');\n  });\n  return this;\n}\nfunction set(data, options = {}, log = false) {\n  if (options === true || log === true) {\n    this.save();\n  }\n  this.data = [];\n  return typeof options !== 'boolean' ? this.add(data, options) : this.add(data);\n}\nasync function setAsync(data, options = {}, log = false) {\n  if (options === true || log === true) {\n    this.save();\n  }\n  this.data = [];\n  return typeof options !== 'boolean' ? this.addAsync(data, options) : this.addAsync(data);\n}\nfunction reset(log) {\n  if (log) {\n    this.save();\n  }\n  this.data = [];\n  this._options = {};\n  return this;\n}\nexport { add, addAsync, set, setAsync, reset };","function getLabel(entry) {\n  if ('citation-label' in entry) {\n    return entry['citation-label'];\n  }\n  let res = '';\n  if (entry.author) {\n    res += entry.author[0].family || entry.author[0].literal;\n  }\n  if (entry.issued && entry.issued['date-parts'] && entry.issued['date-parts'][0]) {\n    res += entry.issued['date-parts'][0][0];\n  }\n  if (entry['year-suffix']) {\n    res += entry['year-suffix'];\n  } else if (entry.title) {\n    res += entry.title.replace(/<\\/?.*?>/g, '').match(/^(?:(?:the|a|an)\\s+)?(\\S+)/i)[1];\n  }\n  return res;\n}\nexport { getLabel };\nexport default {\n  label(data) {\n    return data.reduce((object, entry) => {\n      object[entry.id] = getLabel(entry);\n      return object;\n    }, {});\n  }\n};","import { getLabel } from '../plugin-common/output/label.js';\nimport { format as getName } from '@citation-js/name';\nfunction getComparisonValue(obj, prop, label = prop === 'label') {\n  let value = label ? getLabel(obj) : obj[prop];\n  switch (prop) {\n    case 'author':\n    case 'editor':\n      return value.map(name => name.literal || name.family || getName(name));\n    case 'accessed':\n    case 'issued':\n      return value['date-parts'][0];\n    case 'page':\n      return value.split('-').map(num => parseInt(num));\n    case 'edition':\n    case 'issue':\n    case 'volume':\n      value = parseInt(value);\n      return !isNaN(value) ? value : -Infinity;\n    default:\n      return value || -Infinity;\n  }\n}\nfunction compareProp(entryA, entryB, prop, flip = /^!/.test(prop)) {\n  prop = prop.replace(/^!/, '');\n  const a = getComparisonValue(entryA, prop);\n  const b = getComparisonValue(entryB, prop);\n  return (flip ? -1 : 1) * (a > b ? 1 : a < b ? -1 : 0);\n}\nfunction getSortCallback(...props) {\n  return (a, b) => {\n    const keys = props.slice();\n    let output = 0;\n    while (!output && keys.length) {\n      output = compareProp(a, b, keys.shift());\n    }\n    return output;\n  };\n}\nfunction sort(method = [], log) {\n  if (log) {\n    this.save();\n  }\n  this.data.sort(typeof method === 'function' ? method : getSortCallback(...method, 'label'));\n  return this;\n}\nexport { sort };","import Register from '../util/register.js';\nfunction validate(name, formatter) {\n  if (typeof name !== 'string') {\n    throw new TypeError(`Invalid output format name, expected string, got ${typeof name}`);\n  } else if (typeof formatter !== 'function') {\n    throw new TypeError(`Invalid formatter, expected function, got ${typeof formatter}`);\n  }\n}\nexport const register = new Register();\nexport function add(name, formatter) {\n  validate(name, formatter);\n  register.set(name, formatter);\n}\nexport function remove(name) {\n  register.remove(name);\n}\nexport function has(name) {\n  return register.has(name);\n}\nexport function list() {\n  return register.list();\n}\nexport function format(name, data, ...options) {\n  if (!register.has(name)) {\n    throw new Error(`Output format \"${name}\" unavailable`);\n  }\n  return register.get(name)(data, ...options);\n}","import { validateOutputOptions as validate } from './validate.js';\nimport { format as formatData } from '../plugins/output.js';\nimport { clean as parseCsl } from '../plugins/input/csl.js';\nexport function getIds() {\n  return this.data.map(entry => entry.id);\n}\nexport function format(format, ...options) {\n  return formatData(format, parseCsl(this.data), ...options);\n}\nexport function get(options = {}) {\n  validate(options);\n  const parsedOptions = Object.assign({}, this.defaultOptions, this._options.output, options);\n  const {\n    type,\n    style\n  } = parsedOptions;\n  const [styleType, styleFormat] = style.split('-');\n  const newStyle = styleType === 'citation' ? 'bibliography' : styleType === 'csl' ? 'data' : styleType;\n  const newType = type === 'string' ? 'text' : type === 'json' ? 'object' : type;\n  let formatOptions;\n  switch (newStyle) {\n    case 'bibliography':\n      {\n        const {\n          lang,\n          append,\n          prepend\n        } = parsedOptions;\n        formatOptions = {\n          template: styleFormat,\n          lang,\n          format: newType,\n          append,\n          prepend\n        };\n        break;\n      }\n    case 'data':\n    case 'bibtex':\n    case 'bibtxt':\n    case 'ndjson':\n    case 'ris':\n      formatOptions = {\n        type: newType\n      };\n      break;\n    default:\n      throw new Error(`Invalid style \"${newStyle}\"`);\n  }\n  const result = this.format(newStyle, Object.assign(formatOptions, options._newOptions));\n  const {\n    format\n  } = parsedOptions;\n  if (format === 'real' && newType === 'html' && typeof document !== 'undefined' && typeof document.createElement === 'function') {\n    const tmp = document.createElement('div');\n    tmp.innerHTML = result;\n    return tmp.firstChild;\n  } else if (format === 'string' && typeof result === 'object') {\n    return JSON.stringify(result);\n  } else {\n    return result;\n  }\n}","function async(data, options, callback) {\n  if (typeof options === 'function' && !callback) {\n    callback = options;\n    options = undefined;\n  }\n  const promise = new this().setAsync(data, options);\n  if (typeof callback === 'function') {\n    promise.then(callback);\n    return undefined;\n  } else {\n    return promise;\n  }\n}\nexport default async;","import * as log from './log.js';\nimport * as options from './options.js';\nimport * as set from './set.js';\nimport * as sort from './sort.js';\nimport * as get from './get.js';\nimport * as staticMethods from './static.js';\nfunction Cite(data, options = {}) {\n  if (!(this instanceof Cite)) {\n    return new Cite(data, options);\n  }\n  this._options = options;\n  this.log = [];\n  this.data = [];\n  this.set(data, options);\n  this.options(options);\n  return this;\n}\nObject.assign(Cite.prototype, log, options, set, sort, get);\nCite.prototype[Symbol.iterator] = function* () {\n  yield* this.data;\n};\nObject.assign(Cite, staticMethods);\nexport default Cite;","import Register from '../util/register.js';\nfunction validate(name, dict) {\n  if (typeof name !== 'string') {\n    throw new TypeError(`Invalid dict name, expected string, got ${typeof name}`);\n  } else if (typeof dict !== 'object') {\n    throw new TypeError(`Invalid dict, expected object, got ${typeof dict}`);\n  }\n  for (const entryName in dict) {\n    const entry = dict[entryName];\n    if (!Array.isArray(entry) || entry.some(part => typeof part !== 'string')) {\n      throw new TypeError(`Invalid dict entry \"${entryName}\", expected array of strings`);\n    }\n  }\n}\nexport const register = new Register({\n  html: {\n    bibliographyContainer: ['<div class=\"csl-bib-body\">', '</div>'],\n    entry: ['<div class=\"csl-entry\">', '</div>'],\n    list: ['<ul style=\"list-style-type:none\">', '</ul>'],\n    listItem: ['<li>', '</li>']\n  },\n  text: {\n    bibliographyContainer: ['', '\\n'],\n    entry: ['', '\\n'],\n    list: ['\\n', ''],\n    listItem: ['\\t', '\\n']\n  }\n});\nexport function add(name, dict) {\n  validate(name, dict);\n  register.set(name, dict);\n}\nexport function remove(name) {\n  register.remove(name);\n}\nexport function has(name) {\n  return register.has(name);\n}\nexport function list() {\n  return register.list();\n}\nexport function get(name) {\n  if (!register.has(name)) {\n    throw new Error(`Dict \"${name}\" unavailable`);\n  }\n  return register.get(name);\n}\nexport const htmlDict = {\n  wr_start: '<div class=\"csl-bib-body\">',\n  wr_end: '</div>',\n  en_start: '<div class=\"csl-entry\">',\n  en_end: '</div>',\n  ul_start: '<ul style=\"list-style-type:none\">',\n  ul_end: '</ul>',\n  li_start: '<li>',\n  li_end: '</li>'\n};\nexport const textDict = {\n  wr_start: '',\n  wr_end: '\\n',\n  en_start: '',\n  en_end: '\\n',\n  ul_start: '\\n',\n  ul_end: '',\n  li_start: '\\t',\n  li_end: '\\n'\n};","const configs = {};\nexport function add(ref, config) {\n  configs[ref] = config;\n}\nexport function get(ref) {\n  return configs[ref];\n}\nexport function has(ref) {\n  return Object.prototype.hasOwnProperty.call(configs, ref);\n}\nexport function remove(ref) {\n  delete configs[ref];\n}\nexport function list() {\n  return Object.keys(configs);\n}","import * as input from './input/index.js';\nimport * as output from './output.js';\nimport * as dict from './dict.js';\nimport * as config from './config.js';\nconst registers = {\n  input,\n  output,\n  dict,\n  config\n};\nconst indices = {};\nexport function add(ref, plugins = {}) {\n  const mainIndex = indices[ref] = {};\n  for (const type in plugins) {\n    if (type === 'config') {\n      mainIndex.config = {\n        [ref]: plugins.config\n      };\n      registers.config.add(ref, plugins.config);\n      continue;\n    }\n    const typeIndex = mainIndex[type] = {};\n    const typePlugins = plugins[type];\n    for (const name in typePlugins) {\n      const typePlugin = typePlugins[name];\n      typeIndex[name] = true;\n      registers[type].add(name, typePlugin);\n    }\n  }\n}\nexport function remove(ref) {\n  const mainIndex = indices[ref];\n  for (const type in mainIndex) {\n    const typeIndex = mainIndex[type];\n    for (const name in typeIndex) {\n      registers[type].remove(name);\n    }\n  }\n  delete indices[ref];\n}\nexport function has(ref) {\n  return ref in indices;\n}\nexport function list() {\n  return Object.keys(indices);\n}\nexport { input, output, dict, config };","export function parse() {\n  return [];\n}","import logger from '../../logger.js';\nconst substituters = [[/((?:\\[|:|,)\\s*)'((?:\\\\'|[^'])*?[^\\\\])?'(?=\\s*(?:\\]|}|,))/g, '$1\"$2\"'], [/((?:(?:\"|]|}|\\/[gmiuys]|\\.|(?:\\d|\\.|-)*\\d)\\s*,|{)\\s*)(?:\"([^\":\\n]+?)\"|'([^\":\\n]+?)'|([^\":\\n]+?))(\\s*):/g, '$1\"$2$3$4\"$5:']];\nfunction parseJSON(str) {\n  if (typeof str !== 'string') {\n    return JSON.parse(str);\n  }\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    logger.debug('[plugin-common]', 'Invalid JSON, switching to experimental parser');\n    substituters.forEach(([regex, subst]) => {\n      str = str.replace(regex, subst);\n    });\n    return JSON.parse(str);\n  }\n}\nexport { parseJSON as parse, parseJSON as default };","export function parse(input) {\n  return input.val() || input.text() || input.html();\n}","export function parse(input) {\n  return input.value || input.textContent;\n}","import * as plugins from '../../plugins/index.js';\nimport * as util from '../../util/index.js';\nimport logger from '../../logger.js';\nfunction appendCommas(string, index, array) {\n  return string + (index < array.length - 1 ? ',' : '');\n}\nfunction getJsonObject(src, dict) {\n  const isArray = Array.isArray(src);\n  let entries;\n  if (isArray) {\n    entries = src.map(entry => getJsonValue(entry, dict));\n  } else {\n    entries = Object.keys(src).filter(prop => JSON.stringify(src[prop])).map(prop => `\"${prop}\": ${getJsonValue(src[prop], dict)}`);\n  }\n  entries = entries.map(appendCommas).map(entry => dict.listItem.join(entry));\n  entries = dict.list.join(entries.join(''));\n  return isArray ? `[${entries}]` : `{${entries}}`;\n}\nfunction getJsonValue(src, dict) {\n  if (typeof src === 'object' && src !== null) {\n    if (src.length === 0) {\n      return '[]';\n    } else if (Object.keys(src).length === 0) {\n      return '{}';\n    } else {\n      return getJsonObject(src, dict);\n    }\n  } else {\n    return JSON.stringify(src);\n  }\n}\nfunction getJson(src, dict) {\n  let entries = src.map(entry => getJsonObject(entry, dict));\n  entries = entries.map(appendCommas).map(entry => dict.entry.join(entry));\n  entries = entries.join('');\n  return dict.bibliographyContainer.join(`[${entries}]`);\n}\nexport function getJsonWrapper(src) {\n  return getJson(src, plugins.dict.get('html'));\n}\nexport default {\n  data(data, {\n    type,\n    format = type || 'text',\n    version = '1.0.2'\n  } = {}) {\n    if (version < '1.0.2') {\n      data = util.downgradeCsl(data);\n    }\n    if (format === 'object') {\n      return util.deepCopy(data);\n    } else if (format === 'text') {\n      return JSON.stringify(data, null, 2);\n    } else {\n      logger.warn('[core]', 'This feature (JSON output with special formatting) is unstable. See https://github.com/larsgw/citation.js/issues/144');\n      return getJson(data, plugins.dict.get(format));\n    }\n  },\n  ndjson(data, {\n    version = '1.0.2'\n  } = {}) {\n    if (version < '1.0.2') {\n      data = util.downgradeCsl(data);\n    }\n    return data.map(entry => JSON.stringify(entry)).join('\\n');\n  }\n};","import * as plugins from '../plugins';\nimport { ref, formats as input } from './input/';\nimport output from './output/';\nplugins.add(ref, {\n  input,\n  output\n});","import * as empty from './empty.js';\nimport * as json from './json.js';\nimport * as jquery from './jquery.js';\nimport * as html from './html.js';\nexport const ref = '@else';\nexport const parsers = {\n  empty,\n  json,\n  jquery,\n  html\n};\nexport const formats = {\n  '@empty/text': {\n    parse: empty.parse,\n    parseType: {\n      dataType: 'String',\n      predicate: input => input === ''\n    }\n  },\n  '@empty/whitespace+text': {\n    parse: empty.parse,\n    parseType: {\n      dataType: 'String',\n      predicate: /^\\s+$/\n    }\n  },\n  '@empty': {\n    parse: empty.parse,\n    parseType: {\n      dataType: 'Primitive',\n      predicate: input => input == null\n    }\n  },\n  '@else/json': {\n    parse: json.parse,\n    parseType: {\n      dataType: 'String',\n      predicate: /^\\s*(\\{[\\S\\s]*\\}|\\[[\\S\\s]*\\])\\s*$/\n    }\n  },\n  '@else/url': {\n    parseType: {\n      dataType: 'String',\n      predicate: /^https?:\\/\\/(([\\w-]+\\.)*[\\w-]+)(:\\d+)?(\\/[^?/]*)*(\\?[^#]*)?(#.*)?$/i\n    }\n  },\n  '@else/jquery': {\n    parse: jquery.parse,\n    parseType: {\n      dataType: 'ComplexObject',\n      predicate(input) {\n        return typeof jQuery !== 'undefined' && input instanceof jQuery;\n      }\n    }\n  },\n  '@else/html': {\n    parse: html.parse,\n    parseType: {\n      dataType: 'ComplexObject',\n      predicate(input) {\n        return typeof HTMLElement !== 'undefined' && input instanceof HTMLElement;\n      }\n    }\n  }\n};","import json from './json.js';\nimport label from './label.js';\nexport default Object.assign({}, json, label);","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"format\", {\n  enumerable: true,\n  get: function get() {\n    return _output.default;\n  }\n});\nObject.defineProperty(exports, \"parse\", {\n  enumerable: true,\n  get: function get() {\n    return _input.default;\n  }\n});\n\nvar _input = _interopRequireDefault(require(\"./input\"));\n\nvar _output = _interopRequireDefault(require(\"./output\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nconst monthMap = {\n  jan: 1,\n  feb: 2,\n  mar: 3,\n  apr: 4,\n  may: 5,\n  jun: 6,\n  jul: 7,\n  aug: 8,\n  sep: 9,\n  oct: 10,\n  nov: 11,\n  dec: 12\n};\nconst dateRangeDelimiters = / (?:to|[-/]) | ?(?:--|[]) ?/;\nconst dateRangePattern = /^(\\d{4}-\\d{2}-\\d{2})\\/(\\d{4}-\\d{2}-\\d{2})$/;\n\nfunction getMonth(monthName) {\n  return monthMap[monthName.toLowerCase().slice(0, 3)];\n}\n\nfunction parseEpoch(date) {\n  const epoch = new Date(date);\n\n  if (typeof date === 'number' && !isNaN(epoch.valueOf())) {\n    return [epoch.getFullYear(), epoch.getMonth() + 1, epoch.getDate()];\n  } else {\n    return null;\n  }\n}\n\nconst parseIso8601 = function parseIso8601(date) {\n  const pattern = /^(\\d{4}|[-+]\\d{6,})-(\\d{2})(?:-(\\d{2}))?/;\n\n  if (typeof date !== 'string' || !pattern.test(date)) {\n    return null;\n  }\n\n  const _date$match = date.match(pattern),\n        _date$match2 = _slicedToArray(_date$match, 4),\n        year = _date$match2[1],\n        month = _date$match2[2],\n        day = _date$match2[3];\n\n  if (!+month) {\n    return [year];\n  } else if (!+day) {\n    return [year, month];\n  } else {\n    return [year, month, day];\n  }\n};\n\nconst parseRfc2822 = function parseRfc2822(date) {\n  const pattern = /^(?:[a-z]{3},\\s*)?(\\d{1,2}) ([a-z]{3}) (\\d{4,})/i;\n\n  if (typeof date !== 'string' || !pattern.test(date)) {\n    return null;\n  }\n\n  let _date$match3 = date.match(pattern),\n      _date$match4 = _slicedToArray(_date$match3, 4),\n      day = _date$match4[1],\n      month = _date$match4[2],\n      year = _date$match4[3];\n\n  month = getMonth(month);\n\n  if (!month) {\n    return null;\n  }\n\n  return [year, month, day];\n};\n\nfunction parseAmericanDay(date) {\n  const pattern = /^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2}(?:\\d{2})?)/;\n\n  if (typeof date !== 'string' || !pattern.test(date)) {\n    return null;\n  }\n\n  const _date$match5 = date.match(pattern),\n        _date$match6 = _slicedToArray(_date$match5, 4),\n        month = _date$match6[1],\n        day = _date$match6[2],\n        year = _date$match6[3];\n\n  const check = new Date(year, month, day);\n\n  if (check.getMonth() === parseInt(month)) {\n    return [year, month, day];\n  } else {\n    return null;\n  }\n}\n\nfunction parseDay(date) {\n  const pattern = /^(\\d{1,2})[ .\\-/](\\d{1,2}|[a-z]{3,10})[ .\\-/](-?\\d+)/i;\n  const reversePattern = /^(-?\\d+)[ .\\-/](\\d{1,2}|[a-z]{3,10})[ .\\-/](\\d{1,2})/i;\n  let year;\n  let month;\n  let day;\n\n  if (typeof date !== 'string') {\n    return null;\n  } else if (pattern.test(date)) {\n    var _date$match7 = date.match(pattern);\n\n    var _date$match8 = _slicedToArray(_date$match7, 4);\n\n    day = _date$match8[1];\n    month = _date$match8[2];\n    year = _date$match8[3];\n  } else if (reversePattern.test(date)) {\n    var _date$match9 = date.match(reversePattern);\n\n    var _date$match10 = _slicedToArray(_date$match9, 4);\n\n    year = _date$match10[1];\n    month = _date$match10[2];\n    day = _date$match10[3];\n  } else {\n    return null;\n  }\n\n  if (getMonth(month)) {\n    month = getMonth(month);\n  } else if (isNaN(month)) {\n    return null;\n  }\n\n  return [year, month, day];\n}\n\nfunction parseMonth(date) {\n  const pattern = /^([a-z]{3,10}|-?\\d+)[^\\w-]+([a-z]{3,10}|-?\\d+)$/i;\n\n  if (typeof date === 'string' && pattern.test(date)) {\n    const values = date.match(pattern).slice(1, 3);\n    let month;\n\n    if (getMonth(values[1])) {\n      month = getMonth(values.pop());\n    } else if (getMonth(values[0])) {\n      month = getMonth(values.shift());\n    } else if (values.some(isNaN) || values.every(value => +value < 0)) {\n      return null;\n    } else if (+values[0] < 0) {\n      month = values.pop();\n    } else if (+values[0] > +values[1] && +values[1] > 0) {\n      month = values.pop();\n    } else {\n      month = values.shift();\n    }\n\n    const year = values.pop();\n    return [year, month];\n  } else {\n    return null;\n  }\n}\n\nfunction parseYear(date) {\n  if (typeof date !== 'string') {\n    return null;\n  }\n\n  const adBc = date.match(/^(\\d+) ?(a\\.?d\\.?|b\\.?c\\.?)$/i);\n\n  if (adBc) {\n    const _adBc$slice = adBc.slice(1),\n          _adBc$slice2 = _slicedToArray(_adBc$slice, 2),\n          date = _adBc$slice2[0],\n          suffix = _adBc$slice2[1];\n\n    return [date * (suffix.toLowerCase()[0] === 'a' ? 1 : -1)];\n  } else if (/^-?\\d+$/.test(date)) {\n    return [date];\n  } else {\n    return null;\n  }\n}\n\nfunction parseDateParts(value) {\n  const dateParts = parseEpoch(value) || parseIso8601(value) || parseRfc2822(value) || parseAmericanDay(value) || parseDay(value) || parseMonth(value) || parseYear(value);\n  return dateParts && dateParts.map(string => parseInt(string));\n}\n\nfunction splitDateRange(range) {\n  if (dateRangePattern.test(range)) {\n    return range.match(dateRangePattern).slice(1, 3);\n  } else {\n    return range.split(dateRangeDelimiters);\n  }\n}\n\nfunction parseDate(rangeStart, rangeEnd) {\n  const range = [];\n  const rangeStartAsRange = typeof rangeStart === 'string' && splitDateRange(rangeStart);\n\n  if (rangeEnd) {\n    range.push(rangeStart, rangeEnd);\n  } else if (rangeStartAsRange && rangeStartAsRange.length === 2) {\n    range.push(...rangeStartAsRange);\n  } else {\n    range.push(rangeStart);\n  }\n\n  const dateParts = range.map(parseDateParts);\n\n  if (dateParts.filter(Boolean).length === range.length) {\n    return {\n      'date-parts': dateParts\n    };\n  } else {\n    return {\n      raw: rangeEnd ? range.join('/') : rangeStart\n    };\n  }\n}\n\nvar _default = parseDate;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nfunction padStart(str, len, chr) {\n  if (str.length >= len) {\n    return str;\n  }\n\n  while (str.length < len) {\n    str = chr + str;\n  }\n\n  return str.slice(-len);\n}\n\nconst getDate = function getDate(date, delimiter = '-') {\n  if (!date['date-parts']) {\n    return date.raw;\n  }\n\n  const dateParts = date['date-parts'][0].map(part => part.toString());\n\n  switch (dateParts.length) {\n    case 3:\n      dateParts[2] = padStart(dateParts[2], 2, '0');\n\n    case 2:\n      dateParts[1] = padStart(dateParts[1], 2, '0');\n\n    case 1:\n      dateParts[0] = padStart(dateParts[0], 4, '0');\n      break;\n  }\n\n  return dateParts.join(delimiter);\n};\n\nvar _default = getDate;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"parse\", {\n  enumerable: true,\n  get: function get() {\n    return _input.default;\n  }\n});\nObject.defineProperty(exports, \"format\", {\n  enumerable: true,\n  get: function get() {\n    return _output.default;\n  }\n});\n\nvar _input = _interopRequireDefault(require(\"./input\"));\n\nvar _output = _interopRequireDefault(require(\"./output\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.parse = exports.types = exports.scope = void 0;\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nconst punctutationMatcher = string => string.replace(/$|( )|(?!^)(?=[A-Z])/g, '\\\\.?$1');\n\nconst getListMatcher = list => `(?:${list.join('|')})\\\\b`;\n\nconst getSplittingRegex = (matcher, flags) => new RegExp(`(?:^| )(${matcher}$)`, flags);\n\nconst titles = ['mr', 'mrs', 'ms', 'miss', 'dr', 'herr', 'monsieur', 'hr', 'frau', 'a v m', 'admiraal', 'admiral', 'air cdre', 'air commodore', 'air marshal', 'air vice marshal', 'alderman', 'alhaji', 'ambassador', 'baron', 'barones', 'brig', 'brig gen', 'brig general', 'brigadier', 'brigadier general', 'brother', 'canon', 'capt', 'captain', 'cardinal', 'cdr', 'chief', 'cik', 'cmdr', 'coach', 'col', 'col dr', 'colonel', 'commandant', 'commander', 'commissioner', 'commodore', 'comte', 'comtessa', 'congressman', 'conseiller', 'consul', 'conte', 'contessa', 'corporal', 'councillor', 'count', 'countess', 'crown prince', 'crown princess', 'dame', 'datin', 'dato', 'datuk', 'datuk seri', 'deacon', 'deaconess', 'dean', 'dhr', 'dipl ing', 'doctor', 'dott', 'dott sa', 'dr', 'dr ing', 'dra', 'drs', 'embajador', 'embajadora', 'en', 'encik', 'eng', 'eur ing', 'exma sra', 'exmo sr', 'f o', 'father', 'first lieutient', 'first officer', 'flt lieut', 'flying officer', 'fr', 'frau', 'fraulein', 'fru', 'gen', 'generaal', 'general', 'governor', 'graaf', 'gravin', 'group captain', 'grp capt', 'h e dr', 'h h', 'h m', 'h r h', 'hajah', 'haji', 'hajim', 'her highness', 'her majesty', 'herr', 'high chief', 'his highness', 'his holiness', 'his majesty', 'hon', 'hr', 'hra', 'ing', 'ir', 'jonkheer', 'judge', 'justice', 'khun ying', 'kolonel', 'lady', 'lcda', 'lic', 'lieut', 'lieut cdr', 'lieut col', 'lieut gen', 'lord', 'm', 'm l', 'm r', 'madame', 'mademoiselle', 'maj gen', 'major', 'master', 'mevrouw', 'miss', 'mlle', 'mme', 'monsieur', 'monsignor', 'mr', 'mrs', 'ms', 'mstr', 'nti', 'pastor', 'president', 'prince', 'princess', 'princesse', 'prinses', 'prof', 'prof dr', 'prof sir', 'professor', 'puan', 'puan sri', 'rabbi', 'rear admiral', 'rev', 'rev canon', 'rev dr', 'rev mother', 'reverend', 'rva', 'senator', 'sergeant', 'sheikh', 'sheikha', 'sig', 'sig na', 'sig ra', 'sir', 'sister', 'sqn ldr', 'sr', 'sr d', 'sra', 'srta', 'sultan', 'tan sri', 'tan sri dato', 'tengku', 'teuku', 'than puying', 'the hon dr', 'the hon justice', 'the hon miss', 'the hon mr', 'the hon mrs', 'the hon ms', 'the hon sir', 'the very rev', 'toh puan', 'tun', 'vice admiral', 'viscount', 'viscountess', 'wg cdr'];\nconst suffixes = ['I', 'II', 'III', 'IV', 'V', 'Senior', 'Junior', 'Jr', 'Sr', 'PhD', 'Ph\\\\.D', 'APR', 'RPh', 'PE', 'MD', 'MA', 'DMD', 'CME', 'BVM', 'CFRE', 'CLU', 'CPA', 'CSC', 'CSJ', 'DC', 'DD', 'DDS', 'DO', 'DVM', 'EdD', 'Esq', 'JD', 'LLD', 'OD', 'OSB', 'PC', 'Ret', 'RGS', 'RN', 'RNC', 'SHCJ', 'SJ', 'SNJM', 'SSMO', 'USA', 'USAF', 'USAFR', 'USAR', 'USCG', 'USMC', 'USMCR', 'USN', 'USNR'];\nconst particles = ['Vere', 'Von', 'Van', 'De', 'Del', 'Della', 'Di', 'Da', 'Pietro', 'Vanden', 'Du', 'St.', 'St', 'La', 'Lo', 'Ter', 'O', 'O\\'', 'Mac', 'Fitz'];\nconst titleMatcher = getListMatcher(titles.map(punctutationMatcher));\nconst suffixMatcher = getListMatcher(suffixes.map(punctutationMatcher));\nconst particleMatcher = getListMatcher(particles);\nconst titleSplitter = new RegExp(`^((?:${titleMatcher} )*)(.*)$`, 'i');\nconst suffixSplitter = getSplittingRegex(`(?:${suffixMatcher}, )*(?:${suffixMatcher})`, 'i');\nconst particleSplitter = getSplittingRegex(`${/(?:[A-Z\\xC0-\\xD6\\xD8-\\xDE\\u0100\\u0102\\u0104\\u0106\\u0108\\u010A\\u010C\\u010E\\u0110\\u0112\\u0114\\u0116\\u0118\\u011A\\u011C\\u011E\\u0120\\u0122\\u0124\\u0126\\u0128\\u012A\\u012C\\u012E\\u0130\\u0132\\u0134\\u0136\\u0139\\u013B\\u013D\\u013F\\u0141\\u0143\\u0145\\u0147\\u014A\\u014C\\u014E\\u0150\\u0152\\u0154\\u0156\\u0158\\u015A\\u015C\\u015E\\u0160\\u0162\\u0164\\u0166\\u0168\\u016A\\u016C\\u016E\\u0170\\u0172\\u0174\\u0176\\u0178\\u0179\\u017B\\u017D\\u0181\\u0182\\u0184\\u0186\\u0187\\u0189-\\u018B\\u018E-\\u0191\\u0193\\u0194\\u0196-\\u0198\\u019C\\u019D\\u019F\\u01A0\\u01A2\\u01A4\\u01A6\\u01A7\\u01A9\\u01AC\\u01AE\\u01AF\\u01B1-\\u01B3\\u01B5\\u01B7\\u01B8\\u01BC\\u01C4\\u01C7\\u01CA\\u01CD\\u01CF\\u01D1\\u01D3\\u01D5\\u01D7\\u01D9\\u01DB\\u01DE\\u01E0\\u01E2\\u01E4\\u01E6\\u01E8\\u01EA\\u01EC\\u01EE\\u01F1\\u01F4\\u01F6-\\u01F8\\u01FA\\u01FC\\u01FE\\u0200\\u0202\\u0204\\u0206\\u0208\\u020A\\u020C\\u020E\\u0210\\u0212\\u0214\\u0216\\u0218\\u021A\\u021C\\u021E\\u0220\\u0222\\u0224\\u0226\\u0228\\u022A\\u022C\\u022E\\u0230\\u0232\\u023A\\u023B\\u023D\\u023E\\u0241\\u0243-\\u0246\\u0248\\u024A\\u024C\\u024E\\u0370\\u0372\\u0376\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E\\u038F\\u0391-\\u03A1\\u03A3-\\u03AB\\u03CF\\u03D2-\\u03D4\\u03D8\\u03DA\\u03DC\\u03DE\\u03E0\\u03E2\\u03E4\\u03E6\\u03E8\\u03EA\\u03EC\\u03EE\\u03F4\\u03F7\\u03F9\\u03FA\\u03FD-\\u042F\\u0460\\u0462\\u0464\\u0466\\u0468\\u046A\\u046C\\u046E\\u0470\\u0472\\u0474\\u0476\\u0478\\u047A\\u047C\\u047E\\u0480\\u048A\\u048C\\u048E\\u0490\\u0492\\u0494\\u0496\\u0498\\u049A\\u049C\\u049E\\u04A0\\u04A2\\u04A4\\u04A6\\u04A8\\u04AA\\u04AC\\u04AE\\u04B0\\u04B2\\u04B4\\u04B6\\u04B8\\u04BA\\u04BC\\u04BE\\u04C0\\u04C1\\u04C3\\u04C5\\u04C7\\u04C9\\u04CB\\u04CD\\u04D0\\u04D2\\u04D4\\u04D6\\u04D8\\u04DA\\u04DC\\u04DE\\u04E0\\u04E2\\u04E4\\u04E6\\u04E8\\u04EA\\u04EC\\u04EE\\u04F0\\u04F2\\u04F4\\u04F6\\u04F8\\u04FA\\u04FC\\u04FE\\u0500\\u0502\\u0504\\u0506\\u0508\\u050A\\u050C\\u050E\\u0510\\u0512\\u0514\\u0516\\u0518\\u051A\\u051C\\u051E\\u0520\\u0522\\u0524\\u0526\\u0528\\u052A\\u052C\\u052E\\u0531-\\u0556\\u10A0-\\u10C5\\u10C7\\u10CD\\u13A0-\\u13F5\\u1C90-\\u1CBA\\u1CBD-\\u1CBF\\u1E00\\u1E02\\u1E04\\u1E06\\u1E08\\u1E0A\\u1E0C\\u1E0E\\u1E10\\u1E12\\u1E14\\u1E16\\u1E18\\u1E1A\\u1E1C\\u1E1E\\u1E20\\u1E22\\u1E24\\u1E26\\u1E28\\u1E2A\\u1E2C\\u1E2E\\u1E30\\u1E32\\u1E34\\u1E36\\u1E38\\u1E3A\\u1E3C\\u1E3E\\u1E40\\u1E42\\u1E44\\u1E46\\u1E48\\u1E4A\\u1E4C\\u1E4E\\u1E50\\u1E52\\u1E54\\u1E56\\u1E58\\u1E5A\\u1E5C\\u1E5E\\u1E60\\u1E62\\u1E64\\u1E66\\u1E68\\u1E6A\\u1E6C\\u1E6E\\u1E70\\u1E72\\u1E74\\u1E76\\u1E78\\u1E7A\\u1E7C\\u1E7E\\u1E80\\u1E82\\u1E84\\u1E86\\u1E88\\u1E8A\\u1E8C\\u1E8E\\u1E90\\u1E92\\u1E94\\u1E9E\\u1EA0\\u1EA2\\u1EA4\\u1EA6\\u1EA8\\u1EAA\\u1EAC\\u1EAE\\u1EB0\\u1EB2\\u1EB4\\u1EB6\\u1EB8\\u1EBA\\u1EBC\\u1EBE\\u1EC0\\u1EC2\\u1EC4\\u1EC6\\u1EC8\\u1ECA\\u1ECC\\u1ECE\\u1ED0\\u1ED2\\u1ED4\\u1ED6\\u1ED8\\u1EDA\\u1EDC\\u1EDE\\u1EE0\\u1EE2\\u1EE4\\u1EE6\\u1EE8\\u1EEA\\u1EEC\\u1EEE\\u1EF0\\u1EF2\\u1EF4\\u1EF6\\u1EF8\\u1EFA\\u1EFC\\u1EFE\\u1F08-\\u1F0F\\u1F18-\\u1F1D\\u1F28-\\u1F2F\\u1F38-\\u1F3F\\u1F48-\\u1F4D\\u1F59\\u1F5B\\u1F5D\\u1F5F\\u1F68-\\u1F6F\\u1FB8-\\u1FBB\\u1FC8-\\u1FCB\\u1FD8-\\u1FDB\\u1FE8-\\u1FEC\\u1FF8-\\u1FFB\\u2102\\u2107\\u210B-\\u210D\\u2110-\\u2112\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u2130-\\u2133\\u213E\\u213F\\u2145\\u2160-\\u216F\\u2183\\u24B6-\\u24CF\\u2C00-\\u2C2E\\u2C60\\u2C62-\\u2C64\\u2C67\\u2C69\\u2C6B\\u2C6D-\\u2C70\\u2C72\\u2C75\\u2C7E-\\u2C80\\u2C82\\u2C84\\u2C86\\u2C88\\u2C8A\\u2C8C\\u2C8E\\u2C90\\u2C92\\u2C94\\u2C96\\u2C98\\u2C9A\\u2C9C\\u2C9E\\u2CA0\\u2CA2\\u2CA4\\u2CA6\\u2CA8\\u2CAA\\u2CAC\\u2CAE\\u2CB0\\u2CB2\\u2CB4\\u2CB6\\u2CB8\\u2CBA\\u2CBC\\u2CBE\\u2CC0\\u2CC2\\u2CC4\\u2CC6\\u2CC8\\u2CCA\\u2CCC\\u2CCE\\u2CD0\\u2CD2\\u2CD4\\u2CD6\\u2CD8\\u2CDA\\u2CDC\\u2CDE\\u2CE0\\u2CE2\\u2CEB\\u2CED\\u2CF2\\uA640\\uA642\\uA644\\uA646\\uA648\\uA64A\\uA64C\\uA64E\\uA650\\uA652\\uA654\\uA656\\uA658\\uA65A\\uA65C\\uA65E\\uA660\\uA662\\uA664\\uA666\\uA668\\uA66A\\uA66C\\uA680\\uA682\\uA684\\uA686\\uA688\\uA68A\\uA68C\\uA68E\\uA690\\uA692\\uA694\\uA696\\uA698\\uA69A\\uA722\\uA724\\uA726\\uA728\\uA72A\\uA72C\\uA72E\\uA732\\uA734\\uA736\\uA738\\uA73A\\uA73C\\uA73E\\uA740\\uA742\\uA744\\uA746\\uA748\\uA74A\\uA74C\\uA74E\\uA750\\uA752\\uA754\\uA756\\uA758\\uA75A\\uA75C\\uA75E\\uA760\\uA762\\uA764\\uA766\\uA768\\uA76A\\uA76C\\uA76E\\uA779\\uA77B\\uA77D\\uA77E\\uA780\\uA782\\uA784\\uA786\\uA78B\\uA78D\\uA790\\uA792\\uA796\\uA798\\uA79A\\uA79C\\uA79E\\uA7A0\\uA7A2\\uA7A4\\uA7A6\\uA7A8\\uA7AA-\\uA7AE\\uA7B0-\\uA7B4\\uA7B6\\uA7B8\\uFF21-\\uFF3A]|\\uD801[\\uDC00-\\uDC27\\uDCB0-\\uDCD3]|\\uD803[\\uDC80-\\uDCB2]|\\uD806[\\uDCA0-\\uDCBF]|\\uD81B[\\uDE40-\\uDE5F]|\\uD835[\\uDC00-\\uDC19\\uDC34-\\uDC4D\\uDC68-\\uDC81\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB5\\uDCD0-\\uDCE9\\uDD04\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD38\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD6C-\\uDD85\\uDDA0-\\uDDB9\\uDDD4-\\uDDED\\uDE08-\\uDE21\\uDE3C-\\uDE55\\uDE70-\\uDE89\\uDEA8-\\uDEC0\\uDEE2-\\uDEFA\\uDF1C-\\uDF34\\uDF56-\\uDF6E\\uDF90-\\uDFA8\\uDFCA]|\\uD83A[\\uDD00-\\uDD21]|\\uD83C[\\uDD30-\\uDD49\\uDD50-\\uDD69\\uDD70-\\uDD89])/.source}.*`);\nconst endSplitter = getSplittingRegex(`(?:${/(?:[a-z\\xAA\\xB5\\xBA\\xDF-\\xF6\\xF8-\\xFF\\u0101\\u0103\\u0105\\u0107\\u0109\\u010B\\u010D\\u010F\\u0111\\u0113\\u0115\\u0117\\u0119\\u011B\\u011D\\u011F\\u0121\\u0123\\u0125\\u0127\\u0129\\u012B\\u012D\\u012F\\u0131\\u0133\\u0135\\u0137\\u0138\\u013A\\u013C\\u013E\\u0140\\u0142\\u0144\\u0146\\u0148\\u0149\\u014B\\u014D\\u014F\\u0151\\u0153\\u0155\\u0157\\u0159\\u015B\\u015D\\u015F\\u0161\\u0163\\u0165\\u0167\\u0169\\u016B\\u016D\\u016F\\u0171\\u0173\\u0175\\u0177\\u017A\\u017C\\u017E-\\u0180\\u0183\\u0185\\u0188\\u018C\\u018D\\u0192\\u0195\\u0199-\\u019B\\u019E\\u01A1\\u01A3\\u01A5\\u01A8\\u01AA\\u01AB\\u01AD\\u01B0\\u01B4\\u01B6\\u01B9\\u01BA\\u01BD-\\u01BF\\u01C6\\u01C9\\u01CC\\u01CE\\u01D0\\u01D2\\u01D4\\u01D6\\u01D8\\u01DA\\u01DC\\u01DD\\u01DF\\u01E1\\u01E3\\u01E5\\u01E7\\u01E9\\u01EB\\u01ED\\u01EF\\u01F0\\u01F3\\u01F5\\u01F9\\u01FB\\u01FD\\u01FF\\u0201\\u0203\\u0205\\u0207\\u0209\\u020B\\u020D\\u020F\\u0211\\u0213\\u0215\\u0217\\u0219\\u021B\\u021D\\u021F\\u0221\\u0223\\u0225\\u0227\\u0229\\u022B\\u022D\\u022F\\u0231\\u0233-\\u0239\\u023C\\u023F\\u0240\\u0242\\u0247\\u0249\\u024B\\u024D\\u024F-\\u0293\\u0295-\\u02B8\\u02C0\\u02C1\\u02E0-\\u02E4\\u0345\\u0371\\u0373\\u0377\\u037A-\\u037D\\u0390\\u03AC-\\u03CE\\u03D0\\u03D1\\u03D5-\\u03D7\\u03D9\\u03DB\\u03DD\\u03DF\\u03E1\\u03E3\\u03E5\\u03E7\\u03E9\\u03EB\\u03ED\\u03EF-\\u03F3\\u03F5\\u03F8\\u03FB\\u03FC\\u0430-\\u045F\\u0461\\u0463\\u0465\\u0467\\u0469\\u046B\\u046D\\u046F\\u0471\\u0473\\u0475\\u0477\\u0479\\u047B\\u047D\\u047F\\u0481\\u048B\\u048D\\u048F\\u0491\\u0493\\u0495\\u0497\\u0499\\u049B\\u049D\\u049F\\u04A1\\u04A3\\u04A5\\u04A7\\u04A9\\u04AB\\u04AD\\u04AF\\u04B1\\u04B3\\u04B5\\u04B7\\u04B9\\u04BB\\u04BD\\u04BF\\u04C2\\u04C4\\u04C6\\u04C8\\u04CA\\u04CC\\u04CE\\u04CF\\u04D1\\u04D3\\u04D5\\u04D7\\u04D9\\u04DB\\u04DD\\u04DF\\u04E1\\u04E3\\u04E5\\u04E7\\u04E9\\u04EB\\u04ED\\u04EF\\u04F1\\u04F3\\u04F5\\u04F7\\u04F9\\u04FB\\u04FD\\u04FF\\u0501\\u0503\\u0505\\u0507\\u0509\\u050B\\u050D\\u050F\\u0511\\u0513\\u0515\\u0517\\u0519\\u051B\\u051D\\u051F\\u0521\\u0523\\u0525\\u0527\\u0529\\u052B\\u052D\\u052F\\u0560-\\u0588\\u10D0-\\u10FA\\u10FD-\\u10FF\\u13F8-\\u13FD\\u1C80-\\u1C88\\u1D00-\\u1DBF\\u1E01\\u1E03\\u1E05\\u1E07\\u1E09\\u1E0B\\u1E0D\\u1E0F\\u1E11\\u1E13\\u1E15\\u1E17\\u1E19\\u1E1B\\u1E1D\\u1E1F\\u1E21\\u1E23\\u1E25\\u1E27\\u1E29\\u1E2B\\u1E2D\\u1E2F\\u1E31\\u1E33\\u1E35\\u1E37\\u1E39\\u1E3B\\u1E3D\\u1E3F\\u1E41\\u1E43\\u1E45\\u1E47\\u1E49\\u1E4B\\u1E4D\\u1E4F\\u1E51\\u1E53\\u1E55\\u1E57\\u1E59\\u1E5B\\u1E5D\\u1E5F\\u1E61\\u1E63\\u1E65\\u1E67\\u1E69\\u1E6B\\u1E6D\\u1E6F\\u1E71\\u1E73\\u1E75\\u1E77\\u1E79\\u1E7B\\u1E7D\\u1E7F\\u1E81\\u1E83\\u1E85\\u1E87\\u1E89\\u1E8B\\u1E8D\\u1E8F\\u1E91\\u1E93\\u1E95-\\u1E9D\\u1E9F\\u1EA1\\u1EA3\\u1EA5\\u1EA7\\u1EA9\\u1EAB\\u1EAD\\u1EAF\\u1EB1\\u1EB3\\u1EB5\\u1EB7\\u1EB9\\u1EBB\\u1EBD\\u1EBF\\u1EC1\\u1EC3\\u1EC5\\u1EC7\\u1EC9\\u1ECB\\u1ECD\\u1ECF\\u1ED1\\u1ED3\\u1ED5\\u1ED7\\u1ED9\\u1EDB\\u1EDD\\u1EDF\\u1EE1\\u1EE3\\u1EE5\\u1EE7\\u1EE9\\u1EEB\\u1EED\\u1EEF\\u1EF1\\u1EF3\\u1EF5\\u1EF7\\u1EF9\\u1EFB\\u1EFD\\u1EFF-\\u1F07\\u1F10-\\u1F15\\u1F20-\\u1F27\\u1F30-\\u1F37\\u1F40-\\u1F45\\u1F50-\\u1F57\\u1F60-\\u1F67\\u1F70-\\u1F7D\\u1F80-\\u1F87\\u1F90-\\u1F97\\u1FA0-\\u1FA7\\u1FB0-\\u1FB4\\u1FB6\\u1FB7\\u1FBE\\u1FC2-\\u1FC4\\u1FC6\\u1FC7\\u1FD0-\\u1FD3\\u1FD6\\u1FD7\\u1FE0-\\u1FE7\\u1FF2-\\u1FF4\\u1FF6\\u1FF7\\u2071\\u207F\\u2090-\\u209C\\u210A\\u210E\\u210F\\u2113\\u212F\\u2134\\u2139\\u213C\\u213D\\u2146-\\u2149\\u214E\\u2170-\\u217F\\u2184\\u24D0-\\u24E9\\u2C30-\\u2C5E\\u2C61\\u2C65\\u2C66\\u2C68\\u2C6A\\u2C6C\\u2C71\\u2C73\\u2C74\\u2C76-\\u2C7D\\u2C81\\u2C83\\u2C85\\u2C87\\u2C89\\u2C8B\\u2C8D\\u2C8F\\u2C91\\u2C93\\u2C95\\u2C97\\u2C99\\u2C9B\\u2C9D\\u2C9F\\u2CA1\\u2CA3\\u2CA5\\u2CA7\\u2CA9\\u2CAB\\u2CAD\\u2CAF\\u2CB1\\u2CB3\\u2CB5\\u2CB7\\u2CB9\\u2CBB\\u2CBD\\u2CBF\\u2CC1\\u2CC3\\u2CC5\\u2CC7\\u2CC9\\u2CCB\\u2CCD\\u2CCF\\u2CD1\\u2CD3\\u2CD5\\u2CD7\\u2CD9\\u2CDB\\u2CDD\\u2CDF\\u2CE1\\u2CE3\\u2CE4\\u2CEC\\u2CEE\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\uA641\\uA643\\uA645\\uA647\\uA649\\uA64B\\uA64D\\uA64F\\uA651\\uA653\\uA655\\uA657\\uA659\\uA65B\\uA65D\\uA65F\\uA661\\uA663\\uA665\\uA667\\uA669\\uA66B\\uA66D\\uA681\\uA683\\uA685\\uA687\\uA689\\uA68B\\uA68D\\uA68F\\uA691\\uA693\\uA695\\uA697\\uA699\\uA69B-\\uA69D\\uA723\\uA725\\uA727\\uA729\\uA72B\\uA72D\\uA72F-\\uA731\\uA733\\uA735\\uA737\\uA739\\uA73B\\uA73D\\uA73F\\uA741\\uA743\\uA745\\uA747\\uA749\\uA74B\\uA74D\\uA74F\\uA751\\uA753\\uA755\\uA757\\uA759\\uA75B\\uA75D\\uA75F\\uA761\\uA763\\uA765\\uA767\\uA769\\uA76B\\uA76D\\uA76F-\\uA778\\uA77A\\uA77C\\uA77F\\uA781\\uA783\\uA785\\uA787\\uA78C\\uA78E\\uA791\\uA793-\\uA795\\uA797\\uA799\\uA79B\\uA79D\\uA79F\\uA7A1\\uA7A3\\uA7A5\\uA7A7\\uA7A9\\uA7AF\\uA7B5\\uA7B7\\uA7B9\\uA7F8-\\uA7FA\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABBF\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFF41-\\uFF5A]|\\uD801[\\uDC28-\\uDC4F\\uDCD8-\\uDCFB]|\\uD803[\\uDCC0-\\uDCF2]|\\uD806[\\uDCC0-\\uDCDF]|\\uD81B[\\uDE60-\\uDE7F]|\\uD835[\\uDC1A-\\uDC33\\uDC4E-\\uDC54\\uDC56-\\uDC67\\uDC82-\\uDC9B\\uDCB6-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDCCF\\uDCEA-\\uDD03\\uDD1E-\\uDD37\\uDD52-\\uDD6B\\uDD86-\\uDD9F\\uDDBA-\\uDDD3\\uDDEE-\\uDE07\\uDE22-\\uDE3B\\uDE56-\\uDE6F\\uDE8A-\\uDEA5\\uDEC2-\\uDEDA\\uDEDC-\\uDEE1\\uDEFC-\\uDF14\\uDF16-\\uDF1B\\uDF36-\\uDF4E\\uDF50-\\uDF55\\uDF70-\\uDF88\\uDF8A-\\uDF8F\\uDFAA-\\uDFC2\\uDFC4-\\uDFC9\\uDFCB]|\\uD83A[\\uDD22-\\uDD43])/.source}.*|${particleMatcher}.*|\\\\S*)`);\n\nconst parseName = function parseName(name = '') {\n  if (typeof name !== 'string') {\n    name = name + '';\n  }\n\n  let start = '';\n  let mid = '';\n  let end = '';\n\n  if (/[^.], /.test(name)) {\n    const parts = name.split(', ');\n    end = parts.shift();\n    const suffixMatch = RegExp(suffixMatcher).exec(parts.join(', '));\n    start = parts.splice(suffixMatch && suffixMatch.index !== 0 ? 0 : -1, 1)[0];\n    mid = parts.join(', ');\n  } else {\n    const parts = name.split(suffixSplitter, 2);\n    const main = parts.shift().split(endSplitter, 2);\n    start = main[0];\n    end = main[1];\n    mid = parts.pop();\n  }\n\n  const _start$match = start.match(titleSplitter),\n        _start$match2 = _slicedToArray(_start$match, 3),\n        droppingParticle = _start$match2[1],\n        given = _start$match2[2];\n\n  const suffix = mid;\n\n  const _end$split$reverse = end.split(particleSplitter, 2).reverse(),\n        _end$split$reverse2 = _slicedToArray(_end$split$reverse, 2),\n        family = _end$split$reverse2[0],\n        nonDroppingParticle = _end$split$reverse2[1];\n\n  if (!given && family) {\n    return family.includes(' ') ? {\n      literal: family\n    } : {\n      family\n    };\n  } else if (family) {\n    const nameObject = {\n      'dropping-particle': droppingParticle,\n      given,\n      suffix,\n      'non-dropping-particle': nonDroppingParticle,\n      family\n    };\n    Object.keys(nameObject).forEach(key => {\n      if (!nameObject[key]) {\n        delete nameObject[key];\n      }\n    });\n    return nameObject;\n  } else {\n    return {\n      literal: name\n    };\n  }\n};\n\nexports.default = exports.parse = parseName;\nconst scope = '@name';\nexports.scope = scope;\nconst types = '@name';\nexports.types = types;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nconst startParts = ['dropping-particle', 'given'];\nconst suffixParts = ['suffix'];\nconst endParts = ['non-dropping-particle', 'family'];\n\nconst getName = function getName(name, reversed = false) {\n  const get = parts => parts.map(entry => name[entry] || '').filter(Boolean).join(' ');\n\n  if (name.literal) {\n    return name.literal;\n  } else if (reversed) {\n    const suffixPart = get(suffixParts) ? `, ${get(suffixParts)}` : '';\n    const startPart = get(startParts) ? `, ${get(startParts)}` : '';\n    return get(endParts) + suffixPart + startPart;\n  } else {\n    return `${get([...startParts, ...suffixParts, ...endParts])}`;\n  }\n};\n\nvar _default = getName;\nexports.default = _default;","import _required from './required.json';\nimport _fieldTypes from './fieldTypes.json';\nimport unicode from './unicode.json';\nexport const required = _required;\nexport const fieldTypes = _fieldTypes;\nexport const diacritics = unicode.diacritics;\nexport const commands = unicode.commands;\nexport const defaultStrings = {\n  jan: '01',\n  feb: '02',\n  mar: '03',\n  apr: '04',\n  may: '05',\n  jun: '06',\n  jul: '07',\n  aug: '08',\n  sep: '09',\n  oct: '10',\n  nov: '11',\n  dec: '12',\n  acmcs: 'ACM Computing Surveys',\n  acta: 'Acta Informatica',\n  cacm: 'Communications of the ACM',\n  ibmjrd: 'IBM Journal of Research and Development',\n  ibmsj: 'IBM Systems Journal',\n  ieeese: 'IEEE Transactions on Software Engineering',\n  ieeetc: 'IEEE Transactions on Computers',\n  ieeetcad: 'IEEE Transactions on Computer-Aided Design of Integrated Circuits',\n  ipl: 'Information Processing Letters',\n  jacm: 'Journal of the ACM',\n  jcss: 'Journal of Computer and System Sciences',\n  scp: 'Science of Computer Programming',\n  sicomp: 'SIAM Journal on Computing',\n  tocs: 'ACM Transactions on Computer Systems',\n  tods: 'ACM Transactions on Database Systems',\n  tog: 'ACM Transactions on Graphics',\n  toms: 'ACM Transactions on Mathematical Software',\n  toois: 'ACM Transactions on Office Information Systems',\n  toplas: 'ACM Transactions on Programming Languages and Systems',\n  tcs: 'Theoretical Computer Science'\n};\nexport const formattingEnvs = {\n  it: 'italics',\n  itshape: 'italics',\n  sl: 'italics',\n  slshape: 'italics',\n  em: 'italics',\n  bf: 'bold',\n  bfseries: 'bold',\n  sc: 'smallcaps',\n  scshape: 'smallcaps',\n  rm: undefined,\n  sf: undefined,\n  tt: undefined\n};\nexport const formattingCommands = {\n  textit: 'italics',\n  textsl: 'italics',\n  emph: 'italics',\n  mkbibitalic: 'italics',\n  mkbibemph: 'italics',\n  textbf: 'bold',\n  strong: 'bold',\n  mkbibbold: 'bold',\n  textsc: 'smallcaps',\n  textsuperscript: 'superscript',\n  textsubscript: 'subscript',\n  enquote: 'quotes',\n  mkbibquote: 'quotes',\n  textmd: undefined,\n  textrm: undefined,\n  textsf: undefined,\n  texttt: undefined,\n  textup: undefined\n};\nexport const formatting = {\n  italics: ['<i>', '</i>'],\n  bold: ['<b>', '</b>'],\n  superscript: ['<sup>', '</sup>'],\n  subscript: ['<sub>', '</sub>'],\n  smallcaps: ['<span style=\"font-variant:small-caps;\">', '</span>'],\n  nocase: ['<span class=\"nocase\">', '</span>'],\n  quotes: ['\\u201C', '\\u201D']\n};\nexport const argumentCommands = {\n  ElsevierGlyph(glyph) {\n    return String.fromCharCode(parseInt(glyph, 16));\n  },\n  href(url, text) {\n    return url;\n  },\n  url(url) {\n    return url;\n  }\n};\nexport const ligaturePattern = /---?|''|``|~/g;\nexport const ligatures = {\n  '--': '\\u2013',\n  '---': '\\u2014',\n  '``': '\\u201C',\n  \"''\": '\\u201D',\n  '~': '\\u00A0'\n};\nexport const mathScriptFormatting = {\n  '^': 'superscript',\n  sp: 'superscript',\n  _: 'subscript',\n  sb: 'subscript',\n  mathrm: undefined\n};\nexport const mathScripts = {\n  '^': {\n    '0': '\\u2070',\n    '1': '\\u00B9',\n    '2': '\\u00B2',\n    '3': '\\u00B3',\n    '4': '\\u2074',\n    '5': '\\u2075',\n    '6': '\\u2076',\n    '7': '\\u2077',\n    '8': '\\u2078',\n    '9': '\\u2079',\n    '+': '\\u207A',\n    '-': '\\u207B',\n    '=': '\\u207C',\n    '(': '\\u207D',\n    ')': '\\u207E',\n    'i': '\\u2071',\n    'n': '\\u207F'\n  },\n  '_': {\n    '0': '\\u2080',\n    '1': '\\u2081',\n    '2': '\\u2082',\n    '3': '\\u2083',\n    '4': '\\u2084',\n    '5': '\\u2085',\n    '6': '\\u2086',\n    '7': '\\u2087',\n    '8': '\\u2088',\n    '9': '\\u2089',\n    '+': '\\u208A',\n    '-': '\\u208B',\n    '=': '\\u208C',\n    '(': '\\u208D',\n    ')': '\\u208E',\n    'a': '\\u2090',\n    'e': '\\u2091',\n    'o': '\\u2092',\n    'x': '\\u2093',\n    '\\u0259': '\\u2094',\n    'h': '\\u2095',\n    'k': '\\u2096',\n    'l': '\\u2097',\n    'm': '\\u2098',\n    'n': '\\u2099',\n    's': '\\u209A',\n    'p': '\\u209B',\n    't': '\\u209C'\n  }\n};\nexport const sentenceCaseLanguages = ['american', 'british', 'canadian', 'english', 'australian', 'newzealand', 'usenglish', 'ukenglish', 'en', 'eng', 'en-au', 'en-bz', 'en-ca', 'en-cb', 'en-gb', 'en-ie', 'en-jm', 'en-nz', 'en-ph', 'en-tt', 'en-us', 'en-za', 'en-zw', 'anglais'];","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { util, logger } from '@citation-js/core';\nimport moo from 'moo';\nimport { defaultStrings } from './constants.js';\nconst identifier = /[a-zA-Z_][a-zA-Z0-9_:-]*/;\nconst whitespace = {\n  comment: /%.*/,\n  whitespace: {\n    match: /\\s+/,\n    lineBreaks: true\n  }\n};\nconst lexer = moo.states({\n  main: {\n    junk: {\n      match: /@[cC][oO][mM][mM][eE][nN][tT].+|[^@]+/,\n      lineBreaks: true\n    },\n    at: {\n      match: '@',\n      push: 'entry'\n    }\n  },\n  entry: _objectSpread(_objectSpread({}, whitespace), {}, {\n    otherEntryType: {\n      match: /[sS][tT][rR][iI][nN][gG]|[pP][rR][eE][aA][mM][bB][lL][eE]/,\n      next: 'otherEntryContents'\n    },\n    dataEntryType: {\n      match: identifier,\n      next: 'dataEntryContents'\n    }\n  }),\n  otherEntryContents: _objectSpread(_objectSpread({}, whitespace), {}, {\n    lbrace: {\n      match: /[{(]/,\n      next: 'fields'\n    }\n  }),\n  dataEntryContents: _objectSpread(_objectSpread({}, whitespace), {}, {\n    lbrace: {\n      match: /[{(]/,\n      next: 'dataEntryContents'\n    },\n    label: /[^,\\s]+/,\n    comma: {\n      match: ',',\n      next: 'fields'\n    }\n  }),\n  fields: _objectSpread(_objectSpread({}, whitespace), {}, {\n    identifier,\n    number: /-?\\d+/,\n    hash: '#',\n    equals: '=',\n    comma: ',',\n    quote: {\n      match: '\"',\n      push: 'quotedLiteral'\n    },\n    lbrace: {\n      match: '{',\n      push: 'bracedLiteral'\n    },\n    rbrace: {\n      match: /[})]/,\n      pop: true\n    }\n  }),\n  quotedLiteral: {\n    lbrace: {\n      match: '{',\n      push: 'bracedLiteral'\n    },\n    quote: {\n      match: '\"',\n      pop: true\n    },\n    text: {\n      match: /(?:\\\\[\\\\{]|[^{\"])+/,\n      lineBreaks: true\n    }\n  },\n  bracedLiteral: {\n    lbrace: {\n      match: '{',\n      push: 'bracedLiteral'\n    },\n    rbrace: {\n      match: '}',\n      pop: true\n    },\n    text: {\n      match: /(?:\\\\[\\\\{}]|[^{}])+/,\n      lineBreaks: true\n    }\n  }\n});\nconst delimiters = {\n  '(': ')',\n  '{': '}'\n};\nexport const bibtexGrammar = new util.Grammar({\n  Main() {\n    const entries = [];\n    while (true) {\n      while (this.matchToken('junk')) {\n        this.consumeToken('junk');\n      }\n      if (this.matchEndOfFile()) {\n        break;\n      }\n      entries.push(this.consumeRule('Entry'));\n    }\n    return entries.filter(Boolean);\n  },\n  _() {\n    let oldToken;\n    while (oldToken !== this.token) {\n      oldToken = this.token;\n      this.consumeToken('whitespace', true);\n      this.consumeToken('comment', true);\n    }\n  },\n  Entry() {\n    this.consumeToken('at');\n    this.consumeRule('_');\n    const type = (this.matchToken('otherEntryType') ? this.consumeToken('otherEntryType') : this.consumeToken('dataEntryType')).value.toLowerCase();\n    this.consumeRule('_');\n    const openBrace = this.consumeToken('lbrace').value;\n    this.consumeRule('_');\n    let result;\n    if (type === 'string') {\n      const [key, value] = this.consumeRule('Field');\n      this.state.strings[key] = value;\n    } else if (type === 'preamble') {\n      this.consumeRule('Expression');\n    } else {\n      const label = this.consumeToken('label').value;\n      this.consumeRule('_');\n      this.consumeToken('comma');\n      this.consumeRule('_');\n      const properties = this.consumeRule('EntryBody');\n      result = {\n        type,\n        label,\n        properties\n      };\n    }\n    this.consumeRule('_');\n    const closeBrace = this.consumeToken('rbrace').value;\n    if (closeBrace !== delimiters[openBrace]) {\n      logger.warn('[plugin-bibtex]', `entry started with \"${openBrace}\", but ends with \"${closeBrace}\"`);\n    }\n    return result;\n  },\n  EntryBody() {\n    const properties = {};\n    while (this.matchToken('identifier')) {\n      const [field, value] = this.consumeRule('Field');\n      properties[field] = value;\n      this.consumeRule('_');\n      if (this.consumeToken('comma', true)) {\n        this.consumeRule('_');\n      } else {\n        break;\n      }\n    }\n    return properties;\n  },\n  Field() {\n    const field = this.consumeToken('identifier').value.toLowerCase();\n    this.consumeRule('_');\n    this.consumeToken('equals');\n    this.consumeRule('_');\n    const value = this.consumeRule('Expression');\n    return [field, value];\n  },\n  Expression() {\n    let output = this.consumeRule('ExpressionPart');\n    this.consumeRule('_');\n    while (this.matchToken('hash')) {\n      this.consumeToken('hash');\n      this.consumeRule('_');\n      output += this.consumeRule('ExpressionPart').toString();\n      this.consumeRule('_');\n    }\n    return output;\n  },\n  ExpressionPart() {\n    if (this.matchToken('identifier')) {\n      return this.state.strings[this.consumeToken('identifier').value.toLowerCase()] || '';\n    } else if (this.matchToken('number')) {\n      return parseInt(this.consumeToken('number'));\n    } else if (this.matchToken('quote')) {\n      return this.consumeRule('QuoteString');\n    } else {\n      return this.consumeRule('BracketString');\n    }\n  },\n  QuoteString() {\n    let output = '';\n    this.consumeToken('quote');\n    while (!this.matchToken('quote')) {\n      output += this.consumeRule('Text');\n    }\n    this.consumeToken('quote');\n    return output;\n  },\n  BracketString() {\n    let output = '';\n    this.consumeToken('lbrace');\n    while (!this.matchToken('rbrace')) {\n      output += this.consumeRule('Text');\n    }\n    this.consumeToken('rbrace');\n    return output;\n  },\n  Text() {\n    if (this.matchToken('lbrace')) {\n      return `{${this.consumeRule('BracketString')}}`;\n    } else {\n      return this.consumeToken('text').value;\n    }\n  }\n}, {\n  strings: defaultStrings\n});\nexport function parse(text) {\n  return bibtexGrammar.parse(lexer.reset(text));\n}","const bibTxtRegex = {\n  splitEntries: /\\n\\s*(?=\\[)/g,\n  parseEntry: /^\\[(.+?)\\]\\s*(?:\\n([\\s\\S]+))?$/,\n  splitPairs: /((?=.)\\s)*\\n\\s*/g,\n  splitPair: /:(.*)/\n};\nconst parseBibTxtEntry = entry => {\n  const [, label, pairs] = entry.match(bibTxtRegex.parseEntry) || [];\n  if (!label || !pairs) {\n    return {};\n  } else {\n    const out = {\n      type: 'book',\n      label,\n      properties: {}\n    };\n    pairs.trim().split(bibTxtRegex.splitPairs).filter(v => v).forEach(pair => {\n      let [key, value] = pair.split(bibTxtRegex.splitPair);\n      if (value) {\n        key = key.trim();\n        value = value.trim();\n        if (key === 'type') {\n          out.type = value;\n        } else {\n          out.properties[key] = value;\n        }\n      }\n    });\n    return out;\n  }\n};\nconst parseBibTxt = src => src.trim().split(bibTxtRegex.splitEntries).map(parseBibTxtEntry);\nexport { parseBibTxt as parse, parseBibTxt as text, parseBibTxtEntry as textEntry };","import biblatex from './mapping/biblatexTypes.json';\nimport bibtex from './mapping/bibtexTypes.json';\nimport * as constants from './input/constants.js';\nexport default {\n  constants,\n  types: {\n    biblatex,\n    bibtex\n  },\n  parse: {\n    biblatex: true,\n    strict: false,\n    sentenceCase: 'never'\n  },\n  format: {\n    useIdAsLabel: false\n  }\n};","import { util } from '@citation-js/core';\nimport config from '../config.js';\nconst stopWords = new Set(['the', 'a', 'an']);\nconst unsafeChars = /(?:<\\/?.*?>|[\\u0020-\\u002F\\u003A-\\u0040\\u005B-\\u005E\\u0060\\u007B-\\u007F])+/g;\nconst unicode = /[^\\u0020-\\u007F]+/g;\nfunction firstWord(text) {\n  if (!text) {\n    return '';\n  } else {\n    return text.normalize('NFKD').replace(unicode, '').split(unsafeChars).find(word => word.length && !stopWords.has(word.toLowerCase()));\n  }\n}\nconst name = new util.Translator([{\n  source: 'given',\n  target: 'given'\n}, {\n  source: 'family',\n  target: 'family'\n}, {\n  source: 'suffix',\n  target: 'suffix'\n}, {\n  source: 'prefix',\n  target: 'non-dropping-particle'\n}, {\n  source: 'family',\n  target: 'literal',\n  when: {\n    source: false,\n    target: {\n      family: false,\n      given: false\n    }\n  }\n}]);\nconst months = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];\nexport const TYPE = 'BibTeX type';\nexport const LABEL = 'BibTeX label';\nexport const MONTHS = {\n  jan: 1,\n  feb: 2,\n  mar: 3,\n  apr: 4,\n  may: 5,\n  jun: 6,\n  jul: 7,\n  aug: 8,\n  sep: 9,\n  oct: 10,\n  nov: 11,\n  dec: 12,\n  january: 1,\n  february: 2,\n  march: 3,\n  april: 4,\n  may: 5,\n  june: 6,\n  july: 7,\n  august: 8,\n  september: 9,\n  october: 10,\n  november: 11,\n  december: 12\n};\nexport const TYPE_KEYS = {\n  bathesis: 'Bachelor\\'s thesis',\n  mathesis: 'Master\\'s thesis',\n  phdthesis: 'PhD thesis',\n  candthesis: 'Candidate thesis',\n  techreport: 'technical report',\n  resreport: 'research report',\n  software: 'computer software',\n  datacd: 'data cd',\n  audiocd: 'audio cd',\n  patent: 'patent',\n  patentde: 'German patent',\n  patenteu: 'European patent',\n  patentfr: 'French patent',\n  patentuk: 'British patent',\n  patentus: 'U.S. patent',\n  patreq: 'patent request',\n  patreqde: 'German patent request',\n  patreqeu: 'European patent request',\n  patreqfr: 'French patent request',\n  patrequk: 'British patent request',\n  patrequs: 'U.S. patent request'\n};\nexport const STANDARD_NUMBERS_PATTERN = /(^(?:ISAN )?(?:[0-9a-f]{4}-){4}[0-9a-z](?:-(?:[0-9a-f]{4}-){2}[0-9a-z])?$)|(^(?:979-?0-?|M-?)(?:\\d{9}|(?=[\\d-]{11}$)\\d+-\\d+-\\d)$)|(^ISRN .{1,36}$)|(^(?:ISWC )?T-?\\d{9}-?\\d$)/i;\nexport function parseDate(date) {\n  const parts = date.split('T')[0].replace(/[?~%]$/, '').split('-');\n  const year = +parts[0].replace(/^Y(?=-?\\d{4}\\d+)/, '').replace(/X/g, '0');\n  const month = +parts[1];\n  const day = +parts[2];\n  if (!month || month > 20) {\n    return [year];\n  } else if (!day) {\n    return [year, month];\n  } else {\n    return [year, month, day];\n  }\n}\nexport function parseMonth(value) {\n  if (value == null) {\n    return [];\n  }\n  if (+value) {\n    return [parseInt(value, 10)];\n  }\n  value = value.trim().toLowerCase();\n  if (value in MONTHS) {\n    return [MONTHS[value]];\n  }\n  const parts = value.split(/\\s+/);\n  let month;\n  let day;\n  if (parts[0] in MONTHS) {\n    month = MONTHS[parts[0]];\n    day = parseInt(parts[1]);\n  } else if (parts[1] in MONTHS) {\n    month = MONTHS[parts[1]];\n    day = parseInt(parts[0]);\n  }\n  return day ? [month, day] : month ? [month] : [];\n}\nexport function formatLabel(author, issued, suffix, title) {\n  let label = '';\n  if (author && author[0]) {\n    label += firstWord(author[0].family || author[0].literal);\n  }\n  if (issued && issued['date-parts'] && issued['date-parts'][0]) {\n    label += issued['date-parts'][0][0];\n  }\n  if (suffix) {\n    label += suffix;\n  } else if (title) {\n    label += firstWord(title);\n  }\n  return label;\n}\nexport const Converters = {\n  PICK: {\n    toTarget(...args) {\n      return args.find(Boolean);\n    },\n    toSource(value) {\n      return [value];\n    }\n  },\n  DATE: {\n    toTarget(date) {\n      const parts = date.split('/').map(part => part && part !== '..' ? parseDate(part) : undefined);\n      return isNaN(parts[0][0]) ? {\n        literal: date\n      } : {\n        'date-parts': parts\n      };\n    },\n    toSource(date) {\n      if ('date-parts' in date) {\n        return date['date-parts'].map(datePart => datePart.map(datePart => datePart.toString().padStart(2, '0')).join('-')).join('/');\n      }\n    }\n  },\n  YEAR_MONTH: {\n    toTarget(year, month, day) {\n      if (isNaN(+year)) {\n        return {\n          literal: year\n        };\n      } else if (!isNaN(+day) && !isNaN(+month)) {\n        return {\n          'date-parts': [[+year, +month, +day]]\n        };\n      } else {\n        return {\n          'date-parts': [[+year, ...parseMonth(month)]]\n        };\n      }\n    },\n    toSource(date) {\n      if ('date-parts' in date) {\n        const [year, month, day] = date['date-parts'][0];\n        return [year.toString(), month ? day ? `${months[month - 1]} ${day}` : month : undefined];\n      } else {\n        return [];\n      }\n    }\n  },\n  EPRINT: {\n    toTarget(id, type) {\n      if (type === 'pubmed') {\n        return id;\n      }\n    },\n    toSource(id) {\n      return [id, 'pubmed'];\n    }\n  },\n  EVENT_TITLE: {\n    toTarget(title, addon) {\n      if (addon) {\n        title += ' (' + addon + ')';\n      }\n      return title;\n    },\n    toSource(title) {\n      return title.match(/^(.+)(?: \\((.+)\\))?$/).slice(1, 3);\n    }\n  },\n  HOW_PUBLISHED: {\n    toTarget(howPublished) {\n      if (howPublished.startsWith('http')) {\n        return howPublished;\n      }\n    }\n  },\n  KEYWORDS: {\n    toTarget(list) {\n      return list.join(',');\n    },\n    toSource(list) {\n      return list.split(',');\n    }\n  },\n  LABEL: {\n    toTarget(label) {\n      return [label, label];\n    },\n    toSource(id, label, author, issued, suffix, title) {\n      let safeId;\n      if (id === null) {\n        safeId = 'null';\n      } else if (id === undefined) {\n        safeId = 'undefined';\n      } else {\n        safeId = id.toString().replace(unsafeChars, '');\n      }\n      if (config.format.useIdAsLabel) {\n        return safeId;\n      }\n      if (label && !unsafeChars.test(label)) {\n        return label;\n      } else {\n        return formatLabel(author, issued, suffix, title) || safeId;\n      }\n    }\n  },\n  NAMES: {\n    toTarget(list) {\n      return list.map(name.convertToTarget);\n    },\n    toSource(list) {\n      return list.map(name.convertToSource);\n    }\n  },\n  PAGES: {\n    toTarget(pages) {\n      return pages.replace(/[]/, '-');\n    },\n    toSource(pages) {\n      return pages.replace('-', '--');\n    }\n  },\n  STANDARD_NUMBERS: {\n    toTarget(...args) {\n      return args.find(Boolean);\n    },\n    toSource(number) {\n      const match = number.toString().match(STANDARD_NUMBERS_PATTERN);\n      return match ? match.slice(1, 5) : [];\n    }\n  },\n  STATUS: {\n    toSource(state) {\n      if (/^(inpreparation|submitted|forthcoming|inpress|prepublished)$/i.test(state)) {\n        return state;\n      }\n    }\n  },\n  TITLE: {\n    toTarget(title, subtitle, addon) {\n      if (subtitle) {\n        title += ': ' + subtitle;\n      }\n      return title;\n    },\n    toSource(title) {\n      return [title];\n    }\n  }\n};","import { util } from '@citation-js/core';\nimport { format as formatDate } from '@citation-js/date';\nimport types from './biblatexTypes.json';\nimport { TYPE, LABEL, TYPE_KEYS, Converters } from './shared.js';\nconst nonSpec = [{\n  source: 'note',\n  target: 'accessed',\n  when: {\n    source: false,\n    target: {\n      note: false,\n      addendum: false\n    }\n  },\n  convert: {\n    toSource(accessed) {\n      return `[Online; accessed ${formatDate(accessed)}]`;\n    }\n  }\n}, {\n  source: 'numpages',\n  target: 'number-of-pages',\n  when: {\n    source: {\n      pagetotal: false\n    },\n    target: false\n  }\n}, {\n  source: 'pmid',\n  target: 'PMID',\n  when: {\n    source: {\n      eprinttype(type) {\n        return type !== 'pmid';\n      },\n      archiveprefix(type) {\n        return type !== 'pmid';\n      }\n    },\n    target: false\n  }\n}, {\n  source: 'pmcid',\n  target: 'PMCID',\n  when: {\n    target: false\n  }\n}, {\n  source: 's2id',\n  target: 'custom',\n  convert: {\n    toTarget(S2ID) {\n      return {\n        S2ID\n      };\n    },\n    toSource({\n      S2ID\n    }) {\n      return S2ID;\n    }\n  }\n}];\nconst aliases = [{\n  source: 'annote',\n  target: 'annote',\n  when: {\n    source: {\n      annotation: false\n    },\n    target: false\n  }\n}, {\n  source: 'address',\n  target: 'publisher-place',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      location: false\n    },\n    target: false\n  }\n}, {\n  source: ['eprint', 'archiveprefix'],\n  target: 'PMID',\n  convert: Converters.EPRINT,\n  when: {\n    source: {\n      eprinttype: false\n    },\n    target: false\n  }\n}, {\n  source: 'journal',\n  target: 'container-title',\n  when: {\n    source: {\n      maintitle: false,\n      booktitle: false,\n      journaltitle: false\n    },\n    target: false\n  }\n}, {\n  source: 'school',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      institution: false,\n      organization: false,\n      publisher: false\n    },\n    target: false\n  }\n}];\nexport default new util.Translator([...aliases, ...nonSpec, {\n  source: 'abstract',\n  target: 'abstract'\n}, {\n  source: 'urldate',\n  target: 'accessed',\n  convert: Converters.DATE\n}, {\n  source: 'annotation',\n  target: 'annote'\n}, {\n  source: 'author',\n  target: 'author',\n  convert: Converters.NAMES\n}, {\n  source: 'library',\n  target: 'call-number'\n}, {\n  source: 'chapter',\n  target: 'chapter-number'\n}, {\n  source: 'bookauthor',\n  target: 'container-author',\n  convert: Converters.NAMES\n}, {\n  source: ['maintitle', 'mainsubtitle', 'maintitleaddon'],\n  target: 'container-title',\n  when: {\n    source: true,\n    target: {\n      'number-of-volumes': true\n    }\n  },\n  convert: Converters.TITLE\n}, {\n  source: ['booktitle', 'booksubtitle', 'booktitleaddon'],\n  target: 'container-title',\n  when: {\n    source: {\n      maintitle: false\n    },\n    target: {\n      'number-of-volumes': false,\n      type(type) {\n        return !type || !type.startsWith('article');\n      }\n    }\n  },\n  convert: Converters.TITLE\n}, {\n  source: ['journaltitle', 'journalsubtitle', 'journaltitleaddon'],\n  target: 'container-title',\n  when: {\n    source: {\n      [TYPE]: 'article'\n    },\n    target: {\n      type: ['article', 'article-newspaper', 'article-journal', 'article-magazine']\n    }\n  },\n  convert: Converters.TITLE\n}, {\n  source: 'shortjournal',\n  target: 'container-title-short',\n  when: {\n    source: {\n      [TYPE]: 'article'\n    },\n    target: {\n      type: ['article', 'article-newspaper', 'article-journal', 'article-magazine']\n    }\n  }\n}, {\n  source: 'shortjournal',\n  target: 'journalAbbreviation',\n  when: {\n    source: false,\n    target: {\n      'container-title-short': false\n    }\n  }\n}, {\n  source: 'number',\n  target: 'collection-number',\n  when: {\n    source: {\n      [TYPE]: ['book', 'mvbook', 'inbook', 'bookinbook', 'suppbook', 'collection', 'mvcollection', 'incollection', 'suppcollection', 'manual', 'suppperiodical', 'proceedings', 'mvproceedings', 'refererence']\n    },\n    target: {\n      type: ['bill', 'book', 'broadcast', 'chapter', 'dataset', 'entry', 'entry-dictionary', 'entry-encyclopedia', 'figure', 'graphic', 'interview', 'legislation', 'legal_case', 'manuscript', 'map', 'motion_picture', 'musical_score', 'pamphlet', 'post', 'post-weblog', 'personal_communication', 'review', 'review-book', 'song', 'speech', 'thesis', 'treaty', 'webpage']\n    }\n  }\n}, {\n  source: 'series',\n  target: 'collection-title'\n}, {\n  source: 'shortseries',\n  target: 'collection-title-short'\n}, {\n  source: 'doi',\n  target: 'DOI'\n}, {\n  source: 'edition',\n  target: 'edition'\n}, {\n  source: 'editor',\n  target: 'editor',\n  convert: Converters.NAMES\n}, {\n  source: [TYPE, 'entrysubtype', 'type'],\n  target: ['type', 'genre'],\n  convert: {\n    toTarget(type, subtype, typeKey) {\n      if (!typeKey) {\n        if (type === 'mastersthesis') {\n          typeKey = 'mathesis';\n        }\n        if (type === 'phdthesis') {\n          typeKey = 'phdthesis';\n        }\n        if (type === 'techreport') {\n          typeKey = 'techreport';\n        }\n      }\n      return [types.source[type] || 'document', typeKey || subtype];\n    },\n    toSource(type, genre) {\n      const sourceType = types.target[type] || 'misc';\n      return genre in TYPE_KEYS ? [sourceType, undefined, genre] : [sourceType, genre];\n    }\n  }\n}, {\n  source: TYPE,\n  when: {\n    target: {\n      type: false\n    }\n  },\n  convert: {\n    toSource() {\n      return 'misc';\n    }\n  }\n}, {\n  source: 'eventdate',\n  target: 'event-date',\n  convert: Converters.DATE\n}, {\n  source: 'venue',\n  target: 'event-place'\n}, {\n  source: ['eventtitle', 'eventtitleaddon'],\n  target: 'event-title',\n  convert: Converters.EVENT_TITLE\n}, {\n  source: ['eventtitle', 'eventtitleaddon'],\n  target: 'event',\n  convert: Converters.EVENT_TITLE,\n  when: {\n    source: false,\n    target: {\n      'event-title': false\n    }\n  }\n}, {\n  source: LABEL,\n  target: ['id', 'citation-key', 'author', 'issued', 'year-suffix', 'title'],\n  convert: Converters.LABEL\n}, {\n  source: 'isbn',\n  target: 'ISBN'\n}, {\n  source: 'issn',\n  target: 'ISSN'\n}, {\n  source: 'issue',\n  target: 'issue',\n  when: {\n    source: {\n      number: false,\n      [TYPE]: ['article', 'periodical']\n    },\n    target: {\n      issue(issue) {\n        return typeof issue === 'string' && !issue.match(/\\d+/);\n      },\n      type: ['article', 'article-journal', 'article-newspaper', 'article-magazine', 'periodical']\n    }\n  }\n}, {\n  source: 'number',\n  target: 'issue',\n  when: {\n    source: {\n      [TYPE]: ['article', 'periodical', 'inproceedings']\n    },\n    target: {\n      issue(issue) {\n        return issue && (typeof issue === 'number' || issue.match(/\\d+/));\n      },\n      type: ['article', 'article-journal', 'article-newspaper', 'article-magazine', 'paper-conference', 'periodical']\n    }\n  }\n}, {\n  source: 'date',\n  target: 'issued',\n  convert: Converters.DATE\n}, {\n  source: ['year', 'month', 'day'],\n  target: 'issued',\n  convert: Converters.YEAR_MONTH,\n  when: {\n    source: {\n      date: false\n    },\n    target: false\n  }\n}, {\n  source: 'location',\n  target: 'jurisdiction',\n  when: {\n    source: {\n      type: 'patent'\n    },\n    target: {\n      type: 'patent'\n    }\n  }\n}, {\n  source: 'keywords',\n  target: 'keyword',\n  convert: Converters.KEYWORDS\n}, {\n  source: 'language',\n  target: 'language',\n  convert: Converters.PICK\n}, {\n  source: 'langid',\n  target: 'language',\n  when: {\n    source: {\n      language: false\n    },\n    target: false\n  }\n}, {\n  source: 'note',\n  target: 'note'\n}, {\n  source: 'addendum',\n  target: 'note',\n  when: {\n    source: {\n      note: false\n    },\n    target: false\n  }\n}, {\n  source: 'eid',\n  target: 'number',\n  when: {\n    target: {\n      type: ['article-journal']\n    }\n  }\n}, {\n  source: ['isan', 'ismn', 'isrn', 'iswc'],\n  target: 'number',\n  convert: Converters.STANDARD_NUMBERS,\n  when: {\n    source: {\n      [TYPE](type) {\n        return type !== 'patent';\n      }\n    },\n    target: {\n      type(type) {\n        return type !== 'patent';\n      }\n    }\n  }\n}, {\n  source: 'number',\n  target: 'number',\n  when: {\n    source: {\n      [TYPE]: ['patent', 'report', 'techreport', 'legislation']\n    },\n    target: {\n      type: ['patent', 'report', 'legislation']\n    }\n  }\n}, {\n  source: 'origdate',\n  target: 'original-date',\n  convert: Converters.DATE\n}, {\n  source: 'origlocation',\n  target: 'original-publisher-place',\n  convert: Converters.PICK\n}, {\n  source: 'origpublisher',\n  target: 'original-publisher',\n  convert: Converters.PICK\n}, {\n  source: 'origtitle',\n  target: 'original-title'\n}, {\n  source: 'pages',\n  target: 'page',\n  when: {\n    source: {\n      bookpagination: [undefined, 'page']\n    }\n  },\n  convert: Converters.PAGES\n}, {\n  source: 'pagetotal',\n  target: 'number-of-pages'\n}, {\n  source: 'part',\n  target: 'part-number'\n}, {\n  source: ['eprint', 'eprinttype'],\n  target: 'PMID',\n  convert: Converters.EPRINT\n}, {\n  source: 'location',\n  target: 'publisher-place',\n  convert: Converters.PICK\n}, {\n  source: 'publisher',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: true,\n    target: {\n      type: ['article', 'article-journal', 'article-magazine', 'article-newspaper', 'bill', 'book', 'broadcast', 'chapter', 'classic', 'collection', 'dataset', 'document', 'entry', 'entry-dictionary', 'entry-encyclopedia', 'event', 'figure', 'graphic', 'hearing', 'interview', 'legal_case', 'legislation', 'manuscript', 'map', 'motion_picture', 'musical_score', 'pamphlet', 'paper-conference', 'patent', 'performance', 'periodical', 'personal_communication', 'post', 'post-weblog', 'regulation', 'review', 'review-book', 'software', 'song', 'speech', 'standard', 'treaty']\n    }\n  }\n}, {\n  source: 'organization',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      publisher: false\n    },\n    target: {\n      type: 'webpage'\n    }\n  }\n}, {\n  source: 'institution',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      publisher: false,\n      organization: false\n    },\n    target: {\n      type: ['report', 'thesis']\n    }\n  }\n}, {\n  source: 'howpublished',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      howpublished(howPublished) {\n        return howPublished && !howPublished.startsWith('http');\n      },\n      publisher: false,\n      organization: false,\n      institution: false\n    },\n    target: {\n      type: 'manuscript'\n    }\n  }\n}, {\n  source: ['pages', 'bookpagination'],\n  target: 'section',\n  when: {\n    source: {\n      bookpagination: 'section'\n    },\n    target: {\n      page: false\n    }\n  },\n  convert: {\n    toTarget(section) {\n      return section;\n    },\n    toSource(section) {\n      return [section, 'section'];\n    }\n  }\n}, {\n  source: 'pubstate',\n  target: 'status',\n  convert: Converters.STATUS\n}, {\n  source: 'shorttitle',\n  target: 'title-short'\n}, {\n  source: 'shorttitle',\n  target: 'shortTitle',\n  when: {\n    source: false,\n    target: {\n      'title-short': false\n    }\n  }\n}, {\n  source: ['title', 'subtitle', 'titleaddon'],\n  target: 'title',\n  convert: Converters.TITLE\n}, {\n  source: 'translator',\n  target: 'translator',\n  convert: Converters.NAMES\n}, {\n  source: 'url',\n  target: 'URL'\n}, {\n  source: 'howpublished',\n  target: 'URL',\n  convert: Converters.HOW_PUBLISHED,\n  when: {\n    source: {\n      url: false\n    },\n    target: false\n  }\n}, {\n  source: 'version',\n  target: 'version'\n}, {\n  source: 'volume',\n  target: 'volume'\n}, {\n  source: 'volumes',\n  target: 'number-of-volumes'\n}, {\n  source: ['issuetitle', 'issuesubtitle', 'issuetitleaddon'],\n  target: 'volume-title',\n  convert: Converters.TITLE\n}]);","import { util } from '@citation-js/core';\nimport { format as formatDate } from '@citation-js/date';\nimport types from './bibtexTypes.json';\nimport { TYPE, LABEL, Converters } from './shared.js';\nexport default new util.Translator([{\n  source: 'note',\n  target: 'accessed',\n  when: {\n    source: false,\n    target: {\n      note: false\n    }\n  },\n  convert: {\n    toSource(accessed) {\n      return `[Online; accessed ${formatDate(accessed)}]`;\n    }\n  }\n}, {\n  source: 'annote',\n  target: 'annote'\n}, {\n  source: 'address',\n  target: 'publisher-place',\n  convert: Converters.PICK\n}, {\n  source: 'author',\n  target: 'author',\n  convert: Converters.NAMES\n}, {\n  source: 'chapter',\n  target: 'chapter-number'\n}, {\n  source: 'number',\n  target: 'collection-number',\n  when: {\n    source: {\n      [TYPE]: ['book', 'mvbook', 'inbook', 'collection', 'mvcollection', 'incollection', 'suppcollection', 'manual', 'suppperiodical', 'proceedings', 'mvproceedings', 'refererence']\n    },\n    target: {\n      type: ['bill', 'book', 'broadcast', 'chapter', 'dataset', 'entry', 'entry-dictionary', 'entry-encyclopedia', 'figure', 'graphic', 'interview', 'legislation', 'legal_case', 'manuscript', 'map', 'motion_picture', 'musical_score', 'pamphlet', 'post', 'post-weblog', 'personal_communication', 'review', 'review-book', 'song', 'speech', 'thesis', 'treaty', 'webpage']\n    }\n  }\n}, {\n  source: 'series',\n  target: 'collection-title'\n}, {\n  source: 'booktitle',\n  target: 'container-title',\n  when: {\n    target: {\n      type: ['chapter', 'paper-conference']\n    }\n  }\n}, {\n  source: 'journal',\n  target: 'container-title',\n  when: {\n    source: {\n      [TYPE]: 'article'\n    },\n    target: {\n      type: ['article', 'article-newspaper', 'article-journal', 'article-magazine']\n    }\n  }\n}, {\n  source: 'edition',\n  target: 'edition'\n}, {\n  source: 'editor',\n  target: 'editor',\n  convert: Converters.NAMES\n}, {\n  source: LABEL,\n  target: ['id', 'citation-key', 'author', 'issued', 'year-suffix', 'title'],\n  convert: Converters.LABEL\n}, {\n  source: 'number',\n  target: 'issue',\n  when: {\n    source: {\n      [TYPE]: ['article', 'periodical', 'inproceedings']\n    },\n    target: {\n      issue(issue) {\n        return typeof issue === 'number' || typeof issue === 'string' && issue.match(/\\d+/);\n      },\n      type: ['article', 'article-journal', 'article-newspaper', 'article-magazine', 'paper-conference', 'periodical']\n    }\n  }\n}, {\n  source: ['year', 'month', 'day'],\n  target: 'issued',\n  convert: Converters.YEAR_MONTH\n}, {\n  source: 'note',\n  target: 'note'\n}, {\n  source: 'number',\n  target: 'number',\n  when: {\n    source: {\n      [TYPE]: ['patent', 'report', 'techreport']\n    },\n    target: {\n      type: ['patent', 'report']\n    }\n  }\n}, {\n  source: 'pages',\n  target: 'page',\n  convert: Converters.PAGES\n}, {\n  source: 'publisher',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    target: {\n      type: ['article', 'article-journal', 'article-magazine', 'article-newspaper', 'bill', 'book', 'broadcast', 'chapter', 'classic', 'collection', 'dataset', 'document', 'entry', 'entry-dictionary', 'entry-encyclopedia', 'event', 'figure', 'graphic', 'hearing', 'interview', 'legal_case', 'legislation', 'map', 'motion_picture', 'musical_score', 'pamphlet', 'patent', 'performance', 'periodical', 'personal_communication', 'post', 'post-weblog', 'regulation', 'review', 'review-book', 'software', 'song', 'speech', 'standard', 'treaty', 'webpage']\n    }\n  }\n}, {\n  source: 'organization',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      publisher: false\n    },\n    target: {\n      type: 'paper-conference'\n    }\n  }\n}, {\n  source: 'institution',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      publisher: false,\n      organization: false\n    },\n    target: {\n      type: 'report'\n    }\n  }\n}, {\n  source: 'school',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      institution: false,\n      organization: false,\n      publisher: false\n    },\n    target: {\n      type: 'thesis'\n    }\n  }\n}, {\n  source: 'howpublished',\n  target: 'publisher',\n  convert: Converters.PICK,\n  when: {\n    source: {\n      howpublished(howPublished) {\n        return howPublished && !howPublished.startsWith('http');\n      },\n      publisher: false,\n      organization: false,\n      institution: false,\n      school: false\n    },\n    target: {\n      type: 'manuscript'\n    }\n  }\n}, {\n  source: 'title',\n  target: 'title'\n}, {\n  source: [TYPE, 'type'],\n  target: ['type', 'genre'],\n  convert: {\n    toTarget(sourceType, subType) {\n      const type = types.source[sourceType] || 'document';\n      if (subType) {\n        return [type, subType];\n      } else if (sourceType === 'mastersthesis') {\n        return [type, 'Master\\'s thesis'];\n      } else if (sourceType === 'phdthesis') {\n        return [type, 'PhD thesis'];\n      } else {\n        return [type];\n      }\n    },\n    toSource(targetType, genre) {\n      const type = types.target[targetType] || 'misc';\n      if (/^(master'?s|diploma) thesis$/i.test(genre)) {\n        return ['mastersthesis'];\n      } else if (/^(phd|doctoral) thesis$/i.test(genre)) {\n        return ['phdthesis'];\n      } else {\n        return [type, genre];\n      }\n    }\n  }\n}, {\n  source: TYPE,\n  when: {\n    target: {\n      type: false\n    }\n  },\n  convert: {\n    toSource() {\n      return 'misc';\n    }\n  }\n}, {\n  source: 'howpublished',\n  target: 'URL',\n  convert: Converters.HOW_PUBLISHED,\n  when: {\n    target: {\n      publisher: false\n    }\n  }\n}, {\n  source: 'volume',\n  target: 'volume'\n}]);","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst BOOK = new Set(['book', 'inbook', 'bookinbook', 'suppbook']);\nconst BOOK_PART = new Set(['inbook', 'bookinbook', 'suppbook']);\nconst COLLECTION = new Set(['collection', 'reference', 'incollection', 'inreference', 'suppcollection']);\nconst COLLECTION_PART = new Set(['incollection', 'inreference', 'suppcollection']);\nconst PROCEEDINGS = new Set(['proceedings', 'inproceedings']);\nconst PROCEEDINGS_PART = new Set(['inproceedings']);\nconst PERIODICAL_PART = new Set(['article', 'suppperiodical']);\nconst TITLE_MAP = {\n  mvbook: ['main', BOOK],\n  mvcollection: ['main', COLLECTION],\n  mvreference: ['main', COLLECTION],\n  mvproceedings: ['main', PROCEEDINGS],\n  book: ['book', BOOK_PART],\n  collection: ['book', COLLECTION_PART],\n  reference: ['book', COLLECTION_PART],\n  proceedings: ['book', PROCEEDINGS_PART],\n  periodical: ['journal', PERIODICAL_PART]\n};\nexport function crossref(target, entry, registry) {\n  if (entry.crossref in registry) {\n    const parent = registry[entry.crossref];\n    if (parent.properties === entry) {\n      return entry;\n    }\n    const data = _objectSpread({}, crossref(parent.type, parent.properties, registry));\n    delete data.ids;\n    delete data.crossref;\n    delete data.xref;\n    delete data.entryset;\n    delete data.entrysubtype;\n    delete data.execute;\n    delete data.label;\n    delete data.options;\n    delete data.presort;\n    delete data.related;\n    delete data.relatedoptions;\n    delete data.relatedstring;\n    delete data.relatedtype;\n    delete data.shortand;\n    delete data.shortandintro;\n    delete data.sortkey;\n    if ((parent.type === 'mvbook' || parent.type === 'book') && BOOK_PART.has(target)) {\n      data.bookauthor = data.author;\n    }\n    if (parent.type in TITLE_MAP) {\n      const [prefix, targets] = TITLE_MAP[parent.type];\n      if (targets.has(target)) {\n        data[prefix + 'title'] = data.title;\n        data[prefix + 'subtitle'] = data.subtitle;\n        if (prefix !== 'journal') {\n          data[prefix + 'titleaddon'] = data.titleaddon;\n        }\n        delete data.title;\n        delete data.subtitle;\n        delete data.titleaddon;\n        delete data.shorttitle;\n        delete data.sorttitle;\n        delete data.indextitle;\n        delete data.indexsorttitle;\n      }\n    }\n    return Object.assign(data, entry);\n  }\n  return entry;\n}","function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { TYPE, LABEL } from './shared.js';\nimport biblatex from './biblatex.js';\nimport bibtex from './bibtex.js';\nimport { crossref } from './crossref.js';\nfunction _parse(input, spec) {\n  const registry = {};\n  for (const entry of input) {\n    registry[entry.label] = entry;\n  }\n  return input.map(({\n    type,\n    label,\n    properties\n  }) => spec.convertToTarget(_objectSpread({\n    [TYPE]: type,\n    [LABEL]: label\n  }, crossref(type, properties, registry))));\n}\nfunction _format(input, spec) {\n  return input.map(entry => {\n    const _spec$convertToSource = spec.convertToSource(entry),\n      {\n        [TYPE]: type,\n        [LABEL]: label\n      } = _spec$convertToSource,\n      properties = _objectWithoutProperties(_spec$convertToSource, [TYPE, LABEL].map(_toPropertyKey));\n    return {\n      type,\n      label,\n      properties\n    };\n  });\n}\nexport function parseBibtex(input) {\n  return _parse(input, bibtex);\n}\nexport function formatBibtex(input) {\n  return _format(input, bibtex);\n}\nexport function parse(input) {\n  return _parse(input, biblatex);\n}\nexport function format(input) {\n  return _format(input, biblatex);\n}","export function getStringCase(string) {\n  const a = string.toUpperCase();\n  const b = string.toLowerCase();\n  for (let i = 0; i < string.length; i++) {\n    if (a[i] !== b[i]) {\n      return a[i] === string[i];\n    }\n  }\n  return null;\n}\nexport function formatNameParts(parts) {\n  if (parts.length === 0) {\n    return undefined;\n  }\n  let piece = '';\n  while (parts.length > 1) {\n    const {\n      value,\n      hyphenated\n    } = parts.shift();\n    piece += value + (hyphenated ? '-' : ' ');\n  }\n  const output = piece + parts[0].value;\n  return output[0] && output;\n}\nexport function orderNameParts(parts, orderGiven = true) {\n  const given = [];\n  const undecided = [];\n  if (orderGiven) {\n    while (parts.length > 1 && parts[0].upperCase !== false) {\n      given.push(...undecided);\n      undecided.length = 0;\n      while (parts.length > 1 && parts[0].upperCase !== false && !parts[0].hyphenated) {\n        given.push(parts.shift());\n      }\n      while (parts.length > 0 && parts[0].upperCase !== false && parts[0].hyphenated) {\n        undecided.push(parts.shift());\n      }\n    }\n  }\n  const prefix = [];\n  const family = [];\n  while (parts.length > 1) {\n    prefix.push(...family);\n    family.length = 0;\n    while (parts.length > 1 && parts[0].upperCase === false) {\n      prefix.push(parts.shift());\n    }\n    while (parts.length > 0 && parts[0].upperCase !== false) {\n      family.push(parts.shift());\n    }\n  }\n  if (undecided.length) {\n    family.unshift(...undecided);\n  }\n  if (parts.length) {\n    family.push(parts[0]);\n  }\n  return [formatNameParts(given), formatNameParts(prefix), formatNameParts(family)];\n}\nexport function orderNamePieces(pieces) {\n  if (pieces[0][0].label) {\n    const name = {};\n    for (const [{\n      value,\n      label\n    }] of pieces) {\n      name[label] = value;\n    }\n    return name;\n  }\n  const name = {};\n  const [given, prefix, family] = orderNameParts(pieces[0], pieces.length === 1);\n  if (family) {\n    name.family = family;\n  }\n  if (prefix) {\n    name.prefix = prefix;\n  }\n  if (pieces.length === 3) {\n    name.given = formatNameParts(pieces[2]);\n    name.suffix = formatNameParts(pieces[1]);\n  } else if (pieces.length === 2) {\n    name.given = formatNameParts(pieces[1]);\n  } else if (given) {\n    name.given = given;\n  }\n  return name;\n}","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { util } from '@citation-js/core';\nimport moo from 'moo';\nimport config from '../config.js';\nimport * as constants from './constants.js';\nimport { orderNamePieces, formatNameParts, getStringCase } from './name.js';\nconst text = {\n  command: {\n    match: /\\\\(?:[a-zA-Z]+|.) */,\n    type: moo.keywords({\n      commandBegin: '\\\\begin',\n      commandEnd: '\\\\end'\n    }),\n    value: s => s.slice(1).trim()\n  },\n  lbrace: {\n    match: '{',\n    push: 'bracedLiteral'\n  },\n  mathShift: {\n    match: '$',\n    push: 'mathLiteral'\n  },\n  whitespace: {\n    match: /[\\s]+|~/,\n    lineBreaks: true,\n    value(token) {\n      return token === '~' ? '\\xa0' : ' ';\n    }\n  }\n};\nconst lexer = moo.states({\n  stringLiteral: _objectSpread(_objectSpread({}, text), {}, {\n    text: /[^{$}\\s~\\\\]+/\n  }),\n  namesLiteral: _objectSpread(_objectSpread({\n    and: /\\s+[aA][nN][dD]\\s+/,\n    comma: ',',\n    hyphen: '-',\n    equals: '='\n  }, text), {}, {\n    text: /[^{$}\\s~\\\\,=-]+/\n  }),\n  listLiteral: _objectSpread(_objectSpread({\n    and: /\\s+and\\s+/\n  }, text), {}, {\n    text: /[^{$}\\s~\\\\]+/\n  }),\n  separatedLiteral: _objectSpread(_objectSpread({\n    comma: ','\n  }, text), {}, {\n    text: /[^{$}\\s~\\\\,]+/\n  }),\n  bracedLiteral: _objectSpread(_objectSpread({}, text), {}, {\n    rbrace: {\n      match: '}',\n      pop: true\n    },\n    text: /[^{$}\\s~\\\\]+/\n  }),\n  mathLiteral: _objectSpread(_objectSpread({}, text), {}, {\n    mathShift: {\n      match: '$',\n      pop: true\n    },\n    script: /[\\^_]/,\n    text: /[^{$}\\s~\\\\^_]+/\n  })\n});\nfunction flattenConsString(string) {\n  string[0];\n  return string;\n}\nfunction applyFormatting(text, format) {\n  if (format in constants.formatting) {\n    return text && constants.formatting[format].join(text);\n  } else {\n    return text;\n  }\n}\nexport const valueGrammar = new util.Grammar({\n  String() {\n    let output = '';\n    while (!this.matchEndOfFile()) {\n      output += this.consumeRule('Text');\n    }\n    return flattenConsString(output);\n  },\n  StringNames() {\n    const list = [];\n    while (true) {\n      this.consumeToken('whitespace', true);\n      list.push(this.consumeRule('Name'));\n      this.consumeToken('whitespace', true);\n      if (this.matchEndOfFile()) {\n        return list;\n      } else {\n        this.consumeToken('and');\n      }\n    }\n  },\n  Name() {\n    const pieces = [];\n    while (true) {\n      pieces.push(this.consumeRule('NamePiece'));\n      if (this.matchEndOfFile() || this.matchToken('and')) {\n        return orderNamePieces(pieces);\n      } else {\n        this.consumeToken('comma');\n        this.consumeToken('whitespace', true);\n      }\n    }\n  },\n  NamePiece() {\n    const parts = [];\n    while (true) {\n      const part = this.consumeRule('NameToken');\n      if (part.label) {\n        part.label = formatNameParts([...parts, {\n          value: part.label\n        }]);\n        return [part];\n      }\n      parts.push(part);\n      if (this.matchEndOfFile() || this.matchToken('and') || this.matchToken('comma')) {\n        return parts;\n      } else {\n        while (this.matchToken('hyphen') || this.matchToken('whitespace')) {\n          this.consumeToken();\n        }\n      }\n    }\n  },\n  NameToken() {\n    let upperCase = null;\n    let value = '';\n    while (true) {\n      if (upperCase === null && this.matchToken('text')) {\n        const text = this.consumeToken().value;\n        value += text;\n        upperCase = getStringCase(text);\n      } else if (this.matchEndOfFile() || this.matchToken('and') || this.matchToken('comma') || this.matchToken('whitespace')) {\n        return {\n          value,\n          upperCase\n        };\n      } else if (this.matchToken('hyphen')) {\n        return {\n          value,\n          upperCase,\n          hyphenated: true\n        };\n      } else if (this.matchToken('equals')) {\n        this.consumeToken('equals');\n        const text = this.consumeRule('NamePiece');\n        if (text[0].label) {\n          value += '=' + text[0].label;\n        }\n        return {\n          value: formatNameParts(text),\n          label: value\n        };\n      } else {\n        value += this.consumeRule('Text');\n      }\n    }\n  },\n  StringList() {\n    const list = [];\n    while (!this.matchEndOfFile()) {\n      let output = '';\n      while (!this.matchEndOfFile() && !this.matchToken('and')) {\n        output += this.consumeRule('Text');\n      }\n      list.push(flattenConsString(output));\n      this.consumeToken('and', true);\n    }\n    return list.length === 1 ? list[0] : list;\n  },\n  StringSeparated() {\n    const list = [];\n    while (!this.matchEndOfFile()) {\n      let output = '';\n      while (!this.matchEndOfFile() && !this.matchToken('comma')) {\n        output += this.consumeRule('Text');\n      }\n      list.push(output.trim());\n      this.consumeToken('comma', true);\n      this.consumeToken('whitespace', true);\n    }\n    return list;\n  },\n  StringVerbatim() {\n    let output = '';\n    while (!this.matchEndOfFile()) {\n      output += this.consumeToken().text;\n    }\n    return flattenConsString(output);\n  },\n  StringUri() {\n    const uri = this.consumeRule('StringVerbatim');\n    try {\n      if (decodeURI(uri) === uri) {\n        return encodeURI(uri);\n      } else {\n        return uri;\n      }\n    } catch (e) {\n      return encodeURI(uri);\n    }\n  },\n  StringTitleCase() {\n    this.state.sentenceCase = true;\n    let output = '';\n    while (!this.matchEndOfFile()) {\n      output += this.consumeRule('Text');\n    }\n    return flattenConsString(output);\n  },\n  BracketString() {\n    var _this$state;\n    let output = '';\n    this.consumeToken('lbrace');\n    const sentenceCase = this.state.sentenceCase;\n    this.state.sentenceCase = sentenceCase && this.matchToken('command');\n    (_this$state = this.state).partlyLowercase && (_this$state.partlyLowercase = this.state.sentenceCase);\n    while (!this.matchToken('rbrace')) {\n      output += this.consumeRule('Text');\n    }\n    const topLevel = sentenceCase && !this.state.sentenceCase;\n    const protectCase = topLevel && this.state.partlyLowercase;\n    this.state.sentenceCase = sentenceCase;\n    this.consumeToken('rbrace');\n    return protectCase ? applyFormatting(output, 'nocase') : output;\n  },\n  MathString() {\n    let output = '';\n    this.consumeToken('mathShift');\n    while (!this.matchToken('mathShift')) {\n      if (this.matchToken('script')) {\n        const script = this.consumeToken('script').value;\n        const text = this.consumeRule('Text').split('');\n        if (text.every(char => char in constants.mathScripts[script])) {\n          output += text.map(char => constants.mathScripts[script][char]).join('');\n        } else {\n          const formatName = constants.mathScriptFormatting[script];\n          output += constants.formatting[formatName].join(text.join(''));\n        }\n        continue;\n      }\n      if (this.matchToken('command')) {\n        const command = this.token.value;\n        if (command in constants.mathScriptFormatting) {\n          this.consumeToken('command');\n          const text = this.consumeRule('BracketString');\n          output += applyFormatting(text, constants.mathScriptFormatting[command]);\n          continue;\n        }\n      }\n      output += this.consumeRule('Text');\n    }\n    this.consumeToken('mathShift');\n    return output;\n  },\n  Text() {\n    if (this.matchToken('lbrace')) {\n      return this.consumeRule('BracketString');\n    } else if (this.matchToken('mathShift')) {\n      return this.consumeRule('MathString');\n    } else if (this.matchToken('whitespace')) {\n      return this.consumeToken('whitespace').value;\n    } else if (this.matchToken('commandBegin')) {\n      return this.consumeRule('EnclosedEnv');\n    } else if (this.matchToken('command')) {\n      return this.consumeRule('Command');\n    }\n    const text = this.consumeToken('text').value.replace(constants.ligaturePattern, ligature => constants.ligatures[ligature]);\n    const afterPunctuation = this.state.afterPunctuation;\n    this.state.afterPunctuation = /[?!.:]$/.test(text);\n    if (!this.state.sentenceCase) {\n      var _this$state2;\n      (_this$state2 = this.state).partlyLowercase || (_this$state2.partlyLowercase = text === text.toLowerCase() && text !== text.toUpperCase());\n      return text;\n    }\n    const [first, ...otherCharacters] = text;\n    const rest = otherCharacters.join('');\n    const restLowerCase = rest.toLowerCase();\n    if (rest !== restLowerCase) {\n      return text;\n    }\n    if (!afterPunctuation) {\n      return text.toLowerCase();\n    }\n    return first + restLowerCase;\n  },\n  Command() {\n    const commandToken = this.consumeToken('command');\n    const command = commandToken.value;\n    if (command in constants.formattingEnvs) {\n      const text = this.consumeRule('Env');\n      const format = constants.formattingEnvs[command];\n      return applyFormatting(text, format);\n    } else if (command in constants.formattingCommands) {\n      const text = this.consumeRule('BracketString');\n      const format = constants.formattingCommands[command];\n      return applyFormatting(text, format);\n    } else if (command in constants.commands) {\n      return constants.commands[command];\n    } else if (command in constants.diacritics && !this.matchEndOfFile()) {\n      const text = this.consumeRule('Text');\n      const diacritic = text[0] + constants.diacritics[command];\n      return diacritic.normalize('NFC') + text.slice(1);\n    } else if (command in constants.argumentCommands) {\n      const func = constants.argumentCommands[command];\n      const args = [];\n      let arity = func.length;\n      while (arity-- > 0) {\n        this.consumeToken('whitespace', true);\n        args.push(this.consumeRule('BracketString'));\n      }\n      return func(...args);\n    } else if (/^[&%$#_{}]$/.test(command)) {\n      return commandToken.text.slice(1);\n    } else {\n      return commandToken.text;\n    }\n  },\n  Env() {\n    let output = '';\n    while (!this.matchEndOfFile() && !this.matchToken('rbrace')) {\n      output += this.consumeRule('Text');\n    }\n    return output;\n  },\n  EnclosedEnv() {\n    this.consumeToken('commandBegin');\n    const beginEnv = this.consumeRule('BracketString');\n    let output = '';\n    while (!this.matchToken('commandEnd')) {\n      output += this.consumeRule('Text');\n    }\n    const end = this.consumeToken('commandEnd');\n    const endEnv = this.consumeRule('BracketString');\n    if (beginEnv !== endEnv) {\n      throw new SyntaxError(this.lexer.formatError(end, `environment started with \"${beginEnv}\", ended with \"${endEnv}\"`));\n    }\n    return applyFormatting(output, constants.formattingEnvs[beginEnv]);\n  }\n}, {\n  sentenceCase: false,\n  partlyLowercase: false,\n  afterPunctuation: true\n});\nfunction singleLanguageIsEnglish(language) {\n  return constants.sentenceCaseLanguages.includes(language.toLowerCase());\n}\nfunction isEnglish(languages) {\n  if (Array.isArray(languages)) {\n    return languages.every(singleLanguageIsEnglish);\n  }\n  return singleLanguageIsEnglish(languages);\n}\nfunction getMainRule(fieldType, languages) {\n  if (fieldType[1] === 'name') {\n    return fieldType[0] === 'list' ? 'StringNames' : 'Name';\n  }\n  if (fieldType[1] === 'title') {\n    const option = config.parse.sentenceCase;\n    if (option === 'always' || option === 'english' && isEnglish(languages)) {\n      return 'StringTitleCase';\n    } else {\n      return 'String';\n    }\n  }\n  switch (fieldType[0] === 'field' ? fieldType[1] : fieldType[0]) {\n    case 'list':\n      return 'StringList';\n    case 'separated':\n      return 'StringSeparated';\n    case 'verbatim':\n      return 'StringVerbatim';\n    case 'uri':\n      return 'StringUri';\n    case 'title':\n    case 'literal':\n    default:\n      return 'String';\n  }\n}\nfunction getLexerState(fieldType) {\n  if (fieldType[1] === 'name') {\n    return 'namesLiteral';\n  }\n  switch (fieldType[0]) {\n    case 'list':\n      return 'listLiteral';\n    case 'separated':\n      return 'separatedLiteral';\n    case 'field':\n    default:\n      return 'stringLiteral';\n  }\n}\nexport function parse(text, field, languages = []) {\n  const fieldType = constants.fieldTypes[field] || [];\n  return valueGrammar.parse(lexer.reset(text, {\n    state: getLexerState(fieldType),\n    line: 0,\n    col: 0\n  }), getMainRule(fieldType, languages));\n}","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport config from '../config.js';\nimport { parse as mapBiblatex, parseBibtex as mapBibtex } from '../mapping/index.js';\nimport { parse as parseValue } from './value.js';\nimport { required } from './constants.js';\nfunction validate(entries, requirements) {\n  const problems = [];\n  for (const {\n    type,\n    label,\n    properties\n  } of entries) {\n    if (type in requirements) {\n      const missing = [];\n      for (const field of requirements[type]) {\n        if (Array.isArray(field) && !field.some(field => field in properties)) {\n          missing.push(field.join('/'));\n        } else if (typeof field === 'string' && !(field in properties)) {\n          missing.push(field);\n        }\n      }\n      if (missing.length) {\n        problems.push([label, `missing fields: ${missing.join(', ')}`]);\n      }\n    } else {\n      problems.push([label, `invalid type: \"${type}\"`]);\n    }\n  }\n  if (problems.length) {\n    throw new RangeError(['Invalid entries:'].concat(problems.map(([label, problem]) => `  - ${label} has ${problem}`)).join('\\n'));\n  }\n}\nfunction parseEntryValues(entry) {\n  const output = {};\n  if ('language' in entry.properties) {\n    output.language = parseValue(entry.properties.language, 'language');\n  }\n  for (const property in entry.properties) {\n    const value = entry.properties[property];\n    if (value === '') {\n      continue;\n    }\n    output[property] = parseValue(value + '', property, output.language);\n  }\n  return _objectSpread(_objectSpread({}, entry), {}, {\n    properties: output\n  });\n}\nexport function parse(entries) {\n  if (config.parse.strict) {\n    validate(entries, required.biblatex);\n  }\n  return mapBiblatex(entries.map(parseEntryValues));\n}\nexport function parseBibtex(entries) {\n  if (config.parse.strict) {\n    validate(entries, required.bibtex);\n  }\n  return mapBibtex(entries.map(parseEntryValues));\n}","import { parse as parseFile } from './file.js';\nimport { parse as parseBibtxt } from './bibtxt.js';\nimport { parse as parseEntries, parseBibtex } from './entries.js';\nexport const ref = '@bibtex';\nexport const formats = {\n  '@biblatex/text': {\n    parse: parseFile,\n    parseType: {\n      dataType: 'String',\n      predicate: /@\\s{0,5}[A-Za-z]{1,13}\\s{0,5}\\{\\s{0,5}[^@{}\"=,\\\\\\s]{0,100}\\s{0,5},[\\s\\S]*\\}/\n    }\n  },\n  '@biblatex/entry+object': {\n    parse(input) {\n      return parseEntries([input]);\n    },\n    parseType: {\n      dataType: 'SimpleObject',\n      propertyConstraint: {\n        props: ['type', 'label', 'properties']\n      }\n    }\n  },\n  '@biblatex/entries+list': {\n    parse: parseEntries,\n    parseType: {\n      elementConstraint: '@biblatex/entry+object'\n    }\n  },\n  '@bibtex/text': {\n    parse: parseFile,\n    outputs: '@bibtex/entries+list'\n  },\n  '@bibtex/entry+object': {\n    parse(input) {\n      return parseBibtex([input]);\n    }\n  },\n  '@bibtex/entries+list': {\n    parse: parseBibtex\n  },\n  '@bibtxt/text': {\n    parse: parseBibtxt,\n    parseType: {\n      dataType: 'String',\n      predicate: /^\\s*(\\[(?!\\s*[{[]).*?\\]\\s*(\\n\\s*[^[]((?!:)\\S)+\\s*:\\s*.+?\\s*)*\\s*)+$/\n    }\n  }\n};","import { diacritics, commands, ligatures, fieldTypes } from '../input/constants.js';\nconst unicode = {};\nfor (const command in commands) {\n  unicode[commands[command]] = command;\n}\nfor (const diacritic in diacritics) {\n  unicode[diacritics[diacritic]] = diacritic;\n}\nfor (const ligature in ligatures) {\n  unicode[ligatures[ligature]] = ligature;\n}\nconst UNSAFE_UNICODE = /[^a-zA-Z0-9\\s!\"#%&'()*+,\\-./:;=?@[\\]{}\\u0300-\\u0308\\u030a-\\u030c\\u0332\\u0323\\u0327\\u0328\\u0361\\u0326]/g;\nconst DIACRITIC_PATTERN = /.[\\u0300-\\u0308\\u030a-\\u030c\\u0332\\u0323\\u0327\\u0328\\u0361\\u0326]+/g;\nconst listDelimiters = {\n  separated: ',',\n  list: ' and '\n};\nconst richTextMappings = {\n  i: '\\\\textit{',\n  b: '\\\\textbf{',\n  sc: '\\\\textsc{',\n  sup: '\\\\textsuperscript{',\n  sub: '\\\\textsubscript{',\n  'span style=\"font-variant:small-caps;\"': '\\\\textsc{',\n  'span class=\"nocase\"': '{'\n};\nfunction escapeValue(value) {\n  return value.normalize('NFKD').replace(UNSAFE_UNICODE, char => char in unicode ? unicode[char] in ligatures ? unicode[char] : `\\\\${unicode[char]}{}` : '').replace(DIACRITIC_PATTERN, match => Array.from(match).reduce((subject, diacritic) => `{\\\\${unicode[diacritic]} ${subject}}`));\n}\nfunction formatRichText(value) {\n  const closingTags = [];\n  let tokens = value.split(/<(\\/?(?:i|b|sc|sup|sub|span)|span .*?)>/g);\n  tokens = tokens.map((token, index) => {\n    if (index % 2 === 0) {\n      return escapeValue(token);\n    } else if (token in richTextMappings) {\n      closingTags.push('/' + token.split(' ')[0]);\n      return richTextMappings[token];\n    } else if (token === closingTags[closingTags.length - 1]) {\n      closingTags.pop();\n      return '}';\n    } else {\n      return '';\n    }\n  });\n  return tokens.join('');\n}\nfunction formatName(name) {\n  if (name.family && !name.prefix && !name.given & !name.suffix) {\n    return name.family.includes(listDelimiters.list) ? name.family : `{${name.family}}`;\n  }\n  const parts = [''];\n  if (name.prefix && name.family) {\n    parts[0] += name.prefix + ' ';\n  }\n  if (name.family) {\n    parts[0] += name.family;\n  }\n  if (name.suffix) {\n    parts.push(name.suffix);\n    parts.push(name.given || '');\n  } else {\n    parts.push(name.given);\n  }\n  return escapeValue(parts.join(', ').trim());\n}\nfunction formatTitle(title) {\n  return formatRichText(title).split(/(:\\s*)/).map((part, i) => i % 2 ? part : part.replace(/(?!^)\\b[a-z]*[A-Z].*?\\b/g, '{$&}')).join('');\n}\nfunction formatSingleValue(value, valueType) {\n  switch (valueType) {\n    case 'title':\n      return formatTitle(value);\n    case 'literal':\n      return formatRichText(value.toString());\n    case 'name':\n      return formatName(value);\n    case 'verbatim':\n    case 'uri':\n      return value.toString();\n    default:\n      return escapeValue(value.toString());\n  }\n}\nfunction formatList(values, valueType, listType) {\n  const delimiter = listDelimiters[listType];\n  return values.map(value => {\n    const formatted = formatSingleValue(value, valueType);\n    return formatted.includes(delimiter) ? `{${formatted}}` : formatted;\n  }).join(delimiter);\n}\nexport function format(field, value) {\n  if (!(field in fieldTypes)) {\n    return formatSingleValue(value, 'verbatim');\n  }\n  const [listType, valueType] = fieldTypes[field];\n  if (listType in listDelimiters) {\n    return formatList(value, valueType, listType);\n  } else {\n    return formatSingleValue(value, valueType);\n  }\n}","import { format as mapBiblatex, formatBibtex as mapBibtex } from '../mapping/index.js';\nimport { format as formatValue } from './value.js';\nfunction formatEntryValues({\n  type,\n  label,\n  properties\n}) {\n  const output = {};\n  for (const property in properties) {\n    const value = properties[property];\n    output[property] = formatValue(property, value);\n  }\n  return {\n    type,\n    label,\n    properties: output\n  };\n}\nexport function format(entries) {\n  return mapBiblatex(entries).map(formatEntryValues);\n}\nexport function formatBibtex(entries) {\n  return mapBibtex(entries).map(formatEntryValues);\n}","function formatEntry({\n  type,\n  label,\n  properties\n}, dict) {\n  const fields = Object.entries(properties).map(([field, value]) => dict.listItem.join(`${field} = {${value}},`));\n  return dict.entry.join(`@${type}{${label},${dict.list.join(fields.join(''))}}`);\n}\nexport function format(src, dict) {\n  const entries = src.map(entry => formatEntry(entry, dict)).join('');\n  return dict.bibliographyContainer.join(entries);\n}","import { plugins } from '@citation-js/core';\nimport { format as mapBiblatex, formatBibtex as mapBibtex } from './entries.js';\nimport { format } from './bibtex.js';\nimport { format as formatBibtxt } from './bibtxt.js';\nconst factory = function (mapper, formatter) {\n  return function (data, opts = {}) {\n    const {\n      type,\n      format = type || 'text'\n    } = opts;\n    data = mapper(data);\n    if (format === 'object') {\n      return data;\n    } else if (plugins.dict.has(format)) {\n      return formatter(data, plugins.dict.get(format), opts);\n    } else {\n      throw new RangeError(`Output dictionary \"${format}\" not available`);\n    }\n  };\n};\nexport default {\n  bibtex: factory(mapBibtex, format),\n  biblatex: factory(mapBiblatex, format),\n  bibtxt: factory(mapBibtex, formatBibtxt)\n};","function formatEntry({\n  type,\n  label,\n  properties\n}, dict) {\n  const fields = Object.entries(properties).concat([['type', type]]).map(([field, value]) => dict.listItem.join(`${field}: ${value}`));\n  return dict.entry.join(`[${label}]${dict.list.join(fields.join(''))}`);\n}\nexport function format(src, dict) {\n  const entries = src.map(entry => formatEntry(entry, dict)).join('\\n');\n  return dict.bibliographyContainer.join(entries);\n}","import { plugins } from '@citation-js/core';\nimport { ref, formats as input } from './input/index.js';\nimport config from './config.js';\nimport output from './output/index.js';\nplugins.add(ref, {\n  input,\n  output,\n  config\n});","import { util } from '@citation-js/core';\nimport defaultLocales from './locales.json';\nconst locales = new util.Register(defaultLocales);\nconst fetchLocale = lang => {\n  if (locales.has(lang)) {\n    return locales.get(lang);\n  } else {\n    return locales.get('en-US');\n  }\n};\nexport default fetchLocale;\nexport { locales };","import { util } from '@citation-js/core';\nimport defaultTemplates from './styles.json';\nconst templates = new util.Register(defaultTemplates);\nconst fetchStyle = style => {\n  if (templates.has(style)) {\n    return templates.get(style);\n  } else {\n    return templates.get('apa');\n  }\n};\nexport default fetchStyle;\nexport { templates };","import CSL from 'citeproc';\nimport { templates } from './styles.js';\nimport { locales } from './locales.js';\nconst proxied = Symbol.for('proxied');\nconst getWrapperProxy = function (original) {\n  const proxy = function (state, entry) {\n    if (state.sys.wrapBibliographyEntry) {\n      const [prefix, postfix] = state.sys.wrapBibliographyEntry(this.system_id);\n      entry = [prefix, entry, postfix].join('');\n    }\n    return original.call(this, state, entry);\n  };\n  proxy[proxied] = true;\n  return proxy;\n};\nfor (const format in CSL.Output.Formats) {\n  const original = CSL.Output.Formats[format]['@bibliography/entry'];\n  if (!original || original[proxied]) {\n    continue;\n  }\n  CSL.Output.Formats[format]['@bibliography/entry'] = getWrapperProxy(original);\n}\nfunction retrieveLocale(locale) {\n  if (locales.has(locale)) {\n    return locales.get(locale);\n  }\n  const unnormalised = locale.replace('-', '_');\n  if (locales.has(unnormalised)) {\n    return locales.get(unnormalised);\n  }\n  return {};\n}\nconst engines = {};\nconst fetchEngine = function (style, locale, styleXml, retrieveItem, retrieveLocale) {\n  const engineHash = `${style}|${locale}`;\n  let engine;\n  if (engines[engineHash] instanceof CSL.Engine) {\n    engine = engines[engineHash];\n    engine.sys.retrieveItem = retrieveItem;\n    engine.sys.wrapBibliographyEntry = undefined;\n    engine.updateItems([]);\n  } else {\n    engine = engines[engineHash] = new CSL.Engine({\n      retrieveLocale,\n      retrieveItem\n    }, styleXml, locale, true);\n  }\n  return engine;\n};\nconst prepareEngine = function (data, style, locale, format) {\n  if (!CSL.Output.Formats[format] || !CSL.Output.Formats[format]['@bibliography/entry']) {\n    throw new TypeError(`Cannot find format '${format}'`);\n  }\n  const items = data.reduce((store, entry) => {\n    store[entry.id] = entry;\n    return store;\n  }, {});\n  const template = templates.get(templates.has(style) ? style : 'apa');\n  locale = locales.has(locale) ? locale : undefined;\n  const callback = function (key) {\n    if (Object.prototype.hasOwnProperty.call(items, key)) {\n      return items[key];\n    } else {\n      throw new Error(`Cannot find entry with id '${key}'`);\n    }\n  };\n  const engine = fetchEngine(style, locale, template, callback, retrieveLocale);\n  engine.setOutputFormat(format);\n  return engine;\n};\nexport default prepareEngine;\nexport { fetchEngine };","import { util } from '@citation-js/core';\nimport prepareEngine from './engines.js';\nimport { getPrefixedEntry } from './attr.js';\nconst getAffix = (source, affix) => typeof affix === 'function' ? affix(source) : affix || '';\nexport default function bibliography(data, options = {}) {\n  const {\n    template = 'apa',\n    lang,\n    format = 'text',\n    nosort = false\n  } = options;\n  const ids = options.entry ? [].concat(options.entry) : data.map(({\n    id\n  }) => id);\n  data = util.downgradeCsl(data);\n  const citeproc = prepareEngine(data, template, lang, format);\n  const sortedIds = citeproc.updateItems(ids, nosort);\n  if (options.append || options.prepend) {\n    const items = data.reduce((items, entry) => {\n      items[entry.id] = entry;\n      return items;\n    }, {});\n    citeproc.sys.wrapBibliographyEntry = function (id) {\n      const entry = items[id];\n      return [getAffix(entry, options.prepend), getAffix(entry, options.append)];\n    };\n  }\n  const bibliography = citeproc.makeBibliography();\n  const [{\n    bibstart,\n    bibend\n  }, bibBody] = bibliography;\n  const entries = bibBody.map((element, index) => getPrefixedEntry(element, sortedIds[index]));\n  if (options.asEntryArray) {\n    return entries.map((element, index) => [sortedIds[index], element]);\n  }\n  return bibstart + entries.join('') + bibend;\n}","import { util } from '@citation-js/core';\nimport prepareEngine from './engines.js';\nfunction prepareCiteItem(citeItem) {\n  return typeof citeItem === 'object' ? citeItem : {\n    id: citeItem\n  };\n}\nfunction prepareCitation(citation) {\n  if (citation.citationItems) {\n    return citation;\n  }\n  return {\n    citationItems: [].concat(citation).map(prepareCiteItem),\n    properties: {\n      noteIndex: 0\n    }\n  };\n}\nfunction prepareCitations(context) {\n  if (!context) {\n    return [];\n  }\n  return context.map(prepareCitation);\n}\nexport default function citation(data, options = {}) {\n  const {\n    template = 'apa',\n    lang,\n    format = 'text'\n  } = options;\n  const ids = data.map(({\n    id\n  }) => id);\n  const entries = options.entry ? options.entry : ids;\n  data = util.downgradeCsl(data);\n  const citeproc = prepareEngine(data, template, lang, format);\n  const before = prepareCitations(options.citationsPre);\n  const citation = prepareCitation(entries);\n  const after = prepareCitations(options.citationsPost);\n  const output = citeproc.rebuildProcessorState([...before, citation, ...after], format, []);\n  return output[before.length][2];\n}","import { plugins } from '@citation-js/core';\nimport { locales } from './locales.js';\nimport { templates } from './styles.js';\nimport engine from './engines.js';\nimport bibliography from './bibliography.js';\nimport citation from './citation.js';\nplugins.add('@csl', {\n  output: {\n    bibliography,\n    citation\n  },\n  config: {\n    engine,\n    locales,\n    templates\n  }\n});","const getAttributedEntry = (string, name, value) => string.replace(/^\\s*<[a-z]+/i, `$& data-${name}=\"${value}\"`);\nconst getPrefixedEntry = (value, id) => getAttributedEntry(value, 'csl-entry-id', id);\nexport { getAttributedEntry, getPrefixedEntry };","/*\nCopyright (c) 2009-2019 Frank Bennett\n\n\tThis program is free software: you can redistribute it and/or\n\tmodify it under EITHER\n\n      * the terms of the Common Public Attribution License (CPAL) as\n\t    published by the Open Source Initiative, either version 1 of\n\t    the CPAL, or (at your option) any later version; OR\n\n      * the terms of the GNU Affero General Public License (AGPL)\n        as published by the Free Software Foundation, either version\n        3 of the AGPL, or (at your option) any later version.\n\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n\tAffero General Public License for more details.\n\n\tYou should have received copies of the Common Public Attribution\n    License and of the GNU Affero General Public License along with\n    this program.  If not, see <https://opensource.org/licenses/> or\n    <http://www.gnu.org/licenses/> respectively.\n*/\n/*global CSL: true */\n\n/**\n * A Javascript implementation of the CSL citation formatting language.\n *\n * <p>A configured instance of the process is built in two stages,\n * using {@link CSL.Core.Build} and {@link CSL.Core.Configure}.\n * The former sets up hash-accessible locale data and imports the CSL format file\n * to be applied to the citations,\n * transforming it into a one-dimensional token list, and\n * registering functions and parameters on each token as appropriate.\n * The latter sets jump-point information\n * on tokens that constitute potential branch\n * points, in a single back-to-front scan of the token list.\n * This\n * yields a token list that can be executed front-to-back by\n * body methods available on the\n * {@link CSL.Engine} class.</p>\n *\n * <p>This top-level {@link CSL} object itself carries\n * constants that are needed during processing.</p>\n * @namespace A CSL citation formatter.\n */\n\n// IE6 does not implement Array.indexOf().\n// IE7 neither, according to rumour.\n\n\n// Potential skip words:\n// under; along; out; between; among; outside; inside; amid; amidst; against; toward; towards.\n// See https://forums.zotero.org/discussion/30484/?Focus=159613#Comment_159613\n\n'use strict';\n\n\nvar CSL = {\n\n    PROCESSOR_VERSION: \"1.4.61\",\n\n    error: function(str) { // default error function\n        if (\"undefined\" === typeof Error) {\n            throw new Error(\"citeproc-js error: \" + str);\n        } else {\n            throw \"citeproc-js error: \" + str;\n        }\n    },\n    debug: function(str) { // default debug function\n        if (\"undefined\" === typeof console) {\n            dump(\"CSL: \" + str + \"\\n\");\n        } else {\n            console.log(\"citeproc-js warning: \" + str);\n        }\n    },\n\n    toLocaleUpperCase(str) {\n        var arr = this.tmp.lang_array;\n        try {\n            str = str.toLocaleUpperCase(arr);\n        } catch (e) {\n            str = str.toUpperCase();\n        }\n        return str;\n    },\n\n    toLocaleLowerCase(str) {\n        var arr = this.tmp.lang_array;\n        try {\n            str = str.toLocaleLowerCase(arr);\n        } catch (e) {\n            str = str.toLowerCase();\n        }\n        return str;\n    },\n\n    LOCATOR_LABELS_REGEXP: new RegExp(\"^((vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\\\.)\\\\s+(.*)\"),\n\n    STATUTE_SUBDIV_PLAIN_REGEX: /(?:(?:^| )(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\. *)/,\n    STATUTE_SUBDIV_PLAIN_REGEX_FRONT: /(?:^\\s*[.,;]*\\s*(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\. *)/,\n \n    STATUTE_SUBDIV_STRINGS: {\n        \"vrs.\": \"verse\",\n\t\t\"sv.\": \"sub-verbo\",\n        \"subpara.\": \"subparagraph\",\n        \"op.\": \"opus\",\n        \"subch.\": \"subchapter\",\n        \"add.\": \"addendum\",\n        \"amend.\": \"amendment\",\n        \"annot.\": \"annotation\",\n        \"app.\": \"appendix\",\n        \"art.\": \"article\",\n        \"bibliog.\": \"bibliography\",\n        \"bk.\": \"book\",\n        \"ch.\": \"chapter\",\n        \"cl.\": \"clause\",\n        \"col.\": \"column\",\n        \"cmt.\": \"comment\",\n        \"dec.\": \"decision\",\n        \"dept.\": \"department\",\n        \"ex.\": \"example\",\n        \"fig.\": \"figure\",\n        \"fld.\": \"field\",\n        \"fol.\": \"folio\",\n        \"n.\": \"note\",\n        \"hypo.\": \"hypothetical\",\n        \"illus.\": \"illustration\",\n        \"intro.\": \"introduction\",\n        \"l.\": \"line\",\n        \"no.\": \"issue\",\n        \"p.\": \"page\",\n        \"pp.\": \"page\",\n        \"para.\": \"paragraph\",\n        \"pt.\": \"part\",\n        \"pmbl.\": \"preamble\",\n        \"princ.\": \"principle\",\n        \"pub.\": \"publication\",\n        \"r.\": \"rule\",\n        \"rn.\": \"randnummer\",\n        \"sched.\": \"schedule\",\n        \"sec.\": \"section\",\n        \"ser.\": \"series,\",\n        \"subdiv.\": \"subdivision\",\n        \"subsec.\": \"subsection\",\n        \"supp.\": \"supplement\",\n        \"tbl.\": \"table\",\n        \"tit.\": \"title\",\n        \"vol.\": \"volume\"\n    },\n    STATUTE_SUBDIV_STRINGS_REVERSE: {\n        \"verse\": \"vrs.\",\n\t\t\"sub-verbo\": \"sv.\",\n        \"sub verbo\": \"sv.\",\n        \"subparagraph\": \"subpara.\",\n        \"opus\": \"op.\",\n        \"subchapter\": \"subch.\",\n        \"addendum\": \"add.\",\n        \"amendment\": \"amend.\",\n        \"annotation\": \"annot.\",\n        \"appendix\": \"app.\",\n        \"article\": \"art.\",\n        \"bibliography\": \"bibliog.\",\n        \"book\": \"bk.\",\n        \"chapter\": \"ch.\",\n        \"clause\": \"cl.\",\n        \"column\": \"col.\",\n        \"comment\": \"cmt.\",\n        \"decision\": \"dec.\",\n        \"department\": \"dept.\",\n        \"example\": \"ex.\",\n        \"figure\": \"fig.\",\n        \"field\": \"fld.\",\n        \"folio\": \"fol.\",\n        \"note\": \"n.\",\n        \"hypothetical\": \"hypo.\",\n        \"illustration\": \"illus.\",\n        \"introduction\": \"intro.\",\n        \"line\": \"l.\",\n        \"issue\": \"no.\",\n        \"page\": \"p.\",\n        \"paragraph\": \"para.\",\n        \"part\": \"pt.\",\n        \"preamble\": \"pmbl.\",\n        \"principle\": \"princ.\",\n        \"publication\": \"pub.\",\n        \"rule\": \"r.\",\n        \"randnummer\": \"rn.\",\n        \"schedule\": \"sched.\",\n        \"section\": \"sec.\",\n        \"series,\": \"ser.\",\n        \"subdivision\": \"subdiv.\",\n        \"subsection\": \"subsec.\",\n        \"supplement\": \"supp.\",\n        \"table\": \"tbl.\",\n        \"title\": \"tit.\",\n        \"volume\": \"vol.\"\n    },\n\n    LOCATOR_LABELS_MAP: {\n        \"vrs\": \"verse\",\n\t\t\"sv\": \"sub-verbo\",\n        \"subpara\": \"subparagraph\",\n        \"op\": \"opus\",\n        \"subch\": \"subchapter\",\n        \"add\": \"addendum\",\n        \"amend\": \"amendment\",\n        \"annot\": \"annotation\",\n        \"app\": \"appendix\",\n        \"art\": \"article\",\n        \"bibliog\": \"bibliography\",\n        \"bk\": \"book\",\n        \"ch\": \"chapter\",\n        \"cl\": \"clause\",\n        \"col\": \"column\",\n        \"cmt\": \"comment\",\n        \"dec\": \"decision\",\n        \"dept\": \"department\",\n        \"ex\": \"example\",\n        \"fig\": \"figure\",\n        \"fld\": \"field\",\n        \"fol\": \"folio\",\n        \"n\": \"note\",\n        \"hypo\": \"hypothetical\",\n        \"illus\": \"illustration\",\n        \"intro\": \"introduction\",\n        \"l\": \"line\",\n        \"no\": \"issue\",\n        \"p\": \"page\",\n        \"pp\": \"page\",\n        \"para\": \"paragraph\",\n        \"pt\": \"part\",\n        \"pmbl\": \"preamble\",\n        \"princ\": \"principle\",\n        \"pub\": \"publication\",\n        \"r\": \"rule\",\n        \"rn\": \"randnummer\",\n        \"sched\": \"schedule\",\n        \"sec\": \"section\",\n        \"ser\": \"series,\",\n        \"subdiv\": \"subdivision\",\n        \"subsec\": \"subsection\",\n        \"supp\": \"supplement\",\n        \"tbl\": \"table\",\n        \"tit\": \"title\",\n        \"vol\": \"volume\"\n    },\n    MODULE_MACROS: {\n        \"juris-pretitle\": true,\n        \"juris-title\": true,\n        \"juris-pretitle-short\": true,\n        \"juris-title-short\": true,\n        \"juris-main\": true,\n        \"juris-main-short\": true,\n        \"juris-tail\": true,\n        \"juris-tail-short\": true,\n        \"juris-locator\": true\n    },\n    MODULE_TYPES: {\n        \"legal_case\": true,\n        \"legislation\": true,\n        \"bill\": true,\n        \"hearing\": true,\n        \"gazette\": true,\n        \"report\": true,\n        \"regulation\": true,\n        \"standard\": true,\n        \"patent\": true,\n        \"locator\": true\n    },\n    checkNestedBrace: function(state) {\n        if (state.opt.xclass === \"note\") {\n            this.depth = 0;\n            this.update = function(str) {\n                \n                // Receives affix string, returns with flipped parens.\n                \n                var str = str ? str : \"\";\n                var lst = str.split(/([\\(\\)])/);\n                for (var i=1,ilen=lst.length;i<ilen;i += 2) {\n                    if (lst[i] === \"(\") {\n                        if (1 === (this.depth % 2)) {\n                            lst[i] = \"[\";\n                        }\n                        this.depth += 1;\n                    } else if (lst[i] === \")\") {\n                        if (0 === (this.depth % 2)) {\n                            lst[i] = \"]\";\n                        }\n                        this.depth -= 1;\n                    }\n                }\n                var ret = lst.join(\"\");\n                return ret;\n            };\n        } else {\n            this.update = function(str) {\n                return str;\n            };\n        }\n    },\n\n    MULTI_FIELDS: [\"event\", \"publisher\", \"publisher-place\", \"event-place\", \"title\", \"container-title\", \"collection-title\", \"authority\",\"genre\",\"title-short\",\"medium\",\"country\",\"jurisdiction\",\"archive\",\"archive-place\"],\n\n    LangPrefsMap: {\n        \"title\":\"titles\",\n        \"title-short\":\"titles\",\n        \"event\":\"titles\",\n        \"genre\":\"titles\",\n        \"medium\":\"titles\",\n        \"container-title\":\"journals\",\n        \"collection-title\":\"titles\",\n        \"archive\":\"journals\",\n        \"publisher\":\"publishers\",\n        \"authority\":\"publishers\",\n        \"publisher-place\": \"places\",\n        \"event-place\": \"places\",\n        \"archive-place\": \"places\",\n        \"jurisdiction\": \"places\",\n        \"number\": \"places\",\n        \"edition\":\"places\",\n        \"issue\":\"places\",\n        \"volume\":\"places\"\n    },\n\n    AbbreviationSegments: function () {\n        this[\"container-title\"] = {};\n        this[\"collection-title\"] = {};\n        this[\"institution-entire\"] = {};\n        this[\"institution-part\"] = {};\n        this.nickname = {};\n        this.number = {};\n        this.title = {};\n        this.place = {};\n        this.hereinafter = {};\n        this.classic = {};\n        this[\"container-phrase\"] = {};\n        this[\"title-phrase\"] = {};\n    },\n\n    getAbbrevsDomain: function (state, country, lang) {\n\t\tvar domain = null;\n        if (state.opt.availableAbbrevDomains && country && country !== \"default\") {\n\t        var globalDomainPreference = state.locale[state.opt.lang].opts[\"jurisdiction-preference\"];\n\t\t    var itemDomainPreference = null;\n\t\t    if (state.locale[lang]) {\n\t\t\t    itemDomainPreference = state.locale[lang].opts[\"jurisdiction-preference\"];\n\t\t    }\n\t\t    if (itemDomainPreference) {\n\t\t\t    for (var j=itemDomainPreference.length-1; j > -1; j--) {\n\t\t\t\t    if (state.opt.availableAbbrevDomains[country].indexOf(itemDomainPreference[j]) > -1) {\n\t\t\t\t\t    domain = itemDomainPreference[j];\n\t\t\t\t\t    break;\n\t\t\t\t    }\n\t\t\t    }\n\t\t    }\n\t\t    if (!domain && globalDomainPreference) {\n\t\t\t    for (var j=globalDomainPreference.length-1; j > -1; j--) {\n\t\t\t\t    if (state.opt.availableAbbrevDomains[country].indexOf(globalDomainPreference[j]) > -1) {\n\t\t\t\t\t    domain = globalDomainPreference[j];\n\t\t\t\t\t    break;\n\t\t\t\t    }\n\t\t\t    }\n\t\t    }\n        }\n        return domain;\n    },\n    \n    FIELD_CATEGORY_REMAP: {\n        \"title\": \"title\",\n        \"container-title\": \"container-title\",\n        \"collection-title\": \"collection-title\",\n        \"country\": \"place\",\n        \"number\": \"number\",\n        \"place\": \"place\",\n        \"archive\": \"container-title\",\n        \"title-short\": \"title\",\n        \"genre\": \"title\",\n        \"event\": \"title\",\n        \"medium\": \"title\",\n\t\t\"archive-place\": \"place\",\n\t\t\"publisher-place\": \"place\",\n\t\t\"event-place\": \"place\",\n\t\t\"jurisdiction\": \"place\",\n\t\t\"language-name\": \"place\",\n\t\t\"language-name-original\": \"place\",\n        \"call-number\": \"number\",\n        \"chapter-number\": \"number\",\n        \"collection-number\": \"number\",\n        \"edition\": \"number\",\n        \"page\": \"number\",\n        \"issue\": \"number\",\n        \"locator\": \"number\",\n        \"locator-extra\": \"number\",\n        \"number-of-pages\": \"number\",\n        \"number-of-volumes\": \"number\",\n        \"volume\": \"number\",\n        \"citation-number\": \"number\",\n        \"publisher\": \"institution-part\"\n    },\n    \n    parseLocator: function(item) {\n        if (this.opt.development_extensions.locator_date_and_revision) {\n            // Break out locator elements if necessary\n            if (item.locator) {\n                item.locator = \"\" + item.locator;\n                var idx = item.locator.indexOf(\"|\");\n                if (idx > -1) {\n                    var raw_locator = item.locator;\n                    item.locator = raw_locator.slice(0, idx);\n                    raw_locator = raw_locator.slice(idx + 1);\n                    var m = raw_locator.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/);\n                    if (m) {\n                        item[\"locator-date\"] = this.fun.dateparser.parseDateToObject(m[1]);\n                        raw_locator = raw_locator.slice(m[1].length);\n                    }\n                    item[\"locator-extra\"] = raw_locator.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\n                }\n            }\n        }\n        if (item.locator) {\n            item.locator = (\"\" + item.locator).replace(/\\s+$/, '');\n        }\n        return item;\n    },\n\n    normalizeLocaleStr: function(str) {\n        if (!str) {\n            return;\n        }\n        var lst = str.split('-');\n        lst[0] = lst[0].toLowerCase();\n        if (lst[1]) {\n            lst[1] = lst[1].toUpperCase();\n        }\n        return lst.join(\"-\");\n    },\n\n    parseNoteFieldHacks: function(Item, validFieldsForType, allowDateOverride) {\n        if (\"string\" !== typeof Item.note) {\n            return;\n        }\n        var elems = [];\n        var lines = Item.note.split('\\n');\n        // Normalize entries\n        for (var i=0, ilen=lines.length; i<ilen; i++) {\n            var line = lines[i];\n            var elems = [];\n            var m = line.match(CSL.NOTE_FIELDS_REGEXP);\n            if (m) {\n                var splt = line.split(CSL.NOTE_FIELDS_REGEXP);\n                for (var j=0,jlen=(splt.length-1);j<jlen;j++) {\n                    elems.push(splt[j]);\n                    elems.push(m[j]);\n                }\n                elems.push(splt[splt.length-1]);\n                for (var j=1,jlen=elems.length;j<jlen;j += 2) {\n                    // Abort conversions if preceded by unparseable text\n                    if (elems[j-1].trim() && (i>0 || j>1) && !elems[j-1].match(CSL.NOTE_FIELD_REGEXP)) {\n                        break;\n                    } else {\n                        elems[j] = '\\n' + elems[j].slice(2,-1).trim() + '\\n';\n                    }\n                }\n                lines[i] = elems.join('');\n            }\n        }\n        // Resplit\n        lines = lines.join('\\n').split('\\n');\n        var offset = 0;\n        var names = {};\n        for (var i=0,ilen=lines.length;i<ilen;i++) {\n            var line = lines[i];\n            var mm = line.match(CSL.NOTE_FIELD_REGEXP);\n            if (!line.trim()) {\n                continue;\n            } else if (!mm) {\n                if (i === 0) {\n                    continue;\n                } else {\n                    offset = i;\n                    break;\n                }\n            }\n            var key = mm[1];\n            var val = mm[2].replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\n            if (key === \"type\") {\n                Item.type = val;\n                lines[i] = \"\";\n            } else if (CSL.DATE_VARIABLES.indexOf(key.replace(/^alt-/, \"\")) > -1) {\n                if (!Item[key] || allowDateOverride) {\n                    Item[key] = CSL.DateParser.parseDateToArray(val);\n                    if (!validFieldsForType || (validFieldsForType[key] && this.isDateString(val))) {\n                        lines[i] = \"\";\n                    }\n                }\n            } else if (!Item[key]) {\n                if (CSL.NAME_VARIABLES.indexOf(key.replace(/^alt-/, \"\")) > -1) {\n                    if (!names[key]) {\n                        names[key] = [];\n                    }\n                    var lst = val.split(/\\s*\\|\\|\\s*/);\n                    if (lst.length === 1) {\n                        names[key].push({literal:lst[0]});\n                    } else if (lst.length === 2) {\n                        var name = {family:lst[0],given:lst[1]};\n                        CSL.parseParticles(name);\n                        names[key].push(name);\n                    }\n                } else {\n                    Item[key] = val;\n                }\n                if (!validFieldsForType || validFieldsForType[key]) {\n                    lines[i] = \"\";\n                }\n            }\n        }\n        for (var key in names) {\n            Item[key] = names[key];\n        }\n        // Final cleanup for validCslFields only: eliminate blank lines, add blank line to text\n        if (validFieldsForType) {\n            if (lines[offset].trim()) {\n                lines[offset] = '\\n' + lines[offset];\n            }\n            for (var i=offset-1;i>-1;i--) {\n                if (!lines[i].trim()) {\n                    lines = lines.slice(0, i).concat(lines.slice(i + 1));\n                }\n            }\n        }\n        Item.note = lines.join(\"\\n\").trim();\n    },\n\n    checkPrefixSpaceAppend: function (state, prefix) {\n        if (!prefix) {\n            prefix = \"\";\n        }\n        var sp = \"\";\n        // We need the raw string, without decorations\n        // of any kind. Markup scheme is known, though, so\n        // markup can be safely stripped at string level.\n        //\n        // U+201d = right double quotation mark\n        // U+2019 = right single quotation mark\n        // U+00bb = right double angle bracket (guillemet)\n        // U+202f = non-breaking thin space\n        // U+00a0 = non-breaking space\n        var test_prefix = prefix.replace(/<[^>]+>/g, \"\").replace(/[\"'\\u201d\\u2019\\u00bb\\u202f\\u00a0 ]+$/g,\"\");\n        var test_char = test_prefix.slice(-1);\n        if (test_prefix.match(CSL.ENDSWITH_ROMANESQUE_REGEXP)) {\n            sp = \" \";\n        } else if (CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(test_char) > -1) {\n            sp = \" \";\n        } else if (test_char.match(/[\\)\\],0-9]/)) {\n            sp = \" \";\n        }\n        // Protect against double spaces, which would trigger an extra,\n        // explicit, non-breaking space.\n        var prefix = (prefix + sp).replace(/\\s+/g, \" \");\n        return prefix;\n    },\n\n    checkIgnorePredecessor: function(state, prefix) {\n        var ignorePredecessor = false;\n        var test_prefix = prefix.replace(/<[^>]+>/g, \"\").replace(/[\"'\\u201d\\u2019\\u00bb\\u202f\\u00a0 ]+$/g,\"\");\n        var test_char = test_prefix.slice(-1);\n        if (CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(test_char) > -1 && prefix.trim().indexOf(\" \") > -1) {\n            state.tmp.term_predecessor = false;\n            return true;\n        }\n        return false;\n    },\n\n    checkSuffixSpacePrepend: function(state, suffix) {\n        if (!suffix) {\n            return \"\";\n        }\n        if (suffix.match(CSL.STARTSWITH_ROMANESQUE_REGEXP) || ['[','('].indexOf(suffix.slice(0,1)) > -1) {\n            suffix = \" \" + suffix;\n        }\n        return suffix;\n    },\n    \n    GENDERS: [\"masculine\", \"feminine\"],\n    \n    ERROR_NO_RENDERED_FORM: 1,\n\n    PREVIEW: \"Just for laughs.\",\n    ASSUME_ALL_ITEMS_REGISTERED: 2,\n\n    START: 0,\n    END: 1,\n    SINGLETON: 2,\n\n    SEEN: 6,\n    SUCCESSOR: 3,\n    SUCCESSOR_OF_SUCCESSOR: 4,\n    SUPPRESS: 5,\n\n    SINGULAR: 0,\n    PLURAL: 1,\n\n    LITERAL: true,\n\n    BEFORE: 1,\n    AFTER: 2,\n\n    DESCENDING: 1,\n    ASCENDING: 2,\n\n    PRIMARY: 1,\n    SECONDARY: 2,\n    \n    POSITION_FIRST: 0,\n    POSITION_SUBSEQUENT: 1,\n    POSITION_IBID: 2,\n    POSITION_IBID_WITH_LOCATOR: 3,\n    POSITION_CONTAINER_SUBSEQUENT: 4,\n\n    POSITION_MAP: {\n        \"0\": 0,\n        \"4\": 1,\n        \"1\": 2,\n        \"2\": 3,\n        \"3\": 4\n    },\n    \n    POSITION_TEST_VARS: [\"position\", \"first-reference-note-number\", \"near-note\"],\n\n    AREAS: [\"citation\", \"citation_sort\", \"bibliography\", \"bibliography_sort\", \"intext\"],\n\n    CITE_FIELDS: [\"first-reference-note-number\", \"first-container-reference-note-number\", \"locator\", \"locator-extra\"],\n\n    SWAPPING_PUNCTUATION: [\".\", \"!\", \"?\", \":\", \",\"],\n    TERMINAL_PUNCTUATION: [\":\", \".\", \";\", \"!\", \"?\", \" \"],\n\n    // update modes\n    NONE: 0,\n    NUMERIC: 1,\n    POSITION: 2,\n    TRIGRAPH: 3,\n\n    DATE_PARTS: [\"year\", \"month\", \"day\"],\n    DATE_PARTS_ALL: [\"year\", \"month\", \"day\", \"season\"],\n    DATE_PARTS_INTERNAL: [\"year\", \"month\", \"day\", \"year_end\", \"month_end\", \"day_end\"],\n\n    NAME_PARTS: [\"non-dropping-particle\", \"family\", \"given\", \"dropping-particle\", \"suffix\", \"literal\"],\n\n    DISAMBIGUATE_OPTIONS: [\n        \"disambiguate-add-names\",\n        \"disambiguate-add-givenname\",\n        \"disambiguate-add-year-suffix\"\n    ],\n\n    GIVENNAME_DISAMBIGUATION_RULES: [\n        \"all-names\",\n        \"all-names-with-initials\",\n        \"primary-name\",\n        \"primary-name-with-initials\",\n        \"by-cite\"\n    ],\n\n    NAME_ATTRIBUTES: [\n        \"and\",\n        \"delimiter-precedes-last\",\n        \"delimiter-precedes-et-al\",\n        \"initialize-with\",\n        \"initialize\",\n        \"name-as-sort-order\",\n        \"sort-separator\",\n        \"et-al-min\",\n        \"et-al-use-first\",\n        \"et-al-subsequent-min\",\n        \"et-al-subsequent-use-first\",\n        \"form\",\n        \"prefix\",\n        \"suffix\",\n        \"delimiter\"\n    ],\n\n    LOOSE: 0,\n    STRICT: 1,\n    TOLERANT: 2,\n\n    PREFIX_PUNCTUATION: /[.;:]\\s*$/,\n    SUFFIX_PUNCTUATION: /^\\s*[.;:,\\(\\)]/,\n\n    NUMBER_REGEXP: /(?:^\\d+|\\d+$)/,\n    //\n    // \\u0400-\\u042f are cyrillic and extended cyrillic capitals\n    // this is not fully smart yet.  can't do what this was trying to do\n    // with regexps, actually; we want to identify strings with a leading\n    // capital letter, and any subsequent capital letters.  Have to compare\n    // locale caps version with existing version, character by character.\n    // hard stuff, but if it breaks, that's what to do.\n    // \\u0600-\\u06ff is Arabic/Persian\n    // \\u200c-\\u200e and \\u202a-\\u202e are special spaces and left-right \n    // control characters\n\n\n\n    NAME_INITIAL_REGEXP: /^([A-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0400-\\u042f\\u0590-\\u05d4\\u05d6-\\u05ff\\u0600-\\u06ff\\u0370\\u0372\\u0376\\u0386\\u0388-\\u03ab\\u03e2\\u03e4\\u03e6\\u03e8\\u03ea\\u03ec\\u03ee\\u03f4\\u03f7\\u03fd-\\u03ff])([a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0400-\\u052f\\u0600-\\u06ff\\u0370-\\u03ff\\u1f00-\\u1fff]*|)(\\.)*/,\n    ROMANESQUE_REGEXP: /[-0-9a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]/,\n    ROMANESQUE_NOT_REGEXP: /[^a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]/g,\n    STARTSWITH_ROMANESQUE_REGEXP: /^[&a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]/,\n    ENDSWITH_ROMANESQUE_REGEXP: /[.;:&a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]$/,\n    ALL_ROMANESQUE_REGEXP: /^[a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]+$/,\n\n    VIETNAMESE_SPECIALS: /[\\u00c0-\\u00c3\\u00c8-\\u00ca\\u00cc\\u00cd\\u00d2-\\u00d5\\u00d9\\u00da\\u00dd\\u00e0-\\u00e3\\u00e8-\\u00ea\\u00ec\\u00ed\\u00f2-\\u00f5\\u00f9\\u00fa\\u00fd\\u0101\\u0103\\u0110\\u0111\\u0128\\u0129\\u0168\\u0169\\u01a0\\u01a1\\u01af\\u01b0\\u1ea0-\\u1ef9]/,\n\n    VIETNAMESE_NAMES: /^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \\u00c0-\\u00c3\\u00c8-\\u00ca\\u00cc\\u00cd\\u00d2-\\u00d5\\u00d9\\u00da\\u00dd\\u00e0-\\u00e3\\u00e8-\\u00ea\\u00ec\\u00ed\\u00f2-\\u00f5\\u00f9\\u00fa\\u00fd\\u0101\\u0103\\u0110\\u0111\\u0128\\u0129\\u0168\\u0169\\u01a0\\u01a1\\u01af\\u01b0\\u1ea0-\\u1ef9]{2,6})(\\s+|$))+$/,\n\n    NOTE_FIELDS_REGEXP: /\\{:(?:[\\-_a-z]+|[A-Z]+):[^\\}]+\\}/g,\n    NOTE_FIELD_REGEXP: /^([\\-_a-z]+|[A-Z]+):\\s*([^\\}]+)$/,\n\n\tPARTICLE_GIVEN_REGEXP: /^([^ ]+(?:\\u02bb |\\u2019 | |\\' ) *)(.+)$/,\n\tPARTICLE_FAMILY_REGEXP: /^([^ ]+(?:\\-|\\u02bb|\\u2019| |\\') *)(.+)$/,\n\n    DISPLAY_CLASSES: [\"block\", \"left-margin\", \"right-inline\", \"indent\"],\n\n    NAME_VARIABLES: [\n        \"author\",\n        \"chair\",\n        \"collection-editor\",\n        \"compiler\",\n        \"composer\",\n        \"container-author\",\n        \"contributor\",\n        \"curator\",\n        \"director\",\n        \"editor\",\n        \"editor-translator\", \n        \"editorial-director\",\n        \"executive-producer\",\n        \"guest\",\n        \"host\",\n        \"illustrator\",\n        \"interviewer\",\n        \"narrator\", \n        \"organizer\",\n        \"original-author\",\n        \"performer\",\n        \"producer\",\n        \"recipient\",\n        \"reviewed-author\",\n        \"script-writer\",\n        \"series-creator\",\n        \"translator\",\n        \"commenter\"\n    ],\n    CREATORS: [\n        \"author\",\n        \"chair\",\n        \"collection-editor\",\n        \"compiler\",\n        \"composer\",\n        \"container-author\",\n        \"contributor\",\n        \"curator\",\n        \"director\",\n        \"editor\",\n        \"editor-translator\", \n        \"editorial-director\",\n        \"executive-producer\",\n        \"guest\",\n        \"host\",\n        \"illustrator\",\n        \"interviewer\",\n        \"narrator\", \n        \"organizer\",\n        \"original-author\",\n        \"performer\",\n        \"producer\",\n        \"recipient\",\n        \"reviewed-author\",\n        \"script-writer\",\n        \"series-creator\",\n        \"translator\",\n        \"commenter\"\n    ],\n    NUMERIC_VARIABLES: [\n        \"call-number\",\n        \"chapter-number\",\n        \"collection-number\",\n        \"division\",\n        \"edition\",\n        \"page\",\n        \"issue\",\n        \"locator\",\n        \"locator-extra\",\n        \"number\",\n        \"number-of-pages\",\n        \"number-of-volumes\",\n        \"part-number\",\n        \"printing-number\",\n        \"section\",\n        \"supplement-number\",\n        \"version\",\n        \"volume\",\n        \"supplement\", // maybe deprecated this? supplement-number should serve this purpose in standard CSL.\n        \"citation-number\"\n    ],\n    //var x = new Array();\n    //x = x.concat([\"title\",\"container-title\",\"issued\",\"page\"]);\n    //x = x.concat([\"locator\",\"collection-number\",\"original-date\"]);\n    //x = x.concat([\"reporting-date\",\"decision-date\",\"filing-date\"]);\n    //x = x.concat([\"revision-date\"]);\n    //NUMERIC_VARIABLES = x.slice();\n    DATE_VARIABLES: [\n        \"locator-date\", \n        \"issued\", \n        \"event-date\", \n        \"accessed\", \n        \"original-date\",\n        \"publication-date\",\n        \"available-date\",\n        \"submitted\",\n        \"alt-issued\",\n        \"alt-event\"\n    ],\n    VARIABLES_WITH_SHORT_FORM: [\n        \"title\",\n        \"container-title\"\n    ],\n    TITLE_FIELD_SPLITS: function(seg) {\n        var keys = [\"title\", \"short\", \"main\", \"sub\", \"subjoin\"];\n        var ret = {};\n        for (var i=0,ilen=keys.length;i<ilen;i++) {\n            ret[keys[i]] = seg + \"title\" + (keys[i] === \"title\" ? \"\" : \"-\" + keys[i]);\n        }\n        return ret;\n    },\n    \n    demoteNoiseWords: function (state, fld, drop_or_demote) {\n        var SKIP_WORDS = state.locale[state.opt.lang].opts[\"leading-noise-words\"];\n        if (fld && drop_or_demote) {\n            fld = fld.split(/\\s+/);\n            fld.reverse();\n            var toEnd = [];\n            for (var j  = fld.length - 1; j > -1; j += -1) {\n                if (SKIP_WORDS.indexOf(fld[j].toLowerCase()) > -1) {\n                    toEnd.push(fld.pop());\n                } else {\n                    break;\n                }\n            }\n            fld.reverse();\n            var start = fld.join(\" \");\n            var end = toEnd.join(\" \");\n            if (\"drop\" === drop_or_demote || !end) {\n                fld = start;\n            } else if (\"demote\" === drop_or_demote) {\n                fld = [start, end].join(\", \");\n            }\n        }\n        return fld;\n    },\n\n    extractTitleAndSubtitle: function (Item, narrowSpaceLocale) {\n        var narrowSpace = narrowSpaceLocale ? \"\\u202f\" : \"\";\n        // XXX In this function, split on split-char, but prefer exact match\n        // XXX of subtitle to a split-char in title if found.\n        var segments = [\"\"];\n        if (this.opt.development_extensions.split_container_title) {\n            segments.push(\"container-\");\n        }\n        for (var i=0,ilen=segments.length;i<ilen;i++) {\n            var seg = segments[i];\n            var title = CSL.TITLE_FIELD_SPLITS(seg);\n            var langs = [false];\n            if (Item.multi) {\n                for (var lang in Item.multi._keys[title.short]) {\n                    langs.push(lang);\n                }\n            }\n            for (var j=0,jlen=langs.length;j<jlen;j++) {\n                var lang = langs[j];\n                var vals = {};\n                if (lang) {\n                    if (Item.multi._keys[title.title]) {\n                        vals[title.title] = Item.multi._keys[title.title][lang];\n                    }\n                    if (Item.multi._keys[title[\"short\"]]) {\n                        vals[title[\"short\"]] = Item.multi._keys[title[\"short\"]][lang];\n                    }\n                } else {\n                    vals[title.title] = Item[title.title];\n                    vals[title[\"short\"]] = Item[title[\"short\"]];\n                }\n                vals[title.main] = vals[title.title];\n                vals[title.sub] = false;\n                var shortTitle = vals[title[\"short\"]];\n                if (vals[title.title]) {\n                    // Rules\n                    // TITLE_SPLIT eliminates split-points of period-space preceded by a capital letter.\n                    // If short title exists and matches exactly to a split-point, use that split-point only.\n                    // Otherwise if there is just one split-point, use that as main/sub split.\n                    // Otherwise use all split-points ... which is handled in titleCaseSentenceOrNormal, not here.\n                    if (shortTitle && shortTitle.toLowerCase() === vals[title.title].toLowerCase()) {\n                        vals[title.main] = vals[title.title];\n                        vals[title.subjoin] = \"\";\n                        vals[title.sub] = \"\";\n                    } else if (shortTitle) {\n                        // check for valid match to shortTitle\n                        var tail = vals[title.title].slice(shortTitle.replace(/[\\?\\!]+$/, \"\").length);\n                        var top = vals[title.title].replace(tail.replace(/^[\\?\\!]+/, \"\"), \"\").trim();\n                        var m = CSL.TITLE_SPLIT_REGEXP.matchfirst.exec(tail);\n                        if (m && top.toLowerCase() === shortTitle.toLowerCase()) {\n                            vals[title.main] = top;\n                            vals[title.subjoin] = m[1].replace(/[\\?\\!]+(\\s*)$/, \"$1\");\n                            vals[title.sub] = tail.replace(CSL.TITLE_SPLIT_REGEXP.matchfirst, \"\");\n                            if (this.opt.development_extensions.force_short_title_casing_alignment) {\n                                vals[title[\"short\"]] = vals[title.main];\n                            }\n                        } else {\n                            var splitTitle = CSL.TITLE_SPLIT(vals[title.title]);\n                            if (splitTitle.length == 3) {\n                                vals[title.main] = splitTitle[0];\n                                vals[title.subjoin] = splitTitle[1];\n                                vals[title.sub] = splitTitle[2];\n                            } else {\n                                vals[title.main] = vals[title.title];\n                                vals[title.subjoin] = \"\";\n                                vals[title.sub] = \"\";\n                            }\n                        }\n                    } else {\n                        var splitTitle = CSL.TITLE_SPLIT(vals[title.title]);\n                        if (splitTitle.length == 3) {\n                            vals[title.main] = splitTitle[0];\n                            vals[title.subjoin] = splitTitle[1];\n                            vals[title.sub] = splitTitle[2];\n                            if (this.opt.development_extensions.implicit_short_title && Item.type !== \"legal_case\") {\n                                if (!Item[title.short] && !vals[title.main].match(/^[\\-\\.[0-9]+$/)) {\n                                    var punct = vals[title.subjoin].trim();\n                                    if ([\"?\", \"!\"].indexOf(punct) === -1) {\n                                        punct = \"\";\n                                    }\n                                    vals[title.short] = vals[title.main] + punct;\n                                }\n                            }\n                        } else {\n                            vals[title.main] = vals[title.title];\n                            vals[title.subjoin] = \"\";\n                            vals[title.sub] = \"\";\n                        }\n                    }\n                    if (vals[title.subjoin]) {\n                        if (vals[title.subjoin].match(/([\\?\\!])/)) {\n                            var m = vals[title.subjoin].match(/(\\s*)$/)\n                            vals[title.main] = vals[title.main] + narrowSpace +vals[title.subjoin].trim();\n                            vals[title.subjoin] = m[1];\n                        }\n                    }\n                }\n                if (vals[title.subjoin]) {\n                    if (vals[title.subjoin].indexOf(\":\") > -1) {\n                        vals[title.subjoin] = narrowSpace + \": \";\n                    }\n                    if (vals[title.subjoin].indexOf(\"-\") > -1 || vals[title.subjoin].indexOf(\"\") > -1) {\n                        vals[title.subjoin] = \"\";\n                    }\n                }\n                if (lang) {\n                    for (var key in vals) {\n                        if (!Item.multi._keys[key]) {\n                            Item.multi._keys[key] = {};\n                        }\n                        Item.multi._keys[key][lang] = vals[key];\n                    }\n                } else {\n                    for (var key in vals) {\n                        Item[key] = vals[key];\n                    }\n                }\n            }\n        }\n    },\n\n    titlecaseSentenceOrNormal: function(state, Item, seg, lang, sentenceCase) {\n        // Hold on here.\n        // What is seg here?\n        // It's ... either \"\" or \"container-\". Which is ugly, but works.\n        // But this ALWAYS returns the full title, never short.\n        // So sentence-casing cannot be applied to short.\n        // Goes unnoticed because forced sentence-casing almost never appears in styles.\n        var title = CSL.TITLE_FIELD_SPLITS(seg);\n        var vals = {};\n        if (lang && Item.multi) {\n            if (Item.multi._keys[title.title]) {\n                vals[title.title] = Item.multi._keys[title.title][lang];\n            }\n            if (Item.multi._keys[title.main]) {\n                vals[title.main] = Item.multi._keys[title.main][lang];\n            }\n            if (Item.multi._keys[title.sub]) {\n                vals[title.sub] = Item.multi._keys[title.sub][lang];\n            }\n            if (Item.multi._keys[title.subjoin]) {\n                vals[title.subjoin] = Item.multi._keys[title.subjoin][lang];\n            }\n        } else {\n            vals[title.title] = Item[title.title];\n            vals[title.main] = Item[title.main];\n            vals[title.sub] = Item[title.sub];\n            vals[title.subjoin] = Item[title.subjoin];\n        }\n        if (vals[title.main] && vals[title.sub]) {\n            var mainTitle = vals[title.main];\n            var subJoin = vals[title.subjoin];\n            var subTitle = vals[title.sub];\n            if (sentenceCase) {\n                mainTitle = CSL.Output.Formatters.sentence(state, mainTitle);\n                subTitle = CSL.Output.Formatters.sentence(state, subTitle);\n            } else if (state.opt.development_extensions.uppercase_subtitles) {\n                subTitle = CSL.Output.Formatters[\"capitalize-first\"](state, subTitle);\n            }\n            return [mainTitle, subJoin, subTitle].join(\"\");\n        } else if (vals[title.title]) {\n            if (sentenceCase) {\n                return CSL.Output.Formatters.sentence(state, vals[title.title]);\n            } else if (state.opt.development_extensions.uppercase_subtitles) {\n                // Split and apply everywhere.\n                var splits = CSL.TITLE_SPLIT(vals[title.title]);\n                for (var i=0,ilen=splits.length; i<ilen; i += 2) {\n                    splits[i] = CSL.Output.Formatters[\"capitalize-first\"](state, splits[i]);\n                }\n                for (var i=1, ilen=splits.length-1; i < ilen; i += 2) {\n                    var m = splits[i].match(/([:\\?\\!] )/);\n                    if (m) {\n                        var narrowSpace = state.opt[\"default-locale\"][0].slice(0, 2).toLowerCase() === \"fr\" ? \"\\u202f\" : \"\";\n                        splits[i] = narrowSpace + m[1];\n                    }\n                    if (splits[i].indexOf(\"-\") > -1 || splits[i].indexOf(\"\") > -1) {\n                        splits[i] = \"\";\n                    }\n                }\n                vals[title.title] = splits.join(\"\");\n                return vals[title.title];\n            } else {\n                return vals[title.title];\n            }\n        } else {\n            return \"\";\n        }\n    },\n\n    getSafeEscape: function(state) {\n        if ([\"bibliography\", \"citation\"].indexOf(state.tmp.area) > -1) {\n            // Callback to apply thin space hack\n            // Callback to force LTR/RTL on parens and braces\n            // XXX Is this really necessary?\n            var callbacks = [];\n            if (state.opt.development_extensions.thin_non_breaking_space_html_hack && state.opt.mode === \"html\") {\n                callbacks.push(function (txt) {\n                    return txt.replace(/\\u202f/g, '<span style=\"white-space:nowrap\">&thinsp;</span>');\n                });\n            }\n            if (callbacks.length) {\n                return function (txt) {\n                    for (var i = 0, ilen = callbacks.length; i < ilen; i += 1) {\n                        txt = callbacks[i](txt);\n                    }\n                    return CSL.Output.Formats[state.opt.mode].text_escape(txt);\n                };\n            } else {\n                return CSL.Output.Formats[state.opt.mode].text_escape;\n            }\n        } else {\n            return function (txt) { return txt; };\n        }\n    },\n\n    SKIP_WORDS: [\"about\",\"above\",\"across\",\"afore\",\"after\",\"against\",\"al\", \"along\",\"alongside\",\"amid\",\"amidst\",\"among\",\"amongst\",\"anenst\",\"apropos\",\"apud\",\"around\",\"as\",\"aside\",\"astride\",\"at\",\"athwart\",\"atop\",\"barring\",\"before\",\"behind\",\"below\",\"beneath\",\"beside\",\"besides\",\"between\",\"beyond\",\"but\",\"by\",\"circa\",\"despite\",\"down\",\"during\",\"et\", \"except\",\"for\",\"forenenst\",\"from\",\"given\",\"in\",\"inside\",\"into\",\"lest\",\"like\",\"modulo\",\"near\",\"next\",\"notwithstanding\",\"of\",\"off\",\"on\",\"onto\",\"out\",\"over\",\"per\",\"plus\",\"pro\",\"qua\",\"sans\",\"since\",\"than\",\"through\",\" thru\",\"throughout\",\"thruout\",\"till\",\"to\",\"toward\",\"towards\",\"under\",\"underneath\",\"until\",\"unto\",\"up\",\"upon\",\"versus\",\"vs.\",\"v.\",\"vs\",\"v\",\"via\",\"vis--vis\",\"with\",\"within\",\"without\",\"according to\",\"ahead of\",\"apart from\",\"as for\",\"as of\",\"as per\",\"as regards\",\"aside from\",\"back to\",\"because of\",\"close to\",\"due to\",\"except for\",\"far from\",\"inside of\",\"instead of\",\"near to\",\"next to\",\"on to\",\"out from\",\"out of\",\"outside of\",\"prior to\",\"pursuant to\",\"rather than\",\"regardless of\",\"such as\",\"that of\",\"up to\",\"where as\",\"or\", \"yet\", \"so\", \"for\", \"and\", \"nor\", \"a\", \"an\", \"the\", \"de\", \"d'\", \"von\", \"van\", \"c\", \"ca\"],\n\n    FORMAT_KEY_SEQUENCE: [\n        \"@strip-periods\",\n        \"@font-style\",\n        \"@font-variant\",\n        \"@font-weight\",\n        \"@text-decoration\",\n        \"@vertical-align\",\n        \"@quotes\"\n    ],\n\n    INSTITUTION_KEYS: [\n        \"font-style\",\n        \"font-variant\",\n        \"font-weight\",\n        \"text-decoration\",\n        \"text-case\"\n    ],\n\n    SUFFIX_CHARS: \"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z\",\n    ROMAN_NUMERALS: [\n        [ \"\", \"i\", \"ii\", \"iii\", \"iv\", \"v\", \"vi\", \"vii\", \"viii\", \"ix\" ],\n        [ \"\", \"x\", \"xx\", \"xxx\", \"xl\", \"l\", \"lx\", \"lxx\", \"lxxx\", \"xc\" ],\n        [ \"\", \"c\", \"cc\", \"ccc\", \"cd\", \"d\", \"dc\", \"dcc\", \"dccc\", \"cm\" ],\n        [ \"\", \"m\", \"mm\", \"mmm\", \"mmmm\", \"mmmmm\"]\n    ],\n\n    LANGS: {\n        \"af-ZA\":\"Afrikaans\",\n        \"ar\":\"Arabic\",\n        \"bg-BG\":\"Bulgarian\",\n        \"ca-AD\":\"Catalan\",\n        \"cs-CZ\":\"Czech\",\n        \"da-DK\":\"Danish\",\n        \"de-AT\":\"Austrian\",\n        \"de-CH\":\"German (CH)\",\n        \"de-DE\":\"German (DE)\",\n        \"el-GR\":\"Greek\",\n        \"en-GB\":\"English (GB)\",\n        \"en-US\":\"English (US)\",\n        \"es-ES\":\"Spanish\",\n        \"et-EE\":\"Estonian\",\n        \"eu\":\"European\",\n        \"fa-IR\":\"Persian\",\n        \"fi-FI\":\"Finnish\",\n        \"fr-CA\":\"French (CA)\",\n        \"fr-FR\":\"French (FR)\",\n        \"he-IL\":\"Hebrew\",\n        \"hr-HR\":\"Croatian\",\n        \"hu-HU\":\"Hungarian\",\n        \"is-IS\":\"Icelandic\",\n        \"it-IT\":\"Italian\",\n        \"ja-JP\":\"Japanese\",\n        \"km-KH\":\"Khmer\",\n        \"ko-KR\":\"Korean\",\n        \"lt-LT\":\"Lithuanian\",\n        \"lv-LV\":\"Latvian\",\n        \"mn-MN\":\"Mongolian\",\n        \"nb-NO\":\"Norwegian (Bokml)\",\n        \"nl-NL\":\"Dutch\",\n        \"nn-NO\":\"Norwegian (Nynorsk)\",\n        \"pl-PL\":\"Polish\",\n        \"pt-BR\":\"Portuguese (BR)\",\n        \"pt-PT\":\"Portuguese (PT)\",\n        \"ro-RO\":\"Romanian\",\n        \"ru-RU\":\"Russian\",\n        \"sk-SK\":\"Slovak\",\n        \"sl-SI\":\"Slovenian\",\n        \"sr-RS\":\"Serbian\",\n        \"sv-SE\":\"Swedish\",\n        \"th-TH\":\"Thai\",\n        \"tr-TR\":\"Turkish\",\n        \"uk-UA\":\"Ukrainian\",\n        \"vi-VN\":\"Vietnamese\",\n        \"zh-CN\":\"Chinese (CN)\",\n        \"zh-TW\":\"Chinese (TW)\"\n    },\n\n    LANG_BASES: {\n        af: \"af_ZA\",\n        ar: \"ar\",\n        bg: \"bg_BG\",\n        ca: \"ca_AD\",\n        cs: \"cs_CZ\",\n        da: \"da_DK\",\n        de: \"de_DE\",\n        el: \"el_GR\",\n        en: \"en_US\",\n        es: \"es_ES\",\n        et: \"et_EE\",\n        eu: \"eu\",\n        fa: \"fa_IR\",\n        fi: \"fi_FI\",\n        fr: \"fr_FR\",\n        he: \"he_IL\",\n        hr: \"hr-HR\",\n        hu: \"hu_HU\",\n        is: \"is_IS\",\n        it: \"it_IT\",\n        ja: \"ja_JP\",\n        km: \"km_KH\",\n        ko: \"ko_KR\",\n        lt: \"lt_LT\",\n        lv: \"lv-LV\",\n        mn: \"mn_MN\",\n        nb: \"nb_NO\",\n        nl: \"nl_NL\",\n        nn: \"nn-NO\",\n        pl: \"pl_PL\",\n        pt: \"pt_PT\",\n        ro: \"ro_RO\",\n        ru: \"ru_RU\",\n        sk: \"sk_SK\",\n        sl: \"sl_SI\",\n        sr: \"sr_RS\",\n        sv: \"sv_SE\",\n        th: \"th_TH\",\n        tr: \"tr_TR\",\n        uk: \"uk_UA\",\n        vi: \"vi_VN\",\n        zh: \"zh_CN\"\n    },\n\n    SUPERSCRIPTS: {\n        \"\\u00AA\": \"\\u0061\",\n        \"\\u00B2\": \"\\u0032\",\n        \"\\u00B3\": \"\\u0033\",\n        \"\\u00B9\": \"\\u0031\",\n        \"\\u00BA\": \"\\u006F\",\n        \"\\u02B0\": \"\\u0068\",\n        \"\\u02B1\": \"\\u0266\",\n        \"\\u02B2\": \"\\u006A\",\n        \"\\u02B3\": \"\\u0072\",\n        \"\\u02B4\": \"\\u0279\",\n        \"\\u02B5\": \"\\u027B\",\n        \"\\u02B6\": \"\\u0281\",\n        \"\\u02B7\": \"\\u0077\",\n        \"\\u02B8\": \"\\u0079\",\n        \"\\u02E0\": \"\\u0263\",\n        \"\\u02E1\": \"\\u006C\",\n        \"\\u02E2\": \"\\u0073\",\n        \"\\u02E3\": \"\\u0078\",\n        \"\\u02E4\": \"\\u0295\",\n        \"\\u1D2C\": \"\\u0041\",\n        \"\\u1D2D\": \"\\u00C6\",\n        \"\\u1D2E\": \"\\u0042\",\n        \"\\u1D30\": \"\\u0044\",\n        \"\\u1D31\": \"\\u0045\",\n        \"\\u1D32\": \"\\u018E\",\n        \"\\u1D33\": \"\\u0047\",\n        \"\\u1D34\": \"\\u0048\",\n        \"\\u1D35\": \"\\u0049\",\n        \"\\u1D36\": \"\\u004A\",\n        \"\\u1D37\": \"\\u004B\",\n        \"\\u1D38\": \"\\u004C\",\n        \"\\u1D39\": \"\\u004D\",\n        \"\\u1D3A\": \"\\u004E\",\n        \"\\u1D3C\": \"\\u004F\",\n        \"\\u1D3D\": \"\\u0222\",\n        \"\\u1D3E\": \"\\u0050\",\n        \"\\u1D3F\": \"\\u0052\",\n        \"\\u1D40\": \"\\u0054\",\n        \"\\u1D41\": \"\\u0055\",\n        \"\\u1D42\": \"\\u0057\",\n        \"\\u1D43\": \"\\u0061\",\n        \"\\u1D44\": \"\\u0250\",\n        \"\\u1D45\": \"\\u0251\",\n        \"\\u1D46\": \"\\u1D02\",\n        \"\\u1D47\": \"\\u0062\",\n        \"\\u1D48\": \"\\u0064\",\n        \"\\u1D49\": \"\\u0065\",\n        \"\\u1D4A\": \"\\u0259\",\n        \"\\u1D4B\": \"\\u025B\",\n        \"\\u1D4C\": \"\\u025C\",\n        \"\\u1D4D\": \"\\u0067\",\n        \"\\u1D4F\": \"\\u006B\",\n        \"\\u1D50\": \"\\u006D\",\n        \"\\u1D51\": \"\\u014B\",\n        \"\\u1D52\": \"\\u006F\",\n        \"\\u1D53\": \"\\u0254\",\n        \"\\u1D54\": \"\\u1D16\",\n        \"\\u1D55\": \"\\u1D17\",\n        \"\\u1D56\": \"\\u0070\",\n        \"\\u1D57\": \"\\u0074\",\n        \"\\u1D58\": \"\\u0075\",\n        \"\\u1D59\": \"\\u1D1D\",\n        \"\\u1D5A\": \"\\u026F\",\n        \"\\u1D5B\": \"\\u0076\",\n        \"\\u1D5C\": \"\\u1D25\",\n        \"\\u1D5D\": \"\\u03B2\",\n        \"\\u1D5E\": \"\\u03B3\",\n        \"\\u1D5F\": \"\\u03B4\",\n        \"\\u1D60\": \"\\u03C6\",\n        \"\\u1D61\": \"\\u03C7\",\n        \"\\u2070\": \"\\u0030\",\n        \"\\u2071\": \"\\u0069\",\n        \"\\u2074\": \"\\u0034\",\n        \"\\u2075\": \"\\u0035\",\n        \"\\u2076\": \"\\u0036\",\n        \"\\u2077\": \"\\u0037\",\n        \"\\u2078\": \"\\u0038\",\n        \"\\u2079\": \"\\u0039\",\n        \"\\u207A\": \"\\u002B\",\n        \"\\u207B\": \"\\u2212\",\n        \"\\u207C\": \"\\u003D\",\n        \"\\u207D\": \"\\u0028\",\n        \"\\u207E\": \"\\u0029\",\n        \"\\u207F\": \"\\u006E\",\n        \"\\u2120\": \"\\u0053\\u004D\",\n        \"\\u2122\": \"\\u0054\\u004D\",\n        \"\\u3192\": \"\\u4E00\",\n        \"\\u3193\": \"\\u4E8C\",\n        \"\\u3194\": \"\\u4E09\",\n        \"\\u3195\": \"\\u56DB\",\n        \"\\u3196\": \"\\u4E0A\",\n        \"\\u3197\": \"\\u4E2D\",\n        \"\\u3198\": \"\\u4E0B\",\n        \"\\u3199\": \"\\u7532\",\n        \"\\u319A\": \"\\u4E59\",\n        \"\\u319B\": \"\\u4E19\",\n        \"\\u319C\": \"\\u4E01\",\n        \"\\u319D\": \"\\u5929\",\n        \"\\u319E\": \"\\u5730\",\n        \"\\u319F\": \"\\u4EBA\",\n        \"\\u02C0\": \"\\u0294\",\n        \"\\u02C1\": \"\\u0295\",\n        \"\\u06E5\": \"\\u0648\",\n        \"\\u06E6\": \"\\u064A\"\n    },\n    SUPERSCRIPTS_REGEXP: new RegExp(\"[\\u00AA\\u00B2\\u00B3\\u00B9\\u00BA\\u02B0\\u02B1\\u02B2\\u02B3\\u02B4\\u02B5\\u02B6\\u02B7\\u02B8\\u02E0\\u02E1\\u02E2\\u02E3\\u02E4\\u1D2C\\u1D2D\\u1D2E\\u1D30\\u1D31\\u1D32\\u1D33\\u1D34\\u1D35\\u1D36\\u1D37\\u1D38\\u1D39\\u1D3A\\u1D3C\\u1D3D\\u1D3E\\u1D3F\\u1D40\\u1D41\\u1D42\\u1D43\\u1D44\\u1D45\\u1D46\\u1D47\\u1D48\\u1D49\\u1D4A\\u1D4B\\u1D4C\\u1D4D\\u1D4F\\u1D50\\u1D51\\u1D52\\u1D53\\u1D54\\u1D55\\u1D56\\u1D57\\u1D58\\u1D59\\u1D5A\\u1D5B\\u1D5C\\u1D5D\\u1D5E\\u1D5F\\u1D60\\u1D61\\u2070\\u2071\\u2074\\u2075\\u2076\\u2077\\u2078\\u2079\\u207A\\u207B\\u207C\\u207D\\u207E\\u207F\\u2120\\u2122\\u3192\\u3193\\u3194\\u3195\\u3196\\u3197\\u3198\\u3199\\u319A\\u319B\\u319C\\u319D\\u319E\\u319F\\u02C0\\u02C1\\u06E5\\u06E6]\", \"g\"),\n\n    // I think we need to have separate args for prefix and term,\n    // since they have different effects between comma-safe and comma-safe-numbers-only.\n    // Either that, or -- oh, we could just bang the two together for the test where\n    // necessary.\n    \n    UPDATE_GROUP_CONTEXT_CONDITION: function (state, str, valueTerm, token, value) {\n        if (!state.opt.use_context_condition) return;\n        var flags = state.tmp.group_context.tip;\n        if (flags.condition) {\n            if (!flags.condition.termtxt) {\n                flags.condition.termtxt = str;\n                flags.condition.valueTerm = valueTerm;\n            }\n            if (!flags.value_seen && flags.condition.test === \"comma-safe-numbers-only\") {\n                if (value) {\n                    flags.value_seen = true;\n                    if (!value.match(/^[0-9]/)) {\n                        state.tmp.just_did_number = false;\n                    }\n                }\n            }\n        } else {\n            // If not inside a conditional group, raise numeric flag\n            // if and only if the current term string ends in a number.\n            if (token && token.decorations.filter(o => o[0] === \"@vertical-align\").length > 0) {\n                state.tmp.just_did_number = false;\n            } else if (token && token.strings.suffix) {\n                state.tmp.just_did_number = false;\n            } else if (str) {\n                if (str.match(/[0-9]$/)) {\n                    state.tmp.just_did_number = true;\n                } else {\n                    state.tmp.just_did_number = false;\n                }\n            }\n        }\n    },\n\n    EVALUATE_GROUP_CONDITION: function(state, flags) {\n        if (!state.opt.use_context_condition) return;\n        var testres;\n        var numbersOnly = flags.condition.test === \"comma-safe-numbers-only\";\n        if (flags.condition.test === \"empty-label\") {\n            testres = !flags.condition.termtxt;\n        } else if (flags.condition.test === \"empty-label-no-decor\") {\n            testres = !flags.condition.termtxt || flags.condition.termtxt.indexOf(\"%s\") > -1;\n        } else if ([\"comma-safe\", \"comma-safe-numbers-only\"].indexOf(flags.condition.test) > -1) {\n            var locale_term = flags.condition.termtxt;\n            var termStartAlpha = false;\n            if (flags.condition.termtxt) {\n                termStartAlpha = flags.condition.termtxt.slice(0,1).match(CSL.ALL_ROMANESQUE_REGEXP);\n            }\n            var num = state.tmp.just_did_number;\n            if (num) {\n                if (flags.condition.valueTerm) {\n                    testres = numbersOnly ? false : true;\n                } else if (!locale_term) {\n                    testres = true;\n                } else if (termStartAlpha) {\n                    testres = numbersOnly ? false : true;\n                } else if ([\"always\", \"after-number\"].indexOf(state.opt.require_comma_on_symbol) > -1) {\n                    testres = true;\n                } else {\n                    testres = false;\n                }\n            } else {\n                if (flags.condition.valueTerm) {\n                    testres = false;\n                } else if (!locale_term) {\n                    testres = false;\n                } else if (termStartAlpha) {\n                    testres = numbersOnly ? false : true;\n                } else if (state.opt.require_comma_on_symbol === \"always\") {\n                    testres = true;\n                } else {\n                    testres = false;\n                }\n            }\n        }\n        if (testres) {\n            var force_suppress = false;\n        } else {\n            var force_suppress = true;\n        }\n        if (flags.condition.not) {\n            force_suppress = !force_suppress;\n        }\n        return force_suppress;\n    },\n    \n    SYS_OPTIONS: [\n        \"prioritize_disambiguate_condition\",\n        \"csl_reverse_lookup_support\",\n        \"main_title_from_short_title\",\n        \"uppercase_subtitles\",\n        \"force_short_title_casing_alignment\",\n        \"implicit_short_title\",\n        \"split_container_title\"\n    ],\n\n    TITLE_SPLIT_REGEXP: (function() {\n        var splits = [\n            \"\\\\.\\\\s+\",\n            \"\\\\!\\\\s+\",\n            \"\\\\?\\\\s+\",\n            \"\\\\s*::*\\\\s+\",\n            \"\\\\s*\\\\s*\",\n            \"\\\\s+\\\\-\\\\s+\",\n            \"\\\\s*\\\\-\\\\-\\\\-*\\\\s*\"\n        ]\n        return {\n            match: new RegExp(\"(\" + splits.join(\"|\") + \")\", \"g\"),\n            matchfirst: new RegExp(\"^(\" + splits.join(\"|\") + \")\"),\n            split: new RegExp(\"(?:\" + splits.join(\"|\") + \")\")\n        }\n    })(),\n\n    TITLE_SPLIT: function(str) {\n        if (!str) {\n            return str;\n        }\n        var m = str.match(CSL.TITLE_SPLIT_REGEXP.match);\n        var lst = str.split(CSL.TITLE_SPLIT_REGEXP.split);\n        for (var i=lst.length-2; i>-1; i--) {\n            lst[i] = lst[i].trim();\n            if (lst[i] && lst[i].slice(-1).toLowerCase() !== lst[i].slice(-1)) {\n                // recombine\n                lst[i] = lst[i] + m[i] + lst[i+1];\n                lst = lst.slice(0, i+1).concat(lst.slice(i+2))\n            } else {\n                // merge\n                lst = lst.slice(0, i+1).concat([m[i]]).concat(lst.slice(i+1))\n            }\n        }\n        return lst;\n    },\n    \n    GET_COURT_CLASS: function(state, Item, sortKey){\n        // Get authority as a string\n        var cls = \"\";\n        var authority = null;\n        var country = Item.jurisdiction ? Item.jurisdiction.split(\":\")[0] : null;\n        // inStyle versus in module\n        var classType = \"court_condition_classes\";\n        if (sortKey) {\n            classType = \"court_key_classes\";\n        }\n        if (country && Item.authority) {\n            if (\"string\" === typeof Item.authority) {\n                authority = Item.authority;\n            } else {\n                if (Item.authority[0] && Item.authority[0].literal) {\n                    authority = Item.authority[0].literal;\n                }\n            }\n        }\n        if (authority) {\n            if (this.lang && state.locale[this.lang].opts[classType] && state.locale[this.lang].opts[classType][country] && state.locale[this.lang].opts[classType][country][authority]) {\n                cls = state.locale[this.lang].opts[classType][country][authority];\n            } else if (state.locale[state.opt[\"default-locale\"][0]].opts[classType] && state.locale[state.opt[\"default-locale\"][0]].opts[classType][country] && state.locale[state.opt[\"default-locale\"][0]].opts[classType][country][authority]) {\n                cls = state.locale[state.opt[\"default-locale\"][0]].opts[classType][country][authority]\n            }\n        }\n        return cls;\n    },\n\n    SET_COURT_CLASSES: function(state, lang, myxml, dataObj) {\n        var nodes = myxml.getNodesByName(dataObj, 'court-class');\n        for (var pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n            var courtclass = nodes[pos];\n            var attributes = myxml.attributes(courtclass);\n            var cls = attributes[\"@name\"];\n            var country = attributes[\"@country\"];\n            var courts = attributes[\"@courts\"];\n            \n            // Okay, this is a hack.\n            // If state.registry IS NOT yet defined, this is an in-style declaration.\n            // If state.registry IS defined, this is an in-module declaration.\n            var classType = \"court_key_classes\";\n            if (state.registry) {\n                classType = \"court_condition_classes\";\n            }\n            \n            if (cls && country && courts) {\n                courts = courts.trim().split(/\\s+/);\n                if (!state.locale[lang].opts[classType]) {\n                    state.locale[lang].opts[classType] = {};\n                }\n                if (!state.locale[lang].opts[classType][country]) {\n                    state.locale[lang].opts[classType][country] = {};\n                }\n                for (var i=0,ilen=courts.length;i<ilen;i++) {\n                    state.locale[lang].opts[classType][country][courts[i]] = cls;\n                }\n            }\n        }\n    },\n\n    INIT_JURISDICTION_MACROS: function (state, Item, item, macroName) {\n        if (Item[\"best-jurisdiction\"]) {\n            return true;\n        }\n        if (!state.sys.retrieveStyleModule || !CSL.MODULE_MACROS[macroName] || !Item.jurisdiction) {\n            return false;\n        }\n        var jurisdictionList = state.getJurisdictionList(Item.jurisdiction);\n        // Set up a list of jurisdictions here, we will reuse it\n        if (!state.opt.jurisdictions_seen[jurisdictionList[0]]) {\n            var res = state.retrieveAllStyleModules(jurisdictionList);\n            // Okay. We have code for each of the novel modules in the\n            // hierarchy. Load them all into the processor.\n            for (var jurisdiction in res) {\n                var fallback = state.loadStyleModule(jurisdiction, res[jurisdiction]);\n                if (fallback) {\n                    if (!res[fallback]) {\n                        Object.assign(res, state.retrieveAllStyleModules([fallback]));\n                        state.loadStyleModule(fallback, res[fallback], true);\n                    }\n                }\n            }\n        }\n        if (state.opt.parallel.enable) {\n            if (!state.parallel) {\n                state.parallel = new CSL.Parallel(state);\n            }\n        }\n        // Identify the best jurisdiction for the item and return true, otherwise return false\n        for (var i=0,ilen=jurisdictionList.length;i<ilen;i++) {\n            var jurisdiction = jurisdictionList[i];\n            if (item) {\n                if (state.juris[jurisdiction] && !item[\"best-jurisdiction\"] && state.juris[jurisdiction].types.locator) {\n                    Item[\"best-jurisdiction\"] = jurisdiction;\n                }\n            }\n            if(state.juris[jurisdiction] && state.juris[jurisdiction].types[Item.type]) {\n                Item[\"best-jurisdiction\"] = jurisdiction;\n                return true;\n            }\n        }\n        return false;\n    }\n};\n\n/**\n * Functions for parsing an XML object converted to JSON.\n */\n\n/*\n  Style and locale JSON should be formatted as follows. Note that\n  an empty literal should be set as an explicit empty strings within\n  children:[]\n  \n  {\n    name:\"term\",\n    children:[\n      \"\"\n    ],\n    attrs:{\n      name:\"author\"\n    }\n  }\n\n  The following script will generate correctly formatted JSON\n  from a CSL style or locale file:\n*/\n\nCSL.XmlJSON = function (dataObj) {\n    this.dataObj = dataObj;\n    this.institution = {\n        name:\"institution\",\n        attrs:{\n            \"institution-parts\":\"long\",\n            \"delimiter\":\", \"\n        },\n        children:[\n            {\n                name:\"institution-part\",\n                attrs:{\n                    name:\"long\"\n                },\n                children:[]\n            }\n        ]\n    };\n};\n\n/**\n * No need for cleaning with native JSON.\n */\nCSL.XmlJSON.prototype.clean = function (json) {\n    return json;\n};\n\n\n/**\n * Methods to call on a node.\n */\nCSL.XmlJSON.prototype.getStyleId = function (myjson, styleName) {\n    var tagName = 'id';\n    if (styleName) {\n        tagName = 'title';\n    }\n    var ret = \"\";\n    var children = myjson.children;\n    for (var i=0,ilen=children.length;i<ilen;i++) {\n        if (children[i].name === 'info') {\n            var grandkids = children[i].children;\n            for (var j=0,jlen=grandkids.length;j<jlen;j++) {\n                if (grandkids[j].name === tagName) {\n                    ret = grandkids[j].children[0];\n                }\n            }\n        }\n    }\n    return ret;\n};\n\nCSL.XmlJSON.prototype.children = function (myjson) {\n    //print(\"children()\");\n    if (myjson && myjson.children.length) {\n        return myjson.children.slice();\n    } else {\n        return false;\n    }\n};\n\nCSL.XmlJSON.prototype.nodename = function (myjson) {\n    //print(\"nodename()\");\n    return myjson ? myjson.name : null;\n};\n\nCSL.XmlJSON.prototype.attributes = function (myjson) {\n    //print(\"attributes()\");\n    var ret = {};\n    for (var attrname in myjson.attrs) {\n        ret[\"@\"+attrname] = myjson.attrs[attrname];\n    }\n    return ret;\n};\n\n\nCSL.XmlJSON.prototype.content = function (myjson) {\n    //print(\"content()\");\n    // xmldom.js and xmle4x.js have \"undefined\" as default\n    var ret = \"\";\n    // This only catches content at first level, but that is good enough\n    // for us.\n    if (!myjson || !myjson.children) {\n        return ret;\n    }\n    for (var i=0, ilen=myjson.children.length; i < ilen; i += 1) {\n        if (\"string\" === typeof myjson.children[i]) {\n            ret += myjson.children[i];\n        }\n    }\n    return ret;\n};\n\n\nCSL.XmlJSON.prototype.namespace = {}\n\nCSL.XmlJSON.prototype.numberofnodes = function (myjson) {\n    //print(\"numberofnodes()\");\n    if (myjson && \"number\" == typeof myjson.length) {\n        return myjson.length;\n    } else {\n        return 0;\n    }\n};\n\n// getAttributeName() removed. Looks like it was not being used.\n\nCSL.XmlJSON.prototype.getAttributeValue = function (myjson,name,namespace) {\n    //print(\"getAttributeValue()\");\n    var ret = \"\";\n    if (namespace) {\n        name = namespace+\":\"+name;\n    }\n    if (myjson) {\n        if (myjson.attrs) {\n            if (myjson.attrs[name]) {\n                ret = myjson.attrs[name];\n            } else {\n                ret = \"\";\n            }\n        }\n    }\n    return ret;\n}\n\nCSL.XmlJSON.prototype.getNodeValue = function (myjson,name) {\n    //print(\"getNodeValue()\");\n    var ret = \"\";\n    if (name){\n        for (var i=0, ilen=myjson.children.length; i < ilen; i += 1) {\n            if (myjson.children[i].name === name) {\n                // This will always be Object() unless empty\n                if (myjson.children[i].children.length) {\n                    ret = myjson.children[i];\n                } else {\n                    ret = \"\";\n                }\n            }\n        }\n    } else if (myjson) {\n        ret = myjson;\n    }\n    // Just being careful here, following the former DOM code. The JSON object we receive \n    // for this should be fully normalized.\n    if (ret && ret.children && ret.children.length == 1 && \"string\" === typeof ret.children[0]) {\n        ret = ret.children[0];\n    }\n    return ret;\n}\n\nCSL.XmlJSON.prototype.setAttributeOnNodeIdentifiedByNameAttribute = function (myjson,nodename,partname,attrname,val) {\n    //print(\"setAttributeOnNodeIdentifiedByNameAttribute()\");\n    var pos, len, xml, nodes, node;\n    if (attrname.slice(0,1) === '@'){\n        attrname = attrname.slice(1);\n    }\n    // In the one place this is used in citeproc-js code, it doesn't need to recurse.\n    for (var i=0,ilen=myjson.children.length; i<ilen; i += 1) {\n        if (myjson.children[i].name === nodename && myjson.children[i].attrs.name === partname) {\n            myjson.children[i].attrs[attrname] = val;\n        }\n    }\n}\n\nCSL.XmlJSON.prototype.deleteNodeByNameAttribute = function (myjson,val) {\n    //print(\"deleteNodeByNameAttribute()\");\n    var i, ilen;\n    for (i = 0, ilen = myjson.children.length; i < ilen; i += 1) {\n        if (!myjson.children[i] || \"string\" === typeof myjson.children[i]) {\n            continue;\n        }\n        if (myjson.children[i].attrs.name == val) {\n            myjson.children = myjson.children.slice(0,i).concat(myjson.children.slice(i+1));\n        }\n    }\n}\n\nCSL.XmlJSON.prototype.deleteAttribute = function (myjson,attrname) {\n    //print(\"deleteAttribute()\");\n    var i, ilen;\n    if (\"undefined\" !== typeof myjson.attrs[attrname]) {\n        myjson.attrs.pop(attrname);\n    }\n}\n\nCSL.XmlJSON.prototype.setAttribute = function (myjson,attr,val) {\n    //print(\"setAttribute()\");\n    myjson.attrs[attr] = val;\n    return false;\n}\n\nCSL.XmlJSON.prototype.nodeCopy = function (myjson,clone) {\n    //print(\"nodeCopy()\");\n    if (!clone) {\n        var clone = {};\n    }\n    if (\"object\" === typeof clone && \"undefined\" === typeof clone.length) {\n        // myjson is an object\n        for (var key in myjson) {\n            if (\"string\" === typeof myjson[key]) {\n                clone[key] = myjson[key];\n            } else if (\"object\" === typeof myjson[key]) {\n                if (\"undefined\" === typeof myjson[key].length) {\n                    clone[key] = this.nodeCopy(myjson[key],{});\n                } else {\n                    clone[key] = this.nodeCopy(myjson[key],[]);\n                }\n            }\n        }\n    } else {\n        // myjson is an array\n        for (var i=0,ilen=myjson.length;i<ilen; i += 1) {\n            if (\"string\" === typeof myjson[i]) {\n                clone[i] = myjson[i];\n            } else {\n                // If it's at the first level of an array, it's an object.\n                clone[i] = this.nodeCopy(myjson[i],{});\n            }\n        }\n    }\n    return clone;\n}\n\nCSL.XmlJSON.prototype.getNodesByName = function (myjson,name,nameattrval,ret) {\n    //print(\"getNodesByName()\");\n    var nodes, node, pos, len;\n    if (!ret) {\n        var ret = [];\n    }\n    if (!myjson || !myjson.children) {\n        return ret;\n    }\n    if (name === myjson.name) {\n        if (nameattrval) {\n            if (nameattrval === myjson.attrs.name) {\n                ret.push(myjson);\n            }\n        } else {\n            ret.push(myjson);\n        }\n    }\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1){\n        if (\"object\" !== typeof myjson.children[i]) {\n            continue;\n        }\n        this.getNodesByName(myjson.children[i],name,nameattrval,ret);\n    }\n    return ret;\n}\n\nCSL.XmlJSON.prototype.nodeNameIs = function (myjson,name) {\n    //print(\"nodeNameIs()\");\n    if (typeof myjson === \"undefined\") {\n        return false;\n    }\n    if (name == myjson.name) {\n        return true;\n    }\n    return false;\n}\n\nCSL.XmlJSON.prototype.makeXml = function (myjson) {\n    //print(\"makeXml()\");\n    if (\"string\" === typeof myjson) {\n        if (myjson.slice(0, 1) === \"<\") {\n            myjson = this.jsonStringWalker.walkToObject(myjson);\n        } else {\n            myjson = JSON.parse(myjson);\n        }\n    }\n    return myjson;\n};\n\nCSL.XmlJSON.prototype.insertChildNodeAfter = function (parent,node,pos,datejson) {\n    //print(\"insertChildNodeAfter()\");\n    // Function is misnamed: this replaces the node\n    for (var i=0,ilen=parent.children.length;i<ilen;i+=1) {\n        if (node === parent.children[i]) {\n            parent.children = parent.children.slice(0,i).concat([datejson]).concat(parent.children.slice(i+1));\n            break;\n        }\n    }\n    return parent;\n};\n\n\nCSL.XmlJSON.prototype.insertPublisherAndPlace = function(myjson) {\n    if (myjson.name === \"group\") {\n        var useme = true;\n        var mustHaves = [\"publisher\",\"publisher-place\"];\n        for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n            var haveVarname = mustHaves.indexOf(myjson.children[i].attrs.variable);\n            var isText = myjson.children[i].name === \"text\";\n            if (isText && haveVarname > -1 && !myjson.children[i].attrs.prefix && !myjson.children[i].attrs.suffix) {\n                mustHaves = mustHaves.slice(0,haveVarname).concat(mustHaves.slice(haveVarname+1));\n            } else {\n                useme = false;\n                break;\n            }\n        }\n        if (useme && !mustHaves.length) {\n            myjson.attrs[\"has-publisher-and-publisher-place\"] = true;\n       }\n    }\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (\"object\" === typeof myjson.children[i]) {\n            this.insertPublisherAndPlace(myjson.children[i]);\n        }\n    }    \n}\n/*\nCSL.XmlJSON.prototype.insertPublisherAndPlace = function(myxml) {\n    var group = myxml.getElementsByTagName(\"group\");\n    for (var i = 0, ilen = group.length; i < ilen; i += 1) {\n        var node = group.item(i);\n        var skippers = [];\n        for (var j = 0, jlen = node.childNodes.length; j < jlen; j += 1) {\n            if (node.childNodes.item(j).nodeType !== 1) {\n                skippers.push(j);\n            }\n        }\n        if (node.childNodes.length - skippers.length === 2) {\n            var twovars = [];\n            for (var j = 0, jlen = 2; j < jlen; j += 1) {\n                if (skippers.indexOf(j) > -1) {\n                    continue;\n                }\n                var child = node.childNodes.item(j);                    \n                var subskippers = [];\n                for (var k = 0, klen = child.childNodes.length; k < klen; k += 1) {\n                    if (child.childNodes.item(k).nodeType !== 1) {\n                        subskippers.push(k);\n                    }\n                }\n                if (child.childNodes.length - subskippers.length === 0) {\n                    twovars.push(child.getAttribute('variable'));\n                    if (child.getAttribute('suffix')\n                        || child.getAttribute('prefix')) {\n                        twovars = [];\n                        break;\n                    }\n                }\n            }\n            if (twovars.indexOf(\"publisher\") > -1 && twovars.indexOf(\"publisher-place\") > -1) {\n                node.setAttribute('has-publisher-and-publisher-place', true);\n            }\n        }\n    }\n};\n*/\n\nCSL.XmlJSON.prototype.isChildOfSubstitute = function(parents) {\n    if (parents.length > 0) {\n        var myparents = parents.slice();\n        var parent = myparents.pop();\n        if (parent === \"substitute\") {\n            return true;\n        } else {\n            return this.isChildOfSubstitute(myparents);\n        }\n    }\n    return false;\n};\n\nCSL.XmlJSON.prototype.addMissingNameNodes = function(myjson,parents) {\n    if (!parents) {\n        parents = [];\n    }\n    if (myjson.name === \"names\") {\n        // Trawl through children to decide whether a name node is needed here\n        if (!this.isChildOfSubstitute(parents)) {\n            var addName = true;\n            for (var i=0,ilen=myjson.children.length;i<ilen;i++) {\n                if (myjson.children[i].name === \"name\") {\n                    addName = false;\n                    break;\n                }\n            }\n            if (addName) {\n                myjson.children = [{name:\"name\",attrs:{},children:[]}].concat(myjson.children);\n            }\n        }\n    }\n    parents.push(myjson.name);\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (\"object\" === typeof myjson.children[i]) {\n            this.addMissingNameNodes(myjson.children[i],parents);\n        }\n    }\n    parents.pop();\n}\n\n\nCSL.XmlJSON.prototype.addInstitutionNodes = function(myjson) {\n    //print(\"addInstitutionNodes()\");\n    var names, thenames, institution, theinstitution, name, thename, xml, pos, len;\n    // The idea here is to map relevant attributes from name and nampart=family\n    // to the \"long\" institution-part node, when and only when forcing insert\n    // of the default node.\n    if (myjson.name === \"names\") {\n        // do stuff\n        var attributes = {};\n        var insertPos = -1;\n        for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n            if (myjson.children[i].name == \"name\") {\n                for (var key in myjson.children[i].attrs) {\n                    attributes[key] = myjson.children[i].attrs[key];\n                }\n                attributes.delimiter = myjson.children[i].attrs.delimiter;\n                attributes.and = myjson.children[i].attrs.and;\n                insertPos = i;\n                for (var k=0,klen=myjson.children[i].children.length;k<klen;k+=1) {\n                    if (myjson.children[i].children[k].attrs.name !== 'family') {\n                        continue;\n                    }\n                    for (var key in myjson.children[i].children[k].attrs) {\n                        attributes[key] = myjson.children[i].children[k].attrs[key];\n                    }\n                }\n            }\n            if (myjson.children[i].name == \"institution\") {\n                insertPos = -1;\n                break;\n            }\n        }\n        if (insertPos > -1) {\n            var institution = this.nodeCopy(this.institution);\n            for (var i=0,ilen = CSL.INSTITUTION_KEYS.length;i<ilen;i+=1) {\n                var attrname = CSL.INSTITUTION_KEYS[i];\n                if (\"undefined\" !== typeof attributes[attrname]) {\n                    institution.children[0].attrs[attrname] = attributes[attrname];\n                }\n                if (attributes.delimiter) {\n                    institution.attrs.delimiter = attributes.delimiter;\n                }\n                if (attributes.and) {\n                    institution.attrs.and = attributes.and;\n                }\n            }\n            myjson.children = myjson.children.slice(0,insertPos+1).concat([institution]).concat(myjson.children.slice(insertPos+1));\n        }\n    }\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (\"string\" === typeof myjson.children[i]) {\n            continue;\n        }\n        // Recurse\n        this.addInstitutionNodes(myjson.children[i]);\n    }\n}\nCSL.XmlJSON.prototype.flagDateMacros = function(myjson) {\n    // print(\"flagDateMacros()\");\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (myjson.children[i].name === \"macro\") {\n            if (this.inspectDateMacros(myjson.children[i])) {\n                myjson.children[i].attrs[\"macro-has-date\"] = \"true\";\n            }\n        }\n    }\n}\nCSL.XmlJSON.prototype.inspectDateMacros = function(myjson) {\n    //print(\"inspectDateMacros()\");\n    if (!myjson || !myjson.children) {\n        return false;\n    }\n    if (myjson.name === \"date\") {\n        return true;\n    } else {\n        for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n            if (this.inspectDateMacros(myjson.children[i])) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n/*\n * Clean serialized XML\n */\nCSL.stripXmlProcessingInstruction = function (xml) {\n    if (!xml) {\n        return xml;\n    }\n    xml = xml.replace(/^<\\?[^?]+\\?>/, \"\");\n    xml = xml.replace(/<!--[^>]+-->/g, \"\");\n    xml = xml.replace(/^\\s+/g, \"\");\n    xml = xml.replace(/\\s+$/g, \"\");\n    return xml;\n};\n\n\n/*\n * String parser for XML inputs\n */\nCSL.parseXml = function(str) {\n\n    var _pos = 0;\n    var _obj = {children:[]};\n    var _stack = [_obj.children];\n\n    function _listifyString(str) {\n        str = str.split(/(?:\\r\\n|\\n|\\r)/).join(\" \").replace(/>[\t ]+</g, \"><\").replace(/<\\!--.*?-->/g, \"\");\n        var lst = str.split(\"><\");\n        var stylePos = null;\n        for (var i=0,ilen=lst.length;i<ilen;i++) {\n            if (i > 0) {\n                lst[i] = \"<\" + lst[i];\n            }\n            if (i < (lst.length-1)) {\n                lst[i] = lst[i] + \">\";\n            }\n            if (\"number\" != typeof stylePos) {\n                if (lst[i].slice(0, 7) === \"<style \" || lst[i].slice(0, 8) == \"<locale \") {\n                    stylePos = i;\n                }\n            }\n        }\n        lst = lst.slice(stylePos);\n        // Combine open/close elements for empty terms,\n        // so that they will be passed through correctly\n        // as empty strings.\n        for (var i=lst.length-2;i>-1;i--) {\n            if (lst[i].slice(1).indexOf(\"<\") === -1) {\n                var stub = lst[i].slice(0, 5);\n                if (lst[i].slice(-2) !== \"/>\") {\n                    if (stub === \"<term\") {\n                        if (lst[i+1].slice(0, 6) === \"</term\") {\n                            lst[i] = lst[i] + lst[i+1];\n                            lst = lst.slice(0, i+1).concat(lst.slice(i+2));\n                        }\n                    } else if ([\"<sing\", \"<mult\"].indexOf(stub) > -1) {\n                        if (lst[i].slice(-2) !== \"/>\" && lst[i+1].slice(0, 1) === \"<\") {\n                            lst[i] = lst[i] + lst[i+1];\n                            lst = lst.slice(0, i+1).concat(lst.slice(i+2));\n                        }\n                    }\n                }\n            }\n        }\n        return lst;\n    }\n\n    function _decodeHtmlEntities(str) {\n        return str\n            .split(\"&amp;\").join(\"&\")\n            .split(\"&quot;\").join(\"\\\"\")\n            .split(\"&gt;\").join(\">\").split(\"&lt;\").join(\"<\")\n            .replace(/&#([0-9]{1,6});/gi, function(match, numStr) {\n                var num = parseInt(numStr, 10); // read num as normal number\n                return String.fromCharCode(num);\n            })\n            .replace(/&#x([a-f0-9]{1,6});/gi, function(match, numStr){\n                var num = parseInt(numStr, 16); // read num as hex\n                return String.fromCharCode(num);\n            });\n    }\n\n    function _getAttributes(elem) {\n        var m = elem.match(/([^\\'\\\"=\t ]+)=(?:\\\"[^\\\"]*\\\"|\\'[^\\']*\\')/g);\n        if (m) {\n            for (var i=0,ilen=m.length;i<ilen;i++) {\n                m[i] = m[i].replace(/=.*/, \"\");\n            }\n        }\n        return m;\n    }\n\n    function _getAttribute(elem, attr) {\n        var rex = RegExp('^.*[\t ]+' + attr + '=(\\\"(?:[^\\\"]*)\\\"|\\'(?:[^\\']*)\\').*$');\n        var m = elem.match(rex);\n        return m ? m[1].slice(1, -1) : null;\n    }\n\n    function _getTagName(elem) {\n        var rex = RegExp(\"^<([^\t />]+)\");\n        var m = elem.match(rex);\n        return m ? m[1] : null;\n    }\n    \n\n    function _castObjectFromOpeningTag(elem) {\n        var obj = {};\n        obj.name = _getTagName(elem);\n        obj.attrs = {};\n        var attributes = _getAttributes(elem);\n        if (attributes) {\n            for (var i=0,ilen=attributes.length;i<ilen;i++) {\n                var attr = {\n                    name: attributes[i],\n                    value: _getAttribute(elem, attributes[i])\n                }\n                obj.attrs[attr.name] = _decodeHtmlEntities(attr.value);\n            }\n        }\n        obj.children = [];\n        return obj;\n    }\n\n    function _extractTextFromCompositeElement(elem) {\n        var m = elem.match(/^.*>([^<]*)<.*$/);\n        return _decodeHtmlEntities(m[1]);\n    }\n\n    function _appendToChildren(obj) {\n        _stack.slice(-1)[0].push(obj);\n    }\n\n    function _extendStackWithNewChildren(obj) {\n        _stack.push(obj.children);\n    }\n\n    function processElement(elem) {\n        var obj;\n        if (elem.slice(1).indexOf('<') > -1) {\n            // withtext\n            var tag = elem.slice(0, elem.indexOf('>')+1);\n            obj = _castObjectFromOpeningTag(tag);\n            obj.children = [_extractTextFromCompositeElement(elem)];\n            _appendToChildren(obj);\n        } else if (elem.slice(-2) === '/>') {\n            // singleton\n            obj = _castObjectFromOpeningTag(elem);\n            // Empty term as singleton\n            if (_getTagName(elem) === 'term') {\n                obj.children.push('');\n            }\n            _appendToChildren(obj);\n        } else if (elem.slice(0, 2) === '</') {\n            // close\n            _stack.pop();\n        } else {\n            // open\n            obj = _castObjectFromOpeningTag(elem);\n            _appendToChildren(obj)\n            _extendStackWithNewChildren(obj);\n        }\n    }\n\n    var lst = _listifyString(str);\n\n    for (var i=0,ilen=lst.length;i<ilen;i++) {\n        var elem = lst[i];\n        processElement(elem);\n    }\n    return _obj.children[0];\n}\n\n/**\n * Functions for parsing an XML object using E4X.\n */\n\nCSL.XmlDOM = function (dataObj) {\n    this.dataObj = dataObj;\n    if (\"undefined\" == typeof DOMParser) {\n        DOMParser = function() {};\n        DOMParser.prototype.parseFromString = function(str, contentType) {\n            if (\"undefined\" != typeof ActiveXObject) {\n                var xmldata = new ActiveXObject('MSXML.DomDocument');\n                xmldata.async = false;\n                xmldata.loadXML(str);\n                return xmldata;\n            } else if (\"undefined\" != typeof XMLHttpRequest) {\n                var xmldata = new XMLHttpRequest;\n                if (!contentType) {\n                    contentType = 'text/xml';\n                }\n                xmldata.open('GET', 'data:' + contentType + ';charset=utf-8,' + encodeURIComponent(str), false);\n                if(xmldata.overrideMimeType) {\n                    xmldata.overrideMimeType(contentType);\n                }\n                xmldata.send(null);\n                return xmldata.responseXML;\n            } else if (\"undefined\" != typeof marknote) {\n                var parser = new marknote.Parser();\n                return parser.parse(str);\n            }\n        };\n        this.hasAttributes = function (node) {\n            var ret;\n            if (node.attributes && node.attributes.length) {\n                ret = true;\n            } else {\n                ret = false;\n            }\n            return ret;\n        };\n    } else {\n        /*\n        this.hasAttributes = function (node) {\n            return node[\"hasAttributes\"]();\n        };\n        */\n        this.hasAttributes = function (node) {\n            var ret;\n            if (node.attributes && node.attributes.length) {\n                ret = true;\n            } else {\n                ret = false;\n            }\n            return ret;\n        };\n    }\n    this.importNode = function (doc, srcElement) {\n        var ret;\n        if (\"undefined\" == typeof doc.importNode) {\n            ret = this._importNode(doc, srcElement, true);\n        } else {\n            ret = doc.importNode(srcElement, true);\n        }\n        return ret;\n    };\n    // In case importNode is not available.\n    // Thx + hat tip to Anthony T. Holdener III\n    // http://www.alistapart.com/articles/crossbrowserscripting\n    // cases 3, 4, 8 = text, cdata, comment\n    this._importNode = function(doc, node, allChildren) {\n        switch (node.nodeType) {\n            // element node\n            case 1:\n                var newNode = doc.createElement(node.nodeName);\n                if (node.attributes && node.attributes.length > 0)\n                    for (var i = 0, il = node.attributes.length; i < il;)\n                        newNode.setAttribute(node.attributes[i].nodeName, node.getAttribute(node.attributes[i++].nodeName));\n                    if (allChildren && node.childNodes && node.childNodes.length > 0)\n                        for (var i = 0, il = node.childNodes.length; i < il;)\n                            newNode.appendChild(this._importNode(doc, node.childNodes[i++], allChildren));\n                return newNode;\n                break;\n            case 3:\n            case 4:\n            case 8:\n                // Drop comments on the floor as well.\n                //return doc.createTextNode(node.nodeValue);\n                //break;\n        }\n    };\n    this.parser = new DOMParser();\n\n    // This seems horribly tormented, but there might be a reason for it.\n    // Perhaps this was the only way I found to get namespacing to work ... ?\n    var str = \"<docco><institution institution-parts=\\\"long\\\" delimiter=\\\", \\\" substitute-use-first=\\\"1\\\" use-last=\\\"1\\\"><institution-part name=\\\"long\\\"/></institution></docco>\";\n    var inst_doc = this.parser.parseFromString(str, \"text/xml\");\n    var inst_node = inst_doc.getElementsByTagName(\"institution\");\n    this.institution = inst_node.item(0);\n    var inst_part_node = inst_doc.getElementsByTagName(\"institution-part\");\n    this.institutionpart = inst_part_node.item(0);\n    this.ns = \"http://purl.org/net/xbiblio/csl\";\n};\n\n/**\n * No need for cleaning with the DOM, I think.  This will probably just be a noop.\n * But first, let's get XML mode switching up and running.\n */\nCSL.XmlDOM.prototype.clean = function (xml) {\n    xml = xml.replace(/<\\?[^?]+\\?>/g, \"\");\n    xml = xml.replace(/<![^>]+>/g, \"\");\n    xml = xml.replace(/^\\s+/, \"\");\n    xml = xml.replace(/\\s+$/, \"\");\n    xml = xml.replace(/^\\n*/, \"\");\n    return xml;\n};\n\n\n/**\n * Methods to call on a node.\n */\nCSL.XmlDOM.prototype.getStyleId = function (myxml, styleName) {\n    var text = \"\";\n    var tagName = \"id\";\n    if (styleName) {\n        tagName = \"title\";\n    }\n    var node = myxml.getElementsByTagName(tagName);\n    if (node && node.length) {\n        node = node.item(0);\n    }\n    if (node) {\n        // W3C conformant browsers\n        text = node.textContent;\n    }\n    if (!text) {\n        // Opera, IE 6 & 7\n        text = node.innerText;\n    }\n    if (!text) {\n        // Safari\n        text = node.innerHTML;\n    }\n    return text;\n};\n\nCSL.XmlDOM.prototype.children = function (myxml) {\n    var children, pos, len, ret;\n    if (myxml) {\n        ret = [];\n        children = myxml.childNodes;\n        for (pos = 0, len = children.length; pos < len; pos += 1) {\n            if (children[pos].nodeName != \"#text\") {\n                ret.push(children[pos]);\n            }\n        }\n        return ret;\n    } else {\n        return [];\n    }\n};\n\nCSL.XmlDOM.prototype.nodename = function (myxml) {\n    var ret = myxml.nodeName;\n    return ret;\n};\n\nCSL.XmlDOM.prototype.attributes = function (myxml) {\n    var ret, attrs, attr, key, xml, pos, len;\n    ret = new Object();\n    if (myxml && this.hasAttributes(myxml)) {\n        attrs = myxml.attributes;\n        for (pos = 0, len=attrs.length; pos < len; pos += 1) {\n            attr = attrs[pos];\n            ret[\"@\" + attr.name] = attr.value;\n        }\n    }\n    return ret;\n};\n\n\nCSL.XmlDOM.prototype.content = function (myxml) {\n    var ret;\n    if (\"undefined\" != typeof myxml.textContent) {\n        ret = myxml.textContent;\n    } else if (\"undefined\" != typeof myxml.innerText) {\n        ret = myxml.innerText;\n    } else {\n        ret = myxml.txt;\n    }\n    return ret;\n};\n\n\nCSL.XmlDOM.prototype.namespace = {\n    \"xml\":\"http://www.w3.org/XML/1998/namespace\"\n}\n\nCSL.XmlDOM.prototype.numberofnodes = function (myxml) {\n    if (myxml) {\n        return myxml.length;\n    } else {\n        return 0;\n    }\n};\n\nCSL.XmlDOM.prototype.getAttributeName = function (attr) {\n    var ret = attr.name;\n    return ret;\n}\n\nCSL.XmlDOM.prototype.getAttributeValue = function (myxml,name,namespace) {\n    var ret = \"\";\n    if (namespace) {\n        name = namespace+\":\"+name;\n    }\n    if (myxml && this.hasAttributes(myxml) && myxml.getAttribute(name)) {\n        ret = myxml.getAttribute(name);\n    }\n    return ret;\n}\n\n//\n// Can't this be, you know ... simplified?\n//\nCSL.XmlDOM.prototype.getNodeValue = function (myxml,name) {\n    var ret = null;\n    if (name){\n        var vals = myxml.getElementsByTagName(name);\n        if (vals.length > 0) {\n            if (\"undefined\" != typeof vals[0].textContent) {\n                ret = vals[0].textContent;\n            } else if (\"undefined\" != typeof vals[0].innerText) {\n                ret = vals[0].innerText;\n            } else {\n                ret = vals[0].text;\n            }\n        }\n    }\n    if (ret === null && myxml && myxml.childNodes && (myxml.childNodes.length == 0 || (myxml.childNodes.length == 1 && myxml.firstChild.nodeName == \"#text\"))) {\n        if (\"undefined\" != typeof myxml.textContent) {\n            ret = myxml.textContent;\n        } else if (\"undefined\" != typeof myxml.innerText) {\n            ret = myxml.innerText;\n        } else {\n            ret = myxml.text;\n        }\n    }\n    if (ret === null) {\n        ret = myxml;\n    }\n    return ret;\n}\n\nCSL.XmlDOM.prototype.setAttributeOnNodeIdentifiedByNameAttribute = function (myxml,nodename,partname,attrname,val) {\n    var pos, len, xml, nodes, node;\n    if (attrname.slice(0,1) === '@'){\n        attrname = attrname.slice(1);\n    }\n    nodes = myxml.getElementsByTagName(nodename);\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        node = nodes[pos];\n        if (node.getAttribute(\"name\") != partname) {\n            continue;\n        }\n        node.setAttribute(attrname, val);\n    }\n}\n\nCSL.XmlDOM.prototype.deleteNodeByNameAttribute = function (myxml,val) {\n    var pos, len, node, nodes;\n    nodes = myxml.childNodes;\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        node = nodes[pos];\n        if (!node || node.nodeType == node.TEXT_NODE) {\n            continue;\n        }\n        if (this.hasAttributes(node) && node.getAttribute(\"name\") == val) {\n            myxml.removeChild(nodes[pos]);\n        }\n    }\n}\n\nCSL.XmlDOM.prototype.deleteAttribute = function (myxml,attr) {\n    myxml.removeAttribute(attr);\n}\n\nCSL.XmlDOM.prototype.setAttribute = function (myxml,attr,val) {\n    if (!myxml.ownerDocument) {\n        myxml = myxml.firstChild;\n    }\n    // \"unknown\" to satisfy IE8, which crashes when setAttribute\n    // is checked directly as a property, and report its type as\n    // \"unknown\".\n    // Many thanks to Phil Lord for tracing the cause of the fault.\n    if ([\"function\", \"unknown\"].indexOf(typeof myxml.setAttribute) > -1) {\n        myxml.setAttribute(attr, val);\n    }\n    return false;\n}\n\nCSL.XmlDOM.prototype.nodeCopy = function (myxml) {\n    var cloned_node = myxml.cloneNode(true);\n    return cloned_node;\n}\n\nCSL.XmlDOM.prototype.getNodesByName = function (myxml,name,nameattrval) {\n    var ret, nodes, node, pos, len;\n    ret = [];\n    nodes = myxml.getElementsByTagName(name);\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        node = nodes.item(pos);\n        if (nameattrval && !(this.hasAttributes(node) && node.getAttribute(\"name\") == nameattrval)) {\n//        if (nameattrval && !(this.attributes && node.attributes.name && node.attributes.name.value == nameattrval)) {\n            continue;\n        }\n        ret.push(node);\n    }\n    return ret;\n}\n\nCSL.XmlDOM.prototype.nodeNameIs = function (myxml,name) {\n    if (name == myxml.nodeName) {\n        return true;\n    }\n    return false;\n}\n\nCSL.XmlDOM.prototype.makeXml = function (myxml) {\n    var ret, topnode;\n    if (!myxml) {\n        myxml = \"<docco><bogus/></docco>\";\n    }\n    myxml = myxml.replace(/\\s*<\\?[^>]*\\?>\\s*\\n*/g, \"\");\n    var nodetree = this.parser.parseFromString(myxml, \"application/xml\");\n    return nodetree.firstChild;\n};\n\nCSL.XmlDOM.prototype.insertChildNodeAfter = function (parent,node,pos,datexml) {\n    var myxml, xml;\n    myxml = this.importNode(node.ownerDocument, datexml);\n    parent.replaceChild(myxml, node);\n     return parent;\n};\n\nCSL.XmlDOM.prototype.insertPublisherAndPlace = function(myxml) {\n    var group = myxml.getElementsByTagName(\"group\");\n    for (var i = 0, ilen = group.length; i < ilen; i += 1) {\n        var node = group.item(i);\n        var skippers = [];\n        for (var j = 0, jlen = node.childNodes.length; j < jlen; j += 1) {\n            if (node.childNodes.item(j).nodeType !== 1) {\n                skippers.push(j);\n            }\n        }\n        if (node.childNodes.length - skippers.length === 2) {\n            var twovars = [];\n            for (var j = 0, jlen = 2; j < jlen; j += 1) {\n                if (skippers.indexOf(j) > -1) {\n                    continue;\n                }\n                var child = node.childNodes.item(j);                    \n                var subskippers = [];\n                for (var k = 0, klen = child.childNodes.length; k < klen; k += 1) {\n                    if (child.childNodes.item(k).nodeType !== 1) {\n                        subskippers.push(k);\n                    }\n                }\n                if (child.childNodes.length - subskippers.length === 0) {\n                    twovars.push(child.getAttribute('variable'));\n                    if (child.getAttribute('suffix')\n                        || child.getAttribute('prefix')) {\n                        twovars = [];\n                        break;\n                    }\n                }\n            }\n            if (twovars.indexOf(\"publisher\") > -1 && twovars.indexOf(\"publisher-place\") > -1) {\n                node.setAttribute('has-publisher-and-publisher-place', true);\n            }\n        }\n    }\n};\n\nCSL.XmlDOM.prototype.isChildOfSubstitute = function(node) {\n    if (node.parentNode) {\n        if (node.parentNode.tagName.toLowerCase() === \"substitute\") {\n            return true;\n        } else {\n            return this.isChildOfSubstitute(node.parentNode);\n        }\n    }\n    return false;\n};\n\nCSL.XmlDOM.prototype.addMissingNameNodes = function(myxml) {\n    var nameslist = myxml.getElementsByTagName(\"names\");\n    for (var i = 0, ilen = nameslist.length; i < ilen; i += 1) {\n        var names = nameslist.item(i);\n        var namelist = names.getElementsByTagName(\"name\");\n        if ((!namelist || namelist.length === 0)\n            && !this.isChildOfSubstitute(names)) {\n            \n            var doc = names.ownerDocument;\n            var name = doc.createElement(\"name\");\n            names.appendChild(name);\n        }\n    }\n};\n\n\nCSL.XmlDOM.prototype.addInstitutionNodes = function(myxml) {\n    var names, thenames, institution, theinstitution, theinstitutionpart, name, thename, xml, pos, len;\n    names = myxml.getElementsByTagName(\"names\");\n    for (pos = 0, len = names.length; pos < len; pos += 1) {\n        thenames = names.item(pos);\n        name = thenames.getElementsByTagName(\"name\");\n        if (name.length == 0) {\n            continue;\n        }\n        institution = thenames.getElementsByTagName(\"institution\");\n        if (institution.length == 0) {\n            theinstitution = this.importNode(myxml.ownerDocument, this.institution);\n            theinstitutionpart = theinstitution.getElementsByTagName(\"institution-part\").item(0);\n            thename = name.item(0);\n            thenames.insertBefore(theinstitution, thename.nextSibling);\n            for (var j = 0, jlen = CSL.INSTITUTION_KEYS.length; j < jlen; j += 1) {\n                var attrname = CSL.INSTITUTION_KEYS[j];\n                var attrval = thename.getAttribute(attrname);\n                if (attrval) {\n                    theinstitutionpart.setAttribute(attrname, attrval);\n                }\n            }\n            var nameparts = thename.getElementsByTagName(\"name-part\");\n            for (var j = 0, jlen = nameparts.length; j < jlen; j += 1) {\n                if ('family' === nameparts[j].getAttribute('name')) {\n                    for (var k = 0, klen = CSL.INSTITUTION_KEYS.length; k < klen; k += 1) {\n                        var attrname = CSL.INSTITUTION_KEYS[k];\n                        var attrval = nameparts[j].getAttribute(attrname);\n                        if (attrval) {\n                            theinstitutionpart.setAttribute(attrname, attrval);\n                        }\n                    }\n                }\n            }\n        }\n    }\n};\n\n\nCSL.XmlDOM.prototype.flagDateMacros = function(myxml) {\n    var pos, len, thenode, thedate;\n    var nodes = myxml.getElementsByTagName(\"macro\");\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        thenode = nodes.item(pos);\n        thedate = thenode.getElementsByTagName(\"date\");\n        if (thedate.length) {\n            thenode.setAttribute('macro-has-date', 'true');\n        }\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.setupXml = function(xmlObject) {\n    var dataObj = {};\n    var parser = null;\n    if (\"undefined\" !== typeof xmlObject) {\n        if (\"string\" === typeof xmlObject) {\n            xmlObject = xmlObject.replace(\"^\\uFEFF\", \"\")\n                .replace(/^\\s+/, \"\");\n            if (xmlObject.slice(0, 1) === \"<\") {\n                // Assume serialized XML\n                dataObj = CSL.parseXml(xmlObject);\n            } else {\n                // Assume serialized JSON\n                dataObj = JSON.parse(xmlObject);\n            }\n            parser = new CSL.XmlJSON(dataObj);\n        } else if (\"undefined\" !== typeof xmlObject.getAttribute) {\n            // Assume DOM instance\n            parser = new CSL.XmlDOM(xmlObject);\n        } else if (\"undefined\" !== typeof xmlObject.toXMLString) {\n            // Assume E4X object\n            parser = new CSL.XmlE4X(xmlObject);\n        } else {\n            // Assume JS object\n            parser = new CSL.XmlJSON(xmlObject);\n        }\n    } else {\n        CSL.error(\"unable to parse XML input\");\n    }\n    if (!parser) {\n        CSL.error(\"citeproc-js error: unable to parse CSL style or locale object\");\n    }\n    return parser;\n};\n\n/*global CSL: true */\n\nCSL.getSortCompare = function (default_locale) {\n    if (CSL.stringCompare) {\n        return CSL.stringCompare;\n    }\n    var me = this;\n    var strcmp;\n    var strcmp_opts = {\n        sensitivity:\"base\",\n        ignorePunctuation:true,\n        numeric:true\n    };\n    // In order, attempt the following:\n    //   (1) Set locale collation from processor language\n    //   (2) Use localeCompare()\n    if (!default_locale) {\n        default_locale = \"en-US\";\n    }\n    strcmp = function (a, b) {\n        return CSL.toLocaleLowerCase.call(me, a).localeCompare(CSL.toLocaleLowerCase.call(me, b),default_locale,strcmp_opts);\n    };\n    var stripPunct = function (str) {\n        return str.replace(/^[\\[\\]\\'\\\"]*/g, \"\");\n    };\n    var getBracketPreSort = function () {\n        if (!strcmp(\"[x\",\"x\")) {\n            return false;\n        } else {\n            return function (a, b) {\n                return strcmp(stripPunct(a), stripPunct(b));\n            };\n        }\n    };\n    var bracketPreSort = getBracketPreSort();\n    var sortCompare = function (a, b) {\n        if (bracketPreSort) {\n            return bracketPreSort(a, b);\n        } else {\n            return strcmp(a, b);\n        }\n    };\n    return sortCompare;\n};\n\n/*global CSL: true */\n\nCSL.ambigConfigDiff = function(a, b) {\n    var pos, len, ppos, llen;\n    // return of true means the ambig configs differ\n    if (a.names.length !== b.names.length) {\n        //print(\"   (1)\");\n        return 1;\n    } else {\n        for (pos = 0, len = a.names.length; pos < len; pos += 1) {\n            if (a.names[pos] !== b.names[pos]) {\n        //print(\"   (2) \"+a.names[pos]+\" \"+b.names[pos]);\n                return 1;\n            } else {\n                for (ppos = 0, llen = a.givens[pos]; ppos < llen; ppos += 1) {\n                    if (a.givens[pos][ppos] !== b.givens[pos][ppos]) {\n        //print(\"   (3): \"+a.givens[pos][ppos]+\" \"+b.givens[pos][ppos]+\" \"+pos+\"/\"+ppos+\" \"+b.givens[pos]);\n                        return 1;\n                    }\n                }\n            }\n        }\n    }\n    if (a.disambiguate != b.disambiguate) {\n        //print(\"   (4) \"+a.disambiguate+\" \"+b.disambiguate);\n        return 1;\n    }\n    if (a.year_suffix !== b.year_suffix) {\n        //print(\"   (5) \"+a.year_suffix+\" \"+b.year_suffix);\n        return 1;\n    }\n    return 0;\n};\n\nCSL.cloneAmbigConfig = function (config, oldconfig) {\n    var i, ilen, j, jlen, param;\n    var ret = {};\n    ret.names = [];\n    ret.givens = [];\n    ret.year_suffix = false;\n    ret.disambiguate = false;\n    for (i = 0, ilen = config.names.length; i < ilen; i += 1) {\n        param = config.names[i];\n        // Fixes update bug affecting plugins, without impacting\n        // efficiency with update of large numbers of year-suffixed\n        // items.\n        ret.names[i] = param;\n    }\n    for (i  = 0, ilen = config.givens.length; i < ilen; i += 1) {\n        param = [];\n        for (j = 0, jlen = config.givens[i].length; j < jlen; j += 1) {\n            // condition at line 312 of disambiguate.js protects against negative\n            // values of j\n            param.push(config.givens[i][j]);\n        }\n        ret.givens.push(param);\n    }\n    // XXXX Is this necessary at all?\n    if (oldconfig) {\n        ret.year_suffix = oldconfig.year_suffix;\n        ret.disambiguate = oldconfig.disambiguate;\n    } else {\n        ret.year_suffix = config.year_suffix;\n        ret.disambiguate = config.disambiguate;\n    }\n    return ret;\n};\n\n/**\n * Return current base configuration for disambiguation\n */\nCSL.getAmbigConfig = function () {\n    var config, ret;\n    config = this.tmp.disambig_request;\n    if (!config) {\n        config = this.tmp.disambig_settings;\n    }\n    var ret = CSL.cloneAmbigConfig(config);\n    return ret;\n};\n\n/**\n * Return max values for disambiguation\n */\nCSL.getMaxVals = function () {\n    return this.tmp.names_max.mystack.slice();\n};\n\n/**\n * Return min value for disambiguation\n */\nCSL.getMinVal = function () {\n    return this.tmp[\"et-al-min\"];\n};\n\n/*global CSL: true */\n\n/* For node execution pretty-printing (see below) */\n\n/*\nvar INDENT = \"\";\n*/\n\nCSL.tokenExec = function (token, Item, item) {\n    // Called on state object\n    var next, maybenext, exec, debug;\n    debug = false;\n    next = token.next;\n    maybenext = false;\n\n    /* Pretty-print node executions */\n\n    /*\n    if ([\"if\", \"else-if\", \"else\"].indexOf(token.name) === -1) {\n        if (token.tokentype == 1) {\n            INDENT = INDENT.slice(0, -2);\n        }\n    }\n    this.sys.print(INDENT + \"---> Token: \" + token.name + \" (\" + token.tokentype + \") in \" + this.tmp.area + \", \" + this.output.current.mystack.length);\n    if ([\"if\", \"else-if\", \"else\"].indexOf(token.name) === -1) {\n        if (token.tokentype == 0) {\n            INDENT += \"  \";\n        }\n    }\n    */\n\n    var record = function (result) {\n        if (result) {\n            this.tmp.jump.replace(\"succeed\");\n            return token.succeed;\n        } else {\n            this.tmp.jump.replace(\"fail\");\n            return token.fail;\n        }\n    };\n    if (token.test) {\n        next = record.call(this,token.test(Item, item));\n    }\n    for (var i=0,ilen=token.execs.length;i<ilen;i++) {\n        exec = token.execs[i];\n        maybenext = exec.call(token, this, Item, item);\n        if (maybenext) {\n            next = maybenext;\n        }\n    }\n    //SNIP-START\n    if (debug) {\n        CSL.debug(token.name + \" (\" + token.tokentype + \") ---> done\");\n    }\n    //SNIP-END\n    return next;\n};\n\n/**\n * Macro expander.\n * <p>Called on the state object.</p>\n */\nCSL.expandMacro = function (macro_key_token, target) {\n    var mkey, macro_nodes, end_of_macro, func;\n\n    mkey = macro_key_token.postponed_macro;\n\n    var sort_direction = macro_key_token.strings.sort_direction;\n    \n    // Decorations and affixes are in wrapper applied in cs:text\n    macro_key_token = new CSL.Token(\"group\", CSL.START);\n    \n    var hasDate = false;\n    var macroid = false;\n    macro_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, 'macro', mkey);\n    if (macro_nodes.length) {\n        macroid = this.cslXml.getAttributeValue(macro_nodes[0],'cslid');\n        hasDate = this.cslXml.getAttributeValue(macro_nodes[0], \"macro-has-date\");\n    }\n    if (hasDate) {\n        mkey = mkey + \"@\" + this.build.current_default_locale;\n        func = function (state) {\n            if (state.tmp.extension) {\n                state.tmp[\"doing-macro-with-date\"] = true;\n            }\n        };\n        macro_key_token.execs.push(func);\n    }\n\n    if (this.build.macro_stack.indexOf(mkey) > -1) {\n        CSL.error(\"CSL processor error: call to macro \\\"\" + mkey + \"\\\" would cause an infinite loop\");\n    } else {\n        this.build.macro_stack.push(mkey);\n    }\n\n    macro_key_token.cslid = macroid;\n\n    if (CSL.MODULE_MACROS[mkey]) {\n        macro_key_token.juris = mkey;\n        this.opt.update_mode = CSL.POSITION;\n    }\n    // Macro group is treated as a real node in the style\n    CSL.Node.group.build.call(macro_key_token, this, target, true);\n\n    // Node does not exist in the CSL\n    if (!this.cslXml.getNodeValue(macro_nodes)) {\n        CSL.error(\"CSL style error: undefined macro \\\"\" + mkey + \"\\\"\");\n    }\n\n    // Let's macro\n    var mytarget = CSL.getMacroTarget.call(this, mkey);\n    if (mytarget) {\n        CSL.buildMacro.call(this, mytarget, macro_nodes);\n        CSL.configureMacro.call(this, mytarget);\n    }\n    if (!this.build.extension) {\n        var func = (function(macro_name) {\n            return function (state, Item, item) {\n                var next = 0;\n                while (next < state.macros[macro_name].length) {\n                    next = CSL.tokenExec.call(state, state.macros[macro_name][next], Item, item);\n                }\n            };\n        }(mkey));\n        var text_node = new CSL.Token(\"text\", CSL.SINGLETON);\n        text_node.execs.push(func);\n        target.push(text_node);\n    }\n\n    // Decorations and affixes are in wrapper applied in cs:text\n    end_of_macro = new CSL.Token(\"group\", CSL.END);\n    end_of_macro.strings.sort_direction = sort_direction;\n    \n    if (hasDate) {\n        func = function (state) {\n            if (state.tmp.extension) {\n                state.tmp[\"doing-macro-with-date\"] = false;\n            }\n        };\n        end_of_macro.execs.push(func);\n    }\n    if (macro_key_token.juris) {\n        end_of_macro.juris = mkey;\n     }\n    // Macro group is treated as a real node in the style\n    CSL.Node.group.build.call(end_of_macro, this, target, true);\n\n    this.build.macro_stack.pop();\n};\n\nCSL.getMacroTarget = function (mkey) {\n    var mytarget = false;\n    if (this.build.extension) {\n        mytarget = this[this.build.root + this.build.extension].tokens;\n    } else if (!this.macros[mkey]) {\n        mytarget = [];\n        this.macros[mkey] = mytarget;\n    }\n    return mytarget;\n};\n\nCSL.buildMacro = function (mytarget, macro_nodes) {\n    var builder = CSL.makeBuilder(this, mytarget);\n    var mynode;\n    if (\"undefined\" === typeof macro_nodes.length) {\n        mynode = macro_nodes;\n    } else {\n        mynode = macro_nodes[0];\n    }\n    builder(mynode);\n};\n\nCSL.configureMacro = function (mytarget) {\n    if (!this.build.extension) {\n        this.configureTokenList(mytarget);\n    }\n};\n\n\n/**\n * Convert XML node to token.\n * <p>This is called on an XML node.  After extracting the name and attribute\n * information from the node, it performs three operations.  Attribute information\n * relating to output formatting is stored on the node as an array of tuples,\n * which fixes the sequence of execution of output functions to be invoked\n * in the next phase of processing.  Other attribute information is reduced\n * to functions, and is pushed into an array on the token in no particular\n * order, for later execution.  The element name is used as a key to\n * invoke the relevant <code>build</code> method of the target element.\n * Element methods are defined in {@link CSL.Node}.</p>\n * @param {Object} state  The state object returned by {@link CSL.Engine}.\n * @param {Int} tokentype  A CSL namespace constant (<code>CSL.START</code>,\n * <code>CSL.END</code> or <code>CSL.SINGLETON</code>.\n */\nCSL.XmlToToken = function (state, tokentype, explicitTarget, var_stack) {\n    var name, txt, attrfuncs, attributes, decorations, token, key, target;\n    name = state.cslXml.nodename(this);\n    //CSL.debug(tokentype + \" : \" + name);\n    if (state.build.skip && state.build.skip !== name) {\n        return;\n    }\n    if (!name) {\n        txt = state.cslXml.content(this);\n        if (txt) {\n            state.build.text = txt;\n        }\n        return;\n    }\n    if (!CSL.Node[state.cslXml.nodename(this)]) {\n        CSL.error(\"Undefined node name \\\"\" + name + \"\\\".\");\n    }\n    attrfuncs = [];\n    attributes = state.cslXml.attributes(this);\n    decorations = CSL.setDecorations.call(this, state, attributes);\n    token = new CSL.Token(name, tokentype);\n    if (tokentype !== CSL.END || name === \"if\" || name === \"else-if\" || name === \"layout\") {\n        //\n        // xml: more xml stuff\n        //\n        for (var key in attributes) {\n            if (attributes.hasOwnProperty(key)) {\n                if (tokentype === CSL.END && key !== \"@language\" && key !== \"@locale\") {\n                    continue;\n                }\n                if (attributes.hasOwnProperty(key)) {\n                    if (CSL.Attributes[key]) {\n                        try {\n                            CSL.Attributes[key].call(token, state, \"\" + attributes[key]);\n                        } catch (e) {\n                            CSL.error(key + \" attribute: \" + e);\n                        }\n                    } else {\n                        CSL.debug(\"warning: undefined attribute \\\"\"+key+\"\\\" in style\");\n                    }\n                }\n            }\n        }\n        token.decorations = decorations;\n        if (CSL.DATE_VARIABLES.indexOf(attributes['@variable']) > -1) {\n            var_stack.push(token.variables);\n        }\n    } else if (tokentype === CSL.END && attributes['@variable']) {\n        token.hasVariable = true;\n        if (CSL.DATE_VARIABLES.indexOf(attributes['@variable']) > -1) {\n            token.variables = var_stack.pop();\n        }\n    }\n    //\n    // !!!!!: eliminate diversion of tokens to separate\n    // token list (formerly used for reading in macros\n    // and terms).\n    //\n    if (explicitTarget) {\n        target = explicitTarget;\n    } else {\n        target = state[state.build.area].tokens;\n    }\n    // True flags real nodes in the style\n    CSL.Node[name].build.call(token, state, target, true);\n};\n\n\n\n/*global CSL: true */\n\n\nCSL.DateParser = function () {\n\n    /*\n     * Fixed values\n     */\n\n    // jse imperial years\n    var epochPairs = [\n        [\"\\u660E\\u6CBB\", 1867],\n        [\"\\u5927\\u6B63\", 1911],\n        [\"\\u662D\\u548C\", 1925],\n        [\"\\u5E73\\u6210\", 1988]\n    ];\n\n    // years by jse imperial epoch\n    var epochYearByName = {};\n    for (var i=0,ilen=epochPairs.length; i<ilen; i++) {\n        var key = epochPairs[i][0];\n        var val = epochPairs[i][1];\n        epochYearByName[key] = val;\n    }\n    \n    var epochMatchStrings = [];\n    var epochMap = {};\n    for (var i=0,ilen=epochPairs.length; i<ilen; i++) {\n        var pair = epochPairs[i];\n        var val = pair[0];\n        epochMatchStrings.push(val);\n        epochMap[pair[0]] = pair[1];\n    }\n    var epochMatchString = epochMatchStrings.join(\"|\");\n\n    // regular expression to trap year name and year\n    // (splitter and matcher, to cope with ancient JS implementations)\n    var epochSplitter = new RegExp(\"(?:\" + epochMatchString + \")(?:[0-9]+)\");\n    var epochMatcher = new RegExp(\"(?:\" + epochMatchString + \")(?:[0-9]+)\", \"g\");\n\n    // regular expression for month or day kanji label\n    var kanjiMonthDay = /(\\u6708|\\u5E74)/g;\n\n    // regular expression for year kanji label\n    var kanjiYear = /\\u65E5/g;\n\n    // regular expression for double-width Japanese range marker\n    var kanjiRange = /\\u301c/g;\n\n    // parsing regexps for normalized strings\n    //   raw materials\n    var yearLast = \"(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])\";\n    var yearFirst = \"[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])\";\n    var numberVal = \"[?0-9]{1,3}\";\n    var rangeSeparator = \"[%%DATED%%]\";\n    var fuzzyChar = \"[?~]\";\n    var chars = \"[^\\-\\/\\~\\?0-9]+\";\n    var rexString = \"(\" + yearFirst + \"|\" + yearLast + \"|\" + numberVal + \"|\" + rangeSeparator + \"|\" + fuzzyChar + \"|\" + chars + \")\";\n    //   composed regexps\n    var rexDash = new RegExp(rexString.replace(/%%NUMD%%/g, \"-\").replace(/%%DATED%%/g, \"-\"));\n    var rexDashSlash = new RegExp(rexString.replace(/%%NUMD%%/g, \"-\").replace(/%%DATED%%/g, \"\\/\"));\n    var rexSlashDash = new RegExp(rexString.replace(/%%NUMD%%/g, \"\\/\").replace(/%%DATED%%/g, \"-\"));\n\n    /*\n     * Mutable values\n     */\n\n    // months\n    var monthString = \"january february march april may june july august september october november december spring summer fall winter spring summer\";\n    this.monthStrings = monthString.split(\" \");\n\n    /*\n     * Configuration functions\n     */\n\n    this.setOrderDayMonth = function() {\n        // preferred ordering for numeric dates\n        this.monthGuess = 1;\n        this.dayGuess = 0;\n    };\n\n    this.setOrderMonthDay = function() {\n        // preferred ordering for numeric dates\n        this.monthGuess = 0;\n        this.dayGuess = 1;\n    };\n\n    this.resetDateParserMonths = function() {\n        // Function to reset months to default.\n        this.monthSets = [];\n        for (var i=0,ilen=this.monthStrings.length; i<ilen; i++) {\n            this.monthSets.push([this.monthStrings[i]]);\n        }\n        this.monthAbbrevs = [];\n        for (var i=0,ilen=this.monthSets.length; i<ilen; i++) {\n            this.monthAbbrevs.push([]);\n            for (var j=0,jlen=this.monthSets[i].length; j<jlen; j++) {\n                this.monthAbbrevs[i].push(this.monthSets[i][0].slice(0, 3));\n            }\n        }\n        this.monthRexes = [];\n        for (var i=0,ilen=this.monthAbbrevs.length; i<ilen; i++) {\n            this.monthRexes.push(new RegExp(\"(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\"));\n        }\n    };\n\n    this.addDateParserMonths = function(lst) {\n        // Extend list of months with an additional set of month abbreviations,\n        // extending strings as required to resolve ambiguities.\n\n        // Normalize string to list\n        if (\"string\" === typeof lst) {\n            lst = lst.split(/\\s+/);\n        }\n\n        // Check that there are twelve (or sixteen) to add\n        if (lst.length !== 12 && lst.length !== 16) {\n            CSL.debug(\"month [+season] list of \"+lst.length+\", expected 12 or 16. Ignoring.\");\n            return;\n        }\n\n        // Extend as necessary to resolve ambiguities\n        // For each new month string ...\n        for (var i=0,ilen=lst.length; i<ilen; i++) {\n            var abbrevLength = null;\n            var skip = false;\n            var insert = 3;\n            var extendedSets = {};\n            for (var j=0,jlen=this.monthAbbrevs.length; j<jlen; j++) {\n                extendedSets[j] = {};\n                if (j === i) {\n                    // Mark for skipping if same as an existing abbreviation of same month\n                    for (var k=0,klen=this.monthAbbrevs[i].length; k<klen; k++) {\n                        if (this.monthAbbrevs[i][k] === lst[i].slice(0, this.monthAbbrevs[i][k].length)) {\n                            skip = true;\n                            break;\n                        }\n                    }\n                } else {\n                    // Mark for extending if same as existing abbreviation of any expression of another month\n                    for (var k=0,klen=this.monthAbbrevs[j].length; k<klen; k++) {\n                        abbrevLength = this.monthAbbrevs[j][k].length;\n                        if (this.monthAbbrevs[j][k] === lst[i].slice(0, abbrevLength)) {\n                            while (this.monthSets[j][k].slice(0, abbrevLength) === lst[i].slice(0, abbrevLength)) {\n                                // Abort when full length is hit, otherwise extend\n                                if (abbrevLength > lst[i].length || abbrevLength > this.monthSets[j][k].length) {\n                                    CSL.debug(\"unable to disambiguate month string in date parser: \"+lst[i]);\n                                    break;\n                                } else {\n                                    // Mark both new entry and existing abbrev for extension\n                                    abbrevLength += 1;\n                                }\n                            }\n                            insert = abbrevLength;\n                            extendedSets[j][k] = abbrevLength;\n                        }\n                    }\n                }\n                for (var jKey in extendedSets) {\n                    for (var kKey in extendedSets[jKey]) {\n                        abbrevLength = extendedSets[jKey][kKey];\n                        jKey = parseInt(jKey, 10);\n                        kKey = parseInt(kKey, 10);\n                        this.monthAbbrevs[jKey][kKey] = this.monthSets[jKey][kKey].slice(0, abbrevLength);\n                    }\n                }\n            }\n            // Insert here\n            if (!skip) {\n                this.monthSets[i].push(lst[i]);\n                this.monthAbbrevs[i].push(lst[i].slice(0, insert));\n            }\n        }\n\n        // Compose\n        this.monthRexes = [];\n        this.monthRexStrs = [];\n        for (var i=0,ilen=this.monthAbbrevs.length; i<ilen; i++) {\n            this.monthRexes.push(new RegExp(\"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\"));\n            this.monthRexStrs.push(\"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\");\n        }\n        if (this.monthAbbrevs.length === 18) {\n            for (var i=12,ilen=14; i<ilen; i++) {\n                this.monthRexes[i+4] = new RegExp(\"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\");\n                this.monthRexStrs[i+4] = \"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\";\n            }\n        }\n    };\n\n    /*\n     * Conversion functions\n     */\n\n    this.convertDateObjectToArray = function (thedate) {\n        // Converts object in place and returns object\n        thedate[\"date-parts\"] = [];\n        thedate[\"date-parts\"].push([]);\n        var slicelen = 0;\n        var part;\n        for (var i=0,ilen=3; i<ilen; i++) {\n            part = [\"year\", \"month\", \"day\"][i];\n            if (!thedate[part]) {\n                break;\n            }\n            slicelen += 1;\n            thedate[\"date-parts\"][0].push(thedate[part]);\n            delete thedate[part];\n        }\n        thedate[\"date-parts\"].push([]);\n        for (var i=0, ilen=slicelen; i<ilen; i++) {\n            part = [\"year_end\", \"month_end\", \"day_end\"][i];\n            if (!thedate[part]) {\n                break;\n            }\n            thedate[\"date-parts\"][1].push(thedate[part]);\n            delete thedate[part];\n        }\n        if (thedate[\"date-parts\"][0].length !== thedate[\"date-parts\"][1].length) {\n            thedate[\"date-parts\"].pop();\n        }\n        return thedate;\n    };\n\n    // XXXX String output is currently unable to represent ranges\n    this.convertDateObjectToString = function(thedate) {\n        // Returns string\n        var ret = [];\n        for (var i = 0, ilen = 3; i < ilen; i += 1) {\n            if (thedate[CSL.DATE_PARTS_ALL[i]]) {\n                ret.push(thedate[CSL.DATE_PARTS_ALL[i]]);\n            } else {\n                break;\n            }\n        }\n        return ret.join(\"-\");\n    };\n\n    /*\n     * Utility function\n     */\n\n    this._parseNumericDate = function (ret, delim, suff, txt) {\n        if (!suff) {\n            suff = \"\";\n        }\n        var lst = txt.split(delim);\n        \n        for (var i=0, ilen=lst.length; i<ilen; i++) {\n            if (lst[i].length === 4) {\n                ret[(\"year\" + suff)] = lst[i].replace(/^0*/, \"\");\n                if (!i) {\n                    lst = lst.slice(1);\n                } else {\n                    lst = lst.slice(0, i);\n                }\n                break;\n            }\n        }\n        for (var i=0,ilen=lst.length; i<ilen; i++) {\n            lst[i] = parseInt(lst[i], 10);\n        }\n        if (lst.length === 1 || (lst.length === 2 && !lst[1])) {\n            var month = lst[0];\n            if (month) {\n                ret[(\"month\" + suff)] = \"\" + lst[0];\n            }\n        } else if (lst.length === 2) {\n            if (lst[this.monthGuess] > 12) {\n                var month = lst[this.dayGuess];\n                var day = lst[this.monthGuess];\n                if (month) {\n                    ret[(\"month\" + suff)] = \"\" + month;\n                    if (day) {\n                        ret[(\"day\" + suff)] = \"\" + day;\n                    }\n                }\n            } else {\n                var month = lst[this.monthGuess];\n                var day = lst[this.dayGuess];\n                if (month) {\n                    ret[(\"month\" + suff)] = \"\" + month;\n                    if (day) {\n                        ret[(\"day\" + suff)] = \"\" + day;\n                    }\n                }\n            }\n        }\n    };\n\n    /*\n     * Parsing functions\n     */\n\n    this.parseDateToObject = function (txt) {\n        //\n        // Normalize the format and the year if it's a Japanese date\n        //\n        var orig = txt;\n        var slashPos = -1;\n        var dashPos = -1;\n        var yearIsNegative = false;\n        var lst;\n        if (txt) {\n            txt = txt.replace(/^(.*[0-9])T[0-9].*/, \"$1\");\n            // If string leads with a minus sign, strip and memo it.\n            if (txt.slice(0, 1) === \"-\") {\n                yearIsNegative = true;\n                txt = txt.slice(1);\n            }\n            \n            // If string is a number of 1 to 3 characters only, treat as year.\n            if (txt.match(/^[0-9]{1,3}$/)) {\n                while (txt.length < 4) {\n                    txt = \"0\" + txt;\n                }\n            }\n            \n            // Normalize to string\n            txt = \"\" + txt;\n            // Remove things that look like times\n            txt = txt.replace(/\\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,\"\");\n            var m = txt.match(kanjiMonthDay);\n            if (m) {\n                txt = txt.replace(/\\s+/g, \"\");\n                txt = txt.replace(kanjiYear, \"\");\n                txt = txt.replace(kanjiMonthDay, \"-\");\n                txt = txt.replace(kanjiRange, \"/\");\n                txt = txt.replace(/\\-\\//g, \"/\");\n                txt = txt.replace(/-$/g,\"\");\n\n                // Tortuous workaround for IE6\n                var slst = txt.split(epochSplitter);\n                lst = [];\n                var mm = txt.match(epochMatcher);\n                if (mm) {\n                    var mmx = [];\n                    for (var i=0,ilen=mm.length; i<ilen; i++) {\n                        mmx = mmx.concat(mm[i].match(/([^0-9]+)([0-9]+)/).slice(1));\n                    }\n                    for (var i=0,ilen=slst.length; i<ilen; i++) {\n                        lst.push(slst[i]);\n                        if (i !== (ilen - 1)) {\n                            // pos is undeclared, and multiplying by 2 here is insane.\n                            var mmpos = (i * 2);\n                            lst.push(mmx[mmpos]);\n                            lst.push(mmx[mmpos + 1]);\n                        }\n                    }\n                } else {\n                    lst = slst;\n                }\n                // workaround duly applied, this now works\n                for (var i=1,ilen=lst.length; i<ilen; i+=3) {\n                    lst[i + 1] = epochMap[lst[i]] + parseInt(lst[i + 1], 10);\n                    lst[i] = \"\";\n                }\n                txt = lst.join(\"\");\n                txt = txt.replace(/\\s*-\\s*$/, \"\").replace(/\\s*-\\s*\\//, \"/\");\n                //\n                // normalize date and identify delimiters\n                //\n                txt = txt.replace(/\\.\\s*$/, \"\");\n\n                // not sure what this is meant to do\n                txt = txt.replace(/\\.(?! )/, \"\");\n\n                slashPos = txt.indexOf(\"/\");\n                dashPos = txt.indexOf(\"-\");\n            }\n        }\n        // drop punctuation from a.d., b.c.\n        txt = txt.replace(/([A-Za-z])\\./g, \"$1\");\n\n        var number = \"\";\n        var note = \"\";\n        var thedate = {};\n        var rangeDelim;\n        var dateDelim;\n        if (txt.slice(0, 1) === \"\\\"\" && txt.slice(-1) === \"\\\"\") {\n            thedate.literal = txt.slice(1, -1);\n            return thedate;\n        }\n        if (slashPos > -1 && dashPos > -1) {\n            var slashCount = txt.split(\"/\");\n            if (slashCount.length > 3) {\n                rangeDelim = \"-\";\n                txt = txt.replace(/\\_/g, \"-\");\n                dateDelim = \"/\";\n                lst = txt.split(rexSlashDash);\n            } else {\n                rangeDelim = \"/\";\n                txt = txt.replace(/\\_/g, \"/\");\n                dateDelim = \"-\";\n                lst = txt.split(rexDashSlash);\n            }\n        } else {\n            txt = txt.replace(/\\//g, \"-\");\n            txt = txt.replace(/\\_/g, \"-\");\n            rangeDelim = \"-\";\n            dateDelim = \"-\";\n            lst = txt.split(rexDash);\n        }\n        var ret = [];\n        for (var i=0,ilen=lst.length; i<ilen; i++) {\n            var m = lst[i].match(/^\\s*([\\-\\/]|[^\\-\\/\\~\\?0-9]+|[\\-~?0-9]+)\\s*$/);\n            if (m) {\n                ret.push(m[1]);\n            }\n        }\n        //\n        // Phase 2\n        //\n        var delimPos = ret.indexOf(rangeDelim);\n        var delims = [];\n        var isRange = false;\n        if (delimPos > -1) {\n            delims.push([0, delimPos]);\n            delims.push([(delimPos + 1), ret.length]);\n            isRange = true;\n        } else {\n            delims.push([0, ret.length]);\n        }\n        //\n        // For each side of a range divide ...\n        //\n        var suff = \"\";\n        \n        for (var i=0,ilen=delims.length; i<ilen; i++) {\n            var delim = delims[i];\n            //\n            // Process each element ...\n            //\n            var date = ret.slice(delim[0], delim[1]);\n            outer: \n            for (var j=0,jlen=date.length; j<jlen; j++) {\n                var element = date[j];\n                //\n                // If it's a numeric date, process it.\n                //\n                if (element.indexOf(dateDelim) > -1) {\n                    this._parseNumericDate(thedate, dateDelim, suff, element);\n                    continue;\n                }\n                //\n                // If it's an obvious year, record it.\n                //\n                if (element.match(/[0-9]{4}/)) {\n                    thedate[(\"year\" + suff)] = element.replace(/^0*/, \"\");\n                    continue;\n                }\n                //\n                // If it's a fuzzy marker, record it.\n                //\n                if (element === \"~\" || element === \"?\" || element === \"c\" || element.match(/^cir/)) {\n                    thedate.circa = true;\n                }\n                //\n                // If it's a month, record it.\n                //\n                for (var k=0,klen=this.monthRexes.length; k<klen; k++) {\n                    if (element.toLocaleLowerCase().match(this.monthRexes[k])) {\n                        thedate[(\"month\" + suff)] = \"\" + (parseInt(k, 10) + 1);\n                        continue outer;\n                    }\n                }\n                //\n                // If it's a number, make a note of it\n                //\n                if (element.match(/^[0-9]+$/)) {\n                    number = element;\n                }\n                //\n                // If it's a BC or AD marker, make a year of\n                // any note.  Separate, reverse the sign of the year\n                // if it's BC.\n                //\n                if (element.toLocaleLowerCase().match(/^bc/) && number) {\n                    thedate[(\"year\" + suff)] = \"\" + (number * -1);\n                    number = \"\";\n                    continue;\n                }\n                if (element.toLocaleLowerCase().match(/^ad/) && number) {\n                    thedate[(\"year\" + suff)] = \"\" + number;\n                    number = \"\";\n                    continue;\n                }\n                //\n                // If it's cruft, make a note of it\n                //\n                if (element.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/) && !thedate[(\"season\" + suff)]) {\n                    note = element;\n                    continue;\n                }\n            }\n            //\n            // If at the end of the string there's still a note\n            // hanging around, make a day of it.\n            //\n            if (number) {\n                thedate[(\"day\" + suff)] = number;\n                number = \"\";\n            }\n            //\n            // If at the end of the string there's cruft lying\n            // around, and the season field is empty, put the\n            // cruft there.\n            //\n            if (note && !thedate[(\"season\" + suff)]) {\n                thedate[(\"season\" + suff)] = note.trim();\n                note = \"\";\n            }\n            suff = \"_end\";\n        }\n        //\n        // update any missing elements on each side of the divide\n        // from the other\n        //\n        if (isRange) {\n            for (var j=0,jlen=CSL.DATE_PARTS_ALL.length; j<jlen; j++) {\n                var item = CSL.DATE_PARTS_ALL[j];\n                if (thedate[item] && !thedate[(item + \"_end\")]) {\n                    thedate[(item + \"_end\")] = thedate[item];\n                } else if (!thedate[item] && thedate[(item + \"_end\")]) {\n                    thedate[item] = thedate[(item + \"_end\")];\n                }\n            }\n        }\n        //\n        // If there's no year, or if there only a year and a day, it's a failure; pass through the literal\n        //\n        if (!thedate.year || (thedate.year && thedate.day && !thedate.month)) {\n            thedate = { \"literal\": orig };\n        }\n        var parts = [\"year\", \"month\", \"day\", \"year_end\", \"month_end\", \"day_end\"];\n        for (var i=0,ilen=parts.length; i<ilen; i++) {\n            var part = parts[i];\n            if (\"string\" === typeof thedate[part] && thedate[part].match(/^[0-9]+$/)) {\n                thedate[part] = parseInt(thedate[part], 10);\n            }\n            \n        }\n        if (yearIsNegative && Object.keys(thedate).indexOf(\"year\") > -1) {\n            thedate.year = (thedate.year * -1);\n        }\n        return thedate;\n    };\n\n    this.parseDateToArray = function(txt) {\n        return this.convertDateObjectToArray(this.parseDateToObject(txt));            \n    };\n\n    this.parseDateToString = function(txt) {\n        return this.convertDateObjectToString(this.parseDateToObject(txt));\n    };\n    \n    this.parse = function(txt) {\n        return this.parseDateToObject(txt);\n    };\n    \n    /*\n\n     * Setup\n     */\n\n    this.setOrderMonthDay();\n    this.resetDateParserMonths();\n};\nCSL.DateParser = new CSL.DateParser();\n\n/*global CSL: true */\n\nCSL.Engine = function (sys, style, lang, forceLang) {\n    var attrs, langspec;\n    this.processor_version = CSL.PROCESSOR_VERSION;\n    this.csl_version = \"1.0\";\n    this.sys = sys;\n    \n    if (typeof Object.assign != 'function') {\n        // Must be writable: true, enumerable: false, configurable: true\n        Object.defineProperty(Object, \"assign\", {\n            value: function assign(target) { // .length of function is 2\n                'use strict';\n                if (target == null) { // TypeError if undefined or null\n                    throw new TypeError('Cannot convert undefined or null to object');\n                }\n\n                var to = Object(target);\n\n                for (var index = 1; index < arguments.length; index++) {\n                    var nextSource = arguments[index];\n\n                    if (nextSource != null) { // Skip over if undefined or null\n                        for (var nextKey in nextSource) {\n                            // Avoid bugs when hasOwnProperty is shadowed\n                            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                                to[nextKey] = nextSource[nextKey];\n                            }\n                        }\n                    }\n                }\n                return to;\n            },\n            writable: true,\n            configurable: true\n        });\n    }\n\n    // XXX This may be excess code. Given the normalization performed on\n    // XXX the output queue before variableWrapper() is run, a single\n    // XXX space should be the most cruft that we ever see before a variable.\n    if (sys.variableWrapper) {\n        CSL.VARIABLE_WRAPPER_PREPUNCT_REX = new RegExp('^([' + [\" \"].concat(CSL.SWAPPING_PUNCTUATION).join(\"\") + ']*)(.*)');\n    }\n    // XXXX This should be restored -- temporarily suspended for testing of JSON style support.\n    if (CSL.retrieveStyleModule) {\n        this.sys.retrieveStyleModule = CSL.retrieveStyleModule;\n    }\n    if (CSL.getAbbreviation) {\n        this.sys.getAbbreviation = CSL.getAbbreviation;\n    }\n    if (this.sys.stringCompare) {\n        CSL.stringCompare = this.sys.stringCompare;\n    }\n    this.sys.AbbreviationSegments = CSL.AbbreviationSegments;\n\n    this.transform = new CSL.Transform(this);\n    // true or false\n    this.setParseNames = function (val) {\n        this.opt['parse-names'] = val;\n    };\n    \n    this.opt = new CSL.Engine.Opt();\n    this.tmp = new CSL.Engine.Tmp();\n    this.build = new CSL.Engine.Build();\n    this.fun = new CSL.Engine.Fun(this);\n\n    this.configure = new CSL.Engine.Configure();\n    // Build citation before citation_sort in order to pick up\n    // state.opt.update_mode, needed it determine whether\n    // a grouped sort should be performed.\n    this.citation_sort = new CSL.Engine.CitationSort();\n    this.bibliography_sort = new CSL.Engine.BibliographySort();\n    this.citation = new CSL.Engine.Citation(this);\n    this.bibliography = new CSL.Engine.Bibliography();\n    this.intext = new CSL.Engine.InText();\n\n    this.output = new CSL.Output.Queue(this);\n\n    //this.render = new CSL.Render(this);\n    //\n    // This latter queue is used for formatting date chunks\n    // before they are folded back into the main queue.\n    //\n    this.dateput = new CSL.Output.Queue(this);\n\n    this.cslXml = CSL.setupXml(style);\n\n    for (var i in CSL.SYS_OPTIONS) {\n        var option = CSL.SYS_OPTIONS[i];\n        if (\"boolean\" === typeof this.sys[option]) {\n            this.opt.development_extensions[option] = this.sys[option];\n        }\n        \n    }\n    if (this.opt.development_extensions.uppercase_subtitles || this.opt.development_extensions.implicit_short_title) {\n        this.opt.development_extensions.main_title_from_short_title = true;\n    }\n    if (this.opt.development_extensions.csl_reverse_lookup_support) {\n        this.build.cslNodeId = 0;\n        this.setCslNodeIds = function(myxml, nodename) {\n            var children = this.cslXml.children(myxml);\n            this.cslXml.setAttribute(myxml, 'cslid', this.build.cslNodeId);\n            this.opt.nodenames.push(nodename);\n            this.build.cslNodeId += 1;\n            for (var i = 0, ilen = this.cslXml.numberofnodes(children); i < ilen; i += 1) {\n                nodename = this.cslXml.nodename(children[i]);\n                if (nodename) {\n                    this.setCslNodeIds(children[i], nodename);\n                }\n            }\n        };\n        this.setCslNodeIds(this.cslXml.dataObj, \"style\");\n    }\n    // Preprocessing ops for the XML input\n    this.cslXml.addMissingNameNodes(this.cslXml.dataObj);\n    this.cslXml.addInstitutionNodes(this.cslXml.dataObj);\n    this.cslXml.insertPublisherAndPlace(this.cslXml.dataObj);\n    this.cslXml.flagDateMacros(this.cslXml.dataObj);\n    attrs = this.cslXml.attributes(this.cslXml.dataObj);\n    if (\"undefined\" === typeof attrs[\"@sort-separator\"]) {\n        this.cslXml.setAttribute(this.cslXml.dataObj, \"sort-separator\", \", \");\n    }\n    // This setting does the right thing and seems not to be side-effects\n    this.opt[\"initialize-with-hyphen\"] = true;\n\n    // Locale resolution\n    //\n    // (1) Get three locale strings \n    //     -- default-locale (stripped)\n    //     -- processor-locale\n    //     -- en_US\n    \n    this.setStyleAttributes();\n\n    this.opt.xclass = this.cslXml.getAttributeValue(this.cslXml.dataObj, \"class\");\n    this.opt[\"class\"] = this.opt.xclass;\n    this.opt.styleID = this.cslXml.getStyleId(this.cslXml.dataObj);\n    this.opt.styleName = this.cslXml.getStyleId(this.cslXml.dataObj, true);\n\n    if (this.opt.version.slice(0,4) === \"1.1m\") {\n        this.opt.development_extensions.consolidate_legal_items = true;\n        this.opt.development_extensions.consolidate_container_items = true;\n        this.opt.development_extensions.main_title_from_short_title = true;\n        this.opt.development_extensions.expect_and_symbol_form = true;\n        this.opt.development_extensions.require_explicit_legal_case_title_short = true;\n        this.opt.development_extensions.force_jurisdiction = true;\n        this.opt.development_extensions.force_title_abbrev_fallback = true;\n    }\n    // We seem to have two language specs flying around:\n    //   this.opt[\"default-locale\"], and this.opt.lang\n    // Keeping them aligned for safety's sake, pending\n    // eventual cleanup.\n    if (lang) {\n        lang = lang.replace(\"_\", \"-\");\n        lang = CSL.normalizeLocaleStr(lang);\n    }\n    if (this.opt[\"default-locale\"][0]) {\n        this.opt[\"default-locale\"][0] = this.opt[\"default-locale\"][0].replace(\"_\", \"-\");\n        this.opt[\"default-locale\"][0] = CSL.normalizeLocaleStr(this.opt[\"default-locale\"][0]);\n    }\n    if (lang && forceLang) {\n        this.opt[\"default-locale\"] = [lang];\n    }\n    if (lang && !forceLang && this.opt[\"default-locale\"][0]) {\n        lang = this.opt[\"default-locale\"][0];\n    }\n    if (this.opt[\"default-locale\"].length === 0) {\n        if (!lang) {\n            lang = \"en-US\";\n        }\n        this.opt[\"default-locale\"].push(\"en-US\");\n    }\n    if (!lang) {\n        lang = this.opt[\"default-locale\"][0];\n    }\n    langspec = CSL.localeResolve(lang);\n    this.opt.lang = langspec.best;\n    this.opt[\"default-locale\"][0] = langspec.best;\n    this.locale = {};\n    if (!this.opt[\"default-locale-sort\"]) {\n        this.opt[\"default-locale-sort\"] = this.opt[\"default-locale\"][0];\n    }\n    // Test processor against JS engine locale mess to find a field separator that works\n    if ('dale|'.localeCompare('daleb', this.opt[\"default-locale-sort\"]) > -1) {\n        this.opt.sort_sep = \"@\";\n    } else {\n        this.opt.sort_sep = \"|\";\n    }\n    this.localeConfigure(langspec);\n\n    // Build skip-word regexp\n    function makeRegExp(lst) {\n        var lst = lst.slice();\n        var ret = new RegExp( \"(?:(?:[?!:]*\\\\s+|-|^)(?:\" + lst.join(\"|\") + \")(?=[!?:]*\\\\s+|-|$))\", \"g\");\n        return ret;\n    }\n    this.locale[this.opt.lang].opts[\"skip-words-regexp\"] = makeRegExp(this.locale[this.opt.lang].opts[\"skip-words\"]);\n\n    this.output.adjust = new CSL.Output.Queue.adjust(this.getOpt('punctuation-in-quote'));\n\n    this.registry = new CSL.Registry(this);\n\n    // XXX For modular jurisdiction support, parameterize buildTokenLists().\n    // XXX Feed as arguments:\n    // XXX * actual node to be walked (cslXml)\n    // XXX * actual target array\n\n    this.macros = {};\n\n    this.build.area = \"citation\";\n    var area_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, this.build.area);\n    this.buildTokenLists(area_nodes, this[this.build.area].tokens);\n\n    this.build.area = \"bibliography\";\n    var area_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, this.build.area);\n    this.buildTokenLists(area_nodes, this[this.build.area].tokens);\n\n    this.build.area = \"intext\";\n    var area_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, this.build.area);\n    this.buildTokenLists(area_nodes, this[this.build.area].tokens);\n\n    if (this.opt.parallel.enable) {\n        this.parallel = new CSL.Parallel(this);\n    }\n\n    this.juris = {};\n\n    this.configureTokenLists();\n\n    this.disambiguate = new CSL.Disambiguation(this);\n\n    this.splice_delimiter = false;\n\n    //\n    // date parser\n    //\n    this.fun.dateparser = CSL.DateParser;\n    //\n    // flip-flopper for inline markup\n    //\n    this.fun.flipflopper = new CSL.Util.FlipFlopper(this);\n    //\n    // utility functions for quotes\n    //\n    this.setCloseQuotesArray();\n    //\n    // configure ordinal numbers generator\n    //\n    this.fun.ordinalizer.init(this);\n    //\n    // configure long ordinal numbers generator\n    //\n    this.fun.long_ordinalizer.init(this);\n    //\n    // set up page mangler\n    //\n    this.fun.page_mangler = CSL.Util.PageRangeMangler.getFunction(this, \"page\");\n    this.fun.year_mangler = CSL.Util.PageRangeMangler.getFunction(this, \"year\");\n\n    this.setOutputFormat(\"html\");\n};\n\nCSL.Engine.prototype.setCloseQuotesArray = function () {\n    var ret;\n    ret = [];\n    ret.push(this.getTerm(\"close-quote\"));\n    ret.push(this.getTerm(\"close-inner-quote\"));\n    ret.push('\"');\n    ret.push(\"'\");\n    this.opt.close_quotes_array = ret;\n};\n\n// Walker for preparsed XML input\nCSL.makeBuilder = function (me, target) {\n    var var_stack = [];\n    var node_stack = [];\n    function runStart (node) {\n        node_stack.push(node);\n        CSL.XmlToToken.call(node, me, CSL.START, target, var_stack);\n    }\n    function runEnd () {\n        var node = node_stack.pop();\n        CSL.XmlToToken.call(node, me, CSL.END, target, var_stack);\n    }\n    function runSingle (node) {\n        CSL.XmlToToken.call(node, me, CSL.SINGLETON, target, var_stack);\n    }\n    function buildStyle (nodes, parent, node_stack) {\n        if (!node_stack) {\n            node_stack = [];\n        }\n        if (!nodes) {\n            nodes = [];\n        }\n        if (\"undefined\" === typeof nodes.length) {\n            nodes = [nodes];\n        }\n        for (var i=0; i<nodes.length; i++) {\n            var node = nodes[i];\n            if (me.cslXml.nodename(node) === null) {\n                continue;\n            }\n            if (parent && me.cslXml.nodename(node) === \"date\") {\n                CSL.Util.fixDateNode.call(me, parent, i, node);\n                node = me.cslXml.children(parent)[i];\n            }\n            if (me.cslXml.numberofnodes(me.cslXml.children(node))) {\n                runStart(node);\n                buildStyle(me.cslXml.children(node), node, node_stack);\n                runEnd();\n            } else {\n                runSingle(node);\n            }\n        }\n    }\n    return buildStyle;\n};\n\n\nCSL.Engine.prototype.buildTokenLists = function (area_nodes, target) {\n    if (!this.cslXml.getNodeValue(area_nodes)) {\n        return;\n    }\n    var builder = CSL.makeBuilder(this, target);\n    var mynode;\n    if (\"undefined\" === typeof area_nodes.length) {\n        mynode = area_nodes;\n    } else {\n        mynode = area_nodes[0];\n    }\n    builder(mynode);\n};\n\n\nCSL.Engine.prototype.setStyleAttributes = function () {\n    var dummy, attributes, attrname;\n    // Protect against DOM engines that deliver a top-level document\n    // (needed for createElement) that does not contain our top-level node.\n    // \n    // The string coercion on this.cslXml.tagName addresses a bizarre\n    // condition on the top-level node in jsdom running under node.js, in which:\n    //   (1) typeof this.cslXml.tagName === \"undefined\"; and\n    //   (2) !this.cslXml.tagName === false\n    // Coerced, it becomes an empty string.\n    var dummy = {};\n    dummy.name = this.cslXml.nodename(this.cslXml.dataObj);\n    attributes = this.cslXml.attributes(this.cslXml.dataObj);\n    for (attrname in attributes) {\n        if (attributes.hasOwnProperty(attrname)) {\n            // attr = attributes[key];\n            CSL.Attributes[attrname].call(dummy, this, attributes[attrname]);\n        }\n    }\n};\n\nCSL.Engine.prototype.getTerm = function (term, form, plural, gender, mode, forceDefaultLocale) {\n    if (term && term.match(/[A-Z]/) && term === term.toUpperCase()) {\n        CSL.debug(\"Warning: term key is in uppercase form: \"+term);\n        term = term.toLowerCase();\n    }\n    var lang;\n    if (forceDefaultLocale) {\n        lang = this.opt[\"default-locale\"][0];\n    } else {\n        lang = this.opt.lang;\n    }\n    var ret = CSL.Engine.getField(CSL.LOOSE, this.locale[lang].terms, term, form, plural, gender);\n    // XXXXX Temporary, until locale term is deployed in CSL.\n    if (!ret && term === \"range-delimiter\") {\n        ret = \"\\u2013\";\n    }\n    // XXXXX Not so good if mode is neither strict nor tolerant ...\n    if (typeof ret === \"undefined\") {\n        if (mode === CSL.STRICT) {\n            CSL.error(\"Error in getTerm: term \\\"\" + term + \"\\\" does not exist.\");\n        } else if (mode === CSL.TOLERANT) {\n            ret = \"\";\n        }\n    }\n    if (ret) {\n        this.tmp.cite_renders_content = true;\n    }\n    return ret;\n};\n\nCSL.Engine.prototype.getDate = function (form, forceDefaultLocale) {\n    var lang;\n    if (forceDefaultLocale) {\n        lang = this.opt[\"default-locale\"];\n    } else {\n        lang = this.opt.lang;\n    }\n    if (this.locale[lang].dates[form]) {\n        return this.locale[lang].dates[form];\n    } else {\n        return false;\n    }\n};\n\nCSL.Engine.prototype.getOpt = function (arg) {\n    if (\"undefined\" !== typeof this.locale[this.opt.lang].opts[arg]) {\n        return this.locale[this.opt.lang].opts[arg];\n    } else {\n        return false;\n    }\n};\n\n\n\nCSL.Engine.prototype.getVariable = function (Item, varname, form, plural) {\n    return CSL.Engine.getField(CSL.LOOSE, Item, varname, form, plural);\n};\n\nCSL.Engine.prototype.getDateNum = function (ItemField, partname) {\n    if (\"undefined\" === typeof ItemField) {\n        return 0;\n    } else {\n        return ItemField[partname];\n    }\n};\n\nCSL.Engine.getField = function (mode, hash, term, form, plural, gender) {\n    var ret, forms, f, pos, len, hashterm;\n    ret = \"\";\n    if (\"undefined\" === typeof hash[term]) {\n        if (mode === CSL.STRICT) {\n            CSL.error(\"Error in getField: term \\\"\" + term + \"\\\" does not exist.\");\n        } else {\n            return undefined;\n        }\n    }\n    if (gender && hash[term][gender]) {\n        hashterm = hash[term][gender];\n    } else {\n        hashterm = hash[term];\n    }\n    forms = [];\n    if (form === \"symbol\") {\n        forms = [\"symbol\", \"short\"];\n    } else if (form === \"verb-short\") {\n        forms = [\"verb-short\", \"verb\"];\n    } else if (form !== \"long\") {\n        forms = [form];\n    }\n    forms = forms.concat([\"long\"]);\n    len = forms.length;\n    for (pos = 0; pos < len; pos += 1) {\n        f = forms[pos];\n        if (\"string\" === typeof hashterm || \"number\" === typeof hashterm) {\n            ret = hashterm;\n        } else if (\"undefined\" !== typeof hashterm[f]) {\n            if (\"string\" === typeof hashterm[f] || \"number\" === typeof hashterm[f]) {\n                ret = hashterm[f];\n            } else {\n                if (\"number\" === typeof plural) {\n                    ret = hashterm[f][plural];\n                } else {\n                    ret = hashterm[f][0];\n                }\n            }\n            break;\n        }\n    }\n    return ret;\n};\n\nCSL.Engine.prototype.configureTokenLists = function () {\n    var area, pos, len;\n    //for each (var area in [\"citation\", \"citation_sort\", \"bibliography\",\"bibliography_sort\"]) {\n    len = CSL.AREAS.length;\n    for (pos = 0; pos < len; pos += 1) {\n        //var ret = [];\n        area = CSL.AREAS[pos];\n        var tokens = this[area].tokens;\n        this.configureTokenList(tokens);\n    }\n    this.version = CSL.version;\n    return this.state;\n};\n\nCSL.Engine.prototype.configureTokenList = function (tokens) {\n    var dateparts_master, token, dateparts, part, ppos, pppos, llen, lllen;\n    dateparts_master = [\"year\", \"month\", \"day\"];\n    llen = tokens.length - 1;\n    for (ppos = llen; ppos > -1; ppos += -1) {\n        token = tokens[ppos];\n        //token.pos = ppos;\n        //ret.push(token);\n        if (\"date\" === token.name && CSL.END === token.tokentype) {\n            dateparts = [];\n        }\n        if (\"date-part\" === token.name && token.strings.name) {\n            lllen = dateparts_master.length;\n            for (pppos = 0; pppos < lllen; pppos += 1) {\n                part = dateparts_master[pppos];\n                if (part === token.strings.name) {\n                    dateparts.push(token.strings.name);\n                }\n            }\n        }\n        if (\"date\" === token.name && CSL.START === token.tokentype) {\n            dateparts.reverse();\n            token.dateparts = dateparts;\n        }\n        token.next = (ppos + 1);\n        if (token.name && CSL.Node[token.name].configure) {\n            CSL.Node[token.name].configure.call(token, this, ppos);\n        }\n    }\n};\n\nCSL.Engine.prototype.refetchItems = function (ids) {\n    var ret = [];\n    for (var i = 0, ilen = ids.length; i < ilen; i += 1) {\n        ret.push(this.refetchItem(\"\" + ids[i]));\n    }\n    return ret;\n};\n\nCSL.ITERATION = 0;\n\n// Wrapper for sys.retrieveItem supplied by calling application.\n// Adds experimental fields embedded in the note field for\n// style development trial and testing purposes.\nCSL.Engine.prototype.retrieveItem = function (id) {\n    var Item, m, i;\n\n    if (!this.tmp.loadedItemIDs[id]) {\n        this.tmp.loadedItemIDs[id] = true;\n    } else {\n        return this.registry.refhash[id];\n    }\n\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase &&\n        \"boolean\" === typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        // This is a hack. Should properly be configured by a processor method after build.\n        for (var i=0,ilen=this.opt[\"default-locale\"].length; i<ilen; i+=1) {\n            this.opt[\"default-locale\"][i] = this.opt[\"default-locale\"][i].toLowerCase();\n        }\n        for (var i=0,ilen=this.opt[\"locale-translit\"].length; i<ilen; i+=1) {\n            this.opt[\"locale-translit\"][i] = this.opt[\"locale-translit\"][i].toLowerCase();\n        }\n        for (var i=0,ilen=this.opt[\"locale-translat\"].length; i<ilen; i+=1) {\n            this.opt[\"locale-translat\"][i] = this.opt[\"locale-translat\"][i].toLowerCase();\n        }\n        this.opt.development_extensions.normalize_lang_keys_to_lowercase = 100;\n    }\n\n    //Zotero.debug(\"XXX === ITERATION \" + CSL.ITERATION + \" \"+ id +\" ===\");\n    CSL.ITERATION += 1;\n\n    Item = JSON.parse(JSON.stringify(this.sys.retrieveItem(\"\" + id)));\n\n    // Optionally normalize keys to lowercase()\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        if (Item.multi) {\n            if (Item.multi._keys) {\n                for (var field in Item.multi._keys) {\n                    for (var key in Item.multi._keys[field]) {\n                        if (key !== key.toLowerCase()) {\n                            Item.multi._keys[field][key.toLowerCase()] = Item.multi._keys[field][key];\n                            delete Item.multi._keys[field][key];\n                        }\n                    }\n                }\n            }\n            if (Item.multi.main) {\n                for (var field in Item.multi.main) {\n                    Item.multi.main[field] = Item.multi.main[field].toLowerCase();\n                }\n            }\n        }\n        for (var i=0, ilen=CSL.NAME_VARIABLES.length; i>ilen; i+=1) {\n            var ctype = CSL.NAME_VARIABLES[i];\n            if (Item[ctype] && Item[ctype].multi) {\n                for (var j=0, jlen=Item[ctype].length; j<jlen; j+=1) {\n                    var creator = Item[ctype][j];\n                    if (creator.multi) {\n                        if (creator.multi._key) {\n                            for (var key in creator.multi._key) {\n                                if (key !== key.toLowerCase()) {\n                                    creator.multi._key[key.toLowerCase()] = creator.multi._key[key];\n                                    delete creator.multi._key[key];\n                                }\n                            }\n                        }\n                        if (creator.multi.main) {\n                            creator.multi.main = creator.multi.main.toLowerCase();\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // Normalize language field into \"language\" and \"language-original\"\n    if (Item.language && Item.language.match(/[><]/)) {\n        // Attempt to split field in two\n        var m = Item.language.match(/(.*?)([<>])(.*)/);\n        if (m[2] === \"<\") {\n            Item[\"language-name\"] = m[1];\n            Item[\"language-name-original\"] = m[3];\n        } else {\n            Item[\"language-name\"] = m[3];\n            Item[\"language-name-original\"] = m[1];\n        }\n        if (this.opt.multi_layout) {\n            if (Item[\"language-name-original\"]) {\n                Item.language = Item[\"language-name-original\"];\n            }\n        } else {\n            if (Item[\"language-name\"]) {\n                Item.language = Item[\"language-name\"];\n            }\n        }\n    }\n\n    if (Item.page) {\n        Item[\"page-first\"] = Item.page;\n        var num = \"\" + Item.page;\n        var m = num.split(/\\s*(?:&|, |-|\\u2013)\\s*/);\n        if (m[0].slice(-1) !== \"\\\\\") {\n            Item[\"page-first\"] = m[0];\n        }\n    }\n    // Optional development extensions\n    if (this.opt.development_extensions.field_hack && Item.note) {\n        // false is for validFieldsForType (all conforming entries scrubbed when false)\n        CSL.parseNoteFieldHacks(Item, false, this.opt.development_extensions.allow_field_hack_date_override);\n    }\n    // not including locator-date\n    for (var key in Item) {\n        if (CSL.DATE_VARIABLES.indexOf(key.replace(/^alt-/, \"\")) > -1) {\n            var dateobj = Item[key];\n            if (dateobj) {\n                // raw date parsing is harmless, but can be disabled if desired\n                if (this.opt.development_extensions.raw_date_parsing) {\n                    if (dateobj.raw && (!dateobj[\"date-parts\"] || dateobj[\"date-parts\"].length === 0)) {\n                        dateobj = this.fun.dateparser.parseDateToObject(dateobj.raw);\n                    }\n                }\n                Item[key] = this.dateParseArray(dateobj);\n            }\n        }\n    }\n    if (this.opt.development_extensions.consolidate_legal_items) {\n        if (Item.type && [\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) > -1) {\n            var varname;\n            var elements = [\"type\", \"title\", \"jurisdiction\", \"genre\", \"volume\", \"container-title\"];\n            var legislation_id = [];\n            for (var i = 0, ilen = elements.length; i < ilen; i += 1) {\n                varname = elements[i];\n\t\t\t\tif (Item[varname]) {\n\t\t\t\t\tlegislation_id.push(Item[varname]);\n\t\t\t\t}\n\t\t\t}\n            elements = [\"original-date\", \"issued\"];\n\t\t\tfor (var i = 0, ilen=elements.length; i < ilen; i += 1) {\n                varname = elements[i];\n\t\t\t\tif (Item[varname] && Item[varname].year) {\n\t\t\t\t\tvar value = Item[varname].year;\n\t\t\t\t\tlegislation_id.push(value);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tItem.legislation_id = legislation_id.join(\"::\");\n        }\n    }\n    if (this.bibliography.opt.track_container_items) {\n        if (this.bibliography.opt.track_container_items.indexOf(Item.type) > -1) {\n            var varname;\n            var elements = [\"type\", \"container-title\", \"publisher\", \"edition\"];\n            var container_id = [];\n            for (var i = 0, ilen = elements.length; i < ilen; i += 1) {\n                varname = elements[i];\n\t\t\t\tif (Item[varname]) {\n\t\t\t\t\tcontainer_id.push(Item[varname]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tItem.container_id = container_id.join(\"::\");\n        }\n    }\n    // For authority to name shape in legal styles\n    if (this.opt.development_extensions.force_jurisdiction) {\n        if (\"string\" === typeof Item.authority) {\n            Item.authority = [\n                {\n                    literal: Item.authority,\n                    multi: {\n                        _key: {}\n                    }\n                }\n            ];\n            if (Item.multi && Item.multi._keys && Item.multi._keys.authority) {\n                Item.authority[0].multi._key = {};\n                for (var key in Item.multi._keys.authority) {\n                    Item.authority[0].multi._key[key] = {\n                        literal: Item.multi._keys.authority[key]\n                    };\n                }\n            }\n        }\n    }\n    // Add getAbbreviation() call for title-short and container-title-short\n    if (!Item[\"title-short\"]) {\n        Item[\"title-short\"] = Item.shortTitle;\n    }\n    // Add support for main_title_from_short_title\n    if (this.opt.development_extensions.main_title_from_short_title) {\n        var narrowSpaceLocale = this.opt[\"default-locale\"][0].slice(0, 2).toLowerCase() === \"fr\";\n        CSL.extractTitleAndSubtitle.call(this, Item, narrowSpaceLocale);\n    }\n    var isLegalType = [\"bill\",\"legal_case\",\"legislation\",\"gazette\",\"regulation\"].indexOf(Item.type) > -1;\n    if (this.opt.development_extensions.force_jurisdiction && isLegalType) {\n        if (!Item.jurisdiction) {\n            Item.jurisdiction = \"us\";\n        }\n    }\n    var normalizedKey;\n    if (!isLegalType && Item.title && this.sys.getAbbreviation) {\n        var noHints = false;\n        if (!Item.jurisdiction) {\n            noHints = true;\n        }\n        if (this.sys.normalizeAbbrevsKey) {\n             normalizedKey = this.sys.normalizeAbbrevsKey(\"title\", Item.title);\n        } else {\n            normalizedKey = Item.title;\n        }\n        var jurisdiction = this.transform.loadAbbreviation(Item.jurisdiction, \"title\", normalizedKey, Item.language);\n        if (this.transform.abbrevs[jurisdiction].title) {\n            if (this.transform.abbrevs[jurisdiction].title[normalizedKey]) {\n                Item[\"title-short\"] = this.transform.abbrevs[jurisdiction].title[normalizedKey];\n            }\n        }\n    }\n    if (!Item[\"container-title-short\"]) {\n        Item[\"container-title-short\"] = Item.journalAbbreviation;\n    }\n    if (Item[\"container-title\"] && this.sys.getAbbreviation) {\n        if (this.sys.normalizeAbbrevsKey) {\n            normalizedKey = this.sys.normalizeAbbrevsKey(Item[\"container-title\"]);\n        } else {\n            normalizedKey = Item[\"container-title\"];\n        }\n        var jurisdiction = this.transform.loadAbbreviation(Item.jurisdiction, \"container-title\", normalizedKey, Item.language);\n        if (this.transform.abbrevs[jurisdiction][\"container-title\"]) {\n            if (this.transform.abbrevs[jurisdiction][\"container-title\"][normalizedKey]) {\n                Item[\"container-title-short\"] = this.transform.abbrevs[jurisdiction][\"container-title\"][normalizedKey];\n            }\n        }\n    }\n    if (Item.jurisdiction) {\n        Item.country = Item.jurisdiction.split(\":\")[0];\n    }\n    if (this.registry.refhash[id]) {\n        if (JSON.stringify(this.registry.refhash[id]) != JSON.stringify(Item)) {\n            for (var key in this.registry.refhash[id]) {\n                delete this.registry.refhash[id][key];\n            }\n            this.tmp.taintedItemIDs[Item.id] = true;\n            Object.assign(this.registry.refhash[id], Item);\n        }\n    } else {\n        this.registry.refhash[id] = Item;\n    }\n    return this.registry.refhash[id];\n};\n\nCSL.Engine.prototype.refetchItem = function (id) {\n    return this.registry.refhash[id];\n};\n\n// Executed during style build\nCSL.Engine.prototype.setOpt = function (token, name, value) {\n    if (token.name === \"style\" || token.name === \"cslstyle\") {\n        this.opt.inheritedAttributes[name] = value;\n        this.citation.opt.inheritedAttributes[name] = value;\n        this.bibliography.opt.inheritedAttributes[name] = value;\n    } else if ([\"citation\", \"bibliography\"].indexOf(token.name) > -1) {\n        this[token.name].opt.inheritedAttributes[name] = value;\n    } else {\n        token.strings[name] = value;\n    }\n};\n\n// Executed at runtime, since macros can occur in the context of citation or bibliography\nCSL.Engine.prototype.inheritOpt = function (token, attrname, parentname, defaultValue) {\n    if (\"undefined\" !== typeof token.strings[attrname]) {\n        return token.strings[attrname];\n    } else {\n        var parentValue = this[this.tmp.root].opt.inheritedAttributes[parentname ? parentname : attrname];\n        if (\"undefined\" !== typeof parentValue) {\n            return parentValue;\n        } else {\n            return defaultValue;\n        }\n    }\n};\n\nCSL.Engine.prototype.remapSectionVariable = function (inputList) {\n    // We have items with a value in the section field (on Item) that must\n    // be mapped to the locator field (on item). We simply prepend it as\n    // a string here, and handle all parsing of the resulting string\n    // in processNumber(). Plurals and numeric are set in processNumber().\n    \n    // Because the target is in the citation item (lowercase), the\n    // remapping cannot take place when the Item data is received.\n    // Citation provides a list of Item/item pairs, hence the iteration\n    // used here.\n    for (var i = 0, ilen = inputList.length; i < ilen; i += 1) {\n        var Item = inputList[i][0];\n        var item = inputList[i][1];\n\n        if ([\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) > -1) {\n             // If a locator value exists, then\n            //   (a) Leave be an overriding label at the start of the locator field, defaulting to label value\n            if (item.locator) {\n                item.locator = item.locator.trim();\n                var m = item.locator.match(CSL.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);\n                if (!m) {\n                    if (item.label) {\n                        item.locator = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[item.label] + \" \" + item.locator;\n                    } else {\n                        item.locator = \"p. \" + item.locator;\n                    }\n                }\n            }\n            // If a section value exists, then\n            //   (a) Apply an overriding label at the start of the section field, defaulting to sec.\n            var sectionMasterLabel = null;\n            if (Item.section) {\n                Item.section = Item.section.trim();\n                var m = Item.section.match(CSL.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);\n                if (!m) {\n                    Item.section = \"sec. \" + Item.section;\n                    sectionMasterLabel = \"sec.\";\n                } else {\n                    sectionMasterLabel = m[0].trim();\n                }\n            }\n            // If section is nil, then\n            //   (a) Do nothing\n            if (Item.section) {\n            // If section exists and locator is nil\n            //   (a) Set section string in locator field\n                if (!item.locator) {\n                    item.locator = Item.section;\n                } else {\n            // If both section and locator exist, then\n            //   (a) If locator starts with p., remove p., merge with space or no-space, and set in locator field\n            //   (b) If locator starts with non-p., prepend section value to locator with space, and set in locator field\n                    var m = item.locator.match(/^([^ ]*)\\s*(.*)/);\n                    var space = \" \";\n                    if (m) {\n                        if (m[1] === \"p.\" && sectionMasterLabel !== \"p.\") {\n                            item.locator = m[2];\n                        }\n                        if ([\"[\", \"(\", \".\", \",\", \";\", \":\", \"?\"].indexOf(item.locator.slice(0, 1)) > -1) {\n                            space = \"\";\n                        }\n                    } else {\n                       space = \"\"; \n                    }\n                    item.locator = Item.section + space + item.locator;\n                }\n                //Item.section = \"\";\n            }\n            item.label = \"\";\n            // And that's it. Pre-parse complete.\n        }\n    }\n};\n\n\nCSL.Engine.prototype.setNumberLabels = function (Item) {\n     if (Item.number\n        && [\"bill\", \"gazette\", \"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) > -1\n        && this.opt.development_extensions.consolidate_legal_items\n        && !this.tmp.shadow_numbers[\"number\"]) {\n\n        this.tmp.shadow_numbers[\"number\"] = {};\n        this.tmp.shadow_numbers[\"number\"].values = [];\n        this.tmp.shadow_numbers[\"number\"].plural = 0;\n        this.tmp.shadow_numbers[\"number\"].numeric = false;\n        this.tmp.shadow_numbers[\"number\"].label = false;\n        \n        // Labels embedded in number variable\n        var value = \"\" + Item.number;\n        value = value.split(\"\\\\\").join(\"\");\n        // Get first word, parse out labels only if it parses\n        var firstword = value.split(/\\s+/)[0];\n        var firstlabel = CSL.STATUTE_SUBDIV_STRINGS[firstword];\n        if (firstlabel) {\n            // Get list and match\n            var splt = value.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX);\n            if (splt.length > 1) {\n                // Convert matches to localized form\n                var lst = [];\n                for (var j=1, jlen=splt.length; j < jlen; j += 1) {\n                    lst.push(splt[j].replace(/\\s*$/, \"\").replace(/^\\s*/, \"\"));\n                }\n                // Preemptively save to shadow_numbers\n                value = lst.join(\" \");\n            } else {\n                value = splt[0];\n            }\n            this.tmp.shadow_numbers[\"number\"].label = firstlabel;\n            this.tmp.shadow_numbers[\"number\"].values.push([\"Blob\", value, false]);\n            this.tmp.shadow_numbers[\"number\"].numeric = false;\n        } else {\n            this.tmp.shadow_numbers[\"number\"].values.push([\"Blob\", value, false]);\n            this.tmp.shadow_numbers[\"number\"].numeric = true;\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.substituteOne = function (template) {\n    return function (state, list) {\n        if (!list) {\n            return \"\";\n        } else {\n            // (\"string\" === typeof list)\n            return template.replace(\"%%STRING%%\", list);\n        }\n    };\n};\n\n\n/**\n * Two-tiered substitutions gadget.\n * <p>This is used for\n * options like (now defunct) \"font-family\", where the option value\n * cannot be determined until the attribute is processed.\n * Need for this function might be reviewed at some point ...</p>\n * @param {String} template A template containing\n * <code>%%STRING%%</code> and <code>%%PARAM%%</code>\n * placeholders.  See {@link CSL.Output.Formats.html} for\n * examples.\n */\nCSL.substituteTwo = function (template) {\n    return function (param) {\n        var template2 = template.replace(\"%%PARAM%%\", param);\n        return function (state, list) {\n            if (!list) {\n                return \"\";\n            } else {\n                //(\"string\" === typeof list){\n                return template2.replace(\"%%STRING%%\", list);\n            }\n        };\n    };\n};\n\n/**\n * Generate string functions for designated output mode.\n * <p>Only \"html\" (the default) is supported at present.</p>\n * @param {String} mode Either \"html\" or \"rtf\", eventually.\n */\nCSL.Mode = function (mode) {\n    var decorations, params, param, func, val, args;\n    decorations = {};\n    params = CSL.Output.Formats[mode];\n    for (param in params) {\n        if (true) {\n\n            if (\"@\" !== param.slice(0, 1)) {\n                decorations[param] = params[param];\n                continue;\n            }\n            func = false;\n            val = params[param];\n            args = param.split('/');\n\n            if (typeof val === \"string\" && val.indexOf(\"%%STRING%%\") > -1)  {\n                if (val.indexOf(\"%%PARAM%%\") > -1) {\n                    func = CSL.substituteTwo(val);\n                } else {\n                    func = CSL.substituteOne(val);\n                }\n            } else if (typeof val === \"boolean\" && !val) {\n                func = CSL.Output.Formatters.passthrough;\n            } else if (typeof val === \"function\") {\n                func = val;\n            } else {\n                CSL.error(\"Bad \" + mode + \" config entry for \" + param + \": \" + val);\n            }\n\n            if (args.length === 1) {\n                decorations[args[0]] = func;\n            } else if (args.length === 2) {\n                if (!decorations[args[0]]) {\n                    decorations[args[0]] = {};\n                }\n                decorations[args[0]][args[1]] = func;\n            }\n        }\n    }\n    return decorations;\n};\n\n\n/**\n * Generate a separate list of formatting attributes.\n * <p>This generates a list of tuples containing attribute\n * information relevant to output formatting, in the order\n * fixed in the constant {@link CSL.FORMAT_KEY_SEQUENCE}.\n * This function is called during {@link CSL.Core.Build}.\n * Formatting hints are distilled to functions\n * later, in the second compilation pass ({@link CSL.Core.Configure}).</p>\n * @param {Object} state The state object returned by\n * {@link CSL.Engine}.\n * @param {Object} attributes The hash object containing\n * the attributes and values extracted from an XML node.\n */\nCSL.setDecorations = function (state, attributes) {\n    var ret, key, pos;\n    // This applies a fixed processing sequence\n    ret = [];\n    for (pos in CSL.FORMAT_KEY_SEQUENCE) {\n        if (true) {\n            var key = CSL.FORMAT_KEY_SEQUENCE[pos];\n            if (attributes[key]) {\n                ret.push([key, attributes[key]]);\n                delete attributes[key];\n            }\n        }\n    }\n    return ret;\n};\n\nCSL.Doppeler = function(rexStr, stringMangler) {\n    var matchRex = new RegExp(\"(\" + rexStr + \")\", \"g\");\n    var splitRex = new RegExp(rexStr, \"g\");\n    this.split = function (str) {\n        // Normalize markup\n        if (stringMangler) {\n            str = stringMangler(str);\n        }\n        var match = str.match(matchRex);\n        if (!match) {\n            return {\n                tags: [],\n                strings: [str]\n            };\n        }\n        var split = str.split(splitRex);\n        for (var i=match.length-1; i> -1; i--) {\n            if (typeof match[i] === \"number\") {\n                match[i] = \"\";\n            }\n            var tag = match[i];\n            if (tag === \"\\'\" && split[i+1].length > 0) {\n                // Fixes https://forums.zotero.org/discussion/comment/294317\n                split[i+1] = match[i] + split[i+1];\n                match[i] = \"\";\n            }\n        }\n        return {\n            tags: match,\n            strings: split,\n            origStrings: split.slice()\n        };\n    };\n    this.join = function (obj) {\n        var lst = obj.strings.slice(-1);\n        for (var i=obj.tags.length-1; i>-1; i--) {\n            lst.push(obj.tags[i]);\n            lst.push(obj.strings[i]);\n        }\n        lst.reverse();\n        return lst.join(\"\");\n    };\n};\n\nCSL.Engine.prototype.normalDecorIsOrphan = function (blob, params) {\n    //print(\"params: \"+JSON.stringify(params));\n    if (params[1] === \"normal\") {\n        var use_param = false;\n        var all_the_decor;\n        if (this.tmp.area === \"citation\") {\n            all_the_decor = [this.citation.opt.layout_decorations].concat(blob.alldecor);\n        } else {\n            all_the_decor = blob.alldecor;\n        }\n        for (var k = all_the_decor.length - 1; k > -1; k += -1) {\n            //print(\"  all decor: \"+JSON.stringify(all_the_decor[k]));\n            for (var n = all_the_decor[k].length - 1; n > -1; n += -1) {\n                //print(\"  superior param\"+n+\": \"+all_the_decor[k][n][0]);\n                if (all_the_decor[k][n][0] === params[0]) {\n                    //print(\"  HIT!\");\n                    if (all_the_decor[k][n][1] !== \"normal\") {\n                        use_param = true;\n                    }\n                }\n            }\n        }\n        if (!use_param) {\n            return true;\n        }\n    }\n    return false;\n};\n\n/*global CSL: true */\n\n\nCSL.Engine.prototype.getCitationLabel = function (Item) {\n    var label = \"\";\n    var params = this.getTrigraphParams();\n    var config = params[0];\n    var myname = this.getTerm(\"reference\", \"short\", 0);\n    if (\"undefined\" === typeof myname) {\n        myname = \"reference\";\n    }\n    myname = myname.replace(\".\", \"\");\n    myname = myname.slice(0, 1).toUpperCase() + myname.slice(1);\n    for (var i = 0, ilen = CSL.NAME_VARIABLES.length; i < ilen; i += 1) {\n        var n = CSL.NAME_VARIABLES[i];\n        if (Item[n]) {\n            var names = Item[n];\n            if (names.length > params.length) {\n                config = params[params.length - 1];\n            } else {\n                config = params[names.length - 1];\n            }\n            for (var j = 0, jlen = names.length; j < jlen; j += 1) {\n                if (j === config.authors.length) {\n                    break;\n                }\n                var res = this.nameOutput.getName(names[j], \"locale-translit\", true);\n                var name = res.name;\n                if (name && name.family) {\n                    myname = name.family;\n                    myname = myname.replace(/^([ \\'\\u2019a-z]+\\s+)/, \"\");\n\n                } else if (name && name.literal) {\n                    myname = name.literal;\n                }\n                var m = myname.toLowerCase().match(/^(a\\s+|the\\s+|an\\s+)/);\n                if (m) {\n                    myname = myname.slice(m[1].length);\n                }\n                myname = myname.replace(CSL.ROMANESQUE_NOT_REGEXP, \"\");\n                if (!myname) {\n                    break;\n                }\n                myname = myname.slice(0, config.authors[j]);\n                if (myname.length > 1) {\n                    myname = myname.slice(0, 1).toUpperCase() + myname.slice(1).toLowerCase();\n                } else if (myname.length === 1) {\n                    myname = myname.toUpperCase();\n                }\n                label += myname;\n            }\n            break;\n        }\n    }\n    if (!label) {\n        // Try for something using title\n        if (Item.title) {\n            var skipWords = this.locale[this.opt.lang].opts[\"skip-words\"];\n            var lst = Item.title.split(/\\s+/);\n            for (var i = lst.length - 1; i > -1; i--) {\n                if (skipWords.indexOf(lst[i]) > -1) {\n                    lst = lst.slice(0, i).concat(lst.slice(i + 1));\n                }\n            }\n            var str = lst.join('');\n            str = str.slice(0, params[0].authors[0]);\n            if (str.length > 1) {\n                str = str.slice(0, 1).toUpperCase() + str.slice(1).toLowerCase();\n            } else if (str.length === 1) {\n                str = str.toUpperCase();\n            }\n            label = str;\n        }\n    }\n    var year = \"0000\";\n    if (Item.issued) {\n        if (Item.issued.year) {\n            year = \"\" + Item.issued.year;\n        }\n    }\n    year = year.slice((config.year * -1));\n    label = label + year;\n    return label;\n};\n\nCSL.Engine.prototype.getTrigraphParams = function () {\n    var params = [];\n    var ilst = this.opt.trigraph.split(\":\");\n    if (!this.opt.trigraph || this.opt.trigraph.slice(0,1) !== \"A\") {\n        CSL.error(\"Bad trigraph definition: \"+this.opt.trigraph);\n    }\n    for (var i = 0, ilen = ilst.length; i < ilen; i += 1) {\n        var str = ilst[i];\n        var config = {authors:[], year:0};\n        for (var j = 0, jlen = str.length; j < jlen; j += 1) {\n            switch (str.slice(j,j+1)) {\n            case \"A\":\n                config.authors.push(1);\n                break;\n            case \"a\":\n                config.authors[config.authors.length - 1] += 1;\n                break;\n            case \"0\":\n                config.year += 1;\n                break;\n            default:\n                CSL.error(\"Invalid character in trigraph definition: \"+this.opt.trigraph);\n            }\n        }\n        params.push(config);\n    }\n    return params;\n};\n\n/*global CSL: true */\n\nCSL.Engine.prototype.setOutputFormat = function (mode) {\n    this.opt.mode = mode;\n    this.fun.decorate = CSL.Mode(mode);\n    if (!this.output[mode]) {\n        this.output[mode] = {};\n        this.output[mode].tmp = {};\n    }\n};\n\nCSL.Engine.prototype.getSortFunc = function () {\n    return function (a,b) {\n        a = a.split(\"-\");\n        b = b.split(\"-\");\n        if (a.length < b.length) {\n            return 1;\n        } else if (a.length > b.length) {\n            return -1;\n        } else {\n            a = a.slice(-1)[0];\n            b = b.slice(-1)[0];\n            if (a.length < b.length) {\n                return 1;\n            } else if (a.length > b.length) {\n                return -1;\n            } else {\n                return 0;\n            }\n        }\n    };\n};\n\nCSL.Engine.prototype.setLangTagsForCslSort = function (tags) {\n    var i, ilen;\n    if (tags) {\n        this.opt['locale-sort'] = [];\n        for (i = 0, ilen = tags.length; i < ilen; i += 1) {\n            this.opt['locale-sort'].push(tags[i]);\n        }\n    }\n    this.opt['locale-sort'].sort(this.getSortFunc());\n};\n    \nCSL.Engine.prototype.setLangTagsForCslTransliteration = function (tags) {\n    var i, ilen;\n    this.opt['locale-translit'] = [];\n    if (tags) {\n        for (i = 0, ilen = tags.length; i < ilen; i += 1) {\n            this.opt['locale-translit'].push(tags[i]);\n        }\n    }\n    this.opt['locale-translit'].sort(this.getSortFunc());\n};\n    \nCSL.Engine.prototype.setLangTagsForCslTranslation = function (tags) {\n    var i, ilen;\n    this.opt['locale-translat'] = [];\n    if (tags) {\n        for (i = 0, ilen = tags.length; i < ilen; i += 1) {\n            this.opt['locale-translat'].push(tags[i]);\n        }\n    }\n    this.opt['locale-translat'].sort(this.getSortFunc());\n};\n\nCSL.Engine.prototype.setLangPrefsForCites = function (obj, conv) {\n    var opt = this.opt['cite-lang-prefs'];\n    if (!conv) {\n        conv = function (key) {\n            return key.toLowerCase();\n        };\n    }\n    var segments = ['Persons', 'Institutions', 'Titles', 'Journals', 'Publishers', 'Places'];\n    // Set values in place\n    for (var i = 0, ilen = segments.length; i < ilen; i += 1) {\n        var clientSegment = conv(segments[i]);\n        var citeprocSegment = segments[i].toLowerCase();\n        if (!obj[clientSegment]) {\n            continue;\n        }\n        //\n        // Normalize the sequence of secondary and tertiary\n        // in the provided obj segment list.\n        //\n        var supplements = [];\n        while (obj[clientSegment].length > 1) {\n            supplements.push(obj[clientSegment].pop());\n        }\n        var sortval = {orig:1,translit:2,translat:3};\n        if (supplements.length === 2 && sortval[supplements[0]] < sortval[supplements[1]]) {\n            supplements.reverse();\n        }\n        while (supplements.length) {\n            obj[clientSegment].push(supplements.pop());\n        }\n        //\n        // normalization done.\n        //\n        var lst = opt[citeprocSegment];\n        while (lst.length) {\n            lst.pop();\n        }\n        for (var j = 0, jlen = obj[clientSegment].length; j < jlen; j += 1) {\n            lst.push(obj[clientSegment][j]);\n        }\n    }\n};\n\nCSL.Engine.prototype.setLangPrefsForCiteAffixes = function (affixList) {\n    if (affixList && affixList.length === 48) {\n        var affixes = this.opt.citeAffixes;\n        var count = 0;\n        var settings = [\"persons\", \"institutions\", \"titles\", \"journals\", \"publishers\", \"places\"];\n        var forms = [\"translit\", \"orig\", \"translit\", \"translat\"];\n        var value;\n        for (var i = 0, ilen = settings.length; i < ilen; i += 1) {\n            for (var j = 0, jlen = forms.length; j < jlen; j += 1) {\n                value = \"\";\n                if ((count % 8) === 4) {\n                    if (!affixes[settings[i]][\"locale-\"+forms[j]].prefix\n                        && !affixes[settings[i]][\"locale-\"+forms[j]].suffix) {\n\n                        value = affixList[count] ? affixList[count] : \"\";\n                        affixes[settings[i]][\"locale-\" + forms[j]].prefix = value;\n                        value = affixList[count] ? affixList[count + 1] : \"\";\n                        affixes[settings[i]][\"locale-\" + forms[j]].suffix = value;\n                    }\n                } else {\n                    value = affixList[count] ? affixList[count] : \"\";\n                    affixes[settings[i]][\"locale-\" + forms[j]].prefix = value;\n                    value = affixList[count] ? affixList[count + 1] : \"\";\n                    affixes[settings[i]][\"locale-\" + forms[j]].suffix = value;\n                }\n                count += 2;\n            }\n        }\n        this.opt.citeAffixes = affixes;\n    }\n};\n\nCSL.Engine.prototype.setAutoVietnameseNamesOption = function (arg) {\n    if (arg) {\n        this.opt[\"auto-vietnamese-names\"] = true;\n    } else {\n        this.opt[\"auto-vietnamese-names\"] = false;\n    }\n};\n\nCSL.Engine.prototype.setAbbreviations = function (arg) {\n    if (this.sys.setAbbreviations) {\n        this.sys.setAbbreviations(arg);\n    }\n};\n\nCSL.Engine.prototype.setSuppressTrailingPunctuation = function (arg) {\n    this.citation.opt.suppressTrailingPunctuation = !!arg;\n};\n\n/*global CSL: true */\n\nCSL.Output = {};\n/**\n * Output queue object.\n * @class\n */\nCSL.Output.Queue = function (state) {\n    this.levelname = [\"top\"];\n    this.state = state;\n    this.queue = [];\n    this.empty = new CSL.Token(\"empty\");\n    var tokenstore = {};\n    tokenstore.empty = this.empty;\n    this.formats = new CSL.Stack(tokenstore);\n    this.current = new CSL.Stack(this.queue);\n};\n\n// XXX This works, but causes a mismatch in api_cite\n// Could insert a placeholder\n// Better to have a function that spits out an independent blob.\n// Is that possible though?\n// Okay. Use queue.append() with fake_queue instead.\nCSL.Output.Queue.prototype.pop = function () {\n    // For some reason, state.output.current.value() here can be an array, \n    // not a blob ... ?\n    var drip = this.current.value();\n    if (drip.length) {\n        return drip.pop();\n    } else {\n        return drip.blobs.pop();\n    }\n};\n\nCSL.Output.Queue.prototype.getToken = function (name) {\n    var ret = this.formats.value()[name];\n    return ret;\n};\n\nCSL.Output.Queue.prototype.mergeTokenStrings = function (base, modifier) {\n    var base_token, modifier_token, ret, key;\n    base_token = this.formats.value()[base];\n    modifier_token = this.formats.value()[modifier];\n    ret = base_token;\n    if (modifier_token) {\n        if (!base_token) {\n            base_token = new CSL.Token(base, CSL.SINGLETON);\n            base_token.decorations = [];\n        }\n        ret = new CSL.Token(base, CSL.SINGLETON);\n        var key = \"\";\n        for (var key in base_token.strings) {\n            if (base_token.strings.hasOwnProperty(key)) {\n                ret.strings[key] = base_token.strings[key];\n            }\n        }\n        for (var key in modifier_token.strings) {\n            if (modifier_token.strings.hasOwnProperty(key)) {\n                ret.strings[key] = modifier_token.strings[key];\n            }\n        }\n        ret.decorations = base_token.decorations.concat(modifier_token.decorations);\n    }\n    return ret;\n};\n\n// Store a new output format token based on another\nCSL.Output.Queue.prototype.addToken = function (name, modifier, token) {\n    var newtok, attr;\n    newtok = new CSL.Token(\"output\");\n    if (\"string\" === typeof token) {\n        token = this.formats.value()[token];\n    }\n    if (token && token.strings) {\n        for (attr in token.strings) {\n            if (token.strings.hasOwnProperty(attr)) {\n                newtok.strings[attr] = token.strings[attr];\n            }\n        }\n        newtok.decorations = token.decorations;\n\n    }\n    if (\"string\" === typeof modifier) {\n        newtok.strings.delimiter = modifier;\n    }\n    this.formats.value()[name] = newtok;\n};\n\n//\n// newFormat adds a new bundle of formatting tokens to\n// the queue's internal stack of such bundles\nCSL.Output.Queue.prototype.pushFormats = function (tokenstore) {\n    if (!tokenstore) {\n        tokenstore = {};\n    }\n    tokenstore.empty = this.empty;\n    this.formats.push(tokenstore);\n};\n\n\nCSL.Output.Queue.prototype.popFormats = function () {\n    this.formats.pop();\n};\n\nCSL.Output.Queue.prototype.startTag = function (name, token) {\n    var tokenstore = {};\n    if (this.state.tmp[\"doing-macro-with-date\"] && this.state.tmp.extension) {\n        token = this.empty;\n        name = \"empty\";\n    }\n    tokenstore[name] = token;\n    this.pushFormats(tokenstore);\n    this.openLevel(name);\n};\n\nCSL.Output.Queue.prototype.endTag = function (name) {\n    this.closeLevel(name);\n    this.popFormats();\n};\n\n//\n// newlevel adds a new blob object to the end of the current\n// list, and adjusts the current pointer so that subsequent\n// appends are made to blob list of the new object.\n\nCSL.Output.Queue.prototype.openLevel = function (token) {\n    var blob, curr;\n    if (\"object\" === typeof token) {\n        // delimiter, prefix, suffix, decorations from token\n        blob = new CSL.Blob(undefined, token);\n    } else if (\"undefined\" === typeof token) {\n        blob = new CSL.Blob(undefined, this.formats.value().empty, \"empty\");\n    } else {\n        if (!this.formats.value() || !this.formats.value()[token]) {\n            CSL.error(\"CSL processor error: call to nonexistent format token \\\"\" + token + \"\\\"\");\n        }\n        // delimiter, prefix, suffix, decorations from token\n        blob = new CSL.Blob(undefined, this.formats.value()[token], token);\n    }\n    curr = this.current.value();\n    if (!this.state.tmp.just_looking && this.checkNestedBrace) {\n        blob.strings.prefix = this.checkNestedBrace.update(blob.strings.prefix);\n    }\n    curr.push(blob);\n    this.current.push(blob);\n};\n\n/**\n * \"merge\" used to be real complicated, now it's real simple.\n */\nCSL.Output.Queue.prototype.closeLevel = function (name) {\n    // CLEANUP: Okay, so this.current.value() holds the blob at the\n    // end of the current list.  This is wrong.  It should\n    // be the parent, so that we have  the choice of reading\n    // the affixes and decorations, or appending to its\n    // content.  The code that manipulates blobs will be\n    // much simpler that way.\n    if (name && name !== this.current.value().levelname) {\n        CSL.error(\"Level mismatch error:  wanted \" + name + \" but found \" + this.current.value().levelname);\n    }\n    var blob = this.current.pop();\n    if (!this.state.tmp.just_looking && this.checkNestedBrace) {\n        blob.strings.suffix = this.checkNestedBrace.update(blob.strings.suffix);\n    }\n};\n\n//\n// append does the same thing as newlevel, except\n// that the blob it pushes has text content,\n// and the current pointer is not moved after the push.\n\nCSL.Output.Queue.prototype.append = function (str, tokname, notSerious, ignorePredecessor, noStripPeriods) {\n    var token, blob, curr;\n    var useblob = true;\n    if (notSerious) {\n        ignorePredecessor = true;\n    }\n    // XXXXX Nasty workaround, but still an improvement\n    // over the reverse calls to the cs:date node build\n    // function that we had before.\n    if (this.state.tmp[\"doing-macro-with-date\"] && !notSerious) {\n        if (tokname !== \"macro-with-date\") {\n            return false;\n        }\n        if (tokname === \"macro-with-date\") {\n            tokname = \"empty\";\n        }\n    }\n    if (\"undefined\" === typeof str) {\n        return false;\n    }\n    if (\"number\" === typeof str) {\n        str = \"\" + str;\n    }\n    if (!notSerious \n        && this.state.tmp.element_trace \n        && this.state.tmp.element_trace.value() === \"suppress-me\") {\n        \n        return false;\n    }\n    blob = false;\n    if (!tokname) {\n        token = this.formats.value().empty;\n    } else if (tokname === \"literal\") {\n        token = true;\n        useblob = false;\n    } else if (\"string\" === typeof tokname) {\n        token = this.formats.value()[tokname];\n    } else {\n        token = tokname;\n    }\n    if (!token) {\n        CSL.error(\"CSL processor error: unknown format token name: \" + tokname);\n    }\n    // Unset delimiters must be left undefined until they reach the queue\n    // in order to discriminate unset from explicitly empty delimiters\n    // when inheriting a default value from a superior node. [??? really ???]\n    if (token.strings && \"undefined\" === typeof token.strings.delimiter) {\n        token.strings.delimiter = \"\";\n    }\n    if (\"string\" === typeof str && str.length) {\n\n        // Source (;?!): http://en.wikipedia.org/wiki/Space_(punctuation)#Breaking_and_non-breaking_spaces\n        // Source (:): http://forums.zotero.org/discussion/4933/localized-quotes/#Comment_88384\n        str = str.replace(/ ([:;?!\\u00bb])/g, \"\\u202f$1\").replace(/\\u00ab /g, \"\\u00ab\\u202f\");\n\n        this.last_char_rendered = str.slice(-1);\n        // This, and not the str argument below on flipflop, is the\n        // source of the flipflopper string source.\n        str = str.replace(/\\s+'/g, \" \\'\");\n        if (!notSerious) {\n            // this condition for sort_LeadingApostropheOnNameParticle\n            str = str.replace(/^'/g, \" \\'\");\n        }\n\n        // signal whether we end with terminal punctuation?\n        if (!ignorePredecessor) {\n            this.state.tmp.term_predecessor = true;\n            this.state.tmp.in_cite_predecessor = true;\n        } else if (notSerious) {\n            this.state.tmp.term_predecessor_name = true;\n        }\n    }\n    blob = new CSL.Blob(str, token);\n    curr = this.current.value();\n    if (\"undefined\" === typeof curr && this.current.mystack.length === 0) {\n        // XXXX An operation like this is missing somewhere, this should NOT be necessary.\n        // Addresses error triggered in multi-layouts.\n        this.current.mystack.push([]);\n        curr = this.current.value();\n    }\n    if (\"string\" === typeof blob.blobs) {\n        if (!ignorePredecessor) {\n            this.state.tmp.term_predecessor = true;\n            this.state.tmp.in_cite_predecessor = true;\n        } else if (notSerious) {\n            this.state.tmp.term_predecessor_name = true;\n        }\n    }\n    //\n    // Caution: The parallel detection machinery will blow up if tracking\n    // variables are not properly initialized elsewhere.\n    //\n    if (\"string\" === typeof str) {\n        if (\"string\" === typeof blob.blobs) {\n            if (blob.blobs.slice(0, 1) !== \" \") {\n                var blobPrefix = \"\";\n                var blobBlobs = blob.blobs;\n                while (CSL.TERMINAL_PUNCTUATION.indexOf(blobBlobs.slice(0, 1)) > -1) {\n                    blobPrefix = blobPrefix + blobBlobs.slice(0, 1);\n                    blobBlobs = blobBlobs.slice(1);\n                }\n                if (blobBlobs && blobPrefix) {\n                    blob.strings.prefix = blob.strings.prefix + blobPrefix;\n                    blob.blobs = blobBlobs;\n                }\n            }\n        }\n        if (blob.strings[\"text-case\"]) {\n            //\n            // This one is _particularly_ hard to follow.  It's not obvious,\n            // but the blob already contains the input string at this\n            // point, as blob.blobs -- it's a terminal node, as it were.\n            // The str variable also contains the input string, but\n            // that copy is not used for onward processing.  We have to\n            // apply our changes to the blob copy.\n            //\n            blob.blobs = CSL.Output.Formatters[blob.strings[\"text-case\"]](this.state, str);\n        }\n        if (this.state.tmp.strip_periods && !noStripPeriods) {\n            blob.blobs = blob.blobs.replace(/\\.([^a-z]|$)/g, \"$1\");\n        }\n        for (var i = blob.decorations.length - 1; i > -1; i += -1) {\n            if (blob.decorations[i][0] === \"@quotes\" && blob.decorations[i][1] !== \"false\") {\n                blob.punctuation_in_quote = this.state.getOpt(\"punctuation-in-quote\");\n            }\n            if (!blob.blobs.match(CSL.ROMANESQUE_REGEXP)) {\n                if (blob.decorations[i][0] === \"@font-style\") {\n                    blob.decorations = blob.decorations.slice(0, i).concat(blob.decorations.slice(i + 1));\n                }\n            }\n        }\n        //\n        // XXX: Beware superfluous code in your code.  str in this\n        // case is not the source of the final rendered string.\n        // See note above.\n        //\n        curr.push(blob);\n        this.state.fun.flipflopper.processTags(blob);\n    } else if (useblob) {\n        curr.push(blob);\n    } else {\n        curr.push(str);\n    }\n    return true;\n};\n\nCSL.Output.Queue.prototype.string = function (state, myblobs, blob) {\n    var i, ilen, j, jlen, b;\n    //if (blob && blob.strings.delimiter) {\n    //    print(\"DELIMITER: \"+blob.strings.delimiter+\" on \"+[x.blobs[0].num for each (x in myblobs)]);\n    //}\n    //var blobs, ret, blob_delimiter, i, params, blobjr, last_str, last_char, b, use_suffix, qres, addtoret, span_split, j, res, blobs_start, blobs_end, key, pos, len, ppos, llen, ttype, ltype, terminal, leading, delimiters, use_prefix, txt_esc;\n    var txt_esc = CSL.getSafeEscape(this.state);\n    var blobs = myblobs.slice();\n    var ret = [];\n    \n    if (blobs.length === 0) {\n        return ret;\n    }\n\n    var blob_delimiter = \"\";\n    if (blob) {\n        blob_delimiter = blob.strings.delimiter;\n    } else {\n        //print(\"=== Setting false to start ===\");\n        state.tmp.count_offset_characters = false;\n        state.tmp.offset_characters = 0;\n    }\n\n    if (blob && blob.new_locale) {\n        blob.old_locale = state.opt.lang;\n        state.opt.lang = blob.new_locale;\n    }\n\n    var blobjr, use_suffix, use_prefix, params;\n    for (var i = 0, ilen = blobs.length; i < ilen; i += 1) {\n        blobjr = blobs[i];\n\n        if (blobjr.strings.first_blob) {\n            // Being the Item.id of the the entry being rendered.\n            //print(\"  -- turning on counting\");\n            state.tmp.count_offset_characters = blobjr.strings.first_blob;\n        }\n\n        if (\"string\" === typeof blobjr.blobs) {\n            if (\"number\" === typeof blobjr.num) {\n                ret.push(blobjr);\n            } else if (blobjr.blobs) {\n                if (blobjr.particle) {\n                    blobjr.blobs = blobjr.particle + blobjr.blobs;\n                    blobjr.particle = \"\";\n                }\n                // (skips empty strings)\n                //b = txt_esc(blobjr.blobs);\n                b = txt_esc(blobjr.blobs);\n                var blen = b.length;\n\n                if (!state.tmp.suppress_decorations) {\n                    for (j = 0, jlen = blobjr.decorations.length; j < jlen; j += 1) {\n                        params = blobjr.decorations[j];\n                        if (params[0] === \"@showid\") {\n                            continue;\n                        }\n                        if (state.normalDecorIsOrphan(blobjr, params)) {\n                            continue;\n                        }\n                        b = state.fun.decorate[params[0]][params[1]].call(blobjr, state, b, params[2]);\n                    }\n                }\n                //\n                // because we will rip out portions of the output\n                // queue before rendering, group wrappers need\n                // to produce no output if they are found to be\n                // empty.\n                if (b && b.length) {\n                    b = txt_esc(blobjr.strings.prefix) + b + txt_esc(blobjr.strings.suffix);\n                    if (state.opt.development_extensions.csl_reverse_lookup_support && !state.tmp.suppress_decorations) {\n                        for (j = 0, jlen = blobjr.decorations.length; j < jlen; j += 1) {\n                            params = blobjr.decorations[j];\n\n                            if (params[0] === \"@showid\") {\n                                b = state.fun.decorate[params[0]][params[1]].call(blobjr, state, b, params[2]);\n                            }\n                        }\n                    }\n                    ret.push(b);\n                    if (state.tmp.count_offset_characters) {\n                        state.tmp.offset_characters += (blen + blobjr.strings.suffix.length + blobjr.strings.prefix.length);\n                    }\n                }\n            }\n        } else if (blobjr.blobs.length) {\n            var addtoret = state.output.string(state, blobjr.blobs, blobjr);\n            if (blob) {\n                // Patch up world-class weird bug in the ill-constructed code of mine.\n                if (\"string\" !== addtoret && addtoret.length > 1 && blobjr.strings.delimiter) {\n                    var numberSeen = false;\n                    for (var j=0,jlen=addtoret.length;j<jlen;j++) {\n                        if (\"string\" !== typeof addtoret[j]) {\n                            numberSeen = true;\n                        } else if (numberSeen) {\n                            addtoret[j] = (blobjr.strings.delimiter + addtoret[j]);\n                        }\n                    }\n                }\n            }\n            ret = ret.concat(addtoret);\n        }\n        if (blobjr.strings.first_blob && state.registry.registry[blobjr.strings.first_blob]) {\n            // The Item.id of the entry being rendered.\n            state.registry.registry[blobjr.strings.first_blob].offset = state.tmp.offset_characters;\n            state.tmp.count_offset_characters = false;\n        }\n    }\n\n    // Provide delimiters on adjacent numeric blobs\n    for (i=0,ilen=ret.length - 1;i<ilen;i+=1) {\n        if (\"number\" === typeof ret[i].num && \"number\" === typeof ret[i+1].num && !ret[i+1].UGLY_DELIMITER_SUPPRESS_HACK) {\n            // XXX watch this\n            ret[i].strings.suffix = ret[i].strings.suffix + (blob_delimiter ? blob_delimiter : \"\");\n            ret[i+1].successor_prefix = \"\";\n            ret[i+1].UGLY_DELIMITER_SUPPRESS_HACK = true;\n        }\n    }\n\n    var span_split = 0;\n    for (var i = 0, ilen = ret.length; i < ilen; i += 1) {\n        if (\"string\" === typeof ret[i]) {\n            span_split = (parseInt(i, 10) + 1);\n            if (i < ret.length - 1  && \"object\" === typeof ret[i + 1]) {\n                if (blob_delimiter && !ret[i + 1].UGLY_DELIMITER_SUPPRESS_HACK) {\n                    ret[i] += txt_esc(blob_delimiter);\n                }\n                // One bite of the apple\n                ret[i + 1].UGLY_DELIMITER_SUPPRESS_HACK = true;\n            }\n            //span_split = ret.length;\n            //print(\"XXX ret: \"+ret+\" -- \"+blob_delimiter);\n        }\n    }\n/*\n    if (blob && (blob.decorations.length || blob.strings.suffix || blob.strings.prefix)) {\n        span_split = ret.length;\n    }\n*/\n    if (blob && (blob.decorations.length || blob.strings.suffix)) {\n        span_split = ret.length;\n    } else if (blob && blob.strings.prefix) {\n        for (var i=0,ilen=ret.length;i<ilen;i++) {\n            if (\"undefined\" !== typeof ret[i].num) {\n                span_split = i;\n                if (i === 0) {\n                    ret[i].strings.prefix = blob.strings.prefix + ret[i].strings.prefix;\n                }\n                break;\n            }\n        }\n    }\n\n    var blobs_start = state.output.renderBlobs(ret.slice(0, span_split), blob_delimiter, false, blob);\n    if (blobs_start && blob && (blob.decorations.length || blob.strings.suffix || blob.strings.prefix)) {\n        if (!state.tmp.suppress_decorations) {\n            for (var i = 0, ilen = blob.decorations.length; i < ilen; i += 1) {\n                params = blob.decorations[i];\n                if ([\"@cite\",\"@bibliography\", \"@display\", \"@showid\"].indexOf(params[0]) > -1) {\n                    continue;\n                }\n                if (state.normalDecorIsOrphan(blobjr, params)) {\n                    continue;\n                }\n                if (!params[0]) continue;\n                if (\"string\" === typeof blobs_start) {\n                    blobs_start = state.fun.decorate[params[0]][params[1]].call(blob, state, blobs_start, params[2]);\n                }\n            }\n        }\n        //\n        // XXXX: cut-and-paste warning.  same as a code block above.\n        //\n        b = blobs_start;\n        use_suffix = blob.strings.suffix;\n        if (b && b.length) {\n            use_prefix = blob.strings.prefix;\n            b = txt_esc(use_prefix) + b + txt_esc(use_suffix);\n            if (state.tmp.count_offset_characters) {\n                state.tmp.offset_characters += (use_prefix.length + use_suffix.length);\n            }\n        }\n        blobs_start = b;\n        if (!state.tmp.suppress_decorations) {\n            for (var i = 0, ilen = blob.decorations.length; i < ilen; i += 1) {\n                params = blob.decorations[i];\n                if ([\"@cite\",\"@bibliography\", \"@display\", \"@showid\"].indexOf(params[0]) === -1) {\n                    continue;\n                }\n                if (\"string\" === typeof blobs_start) {\n                    blobs_start = state.fun.decorate[params[0]][params[1]].call(blob, state, blobs_start, params[2]);\n                }\n            }\n        }\n    }\n\n    var blobs_end = ret.slice(span_split, ret.length);\n    if (!blobs_end.length && blobs_start) {\n        ret = [blobs_start];\n    } else if (blobs_end.length && !blobs_start) {\n        ret = blobs_end;\n    } else if (blobs_start && blobs_end.length) {\n        ret = [blobs_start].concat(blobs_end);\n    }\n    //\n    // Blobs is now definitely a string with\n    // trailing blobs.  Return it.\n    if (\"undefined\" === typeof blob) {\n        this.queue = [];\n        this.current.mystack = [];\n        this.current.mystack.push(this.queue);\n        if (state.tmp.suppress_decorations) {\n            ret = state.output.renderBlobs(ret, undefined, false);\n        }\n    } else if (\"boolean\" === typeof blob) {\n        ret = state.output.renderBlobs(ret, undefined, true);\n    }\n\n    if (blob && blob.new_locale) {\n        state.opt.lang = blob.old_locale;\n    }\n    //if (!blob && !state.tmp.just_looking) {\n    //  print(\"QUEUE (\"+ state.tmp.just_looking +\"): \"+JSON.stringify(state.output.queue, [\"num\", \"strings\", \"decorations\", \"blobs\", \"prefix\", \"suffix\", \"delimiter\"], 2));\n    //}\n    return ret;\n};\n\nCSL.Output.Queue.prototype.clearlevel = function () {\n    var blob, pos, len;\n    blob = this.current.value();\n    len = blob.blobs.length;\n    for (pos = 0; pos < len; pos += 1) {\n        blob.blobs.pop();\n    }\n};\n\nCSL.Output.Queue.prototype.renderBlobs = function (blobs, delim, in_cite, parent) {\n    var state, ret, ret_last_char, use_delim, blob, pos, len, ppos, llen, str, params, txt_esc;\n    txt_esc = CSL.getSafeEscape(this.state);\n    if (!delim) {\n        delim = \"\";\n    }\n    state = this.state;\n    ret = \"\";\n    ret_last_char = [];\n    use_delim = \"\";\n    len = blobs.length;\n    if (this.state.tmp.area === \"citation\" && !this.state.tmp.just_looking && len === 1 && typeof blobs[0] === \"object\" && parent) {\n        blobs[0].strings.prefix = parent.strings.prefix + blobs[0].strings.prefix;\n        blobs[0].strings.suffix = blobs[0].strings.suffix + parent.strings.suffix;\n        blobs[0].decorations = blobs[0].decorations.concat(parent.decorations);\n        blobs[0].params = parent.params;\n        return blobs[0];\n    }\n    var start = true;\n    for (pos = 0; pos < len; pos += 1) {\n        if (blobs[pos].checkNext) {\n            blobs[pos].checkNext(blobs[pos + 1],start);\n            start = false;\n        } else if (blobs[pos+1] && blobs[pos+1].splice_prefix) {\n            start = false;\n            //blobs[pos+1].checkNext(blobs[pos + 1],start);\n        } else {\n            start = true;\n        }\n    }\n    \n    // print(\"LEN=\"+len+\" \"+JSON.stringify(blobs, null, 2));\n    // Fix last non-range join\n    var doit = true;\n    for (pos = blobs.length - 1; pos > 0; pos += -1) {\n        if (blobs[pos].checkLast) {\n            if (doit && blobs[pos].checkLast(blobs[pos - 1])) {\n                doit = false;\n            }\n        } else {\n            doit = true;\n        }\n    }\n    len = blobs.length;\n    for (pos = 0; pos < len; pos += 1) {\n        blob = blobs[pos];\n        if (ret) {\n            use_delim = delim;\n        }\n        if (\"string\" === typeof blob) {\n            ret += txt_esc(use_delim);\n            // XXX Blob should be run through flipflop and flattened here.\n            // (I think it must be a fragment of text around a numeric\n            // variable)\n            ret += blob;\n            if (state.tmp.count_offset_characters) {\n                //state.tmp.offset_characters += (use_delim.length + blob.length);\n                state.tmp.offset_characters += (use_delim.length);\n            }\n        } else if (in_cite) {\n            // pass\n            // Okay, so this does it -- but we're now not able to return a string!\n            if (ret) {\n                ret = [ret, blob];\n            } else {\n                ret = [blob];\n            }\n        } else if (blob.status !== CSL.SUPPRESS) {\n            if (blob.particle) {\n                str = blob.particle + blob.num;\n            } else {\n                str = blob.formatter.format(blob.num, blob.gender);\n            }\n            // Workaround to get a more or less accurate value.\n            var strlen = str.replace(/<[^>]*>/g, \"\").length;\n            // notSerious\n            this.append(str, \"empty\", true);\n            var str_blob = this.pop();\n            var count_offset_characters = state.tmp.count_offset_characters;\n            str = this.string(state, [str_blob], false);\n            state.tmp.count_offset_characters = count_offset_characters;\n            if (blob.strings[\"text-case\"]) {\n                str = CSL.Output.Formatters[blob.strings[\"text-case\"]](this.state, str);\n            }\n            if (str && this.state.tmp.strip_periods) {\n                str = str.replace(/\\.([^a-z]|$)/g, \"$1\");\n            }\n            if (!state.tmp.suppress_decorations) {\n                llen = blob.decorations.length;\n                for (ppos = 0; ppos < llen; ppos += 1) {\n                    params = blob.decorations[ppos];\n                    if (state.normalDecorIsOrphan(blob, params)) {\n                        continue;\n                    }\n                    str = state.fun.decorate[params[0]][params[1]].call(blob, state, str, params[2]);\n                }\n            }\n            str = txt_esc(blob.strings.prefix) + str + txt_esc(blob.strings.suffix);\n            var addme = \"\";\n            if (blob.status === CSL.END) {\n                //print(\"  CSL.END\");\n                addme = txt_esc(blob.range_prefix);\n            } else if (blob.status === CSL.SUCCESSOR) {\n                //print(\"  CSL.SUCCESSOR\");\n                addme = txt_esc(blob.successor_prefix);\n            } else if (blob.status === CSL.START) {\n                //print(\"  CSL.START\");\n                if (pos > 0 && !blob.suppress_splice_prefix) {\n                    addme = txt_esc(blob.splice_prefix);\n                } else {\n                    addme = \"\";\n                }\n            } else if (blob.status === CSL.SEEN) {\n                //print(\"  CSL.SEEN\");\n\n                // THIS IS NOT THE PROPER FUNCTION OF CSL.SEEN, IS IT?\n\n                addme = txt_esc(blob.splice_prefix);\n            }\n            ret += addme;\n            ret += str;\n            if (state.tmp.count_offset_characters) {\n                state.tmp.offset_characters += (addme.length + blob.strings.prefix.length + strlen + blob.strings.suffix.length);\n            }\n        }\n    }\n    return ret;\n};\n\nCSL.Output.Queue.purgeEmptyBlobs = function (parent) {\n    //print(\"START1\");\n    if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n        return;\n    }\n    // back-to-front, bottom-first\n    for (var i=parent.blobs.length-1;i>-1;i--) {\n        CSL.Output.Queue.purgeEmptyBlobs(parent.blobs[i]);\n        var child = parent.blobs[i];\n        if (!child || !child.blobs || !child.blobs.length) {\n            var buf = [];\n            while ((parent.blobs.length-1) > i) {\n                buf.push(parent.blobs.pop());\n            }\n            parent.blobs.pop();\n            while (buf.length) {\n                parent.blobs.push(buf.pop());\n            }\n        }\n    }\n    //print(\"   end\");\n};\n\n// Adjustments to be made:\n//\n// * Never migrate beyond a @quotes node\n// * Never migrate into a num node.\n\nCSL.Output.Queue.adjust = function (punctInQuote) {\n\n    var NO_SWAP_IN = {\n        \";\": true,\n        \":\": true\n    };\n\n    var NO_SWAP_OUT = {\n        \".\": true,\n        \"!\": true,\n        \"?\": true\n    };\n\n    var LtoR_MAP = {\n        \"!\": {\n            \".\": \"!\",\n            \"?\": \"!?\",\n            \":\": \"!\",\n            \",\": \"!,\",\n            \";\": \"!;\"\n        },\n        \"?\": {\n            \"!\": \"?!\",\n            \".\": \"?\",\n            \":\": \"?\",\n            \",\": \"?,\",\n            \";\": \"?;\"\n        },\n        \".\": {\n            \"!\": \".!\",\n            \"?\": \".?\",\n            \":\": \".:\",\n            \",\": \".,\",\n            \";\": \".;\"\n        },\n        \":\": {\n            \"!\": \"!\",\n            \"?\": \"?\",\n            \".\": \":\",\n            \",\": \":,\",\n            \";\": \":;\"\n        },\n        \",\": {\n            \"!\": \",!\",\n            \"?\": \",?\",\n            \":\": \",:\",\n            \".\": \",.\",\n            \";\": \",;\"\n        },\n        \";\": {\n            \"!\": \"!\",\n            \"?\": \"?\",\n            \":\": \";\",\n            \",\": \";,\",\n            \".\": \";\"\n        }\n    };\n\n    var SWAP_IN = {};\n    var SWAP_OUT = {};\n    var PUNCT = {};\n    var PUNCT_OR_SPACE = {};\n    for (var key in LtoR_MAP) {\n        PUNCT[key] = true;\n        PUNCT_OR_SPACE[key] = true;\n        if (!NO_SWAP_IN[key]) {\n            SWAP_IN[key] = true;\n        }\n        if (!NO_SWAP_OUT[key]) {\n            SWAP_OUT[key] = true;\n        }\n    }\n    PUNCT_OR_SPACE[\" \"] = true;\n    PUNCT_OR_SPACE[\"\"] = true;\n\n    var RtoL_MAP = {};\n    for (var key in LtoR_MAP) {\n        for (var subkey in LtoR_MAP[key]) {\n            if (!RtoL_MAP[subkey]) {\n                RtoL_MAP[subkey] = {};\n            }\n            RtoL_MAP[subkey][key] = LtoR_MAP[key][subkey];\n        }\n    }\n\n    function blobIsNumber(blob) {\n        return (\"number\" === typeof blob.num || (blob.blobs && blob.blobs.length === 1 && \"number\" === typeof blob.blobs[0].num));\n    }\n\n    function blobEndsInNumber(blob) {\n        if (\"number\" === typeof blob.num) {\n            return true;\n        }\n        if (!blob.blobs || \"object\" !==  typeof blob.blobs) {\n            return false;\n        }\n        if (blobEndsInNumber(blob.blobs[blob.blobs.length-1])) {\n            return true;\n        }\n    }\n    \n    function blobHasDecorations(blob,includeQuotes) {\n        var ret = false;\n        var decorlist = ['@font-style','@font-variant','@font-weight','@text-decoration','@vertical-align'];\n        if (includeQuotes) {\n            decorlist.push('@quotes');\n        }\n        if (blob.decorations) {\n            for (var i=0,ilen=blob.decorations.length;i<ilen;i++) {\n                if (decorlist.indexOf(blob.decorations[i][0]) > -1) {\n                    ret = true;\n                    break;\n                }\n            }\n        }\n        return ret;\n    }\n    \n    function blobHasDescendantQuotes(blob) {\n        if (blob.decorations) {\n            for (var i=0,ilen=blob.decorations.length;i<ilen;i++) {\n                if (blob.decorations[i][0] === '@quotes' && blob.decorations[i][1] !== \"false\") {\n                    return true;\n                }\n            }\n        }\n        if (\"object\" !== typeof blob.blobs) {\n            return false;\n        }\n        return blobHasDescendantQuotes(blob.blobs[blob.blobs.length-1]);\n        //if (blobHasDescendantQuotes(blob.blobs[blob.blobs.length-1])) {\n        //    return true\n        //};\n        //return false;\n    }\n    \n    function blobHasDescendantMergingPunctuation(parentChar,blob) {\n        var childChar = blob.strings.suffix.slice(-1);\n        if (!childChar && \"string\" === typeof blob.blobs) {\n            childChar = blob.blobs.slice(-1);\n        }\n        var mergedChars = RtoL_MAP[parentChar][childChar];\n        if (mergedChars && mergedChars.length === 1) {\n            return true;\n        }\n        if (\"object\" !== typeof blob.blobs) {\n            return false;\n        }\n        if (blobHasDescendantMergingPunctuation(parentChar,blob.blobs[blob.blobs.length-1])) {\n            return true;\n        }\n        return false;\n    }\n    \n    function matchLastChar(blob, chr) {\n        if (!PUNCT[chr]) {\n            return false;\n        }\n        if (\"string\" === typeof blob.blobs) {\n\n            if (blob.blobs.slice(-1) === chr) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            var child = blob.blobs[blob.blobs.length-1];\n            if (child) {\n                var childChar = child.strings.suffix.slice(-1);\n                if (!childChar) {\n                    return matchLastChar(child,chr);\n                } else if (child.strings.suffix.slice(-1) == chr) {\n                    return true;\n                } else {\n                    return false;\n                }\n            } else {\n                return false;\n            }\n        }\n    }\n    \n    function mergeChars (First, first, Second, second, merge_right) {\n        var FirstStrings = \"blobs\" === first ? First : First.strings;\n        var SecondStrings = \"blobs\" === second ? Second: Second.strings;\n        var firstChar = FirstStrings[first].slice(-1);\n        var secondChar = SecondStrings[second].slice(0,1);\n        function cullRight () {\n            SecondStrings[second] = SecondStrings[second].slice(1);\n        }\n        function cullLeft () {\n            FirstStrings[first] = FirstStrings[first].slice(0,-1);\n        }\n        function addRight (chr) {\n            SecondStrings[second] = chr + SecondStrings[second];\n        }\n        function addLeft (chr) {\n            FirstStrings[first] += chr;\n        }\n        var cull = merge_right ? cullLeft : cullRight;\n        function matchOnRight () {\n            return RtoL_MAP[secondChar];\n        }\n        function matchOnLeft () {\n            return LtoR_MAP[firstChar];\n        }\n        var match = merge_right ? matchOnLeft : matchOnRight;\n        function mergeToRight () {\n            var chr = LtoR_MAP[firstChar][secondChar];\n            if (\"string\" === typeof chr) {\n                cullLeft();\n                cullRight();\n                addRight(chr);\n            } else {\n                addRight(firstChar);\n                cullLeft();\n            }\n        }\n        function mergeToLeft () {\n            var chr = RtoL_MAP[secondChar][firstChar];\n            if (\"string\" === typeof chr) {\n                cullLeft();\n                cullRight();\n                addLeft(chr);\n            } else {\n                addLeft(secondChar);\n                cullRight();\n            }\n        }\n        var merge = merge_right ? mergeToRight: mergeToLeft;\n\n        var isDuplicate = firstChar === secondChar;\n        if (isDuplicate) {\n            cull();\n        } else {\n            if (match()) {\n                merge();\n            }\n        }\n    }\n\n    function upward (parent) {\n        //print(\"START2\");\n        // Terminus if no blobs\n        if (parent.blobs && \"string\" == typeof parent.blobs) {\n            if (PUNCT[parent.strings.suffix.slice(0,1)]\n                && parent.strings.suffix.slice(0,1) === parent.blobs.slice(-1)) {\n\n                parent.strings.suffix = parent.strings.suffix.slice(1);\n            }\n            return;\n        } else if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n\n        // back-to-front, bottom-first\n        var parentDecorations = blobHasDecorations(parent,true);\n        for (var i=parent.blobs.length-1;i>-1;i--) {\n            this.upward(parent.blobs[i]);\n            var parentStrings = parent.strings;\n            var childStrings = parent.blobs[i].strings;\n            if (i === 0) {\n                // Remove leading space on first-position child node prefix if there is a trailing space on the node prefix above \n                if (\" \" === parentStrings.prefix.slice(-1) && \" \" === childStrings.prefix.slice(0, 1)) {\n                    childStrings.prefix = childStrings.prefix.slice(1);\n                }\n                // Migrate leading punctuation or space on a first-position prefix upward\n                var childChar = childStrings.prefix.slice(0, 1);\n                if (!parentDecorations && PUNCT_OR_SPACE[childChar] && !parentStrings.prefix) {\n                    parentStrings.prefix += childChar;\n                    childStrings.prefix = childStrings.prefix.slice(1);\n                }\n            }\n            if (i === (parent.blobs.length - 1)) {\n                // Migrate trailing space ONLY on a last-position suffix upward, controlling for duplicates\n                var childChar = childStrings.suffix.slice(-1);\n                // ZZZ Loosened to fix initialized names wrapped in a span and followed by a period\n                if (!parentDecorations && [\" \"].indexOf(childChar) > -1) {\n                    if (parentStrings.suffix.slice(0,1) !== childChar) {\n                        parentStrings.suffix = childChar + parentStrings.suffix;\n                    }\n                    childStrings.suffix = childStrings.suffix.slice(0, -1);\n                }\n            }\n            if (parentStrings.delimiter && i > 0) {\n                // Remove leading space on mid-position child node prefix if there is a trailing space on delimiter above\n                if (PUNCT_OR_SPACE[parentStrings.delimiter.slice(-1)]\n                    && parentStrings.delimiter.slice(-1) === childStrings.prefix.slice(0, 1)) {\n\n                    childStrings.prefix = childStrings.prefix.slice(1);\n                }\n            }\n            // Siblings are handled in adjustNearsideSuffixes()\n        }\n        //print(\"   end\");\n    }\n\n    function leftward (parent) {\n        // Terminus if no blobs\n        if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n\n        for (var i=parent.blobs.length-1;i>-1;i--) {\n            this.leftward(parent.blobs[i]);\n            // This is a delicate one.\n            //\n            // Migrate if:\n            // * there is no umbrella delimiter [ok]\n            // * neither the child nor its sibling is a number [ok]\n            // * decorations exist neither on the child nor on the sibling [ok]\n            // * sibling prefix char is a swapping char [ok]\n            //\n            // Suppress without migration if:\n            // * sibling prefix char matches child suffix char or\n            // * child suffix is empty and sibling prefix char match last field char\n            if ((i < parent.blobs.length -1) && !parent.strings.delimiter) {\n                // If there is a trailing swappable character on a sibling prefix with no intervening delimiter, copy it to suffix,\n                // controlling for duplicates\n                var child = parent.blobs[i];\n                var childChar = child.strings.suffix.slice(-1);\n                var sibling = parent.blobs[i+1];\n                var siblingChar = sibling.strings.prefix.slice(0, 1);\n                var hasDecorations = blobHasDecorations(child) || blobHasDecorations(sibling);\n                var hasNumber = \"number\" === typeof childChar || \"number\" === typeof siblingChar;\n\n                if (!hasDecorations && !hasNumber && PUNCT[siblingChar] && !hasNumber) {\n                    var suffixAndPrefixMatch = siblingChar === child.strings.suffix.slice(-1);\n                    var suffixAndFieldMatch = (!child.strings.suffix && \"string\" === typeof child.blobs && child.blobs.slice(-1) === siblingChar);\n                    if (!suffixAndPrefixMatch && !suffixAndFieldMatch) {\n                        mergeChars(child, 'suffix', sibling, 'prefix');\n                        //child.strings.suffix += siblingChar;\n                    } else {\n                        sibling.strings.prefix = sibling.strings.prefix.slice(1);\n                    }\n                }\n            }\n        }\n    }\n\n    function downward (parent) {\n        //print(\"START3\");\n        // Terminus if no blobs\n        if (parent.blobs && \"string\" == typeof parent.blobs) {\n            if (PUNCT[parent.strings.suffix.slice(0,1)]\n                && parent.strings.suffix.slice(0,1) === parent.blobs.slice(-1)) {\n\n                parent.strings.suffix = parent.strings.suffix.slice(1);\n            }\n            return;\n        } else if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n        //if (top) {\n        //    print(\"JSON \"+JSON.stringify(parent, [\"strings\", \"decorations\", \"blobs\", \"prefix\", \"suffix\", \"delimiter\"], 2));\n        //}\n\n        var parentStrings = parent.strings;\n        // Check for numeric child\n        var someChildrenAreNumbers = false;\n        for (var i=0,ilen=parent.blobs.length;i<ilen;i++) {\n            if (blobIsNumber(parent.blobs[i])) {\n                someChildrenAreNumbers = true;\n                break;\n            }\n        }\n        if (true || !someChildrenAreNumbers) {\n            // If there is a leading swappable character on delimiter, copy it to suffixes IFF none of the targets are numbers\n            if (parentStrings.delimiter && PUNCT[parentStrings.delimiter.slice(0, 1)]) {\n                var delimChar = parentStrings.delimiter.slice(0, 1);\n                for (var i=parent.blobs.length-2;i>-1;i--) {\n                    var childStrings = parent.blobs[i].strings;\n                    if (childStrings.suffix.slice(-1) !== delimChar) {\n                        childStrings.suffix += delimChar;\n                    }\n                }\n                parentStrings.delimiter = parentStrings.delimiter.slice(1);\n            }\n        }\n        // back-to-front, top-first\n        for (var i=parent.blobs.length-1;i>-1;i--) {\n            var child = parent.blobs[i];\n            var childStrings = parent.blobs[i].strings;\n            var childDecorations = blobHasDecorations(child, true);\n            var childIsNumber = blobIsNumber(child);\n\n            if (i === (parent.blobs.length - 1)) {\n\n                //if (blobHasDescendantQuotes(child)) {\n                //    print(\"JSON \"+JSON.stringify(parent, [\"strings\", \"decorations\", \"blobs\", \"prefix\", \"suffix\", \"delimiter\"]));\n                //}\n\n                if (true || !someChildrenAreNumbers) {\n                    // If we have decorations, drill down to see if there are quotes below.\n                    // If so, we allow migration anyway.\n                    // Original discussion is here:\n                    // https://forums.zotero.org/discussion/37091/citeproc-bug-punctuation-in-quotes/\n                    var parentChar = parentStrings.suffix.slice(0, 1);\n\n                    // Hmm.\n                    // Consider writing out the matching child from blobHasDescendant functions.\n                    // It should save some cycles, and produce the same result.\n\n                    var allowMigration = false;\n                    if (PUNCT[parentChar]) {\n                        allowMigration = blobHasDescendantMergingPunctuation(parentChar,child);\n                        if (!allowMigration && punctInQuote) {\n                            allowMigration = blobHasDescendantQuotes(child);\n                        }\n                    }\n                    if (allowMigration) {\n                        if (PUNCT[parentChar]) {\n                            if (!blobEndsInNumber(child)) {\n                                if (\"string\" === typeof child.blobs) {\n                                    mergeChars(child, 'blobs', parent, 'suffix');\n                                } else {\n                                    mergeChars(child, 'suffix', parent, 'suffix');\n                                }\n                                if (parentStrings.suffix.slice(0,1) === \".\") {\n                                    childStrings.suffix += parentStrings.suffix.slice(0,1);\n                                    parentStrings.suffix = parentStrings.suffix.slice(1);\n                                }\n                            }\n                        }\n                    }\n                    if (childStrings.suffix.slice(-1) === \"\" && parentStrings.suffix.slice(0,1) === \" \") {\n                        parentStrings.suffix = parentStrings.suffix.slice(1);\n                    }\n                    // More duplicates control\n                    if (PUNCT_OR_SPACE[childStrings.suffix.slice(0,1)]) {\n                        if (\"string\" === typeof child.blobs && child.blobs.slice(-1) === childStrings.suffix.slice(0,1)) {\n                            // Remove parent punctuation of it duplicates the last character of a field\n                            childStrings.suffix = childStrings.suffix.slice(1);\n                        }\n                        if (childStrings.suffix.slice(-1) === parentStrings.suffix.slice(0, 1)) {\n                            // Remove duplicate punctuation on child suffix\n                            parentStrings.suffix = parentStrings.suffix.slice(0, -1);\n                        }\n                    }\n                }\n                // Squash dupes\n                if (matchLastChar(parent,parent.strings.suffix.slice(0,1))) {\n                    parent.strings.suffix = parent.strings.suffix.slice(1);\n                }\n            } else if (parentStrings.delimiter) {\n                // Remove trailing space on mid-position child node suffix if there is a leading space on delimiter above\n                if (PUNCT_OR_SPACE[parentStrings.delimiter.slice(0,1)]\n                    && parentStrings.delimiter.slice(0, 1) === childStrings.suffix.slice(-1)) {\n\n                    parent.blobs[i].strings.suffix = parent.blobs[i].strings.suffix.slice(0, -1);\n                    \n                }\n            } else {\n                // Otherwise it's a sibling. We don't care about moving spaces here, just suppress a duplicate\n                var siblingStrings = parent.blobs[i+1].strings;\n                if (!blobIsNumber(child) \n                    && !childDecorations\n                    && PUNCT_OR_SPACE[childStrings.suffix.slice(-1)]\n                    && childStrings.suffix.slice(-1) === siblingStrings.prefix.slice(0, 1)) {\n\n                    siblingStrings.prefix = siblingStrings.prefix.slice(1);\n                }\n            }\n            // If field content ends with swappable punctuation, suppress swappable punctuation in style suffix.\n            if (!childIsNumber && !childDecorations && PUNCT[childStrings.suffix.slice(0,1)]\n                && \"string\" === typeof child.blobs) {\n                \n                mergeChars(child, 'blobs', child, 'suffix');\n            }\n            this.downward(parent.blobs[i]);\n        }\n/*\n        if (top) {\n\n            var seen = [];\n            print(JSON.stringify(parent, function(key, val) {\n                if (!val || key === 'alldecor') return;\n                if (typeof val == \"object\") {\n                    if (seen.indexOf(val) >= 0)\n                        return\n                    seen.push(val)\n                }\n                return val\n            },2));\n        }\n*/\n\n        //print(\"  end\");\n    }\n    // Abstract out a couple of utility functions, used in fix() below.\n    function swapToTheLeft (child) {\n        var childChar = child.strings.suffix.slice(0,1);\n        if (\"string\" === typeof child.blobs) {\n            while (SWAP_IN[childChar]) {\n                mergeChars(child, 'blobs', child, 'suffix');\n                childChar = child.strings.suffix.slice(0,1);\n            }                                \n        } else {\n            while (SWAP_IN[childChar]) {\n                mergeChars(child.blobs[child.blobs.length-1], 'suffix', child, 'suffix');\n                childChar = child.strings.suffix.slice(0,1);\n            }\n        }\n    }\n    function swapToTheRight (child) {\n        if (\"string\" === typeof child.blobs) {\n            var childChar = child.blobs.slice(-1);\n            while (SWAP_OUT[childChar]) {\n                mergeChars(child, 'blobs', child, 'suffix', true);\n                childChar = child.blobs.slice(-1);\n            }\n        } else {\n            var childChar = child.blobs[child.blobs.length-1].strings.suffix.slice(-1);\n            while (SWAP_OUT[childChar]) {\n                mergeChars(child.blobs[child.blobs.length-1], 'suffix', child, 'suffix', true);\n                childChar = child.blobs[child.blobs.length-1].strings.suffix.slice(-1);\n            }\n        }\n    }\n\n    function fix (parent) {\n        // Terminus if no blobs\n        if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n        \n        //print(\"START4\");\n        // Do the swap, front-to-back, bottom-first\n        var lastChar;\n\n        // XXX Two things to fix with this:\n        // XXX (1) Stalls after one character\n        // XXX (2) Moves colon and semicolon, both of which SHOULD stall\n\n        for (var i=0,ilen=parent.blobs.length;i<ilen;i++) {\n            var child = parent.blobs[i];\n            var quoteSwap = false;\n            for (var j=0,jlen=child.decorations.length;j<jlen;j++) {\n                var decoration = child.decorations[j];\n                if (decoration[0] === \"@quotes\" && decoration[1] !== \"false\") {\n                    quoteSwap = true;\n                }\n            }\n            if (quoteSwap) {\n                if (punctInQuote) {\n                    swapToTheLeft(child);\n                } else {\n                    swapToTheRight(child);\n                }\n            }\n            lastChar = this.fix(parent.blobs[i]);\n            if (child.blobs && \"string\" === typeof child.blobs) {\n                lastChar = child.blobs.slice(-1);\n            }\n        }\n        return lastChar;\n    }\n    this.upward = upward;\n    this.leftward = leftward;\n    this.downward = downward;\n    this.fix = fix;\n};\n\n/*global CSL: true */\n\nCSL.Engine.Opt = function () {\n    this.parallel = {\n        enable: false,\n    },\n    this.has_disambiguate = false;\n    this.mode = \"html\";\n    this.dates = {};\n    this.jurisdictions_seen = {};\n    this.suppressedJurisdictions = {};\n    this.inheritedAttributes = {};\n    this[\"locale-sort\"] = [];\n    this[\"locale-translit\"] = [];\n    this[\"locale-translat\"] = [];\n    this.citeAffixes = {\n        persons:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        institutions:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        titles:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        journals:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        publishers:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        places:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        }\n    };\n    this[\"default-locale\"] = [];\n    this.update_mode = CSL.NONE;\n    this.bib_mode = CSL.NONE;\n    this.sort_citations = false;\n    /*\n     * Default values.\n     * The various et-al values are set globally,\n     * and the appropriate value is set by the names start\n     * tag at runtime, depending on whether the Item is a\n     * first or a subsequent reference.\n     */\n    this[\"et-al-min\"] = 0;\n    this[\"et-al-use-first\"] = 1;\n    this[\"et-al-use-last\"] = false;\n    this[\"et-al-subsequent-min\"] = false;\n    this[\"et-al-subsequent-use-first\"] = false;\n\n    this[\"demote-non-dropping-particle\"] = \"display-and-sort\";\n    // default of true, because none of our consuming\n    // applications so far store the various prefixes and \n    // suffixes we support in separate fields.\n    this[\"parse-names\"] = true;\n    // this[\"auto-vietnamese-names\"] = true;\n\n    this.citation_number_slug = false;\n    this.trigraph = \"Aaaa00:AaAa00:AaAA00:AAAA00\";\n\n    this.nodenames = [];\n\n    this.gender = {};\n    this['cite-lang-prefs'] = {\n        persons:['orig'],\n        institutions:['orig'],\n        titles:['orig'],\n        journals:['orig'],\n        publishers:['orig'],\n        places:['orig'],\n        number:['orig']\n    };\n\n    this.has_layout_locale = false;\n    this.disable_duplicate_year_suppression = [];\n    this.use_context_condition = false;\n\n    this.jurisdiction_fallbacks = {};\n\n    this.development_extensions = {};\n    this.development_extensions.field_hack = true;\n    this.development_extensions.allow_field_hack_date_override = true;\n    this.development_extensions.locator_date_and_revision = true;\n    this.development_extensions.locator_label_parse = true;\n    this.development_extensions.raw_date_parsing = true;\n    this.development_extensions.clean_up_csl_flaws = true;\n    this.development_extensions.consolidate_legal_items = false;\n    this.development_extensions.csl_reverse_lookup_support = false;\n    this.development_extensions.wrap_url_and_doi = false;\n    this.development_extensions.thin_non_breaking_space_html_hack = false;\n    this.development_extensions.apply_citation_wrapper = false;\n    this.development_extensions.main_title_from_short_title = false;\n    this.development_extensions.uppercase_subtitles = false;\n    this.development_extensions.normalize_lang_keys_to_lowercase = false;\n    this.development_extensions.strict_text_case_locales = false;\n    this.development_extensions.expect_and_symbol_form = false;\n    this.development_extensions.require_explicit_legal_case_title_short = false;\n    this.development_extensions.spoof_institutional_affiliations = false;\n    this.development_extensions.force_jurisdiction = false;\n    this.development_extensions.parse_names = true;\n    this.development_extensions.hanging_indent_legacy_number = false;\n    this.development_extensions.throw_on_empty = false;\n    this.development_extensions.strict_inputs = true;\n    this.development_extensions.prioritize_disambiguate_condition = false;\n    this.development_extensions.force_short_title_casing_alignment = true;\n    this.development_extensions.implicit_short_title = false;\n    this.development_extensions.force_title_abbrev_fallback = false;\n    this.development_extensions.split_container_title = false;\n    this.development_extensions.legacy_institution_name_ordering = false;\n    this.development_extensions.etal_min_etal_usefirst_hack = false;\n};\n\nCSL.Engine.Tmp = function () {\n    //\n    // scratch variable to display the total\n    // number of names in all rendered variables\n    // in a cite.  initialized to zero by the\n    // citation element, incremented by each\n    // name variable actually rendered\n    this.names_max = new CSL.Stack();\n    this.names_base = new CSL.Stack();\n    this.givens_base = new CSL.Stack();\n    //\n    // this holds the field values collected by the @value\n    // and @variable attributes, for processing by the\n    // element functions.\n    this.value = [];\n    /**\n     * Object to hold the decorations declared by a name-part\n     * element.\n     */\n    this.namepart_decorations = {};\n    /**\n     * String variable to hold the type of a name-part\n     * element.\n     */\n    this.namepart_type = false;\n    //\n    // scratch variable to flag whether we are processing\n    // a citation or a bibiliography.  this diverts token and\n    // configuration to the appropriateo objects inside\n    // state.  the default is \"citation\".\n    this.area = \"citation\";\n    this.root = \"citation\";\n    this.extension = \"\";\n    //\n    // controls the implicit conditional wrappers applied\n    // to top-level elements inside a names substitute span.\n    // false by default, names start tag pushes a new true level,\n    // names end tag pops it.  Output value check in @variable\n    // function of attributes.js sets level to false.  closing names\n    // tag maps a false value to superior level.\n    this.can_substitute = new CSL.Stack(0, CSL.LITERAL);\n    //\n    // notes whether the formatted elements of a date span\n    // rendered anything.  controls whether literal fallback\n    // is used.\n    this.element_rendered_ok = false;\n    //\n    // element_trace keeps a record of rendered elements.\n    // used to implement author-only.\n    //\n    this.element_trace = new CSL.Stack(\"style\");\n    //\n    // counter for total namesets\n    this.nameset_counter = 0;\n    //\n    /////  this.fun.check_for_output = CSL.check_for_output;\n    //\n    // stack flag used for term handling.  Set to true\n    // if at least one variable has tried to render, and\n    // no variables had content.\n    this.group_context = new CSL.Stack({\n        term_intended: false,\n        variable_attempt: false,\n        variable_success: false,\n        output_tip: undefined,\n        label_form:  undefined,\n        parallel_first: undefined,\n        parallel_last: undefined,\n        parallel_delimiter_override: undefined,\n        condition: false,\n        force_suppress: false,\n        done_vars: []\n    });\n    //\n    // boolean flag used to control first-letter capitalization\n    // of terms.  Set to true if any item preceding the term\n    // being handled has rendered successfully, otherwise\n    // false.\n    this.term_predecessor = false;\n    //\n    // boolean flag to control use of layout delimiter\n    // immediately before numbers. This hack is needed for\n    // some numeric styles.\n    this.in_cite_predecessor = false;\n    //\n    // stack flag used to control jumps in the closing\n    // token of a conditional.\n    this.jump = new CSL.Stack(0, CSL.LITERAL);\n    //\n    // holds string parameters for group formatting, between\n    // the start of a group and the closing token.\n    this.decorations = new CSL.Stack();\n    //\n    // token store stack.\n    this.tokenstore_stack = new CSL.Stack();\n\n    // for collapsing\n    this.last_suffix_used = \"\";\n    this.last_names_used = [];\n    this.last_years_used = [];\n    this.years_used = [];\n    this.names_used = [];\n\n    this.taintedItemIDs = {};\n    this.taintedCitationIDs = {};\n    //\n    // scratch stack containing initialize-with strings or null values\n    this.initialize_with = new CSL.Stack();\n    //\n    // this is used to set a requested set of\n    // disambiguation parameters in the output.\n    // for the array elements, the base array\n    // (either zero for each nameset, or full-up\n    // if givens are already used) is set\n    // during names processing, if no value\n    // is set in the processor before a rendering\n    // run.  to simplify things for the calling\n    // function, these are just bog-standard arrays,\n    // and can be safely overwritten.\n    this.disambig_request = false;\n    //\n    // scratch variable to toggle an attempt to set a\n    // name in sort order rather than display\n    // order.\n    this[\"name-as-sort-order\"] = false;\n    //\n    // suppress decorations (used for generating\n    // sort keys and disambiguation keys)\n    this.suppress_decorations = false;\n    //\n    // empty settings array, used to report settings used\n    // if disambig_request is not set at runtime\n    this.disambig_settings = new CSL.AmbigConfig();\n    //\n    // sort key array\n    this.bib_sort_keys = [];\n    //\n    // holds the prefix between the start of a group\n    // and the closing token.\n    this.prefix = new CSL.Stack(\"\", CSL.LITERAL);\n    //\n    // holds the suffix between the start of a group\n    // and the closing token.\n    this.suffix = new CSL.Stack(\"\", CSL.LITERAL);\n    //\n    // holds the group delimiter between the start of a group\n    // and the closing token.\n    this.delimiter = new CSL.Stack(\"\", CSL.LITERAL);\n    //\n    // Used for conditional locale switching.\n    this.cite_locales = [];\n    this.cite_affixes = {\n        citation: false, \n        bibliography: false,\n        citation_sort: false, \n        bibliography_sort: false\n    };\n    this.strip_periods = 0;\n    this.shadow_numbers = {};\n    this.authority_stop_last = 0;\n    this.loadedItemIDs = {};\n    //\n    // Push/pop array for set/unset of opt.lang setting, used\n    // in if locale=\"XX\" to force terms to language of item.\n    // @locale tests track their nesting level in a counter,\n    // and push the current value of state.opt.lang to one array,\n    // and the counter value to another. On the way back up,\n    // closing node decrements the counter, compares its value\n    // with the trailing value on the array, and pops both\n    // arrays, resetting state.opt.lang to the previous value.\n    // A hack to solve a surprisingly difficult problem caused\n    // by the use of an execution stack for the nested structure.\n    this.condition_counter = 0; //incremented/decremented on ALL conditions\n    this.condition_lang_val_arr = [];\n    this.condition_lang_counter_arr = [];\n};\n\n\nCSL.Engine.Fun = function (state) {\n    //\n    // matcher\n    this.match = new CSL.Util.Match();\n    //\n    // utility to get standard suffixes for disambiguation\n    this.suffixator = new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);\n    //\n    // utility to romanize a numeric value\n    this.romanizer = new CSL.Util.Romanizer();\n    //\n    // utility to make an ordinal form of a number\n    this.ordinalizer = new CSL.Util.Ordinalizer(state);\n    //\n    // utility to make the long ordinal form of a number, if possible\n    this.long_ordinalizer = new CSL.Util.LongOrdinalizer();\n};\n\n\nCSL.Engine.Build = function () {\n    // Alternate et-al term\n    // Holds the localization key of the alternative term\n    // to be used for et-al in a names environment.  Reduced\n    // to a term object when the element tag is processed during\n    // Build.\n    this[\"alternate-term\"] = false;\n    //\n    // flags that we are in the bibliography area.\n    // used by sort.\n    this.in_bibliography = false;\n    //\n    // scratch variable to alter behaviour when processing\n    // locale files\n    this.in_style = false;\n    //\n    // used to ignore info\n    this.skip = false;\n    //\n    // the macro ATTRIBUTE stores a macro name on this\n    // scratch variable anywhere outside the layout area\n    // during build.  The macro name is picked up when\n    // the token is encountered inside the layout area,\n    // either through a direct call, or as part of a nested\n    // macro expansion, and the macro content is exploded\n    // into the token list.\n    this.postponed_macro = false;\n    //\n    // used especially for controlling macro expansion\n    // during Build.\n    this.layout_flag = false;\n    //\n    // (was buffer_name)\n    // scratch variable to hold the name of a macro\n    // or a term until its children have been collected.\n    this.name = false;\n    this.names_variables = [[]];\n    this.name_label = [{}];\n    //\n    // scratch variable to hold the value of a form\n    // attribute until other attributes needed for\n    // processing have been collected.\n    this.form = false;\n    this.term = false;\n    //\n    // the macros themselves are discarded after Build\n    this.macro = {};\n    //\n    // the macro build stack.  used to raise an error\n    // when macros would attempt to call themselves.\n    this.macro_stack = [];\n    //\n    // stores the content of an XML text node during processing\n    this.text = false;\n    //\n    // this is a scratch variable for holding an attribute\n    // value during processing\n    this.lang = false;\n    //\n    // should be able to run uninitialized; may attract some\n    // cruft this way.\n    this.area = \"citation\";\n    this.root = \"citation\";\n    this.extension = \"\";\n    //\n    // controls the application of implicit conditional wrappers\n    // to top-level elements inside a names substitute span.\n    // zero by default, build of names tag pushes a\n    // new level with value 1.  group start tag increments by 1,\n    // group end tag decrements by 1.  conditional wrappers are\n    // only applied if value is exactly 1.\n    this.substitute_level = new CSL.Stack(0, CSL.LITERAL);\n    this.names_level = 0;\n    this.render_nesting_level = 0;\n    this.render_seen = false;\n    this.bibliography_key_pos = 0;\n};\n\n\nCSL.Engine.Configure = function () {\n    //\n    // the fail and succeed arrays are used for stack\n    // processing during configure.\n    this.tests = [];\n    this.fail = [];\n    this.succeed = [];\n};\n\n\nCSL.Engine.Citation = function (state) {\n     // Citation options area.\n     // Holds a mixture of persistent and ephemeral\n     // options and scratch data used during processing of\n     // a citation.</p>\n    this.opt = {\n        inheritedAttributes: {}\n    };\n\n    this.tokens = [];\n    // Placeholder function\n    this.srt = new CSL.Registry.Comparifier(state, \"citation_sort\");\n    //\n    // configuration array to hold the collapse\n    // options, if any.\n    this.opt.collapse = [];\n    //\n    // disambiguate options\n    this.opt[\"disambiguate-add-names\"] = false;\n    this.opt[\"disambiguate-add-givenname\"] = false;\n    this.opt[\"disambiguate-add-year-suffix\"] = false;\n    this.opt[\"givenname-disambiguation-rule\"] = \"by-cite\";\n    this.opt[\"near-note-distance\"] = 5;\n\n    this.opt.topdecor = [];\n    this.opt.layout_decorations = [];\n    this.opt.layout_prefix = \"\";\n    this.opt.layout_suffix = \"\";\n    this.opt.layout_delimiter = \"\";\n    //\n    // sorting\n    this.opt.sort_locales = [];\n    this.opt.max_number_of_names = 0;\n    this.root = \"citation\";\n};\n\n\nCSL.Engine.Bibliography = function () {\n    this.opt = {\n        inheritedAttributes: {}\n    };\n    this.tokens = [];\n\n    this.opt.collapse = [];\n\n    this.opt.topdecor = [];\n    this.opt.layout_decorations = [];\n    this.opt.layout_prefix = \"\";\n    this.opt.layout_suffix = \"\";\n    this.opt.layout_delimiter = \"\";\n    this.opt[\"line-spacing\"] = 1;\n    this.opt[\"entry-spacing\"] = 1;\n    //\n    // sorting\n    this.opt.sort_locales = [];\n    this.opt.max_number_of_names = 0;\n    this.root = \"bibliography\";\n};\n\n\nCSL.Engine.BibliographySort = function () {\n    this.tokens = [];\n    this.opt = {};\n    this.opt.sort_directions = [];\n    this.opt.topdecor = [];\n    // Holds the final citation-number sort direction, for use\n    // in applying numbers in cs:citation and cs:bibliography.\n    // Value is exclusively controlled by cs:key in bibliography_sort\n    this.opt.citation_number_sort_direction = CSL.ASCENDING;\n    this.opt.citation_number_secondary = false;\n    this.tmp = {};\n    this.keys = [];\n    this.root = \"bibliography\";\n};\n\n\nCSL.Engine.CitationSort = function () {\n    this.tokens = [];\n    this.opt = {};\n    this.opt.sort_directions = [];\n    this.keys = [];\n    this.opt.topdecor = [];\n    this.root = \"citation\";\n};\n\nCSL.Engine.InText = function () {\n     // InText options area.\n     // Holds a mixture of persistent and ephemeral\n     // options and scratch data used during processing of\n     // a citation.</p>\n    this.opt = {\n        inheritedAttributes: {}\n    };\n\n    this.tokens = [];\n    // Placeholder function\n    //this.srt = new CSL.Registry.Comparifier(state, \"citation_sort\");\n    //\n    // configuration array to hold the collapse\n    // options, if any.\n    this.opt.collapse = [];\n    //\n    // disambiguate options\n    this.opt[\"disambiguate-add-names\"] = false;\n    this.opt[\"disambiguate-add-givenname\"] = false;\n    this.opt[\"disambiguate-add-year-suffix\"] = false;\n    this.opt[\"givenname-disambiguation-rule\"] = \"by-cite\";\n    this.opt[\"near-note-distance\"] = 5;\n\n    this.opt.topdecor = [];\n    this.opt.layout_decorations = [];\n    this.opt.layout_prefix = \"\";\n    this.opt.layout_suffix = \"\";\n    this.opt.layout_delimiter = \"\";\n    //\n    // sorting\n    this.opt.sort_locales = [];\n    this.opt.max_number_of_names = 0;\n    this.root = \"intext\";\n};\n\n/*global CSL: true */\n\nCSL.Engine.prototype.previewCitationCluster = function (citation, citationsPre, citationsPost, newMode) {\n    // Generate output for a hypothetical citation at the current position,\n    // Leave the registry in the same state in which it was found.\n    //print(\"################### previewCitationCluster() #################\");\n    var oldMode = this.opt.mode;\n    this.setOutputFormat(newMode);\n    // Avoids generating unwanted ibids, if the citationID already exists in document\n\tif (citation.citationID) {\n\t\tdelete citation.citationID;\n\t}\n    var ret = this.processCitationCluster(citation, citationsPre, citationsPost, CSL.PREVIEW);\n\n    this.setOutputFormat(oldMode);\n    return ret[1];\n};\n\nCSL.Engine.prototype.appendCitationCluster = function (citation) {\n    var citationsPre = [];\n    var len = this.registry.citationreg.citationByIndex.length;\n    for (var pos = 0; pos < len; pos += 1) {\n        var c = this.registry.citationreg.citationByIndex[pos];\n        citationsPre.push([\"\" + c.citationID, c.properties.noteIndex]);\n    }\n    // Drop the data segment to return a list of pos/string pairs.\n    return this.processCitationCluster(citation, citationsPre, [])[1];\n};\n\n\nCSL.Engine.prototype.processCitationCluster = function (citation, citationsPre, citationsPost, flag) {\n    var c, preCitation, postCitation, i, ilen, j, jlen, k, klen, n, nlen, key, Item, item, noteCitations, textCitations, m, citationsInNote;\n    this.debug = false;\n    this.tmp.loadedItemIDs = {};\n\n    // Revert citation dereference from 2ffc4664ae\n    //citation = JSON.parse(JSON.stringify(citation));\n    \n    //print(\"################### processCitationCluster() #################\");\n    this.tmp.citation_errors = [];\n    this.registry.return_data = {\"bibchange\": false};\n\n    // make sure this citation has a unique ID, and register it in citationById.\n    this.setCitationId(citation);\n\n    var oldCitationList;\n    var oldItemList;\n    var oldAmbigs;\n    if (flag === CSL.PREVIEW) {\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start state save *********\");\n        }\n        //SNIP-END\n        //\n        // Simplify.\n\n        // Take a slice of existing citations.\n        oldCitationList = this.registry.citationreg.citationByIndex.slice();\n\n        // Take a slice of current items, for later use with update.\n        oldItemList = this.registry.reflist.slice();\n\n        // Make a list of preview citation ref objects. Omit the current\n        // citation, because it will not exist in registry if: (a) this is\n        // a new citation; or (b) the calling application is assigning\n        // new citationIDs for every transaction.\n        var newCitationList = citationsPre.concat(citationsPost);\n\n        // Make a full list of desired ids, for use in preview update,\n        // and a hash list of same while we're at it.\n        // First step through known citations, then step through\n        // the items in the citation for preview.\n        var newItemIds = {};\n        var newItemIdsList = [];\n        for (var i = 0, ilen = newCitationList.length; i < ilen; i += 1) {\n            c = this.registry.citationreg.citationById[newCitationList[i][0]];\n            for (j = 0, jlen = c.citationItems.length; j < jlen; j += 1) {\n                newItemIds[c.citationItems[j].id] = true;\n                newItemIdsList.push(\"\" + c.citationItems[j].id);\n            }\n        }\n        for (j = 0, jlen = citation.citationItems.length; j < jlen; j += 1) {\n            newItemIds[citation.citationItems[j].id] = true;\n            newItemIdsList.push(\"\" + citation.citationItems[j].id);\n        }\n\n        // Clone and save off disambigs of items that will be lost.\n        oldAmbigs = {};\n        for (var i = 0, ilen = oldItemList.length; i < ilen; i += 1) {\n            if (!newItemIds[oldItemList[i].id]) {\n                var oldAkey = this.registry.registry[oldItemList[i].id].ambig;\n                var ids = this.registry.ambigcites[oldAkey];\n                if (ids) {\n                    for (j = 0, jlen = ids.length; j < jlen; j += 1) {\n                        oldAmbigs[ids[j]] = CSL.cloneAmbigConfig(this.registry.registry[ids[j]].disambig);\n                    }\n                }\n            }\n        }\n\n        // Update items.  This will produce the base name data and sort things.\n        // Possibly unnecessary?\n        //this.updateItems(this.registry.mylist.concat(tmpItems));\n\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end state save *********\");\n        }\n        //SNIP-END\n    }\n\n    this.tmp.taintedCitationIDs = {};\n    var sortedItems = [];\n\n    // Styles that use note backreferencing with a by-cite\n    // givenname disambiguation rule include the note number\n    // in the cite for disambiguation purposes. Correct resolution\n    // of disambiguate=\"true\" conditions on first-reference cites \n    // in certain editing scenarios (e.g. where a cite is moved across\n    // notes) requires that disambiguation be rerun on cites\n    // affected by the edit.\n    var rerunAkeys = {};\n\n    // retrieve item data and compose items for use in rendering\n    // attach pointer to item data to shared copy for good measure\n    for (var i = 0, ilen = citation.citationItems.length; i < ilen; i += 1) {\n        // Protect against caller-side overwrites to locator strings etc\n        item = {};\n        for (var key in citation.citationItems[i]) {\n            item[key] = citation.citationItems[i][key];\n        }\n        Item = this.retrieveItem(\"\" + item.id);\n        if (Item.id) {\n            this.transform.loadAbbreviation(\"default\", \"hereinafter\", Item.id, Item.language);\n        }\n        item = CSL.parseLocator.call(this, item);\n        if (this.opt.development_extensions.consolidate_legal_items) {\n            this.remapSectionVariable([[Item,item]]);\n        }\n        if (this.opt.development_extensions.locator_label_parse) {\n            if (item.locator && [\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) === -1 && (!item.label || item.label === 'page')) {\n                var m = CSL.LOCATOR_LABELS_REGEXP.exec(item.locator);\n                if (m) {\n                    var tryLabel = CSL.LOCATOR_LABELS_MAP[m[2]];\n                    if (this.getTerm(tryLabel)) {\n                        item.label = tryLabel;\n                        item.locator = m[3];\n                    }\n                }\n            }\n        }\n        var newitem = [Item, item];\n        sortedItems.push(newitem);\n        citation.citationItems[i].item = Item;\n    }\n\n    // ZZZ sort stuff moved from here.\n\n    // attach the sorted list to the citation item\n    citation.sortedItems = sortedItems;\n\n    // build reconstituted citations list in current document order\n    var citationByIndex = [];\n    var citationById = {};\n    var lastNotePos;\n    for (i=0, ilen=citationsPre.length; i<ilen; i += 1) {\n        preCitation = citationsPre[i];\n        if (this.opt.development_extensions.strict_inputs) {\n            if (citationById[preCitation[0]]) {\n                CSL.error(\"Previously referenced citationID \" + preCitation[0] + \" encountered in citationsPre\");\n            }\n            if (preCitation[1]) {\n                if (lastNotePos > preCitation[1]) {\n                    CSL.debug(\"Note index sequence is not sane at citationsPre[\" + i + \"]\");\n                }\n                lastNotePos = preCitation[1];\n            }\n        }\n        this.registry.citationreg.citationById[preCitation[0]].properties.noteIndex = preCitation[1];\n        citationByIndex.push(this.registry.citationreg.citationById[preCitation[0]]);\n        citationById[preCitation[0]] = this.registry.citationreg.citationById[preCitation[0]];\n    }\n    if (!citation.properties) {\n        citation.properties = {\n            noteIndex: 0\n        };\n    }\n    if (this.opt.development_extensions.strict_inputs) {\n        if (citationById[citation.citationID]) {\n            CSL.error(\"Citation with previously referenced citationID \" + citation.citationID);\n        }\n        if (citation.properties.noteIndex) {\n            if (lastNotePos > citation.properties.noteIndex) {\n                CSL.debug(\"Note index sequence is not sane for citation \" + citation.citationID);\n            }\n            lastNotePos = citation.properties.noteIndex;\n        }\n    }\n    citationByIndex.push(citation);\n    citationById[citation.citationID] = citation;\n    for (i=0, ilen=citationsPost.length; i<ilen; i += 1) {\n        postCitation = citationsPost[i];\n        if (this.opt.development_extensions.strict_inputs) {\n            if (citationById[postCitation[0]]) {\n                CSL.error(\"Previously referenced citationID \" + postCitation[0] + \" encountered in citationsPost\");\n            }\n            if (postCitation[1]) {\n                if (lastNotePos > postCitation[1]) {\n                    CSL.debug(\"Note index sequence is not sane at postCitation[\" + i + \"]\");\n                }\n                lastNotePos = postCitation[1];\n            }\n        }\n        this.registry.citationreg.citationById[postCitation[0]].properties.noteIndex = postCitation[1];\n        citationByIndex.push(this.registry.citationreg.citationById[postCitation[0]]);\n        citationById[postCitation[0]] = this.registry.citationreg.citationById[postCitation[0]];\n    }\n    this.registry.citationreg.citationByIndex = citationByIndex;\n    this.registry.citationreg.citationById = citationById;\n\n    //\n    // The processor provides three facilities to support\n    // updates following position reevaluation.\n    //\n    // (1) The updateItems() function reports tainted ItemIDs\n    // to state.tmp.taintedItemIDs.\n    //\n    // (2) The processor memos the type of style referencing as\n    // CSL.NONE, CSL.NUMERIC or CSL.POSITION in state.opt.update_mode.\n    //\n    // XXXX: NO LONGER\n    // (3) For citations containing cites with backreference note numbers,\n    // a string image of the rendered citation is held in\n    // citation.properties.backref_citation, and a list of\n    // ItemIDs to be used to update the backreference note numbers\n    // is memoed at citation.properties.backref_index.  When such\n    // citations change position, they can be updated with a\n    // series of simple find and replace operations, without\n    // need for rerendering.\n    //\n\n    //\n    // Position evaluation!\n    //\n    // set positions in reconstituted list, noting taints\n    this.registry.citationreg.citationsByItemId = {};\n    if (this.opt.update_mode === CSL.POSITION) {\n        textCitations = [];\n        noteCitations = [];\n        citationsInNote = {};\n    }\n    var update_items = [];\n    for (var i = 0, ilen = citationByIndex.length; i < ilen; i += 1) {\n        citationByIndex[i].properties.index = i;\n        for (j = 0, jlen = citationByIndex[i].sortedItems.length; j < jlen; j += 1) {\n            item = citationByIndex[i].sortedItems[j];\n            if (!this.registry.citationreg.citationsByItemId[item[1].id]) {\n                this.registry.citationreg.citationsByItemId[item[1].id] = [];\n                update_items.push(\"\" + item[1].id);\n            }\n            if (this.registry.citationreg.citationsByItemId[item[1].id].indexOf(citationByIndex[i]) === -1) {\n                this.registry.citationreg.citationsByItemId[item[1].id].push(citationByIndex[i]);\n            }\n        }\n        if (this.opt.update_mode === CSL.POSITION) {\n            if (citationByIndex[i].properties.noteIndex) {\n                noteCitations.push(citationByIndex[i]);\n            } else {\n                citationByIndex[i].properties.noteIndex = 0;\n                textCitations.push(citationByIndex[i]);\n            }\n        }\n    }\n    //\n    // update bibliography items here\n    //\n    if (flag !== CSL.ASSUME_ALL_ITEMS_REGISTERED) {\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start update items *********\");\n        }\n        //SNIP-END\n        // true signals implicit updateItems (will not rerun sys.retrieveItem())\n        this.updateItems(update_items, null, null, true);\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** endo update items *********\");\n        }\n        //SNIP-END\n    }\n\n    if (!this.opt.citation_number_sort && sortedItems && sortedItems.length > 1 && this.citation_sort.tokens.length > 0) {\n        for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n            sortedItems[i][1].sortkeys = CSL.getSortKeys.call(this, sortedItems[i][0], \"citation_sort\");\n        }\n\n        /* \n         * Grouped sort stuff (start)\n         */\n\n        if (this.opt.grouped_sort &&  !citation.properties.unsorted) {\n            // Insert authorstring as key.\n            for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n                var sortkeys = sortedItems[i][1].sortkeys;\n                this.tmp.authorstring_request = true;\n                // Run getAmbiguousCite() with the current disambig\n                // parameters, and pick up authorstring from the registry.\n                var mydisambig = this.registry.registry[sortedItems[i][0].id].disambig;\n                \n                this.tmp.authorstring_request = true;\n                CSL.getAmbiguousCite.call(this, sortedItems[i][0], mydisambig);\n                var authorstring = this.registry.authorstrings[sortedItems[i][0].id];\n                this.tmp.authorstring_request = false;\n\n                sortedItems[i][1].sortkeys = [authorstring].concat(sortkeys);\n            }\n\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n            // Replace authorstring key in items with same (authorstring) with the \n            // keystring of first normal key. This forces grouped sorts,\n            // as discussed here:\n            // https://github.com/citation-style-language/schema/issues/40\n            var lastauthor = false;\n            var thiskey = false;\n            var thisauthor = false;\n            for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n                if (sortedItems[i][1].sortkeys[0] !== lastauthor) {\n                    thisauthor = sortedItems[i][1].sortkeys[0];\n                    thiskey =  sortedItems[i][1].sortkeys[1];\n                }\n                sortedItems[i][1].sortkeys[0] = \"\" + thiskey + i;\n                lastauthor = thisauthor;\n            }\n        }\n        /*\n         * Grouped sort stuff (end)\n         */\n\n        if (!citation.properties.unsorted) {\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n        }\n    }\n\n    // evaluate parallels\n\n    if (this.opt.parallel.enable) {\n        this.parallel.StartCitation(citation.sortedItems);\n    }\n\n    var citations;\n    if (this.opt.update_mode === CSL.POSITION) {\n        for (var i = 0; i < 2; i += 1) {\n            var first_ref = {};\n            var last_ref = {};\n            var first_container_ref = {};\n            citations = [textCitations, noteCitations][i];\n            for (j = 0, jlen = citations.length; j < jlen; j += 1) {\n                var onecitation = citations[j];\n                if (!citations[j].properties.noteIndex) {\n                    citations[j].properties.noteIndex = 0;\n                }\n                citations[j].properties.noteIndex = parseInt(citations[j].properties.noteIndex, 10);\n                if (j > 0 && onecitation.properties.noteIndex && citations[j - 1].properties.noteIndex > onecitation.properties.noteIndex) {\n                    citationsInNote = {};\n                    first_ref = {};\n                    last_ref = {};\n                    first_container_ref = {};\n                }\n                for (k = 0, klen = onecitation.sortedItems.length; k < klen; k += 1) {\n                    if (onecitation.sortedItems[k][1].parallel && onecitation.sortedItems[k][1].parallel !== \"first\") {\n                        continue;\n                    }\n                    if (!citationsInNote[onecitation.properties.noteIndex]) {\n                        citationsInNote[onecitation.properties.noteIndex] = 1;\n                    } else {\n                        citationsInNote[onecitation.properties.noteIndex] += 1;\n                    }\n                }\n                // Set the following:\n                //\n                // (1) position as required (as per current Zotero)\n                // (2) first-reference-note-number as required (on onecitation item)\n                // (3) near-note as required (on onecitation item, according to\n                //     state.opt[\"near-note-distance\"] parameter)\n                // (4) state.registry.citationreg.citationsByItemId.\n                //\n                // Any state changes caused by unsetting or resetting should\n                // trigger a single entry for the citations in\n                // state.tmp.taintedCitationIDs (can block on presence of\n                // state.registry.citationreg.citationsByItemId).\n                //\n                for (k = 0, klen = citations[j].sortedItems.length; k < klen; k += 1) {\n                    item = citations[j].sortedItems[k];\n                    // Okay ...\n                    // We set up three IDs for use in position evaluation.\n                    // item_id is the real Item.id\n                    // first_id is the legislation_id or Item.id (so statutes backref to first in set, chapters to specific chapter)\n                    // last_id is the legislation_id or container_id (so statute AND chapter distance is from any ref in set)\n                    // (replaces myid)\n                    var item_id = item[0].id;\n                    var first_id = item[0].legislation_id ? item[0].legislation_id : item[0].id;\n                    var last_id = item[0].legislation_id ? item[0].legislation_id : item[0].container_id ? item[0].container_id : item[0].id;\n                    var myxloc = item[1][\"locator-extra\"];\n                    var mylocator = item[1].locator;\n                    var mylabel = item[1].label;\n                    var incitationid;\n                    var incitationxloc;\n                    if (k > 0) {\n                        // incitationid is only reached in the else branch\n                        // following \"undefined\" === typeof first_ref[myid]\n                        // below\n                        if (onecitation.sortedItems[k - 1][0].legislation_id) {\n                            incitationid = onecitation.sortedItems[k - 1][0].legislation_id;\n                        } else {\n                            incitationid = onecitation.sortedItems[k - 1][1].id;\n                            incitationxloc = onecitation.sortedItems[k - 1][1][\"locator-extra\"];\n                            //if (onecitation.sortedItems[k-1][1].parallel === \"last\") {\n                                for (var l=k-2; l>-1; l--) {\n                                    if (onecitation.sortedItems[l][1].parallel === \"first\") {\n                                        incitationid = onecitation.sortedItems[l][1].id;\n                                        incitationxloc = onecitation.sortedItems[l][1][\"locator-extra\"];\n                                    }\n                                }\n                            //}\n                        }\n                    }\n                    // Don't touch item data of other cites when previewing\n                    if (flag === CSL.PREVIEW) {\n                        if (onecitation.citationID != citation.citationID) {\n                            if (\"undefined\" === typeof first_ref[item[1].id]) {\n                                first_ref[first_id] = onecitation.properties.noteIndex;\n                                last_ref[last_id] = onecitation.properties.noteIndex;\n                            } else {\n                                last_ref[last_id] = onecitation.properties.noteIndex;\n                            }\n                            continue;\n                        }\n                    }\n                    var oldvalue = {};\n                    oldvalue.position = item[1].position;\n                    oldvalue[\"first-reference-note-number\"] = item[1][\"first-reference-note-number\"];\n                    oldvalue[\"first-container-reference-note-number\"] = item[1][\"first-container-reference-note-number\"];\n                    oldvalue[\"near-note\"] = item[1][\"near-note\"];\n                    item[1][\"first-reference-note-number\"] = 0;\n                    item[1][\"first-container-reference-note-number\"] = 0;\n                    item[1][\"near-note\"] = false;\n                    if (this.registry.citationreg.citationsByItemId[item_id]) {\n                        if (this.opt.xclass === 'note' && this.opt.has_disambiguate) {\n                            var oldCount = this.registry.registry[item[0].id][\"citation-count\"];\n                            var newCount = this.registry.citationreg.citationsByItemId[item_id].length;\n                            this.registry.registry[item[0].id][\"citation-count\"] = this.registry.citationreg.citationsByItemId[item_id].length;\n                            if (\"number\" === typeof oldCount) {\n                                var oldCountCheck = (oldCount < 2);\n                                var newCountCheck = (newCount < 2);\n                                if (oldCountCheck !== newCountCheck) {\n                                    for (var l=0,llen=this.registry.citationreg.citationsByItemId[item_id].length;l<llen;l++) {\n                                        rerunAkeys[this.registry.registry[item[0].id].ambig] = true;\n                                        this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[item_id][l].citationID] = true;\n                                    }\n                                }\n                            } else {\n                                for (var l=0,llen=this.registry.citationreg.citationsByItemId[item_id].length;l<llen;l++) {\n                                    rerunAkeys[this.registry.registry[item[0].id].ambig] = true;\n                                    this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[item_id][l].citationID] = true;\n                                }\n                            }\n                        }\n                    }\n                    var oldlastid;\n                    var oldlastxloc;\n                    \n                    // Okay, chill.\n                    // The first test needs to be for presence of last_ref[last_id]. Everything\n                    // after in subsequent evaluation depends on that.\n\n                    // HOWEVER, despite starting with this test, we need to catch every member\n                    // of the set, and set its first-container-reference-note-number to point at the\n                    // first.\n\n                    // ALSO, despite starting with this test, we need to set first-reference-note-number\n                    // on every item.\n                    \n                    // So ... we run an independent test on first_ref[first_id]], and let this ride.\n                    \n                    if (\"undefined\" === typeof last_ref[last_id] && onecitation.properties.mode !== \"author-only\") {\n                        first_ref[first_id] = onecitation.properties.noteIndex;\n                        last_ref[last_id] = onecitation.properties.noteIndex;\n                        first_container_ref[last_id] = onecitation.properties.noteIndex;\n                        item[1].position = CSL.POSITION_FIRST;\n                    } else {\n                        //\n                        // backward-looking position evaluation happens here.\n                        //\n                        //\n                        //\n                        var ibidme = false;\n                        var suprame = false;\n                        var prevCitation = null;\n                        if (j > 0) {\n                            var prevCitation = citations[j-1];\n                        }\n                        var thisCitation = citations[j];\n                        // XXX Ugly, but This is used in the second else-if branch condition below.\n                        if (j > 0) {\n                            var old_last_id_offset = 1;\n                            if (prevCitation.properties.mode === \"author-only\" && j > 1) {\n                                old_last_id_offset = 2;\n                            }\n                            var adjusted_offset = (j - old_last_id_offset);\n                            if (citations[adjusted_offset].sortedItems.length) {\n                                oldlastid =  citations[adjusted_offset].sortedItems.slice(-1)[0][1].id;\n                                oldlastxloc =  citations[j - old_last_id_offset].sortedItems.slice(-1)[0][1][\"locator-extra\"];\n                            }\n                            if (prevCitation.sortedItems.length) {\n                                if (prevCitation.sortedItems[0].slice(-1)[0].legislation_id) {\n                                    oldlastid = prevCitation.sortedItems[0].slice(-1)[0].legislation_id;\n                                }\n                            }\n                        }\n                        if (j > 0 && k === 0 && prevCitation.properties.noteIndex !== thisCitation.properties.noteIndex) {\n                            // Case 1: source in previous onecitation\n                            // (1) Threshold conditions\n                            //     (a) there must be a previous onecitation with one item\n                            //     (b) this item must be the first in this onecitation\n                            //     (c) the previous onecitation must contain a reference\n                            //         to the same item ...\n                            //     (d) the note numbers must be the same or consecutive.\n                            // (this has some jiggery-pokery in it for parallels)\n                            var useme = false;\n                            // XXX Can oldid be equated with oldlastid, I wonder ...\n                            var oldid = prevCitation.sortedItems[0][0].id;\n                            if (prevCitation.sortedItems[0][0].legislation_id) {\n                                oldid = prevCitation.sortedItems[0][0].legislation_id;\n                            }\n                            if ((oldid  == first_id && prevCitation.properties.noteIndex >= (thisCitation.properties.noteIndex - 1))) {\n                                var prevxloc = prevCitation.sortedItems[0][1][\"locator-extra\"];\n                                var thisxloc = thisCitation.sortedItems[0][1][\"locator-extra\"];\n                                if ((citationsInNote[prevCitation.properties.noteIndex] === 1 || prevCitation.properties.noteIndex === 0) && prevxloc === thisxloc) {\n                                    useme = true;\n                                }\n                            }\n                            if (useme) {\n                                ibidme = true;\n                            } else {\n                                suprame = true;\n                            }\n                        } else if (k > 0 && incitationid == first_id && incitationxloc == myxloc) {\n                            // Case 2: immediately preceding source in this onecitation\n                            // (1) Threshold conditions\n                            //     (a) there must be an imediately preceding reference to  the\n                            //         same item in this onecitation; and\n                            ibidme = true;\n                        } else if (k === 0 && j > 0 && prevCitation.properties.noteIndex == thisCitation.properties.noteIndex\n                                   && prevCitation.sortedItems.length \n                                   && oldlastid == first_id && oldlastxloc == myxloc) {\n                            // ... in case there are separate citations in the same note ...\n                            // Case 2 [take 2]: immediately preceding source in this onecitation\n                            // (1) Threshold conditions\n                            //     (a) there must be an imediately preceding reference to  the\n                            //         same item in this onecitation; and\n                            ibidme = true;\n                        } else {\n                            // everything else is definitely subsequent\n                            suprame = true;\n                        }\n                        // conditions\n                        var prev, prev_locator, prev_label, curr_locator, curr_label;\n                        if (ibidme) {\n                            if (k > 0) {\n                                prev = onecitation.sortedItems[(k - 1)][1];\n                            } else {\n                                prev = citations[(j - 1)].sortedItems[0][1];\n                            }\n                            if (prev.locator) {\n                                if (prev.label) {\n                                    prev_label = prev.label;\n                                } else {\n                                    prev_label = \"\";\n                                }\n                                prev_locator = \"\" + prev.locator + prev_label;\n                            } else {\n                                prev_locator = prev.locator;\n                            }\n                            if (mylocator) {\n                                if (mylabel) {\n                                    curr_label = mylabel;\n                                } else {\n                                    curr_label = \"\";\n                                }\n                                curr_locator = \"\" + mylocator + curr_label;\n                            } else {\n                                curr_locator = mylocator;\n                            }\n                        }\n                        // triage\n                        if (ibidme && prev_locator && !curr_locator) {\n                            ibidme = false;\n                            suprame = true;\n\n                        }\n                        if (ibidme) {\n                            if (!prev_locator && curr_locator) {\n                                //     (a) if the previous onecitation had no locator\n                                //         and this onecitation has one, use ibid+pages\n                                item[1].position = CSL.POSITION_IBID_WITH_LOCATOR;\n                            } else if (!prev_locator && !curr_locator) {\n                                //     (b) if the previous onecitation had no locator\n                                //         and this onecitation also has none, use ibid\n                                item[1].position = CSL.POSITION_IBID;\n                                //print(\"setting ibid in cmd_cite()\");\n                            } else if (prev_locator && curr_locator === prev_locator) {\n                                //     (c) if the previous onecitation had a locator\n                                //         (page number, etc.) and this onecitation has\n                                //         a locator that is identical, use ibid\n\n                                item[1].position = CSL.POSITION_IBID;\n                                //print(\"setting ibid in cmd_cite() [2]\");\n                            } else if (prev_locator && curr_locator && curr_locator !== prev_locator) {\n                                //     (d) if the previous onecitation had a locator,\n                                //         and this onecitation has one that differs,\n                                //         use ibid+pages\n                                item[1].position = CSL.POSITION_IBID_WITH_LOCATOR;\n                            } else {\n                                //     (e) if the previous onecitation had a locator\n                                //         and this onecitation has none, use subsequent\n                                //\n                                //     ... and everything else would be subsequent also\n                                ibidme = false; // just to be clear\n                                suprame = true;\n                            }\n                        }\n                        if (suprame) {\n                            item[1].position = CSL.POSITION_CONTAINER_SUBSEQUENT;\n                            if (\"undefined\" === typeof first_ref[first_id]) {\n                                first_ref[first_id] = onecitation.properties.noteIndex;\n                            } else {\n                                item[1].position = CSL.POSITION_SUBSEQUENT;\n                            }\n                        }\n                        if (suprame || ibidme) {\n                            if (onecitation.properties.mode === \"author-only\") {\n                                item[1].position = CSL.POSITION_FIRST;\n                            }\n                            if (first_container_ref[last_id] != onecitation.properties.noteIndex) {\n                                item[1]['first-container-reference-note-number'] = first_container_ref[last_id];\n                                if (this.registry.registry[item[0].id]) {\n                                    this.registry.registry[item[0].id]['first-container-reference-note-number'] = first_container_ref[last_id];\n                                }\n                            }\n                            if (first_ref[first_id] != onecitation.properties.noteIndex) {\n                                item[1][\"first-reference-note-number\"] = first_ref[first_id];\n                                if (this.registry.registry[item[0].id]) {\n                                    // This is either the earliest recorded number, or the number of the current citation, whichever is smaller.\n                                    /*\n                                    var oldFirst = this.registry.citationreg.citationsByItemId[item_id][0].properties.noteIndex;\n                                    var newFirst = onecitation.properties.noteIndex;\n                                    this.registry.registry[item[0].id]['first-reference-note-number'] = newFirst < oldFirst ? newFirst: oldFirst;\n                                     */\n                                    // Try this instead?\n                                    this.registry.registry[item[0].id]['first-reference-note-number'] = first_ref[first_id];\n                                }\n                            }\n                        }\n                    }\n                    if (onecitation.properties.noteIndex) {\n                        var note_distance = parseInt(onecitation.properties.noteIndex, 10) - parseInt(last_ref[last_id], 10);\n                        if (item[1].position !== CSL.POSITION_FIRST \n                            && note_distance <= this.citation.opt[\"near-note-distance\"]) {\n                            item[1][\"near-note\"] = true;\n                        }\n                        last_ref[last_id] = onecitation.properties.noteIndex;\n                    } else if (item[1].position !== CSL.POSITION_FIRST) {\n                        item[1][\"near-note\"] = true;\n                    }\n                    if (onecitation.citationID != citation.citationID) {\n                        for (n = 0, nlen = CSL.POSITION_TEST_VARS.length; n < nlen; n += 1) {\n                            var param = CSL.POSITION_TEST_VARS[n];\n                            if (item[1][param] !== oldvalue[param]) {\n                                if (this.registry.registry[item[0].id]) {\n                                    if (param === 'first-reference-note-number') {\n                                        rerunAkeys[this.registry.registry[item[0].id].ambig] = true;\n                                        this.tmp.taintedItemIDs[item[0].id] = true;\n                                    }\n                                }\n                                this.tmp.taintedCitationIDs[onecitation.citationID] = true;\n                            }\n                        }\n                    }\n                    if (this.sys.variableWrapper) {\n                        item[1].index = onecitation.properties.index;\n                        item[1].noteIndex = onecitation.properties.noteIndex;\n                    }\n                }\n            }\n        }\n    }\n    if (this.opt.citation_number_sort && sortedItems && sortedItems.length > 1 && this.citation_sort.tokens.length > 0) {\n        if (!citation.properties.unsorted) {\n            for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n                sortedItems[i][1].sortkeys = CSL.getSortKeys.call(this, sortedItems[i][0], \"citation_sort\");\n            }\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n        }\n    }\n    for (var key in this.tmp.taintedItemIDs) {\n        if (this.tmp.taintedItemIDs.hasOwnProperty(key)) {\n            citations = this.registry.citationreg.citationsByItemId[key];\n            // Current citation may be tainted but will not exist\n            // during previewing.\n            if (citations) {\n                for (var i = 0, ilen = citations.length; i < ilen; i += 1) {\n                    this.tmp.taintedCitationIDs[citations[i].citationID] = true;\n                }\n            }\n        }\n    }\n\n    var ret = [];\n    if (flag === CSL.PREVIEW) {\n        // If previewing, return only a rendered string\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start run processor *********\");\n        }\n        //SNIP-END\n        try {\n            ret = this.process_CitationCluster.call(this, citation.sortedItems, citation);\n        } catch (e) {\n            CSL.error(\"Error running CSL processor for preview: \"+e);\n        }\n            \n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end run processor *********\");\n            CSL.debug(\"****** start state restore *********\");\n        }\n        //SNIP-END\n        // Wind out anything related to new items added for the preview.\n        // This means (1) names, (2) disambig state for affected items,\n        // (3) keys registered in the ambigs pool arrays, and (4) registry\n        // items.\n        //\n\n        // restore sliced citations\n        this.registry.citationreg.citationByIndex = oldCitationList;\n        this.registry.citationreg.citationById = {};\n        for (var i = 0, ilen = oldCitationList.length; i < ilen; i += 1) {\n            this.registry.citationreg.citationById[oldCitationList[i].citationID] = oldCitationList[i];\n        }\n\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start final update *********\");\n        }\n        //SNIP-END\n        var oldItemIds = [];\n        for (var i = 0, ilen = oldItemList.length; i < ilen; i += 1) {\n            oldItemIds.push(\"\" + oldItemList[i].id);\n        }\n        this.updateItems(oldItemIds, null, null, true);\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end final update *********\");\n        }\n        //SNIP-END\n        // Roll back disambig states\n        for (var key in oldAmbigs) {\n            if (oldAmbigs.hasOwnProperty(key)) {\n                this.registry.registry[key].disambig = oldAmbigs[key];\n            }\n        }\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end state restore *********\");\n        }\n        //SNIP-END\n    } else {\n        // Rerun cites that have moved across citations or had a change\n        // in their number of subsequent references, so that disambiguate\n        // and subsequent-reference-count conditions are applied\n        // correctly in output.\n        for (var rerunAkey in rerunAkeys) {\n            this.disambiguate.run(rerunAkey, citation);\n        }\n        // Run taints only if not previewing\n        //\n        // Push taints to the return object\n        //\n        var obj;\n        for (var key in this.tmp.taintedCitationIDs) {\n            if (key == citation.citationID) {\n                continue;\n            }\n            var mycitation = this.registry.citationreg.citationById[key];\n            if (!mycitation.properties.unsorted) {\n                for (var i = 0, ilen = mycitation.sortedItems.length; i < ilen; i += 1) {\n                    mycitation.sortedItems[i][1].sortkeys = CSL.getSortKeys.call(this, mycitation.sortedItems[i][0], \"citation_sort\");\n                }\n                mycitation.sortedItems.sort(this.citation.srt.compareCompositeKeys);\n            }\n            // For error reporting\n            this.tmp.citation_pos = mycitation.properties.index;\n            this.tmp.citation_note_index = mycitation.properties.noteIndex;\n            this.tmp.citation_id = \"\" + mycitation.citationID;\n            obj = [];\n            obj.push(mycitation.properties.index);\n            obj.push(this.process_CitationCluster.call(this, mycitation.sortedItems, mycitation));\n            obj.push(mycitation.citationID);\n            ret.push(obj);\n        }\n        this.tmp.taintedItemIDs = {};\n        this.tmp.taintedCitationIDs = {};\n\n        // For error reporting again\n        this.tmp.citation_pos = citation.properties.index;\n        this.tmp.citation_note_index = citation.properties.noteIndex;\n        this.tmp.citation_id = \"\" + citation.citationID;\n\n        obj = [];\n        obj.push(citationsPre.length);\n        obj.push(this.process_CitationCluster.call(this, sortedItems, citation));\n        obj.push(citation.citationID);\n        ret.push(obj);\n        //\n        // note for posterity: Rhino and Spidermonkey produce different\n        // sort results for items with matching keys.  That discrepancy\n        // turned up a subtle bug in the parallel detection code, trapped\n        // at line 266, above, and in line 94 of util_parallel.js.\n        //\n        ret.sort(function (a, b) {\n            if (a[0] > b[0]) {\n                return 1;\n            } else if (a[0] < b[0]) {\n                return -1;\n            } else {\n                return 0;\n            }\n        });\n        //\n        // In normal rendering, return is a list of two-part arrays, with the first element\n        // a citation index number, and the second the text to be inserted.\n        //\n    }\n    this.registry.return_data.citation_errors = this.tmp.citation_errors.slice();\n    return [this.registry.return_data, ret];\n};\n\nCSL.Engine.prototype.process_CitationCluster = function (sortedItems, citation) {\n    var str = \"\";\n    if (citation && citation.properties && citation.properties.mode === \"composite\") {\n        citation.properties.mode = \"author-only\";\n        var firstChunk = CSL.getCitationCluster.call(this, sortedItems, citation);\n        citation.properties.mode = \"suppress-author\";\n        var secondChunk = \"\";\n        if (citation.properties.infix) {\n            this.output.append(citation.properties.infix);\n            secondChunk = this.output.string(this, this.output.queue);\n            // Had no idea this could return a single-element array! Go figure.\n            if (\"object\" === typeof secondChunk) {\n                secondChunk = secondChunk.join(\"\");\n            }\n        }\n        var thirdChunk = CSL.getCitationCluster.call(this, sortedItems, citation);\n        citation.properties.mode = \"composite\";\n        if (firstChunk && secondChunk && CSL.SWAPPING_PUNCTUATION.concat([\"\\u2019\", \"\\'\"]).indexOf(secondChunk[0]) > -1) {\n            firstChunk += secondChunk;\n            secondChunk = false;\n        }\n        str = [firstChunk, secondChunk, thirdChunk].filter(function(obj) {\n            return obj;\n        }).join(\" \");\n    } else {\n        str = CSL.getCitationCluster.call(this, sortedItems, citation);\n    }\n    return str;\n};\n\nCSL.Engine.prototype.makeCitationCluster = function (rawList) {\n    var inputList, newitem, str, pos, len, item, Item;\n    inputList = [];\n    len = rawList.length;\n    for (pos = 0; pos < len; pos += 1) {\n        item = {};\n        for (var key in rawList[pos]) {\n            item[key] = rawList[pos][key];\n        }\n        Item = this.retrieveItem(\"\" + item.id);\n        // Code block is copied from processCitationCluster() above\n        if (this.opt.development_extensions.locator_label_parse) {\n            if (item.locator && [\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) === -1 && (!item.label || item.label === 'page')) {\n                var m = CSL.LOCATOR_LABELS_REGEXP.exec(item.locator);\n                if (m) {\n                    var tryLabel = CSL.LOCATOR_LABELS_MAP[m[2]];\n                    if (this.getTerm(tryLabel)) {\n                        item.label = tryLabel;\n                        item.locator = m[3];\n                    }\n                }\n            }\n        }\n        if (item.locator) {\n            item.locator = (\"\" + item.locator).replace(/\\s+$/, '');\n        }\n        newitem = [Item, item];\n        inputList.push(newitem);\n    }\n    if (this.opt.development_extensions.consolidate_legal_items) {\n        this.remapSectionVariable(inputList);\n    }\n    if (inputList && inputList.length > 1 && this.citation_sort.tokens.length > 0) {\n        len = inputList.length;\n        for (pos = 0; pos < len; pos += 1) {\n            inputList[pos][1].sortkeys = CSL.getSortKeys.call(this, inputList[pos][0], \"citation_sort\");\n        }\n        inputList.sort(this.citation.srt.compareCompositeKeys);\n    }\n    this.tmp.citation_errors = [];\n    var str = CSL.getCitationCluster.call(this, inputList);\n    return str;\n};\n\n\n/**\n * Get the undisambiguated version of a cite, without decorations\n * <p>This is used internally by the Registry.</p>\n *\n * [object] CSL Item\n * [object] disambiguation parameters\n * [boolean] If true, include first-reference-note-number value in cite\n */\nCSL.getAmbiguousCite = function (Item, disambig, visualForm, item) {\n    var ret;\n    var flags = this.tmp.group_context.tip;\n    var oldTermSiblingLayer = {\n        term_intended: flags.term_intended,\n        variable_attempt: flags.variable_attempt,\n        variable_success: flags.variable_success,\n        output_tip: flags.output_tip,\n        label_form: flags.label_form,\n        non_parallel: flags.non_parallel,\n        parallel_last: flags.parallel_last,\n        parallel_first: flags.parallel_first,\n        parallel_last_override: flags.parallel_last_override,\n        parallel_delimiter_override: flags.parallel_delimiter_override,\n        parallel_delimiter_override_on_suppress: flags.parallel_delimiter_override_on_suppress,\n        condition: flags.condition,\n        force_suppress: flags.force_suppress,\n        done_vars: flags.done_vars.slice()\n    };\n    if (disambig) {\n        this.tmp.disambig_request = disambig;\n    } else {\n        this.tmp.disambig_request = false;\n    }\n    var itemSupp = {\n        position: CSL.POSITION_SUBSEQUENT,\n        \"near-note\": true\n    };\n\n    if (item) {\n        itemSupp.locator = item.locator;\n        itemSupp.label = item.label;\n    }\n\n    if (this.registry.registry[Item.id] \n        && this.registry.citationreg.citationsByItemId\n        && this.registry.citationreg.citationsByItemId[Item.id]\n        && this.registry.citationreg.citationsByItemId[Item.id].length \n        && visualForm) {\n        if (this.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\") {\n            itemSupp['first-reference-note-number'] = this.registry.registry[Item.id]['first-reference-note-number'];\n        }\n    }\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    var origSuppressDecorations = this.tmp.suppress_decorations;\n    this.tmp.suppress_decorations = true;\n    this.tmp.just_looking = true;\n\n    CSL.getCite.call(this, Item, itemSupp, null, false);\n    // !!!\n    for (var i=0,ilen=this.output.queue.length;i<ilen;i+=1) {\n        CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[i]);\n    }\n    if (this.opt.development_extensions.clean_up_csl_flaws) {\n        for (var j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            this.output.adjust.upward(this.output.queue[j]);\n            this.output.adjust.leftward(this.output.queue[j]);\n            this.output.adjust.downward(this.output.queue[j]);\n            this.output.adjust.fix(this.output.queue[j]);\n        }\n    }\n    var ret = this.output.string(this, this.output.queue);\n    this.tmp.just_looking = false;\n    this.tmp.suppress_decorations = origSuppressDecorations;\n    // Cache the result.\n    this.tmp.group_context.replace(oldTermSiblingLayer);\n    return ret;\n};\n\n/**\n * Return delimiter for use in join\n * <p>Splice evaluation is done during cite\n * rendering, and this method returns the\n * result.  Evaluation requires three items\n * of information from the preceding cite, if\n * one is present: the names used; the years\n * used; and the suffix appended to the\n * citation.  These details are copied into\n * the state object before processing begins,\n * and are cleared by the processor on\n * completion of the run.</p>\n */\n\nCSL.getSpliceDelimiter = function (last_locator, last_collapsed, pos) {\n    //print(pos +  \" after-collapse-delimiter=\"+this.citation.opt[\"after-collapse-delimiter\"] + \"\\n  cite_group_delimiter=\" + this.tmp.use_cite_group_delimiter + \"\\n  last_collapsed=\" +last_collapsed + \"\\n  have_collapsed=\" +this.tmp.have_collapsed + \"\\n  last_locator=\" + last_locator)\n    if (undefined !== this.citation.opt[\"after-collapse-delimiter\"]) {\n        if (last_locator) {\n            this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n        } else if (last_collapsed && !this.tmp.have_collapsed) {\n            this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n        } else if (!last_collapsed && !this.tmp.have_collapsed && this.citation.opt.collapse !== \"year-suffix\") {\n            this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n        } else {\n            this.tmp.splice_delimiter = this.citation.opt.layout_delimiter;\n        }\n    } else if (this.tmp.use_cite_group_delimiter) {\n        this.tmp.splice_delimiter = this.citation.opt.cite_group_delimiter;\n    } else {\n        if (this.tmp.have_collapsed && this.opt.xclass === \"in-text\" && this.opt.update_mode !== CSL.NUMERIC) {\n            this.tmp.splice_delimiter = \", \";\n        } else if (this.tmp.cite_locales[pos - 1]) {\n            //\n            // Must have a value to take effect.  Use zero width space to force empty delimiter.\n            var alt_affixes = this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[pos - 1]];\n            if (alt_affixes && alt_affixes.delimiter) {\n                this.tmp.splice_delimiter = alt_affixes.delimiter;\n            }\n        } else if (!this.tmp.splice_delimiter) {\n            // This happens when no delimiter is set on cs:layout under cs:citation\n            this.tmp.splice_delimiter = \"\";\n        }\n    }\n\n/*\n    if (last_locator && \"string\" === typeof this.citation.opt[\"after-collapse-delimiter\"]) {\n        this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n    } else if (last_collapsed && !this.tmp.have_collapsed && \"string\" === typeof this.citation.opt[\"after-collapse-delimiter\"]) {\n        this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n    } else if (!last_collapsed && !this.tmp.have_collapsed && \"string\" === typeof this.citation.opt[\"after-collapse-delimiter\"] && !this.citation.opt.collapse === \"year-suffix\") {\n        this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n    } else if (this.tmp.use_cite_group_delimiter) {\n        this.tmp.splice_delimiter = this.citation.opt.cite_group_delimiter;\n    } else if (this.tmp.have_collapsed && this.opt.xclass === \"in-text\" && this.opt.update_mode !== CSL.NUMERIC) {\n        this.tmp.splice_delimiter = \", \";\n    } else if (this.tmp.cite_locales[pos - 1]) {\n        //\n        // Must have a value to take effect.  Use zero width space to force empty delimiter.\n        var alt_affixes = this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[pos - 1]];\n        if (alt_affixes && alt_affixes.delimiter) {\n            this.tmp.splice_delimiter = alt_affixes.delimiter;\n        }\n    } else if (!this.tmp.splice_delimiter) {\n        // This happens when no delimiter is set on cs:layout under cs:citation\n        this.tmp.splice_delimiter = \"\";\n    }\n*/\n    // Paranoia\n    //if (!this.tmp.splice_delimiter) {\n    //    this.tmp.splice_delimiter = \"\";\n    //}\n    return this.tmp.splice_delimiter;\n};\n\n/*\n * Compose individual cites into a single string, with\n * flexible inter-cite splicing.\n */\nCSL.getCitationCluster = function (inputList, citation) {\n    var result, objects, myparams, len, pos, item, last_collapsed, params, empties, composite, compie, myblobs, Item, llen, ppos, obj, preceding_item, txt_esc, error_object, citationID, authorOnly, suppressAuthor;\n    var citation_prefix = \"\";\n    this.output.checkNestedBrace = new CSL.checkNestedBrace(this);\n    if (citation) {\n        citationID = citation.citationID;\n        authorOnly = citation.properties.mode === \"author-only\" ? !!citation.properties.mode : false;\n        if (this.opt.xclass !== \"note\") {\n            suppressAuthor = citation.properties.mode === \"suppress-author\" ? !!citation.properties.mode : false;\n        }\n        if (citation.properties.prefix) {\n            citation_prefix = CSL.checkPrefixSpaceAppend(this, citation.properties.prefix);\n        }\n    }\n    inputList = inputList ? inputList : [];\n    this.tmp.last_primary_names_string = false;\n    txt_esc = CSL.getSafeEscape(this);\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    result = \"\";\n    objects = [];\n    this.tmp.last_suffix_used = \"\";\n    this.tmp.last_names_used = [];\n    this.tmp.last_years_used = [];\n    this.tmp.backref_index = [];\n    this.tmp.cite_locales = [];\n    if (!this.tmp.just_looking) {\n        this.tmp.abbrev_trimmer = {\n            QUASHES: {}\n        };\n    }\n\n    var use_layout_prefix = this.output.checkNestedBrace.update(this.citation.opt.layout_prefix + citation_prefix);\n    //var use_layout_prefix = this.citation.opt.layout_prefix;\n\n    var suppressTrailingPunctuation = false;\n    if (this.citation.opt.suppressTrailingPunctuation) {\n        suppressTrailingPunctuation = true;\n    }\n    if (citationID) {\n        //this.registry.citationreg.citationById[citationID].properties.backref_index = false;\n        //this.registry.citationreg.citationById[citationID].properties.backref_citation = false;\n        if (this.registry.citationreg.citationById[citationID].properties[\"suppress-trailing-punctuation\"]) {\n            suppressTrailingPunctuation = true;\n        }\n    }\n\n    // Adjust locator positions if that looks like a sensible thing to do.\n    if (this.opt.xclass === \"note\") {\n        var parasets = [];\n        var lastTitle = false;\n        var lastPosition = false;\n        var lastID = false;\n        var lst = [];\n        for (var i=0, ilen = inputList.length; i < ilen; i += 1) {\n            var type = inputList[i][0].type;\n            var title = inputList[i][0].title;\n            var position = inputList[i][1].position;\n            var id = inputList[i][0].id;\n            if (title && type === \"legal_case\" && id !== lastID && position) {\n                // Start a fresh sublist if the item title does not match the last one\n                if (title !== lastTitle || parasets.length === 0) {\n                    lst = [];\n                    parasets.push(lst);\n                }\n                lst.push(inputList[i][1]);\n            }\n            lastTitle = title;\n            lastPosition = position;\n            lastID = id;\n        }\n        // We now have a list of sublists, each w/matching titles\n        for (i=0, ilen=parasets.length; i < ilen; i += 1) {\n            lst = parasets[i];\n            if (lst.length < 2) {\n                continue;\n            }\n            // Get the locator in last position, but only if it's the only one in the set.\n            var locatorInLastPosition = lst.slice(-1)[0].locator;\n            if (locatorInLastPosition) {\n                for (var j=0, jlen=lst.length - 1; j < jlen; j += 1) {\n                    if (lst[j].locator) {\n                        locatorInLastPosition = false;\n                    }\n                }\n            }\n            // move the locator here, if it's called for.\n            if (locatorInLastPosition) {\n                lst[0].locator = locatorInLastPosition;\n                delete lst.slice(-1)[0].locator;\n                lst[0].label = lst.slice(-1)[0].label;\n                if (lst.slice(-1)[0].label) {\n                    delete lst.slice(-1)[0].label;\n                }\n            }\n       }\n    }\n    myparams = [];\n    len = inputList.length;\n    if (inputList[0] && inputList[0][1]) {\n        if (authorOnly) {\n            delete inputList[0][1][\"suppress-author\"];\n            inputList[0][1][\"author-only\"] = true;\n        } else if (suppressAuthor) {\n            delete inputList[0][1][\"author-only\"];\n            inputList[0][1][\"suppress-author\"] = true;\n        }\n    }\n    if (this.opt.parallel.enable) {\n        this.parallel.StartCitation(inputList);\n    }\n    for (pos = 0; pos < len; pos += 1) {\n\n        // Also for parallels only\n        this.tmp.cite_index = pos;\n\n        Item = inputList[pos][0];\n        item = inputList[pos][1];\n        item = CSL.parseLocator.call(this, item);\n        last_collapsed = this.tmp.have_collapsed;\n        var last_locator = false;\n        if (pos > 0 && inputList[pos-1][1]) {\n            last_locator = !!inputList[pos-1][1].locator;\n        }\n        params = {};\n        \n        // Reset shadow_numbers here, suppress reset in getCite()\n        this.tmp.shadow_numbers = {};\n        if (!this.tmp.just_looking && this.opt.hasPlaceholderTerm) {\n            var output = this.output;\n            this.output = new CSL.Output.Queue(this);\n            this.output.adjust = new CSL.Output.Queue.adjust();\n            CSL.getAmbiguousCite.call(this, Item, null, false, item);\n            this.output = output;\n        }\n\n        this.tmp.in_cite_predecessor = false;\n        // true is to block reset of shadow numbers\n        \n        \n        if (pos > 0) {\n            CSL.getCite.call(this, Item, item, \"\" + inputList[(pos - 1)][0].id, true);\n        } else {\n            this.tmp.term_predecessor = false;\n            CSL.getCite.call(this, Item, item, null, true);\n        }\n\n        // Make a note of any errors\n        if (!this.tmp.cite_renders_content) {\n            error_object = {\n                citationID: \"\" + this.tmp.citation_id,\n                index: this.tmp.citation_pos,\n                noteIndex: this.tmp.citation_note_index,\n                itemID: \"\" + Item.id,\n                citationItems_pos: pos,\n                error_code: CSL.ERROR_NO_RENDERED_FORM\n            };\n            this.tmp.citation_errors.push(error_object);\n        }\n        params.splice_delimiter = CSL.getSpliceDelimiter.call(this, last_locator, last_collapsed, pos);\n        // XXX This appears to be superfluous.\n        if (item && item[\"author-only\"]) {\n            this.tmp.suppress_decorations = true;\n        }\n\n        if (pos > 0) {\n            preceding_item = inputList[pos - 1][1];\n\n            // XXX OR if preceding suffix is empty, and the current prefix begins with a full stop.\n\n            var precedingEndsInPeriodOrComma = preceding_item.suffix && [\";\", \".\", \",\"].indexOf(preceding_item.suffix.slice(-1)) > -1;\n            var currentStartsWithPeriodOrComma = !preceding_item.suffix && item.prefix && [\";\", \".\", \",\"].indexOf(item.prefix.slice(0, 1)) > -1;\n            if (precedingEndsInPeriodOrComma || currentStartsWithPeriodOrComma) {\n                var spaceidx = params.splice_delimiter.indexOf(\" \");\n                if (spaceidx > -1 && !currentStartsWithPeriodOrComma) {\n                    params.splice_delimiter = params.splice_delimiter.slice(spaceidx);\n                } else {\n                    params.splice_delimiter = \"\";\n                }\n            }\n        }\n        params.suppress_decorations = this.tmp.suppress_decorations;\n        params.have_collapsed = this.tmp.have_collapsed;\n        //\n        // XXXXX: capture parameters to an array, which\n        // will be of the same length as this.output.queue,\n        // corresponding to each element.\n        //\n        myparams.push(params);\n        if (item[\"author-only\"]) {\n            break;\n        }\n    }\n    //\n    // output.queue is a simple array.  do a slice\n    // of it to get each cite item, setting params from\n    // the array that was built in the preceding loop.\n    //\n    empties = 0;\n    myblobs = this.output.queue.slice();\n\n    var citation_suffix = \"\";\n    if (citation) {\n        citation_suffix = CSL.checkSuffixSpacePrepend(this, citation.properties.suffix);\n    }\n    var suffix = this.citation.opt.layout_suffix;\n    var last_locale = this.tmp.cite_locales[this.tmp.cite_locales.length - 1];\n    //\n    // Must have a value to take effect.  Use zero width space to force empty suffix.\n    if (last_locale && this.tmp.cite_affixes[this.tmp.area][last_locale] && this.tmp.cite_affixes[this.tmp.area][last_locale].suffix) {\n        suffix = this.tmp.cite_affixes[this.tmp.area][last_locale].suffix;\n    }\n    if (CSL.TERMINAL_PUNCTUATION.slice(0, -1).indexOf(suffix.slice(0, 1)) > -1) {\n        suffix = suffix.slice(0, 1);\n    }\n    //print(\"=== FROM CITE ===\");\n    suffix = this.output.checkNestedBrace.update(citation_suffix + suffix);\n\n\n    for (var i=0,ilen=this.output.queue.length;i<ilen;i+=1) {\n        CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[i]);\n    }\n    if (!this.tmp.suppress_decorations && this.output.queue.length) {\n        if (!(this.opt.development_extensions.apply_citation_wrapper\n              && this.sys.wrapCitationEntry\n               && !this.tmp.just_looking\n              && this.tmp.area === \"citation\")) { \n\n            if (!suppressTrailingPunctuation) {\n                this.output.queue[this.output.queue.length - 1].strings.suffix = suffix;\n            }\n            this.output.queue[0].strings.prefix = use_layout_prefix;\n        }\n    }\n    if (this.opt.development_extensions.clean_up_csl_flaws) {\n        for (var j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            //print(\"OUTPUT[5]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.output.adjust.upward(this.output.queue[j]);\n            //print(\"OUTPUT[4]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.output.adjust.leftward(this.output.queue[j]);\n            //print(\"OUTPUT[3]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.output.adjust.downward(this.output.queue[j]);\n            //print(\"OUTPUT[2]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.tmp.last_chr = this.output.adjust.fix(this.output.queue[j]);\n            //print(\"OUTPUT[1]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations','num'],2))\n        }\n    }\n    //print(\"this.tmp.last_chr=\"+this.tmp.last_chr);\n    for (pos = 0, len = myblobs.length; pos < len; pos += 1) {\n        var buffer = [];\n        this.output.queue = [myblobs[pos]];\n        this.tmp.suppress_decorations = myparams[pos].suppress_decorations;\n        this.tmp.splice_delimiter = myparams[pos].splice_delimiter;\n        //\n        // oh, one last second thought on delimiters ...\n        //\n\n        if (myblobs[pos].parallel_delimiter) {\n            this.tmp.splice_delimiter = myblobs[pos].parallel_delimiter;\n        }\n        this.tmp.have_collapsed = myparams[pos].have_collapsed;\n\n        composite = this.output.string(this, this.output.queue);\n\n        this.tmp.suppress_decorations = false;\n        // meaningless assignment\n        // this.tmp.handle_ranges = false;\n        if (\"string\" === typeof composite) {\n            this.tmp.suppress_decorations = false;\n            if (!composite) {\n                if (this.opt.development_extensions.throw_on_empty) {\n                    CSL.error(\"Citation would render no content\");\n                } else {\n                    composite = \"[NO_PRINTED_FORM]\";\n                }\n            }\n            return composite;\n        }\n        if (\"object\" === typeof composite && composite.length === 0 && !item[\"suppress-author\"]) {\n            if (pos === 0) {\n                var errStr = \"[CSL STYLE ERROR: reference with no printed form.]\";\n                var preStr = pos === 0 ? txt_esc(this.citation.opt.layout_prefix) : \"\";\n                var sufStr = pos === (myblobs.length - 1) ? txt_esc(this.citation.opt.layout_suffix) : \"\";\n                composite.push(preStr + errStr + sufStr);\n            } else if (pos === myblobs.length - 1) {\n                var tmpobj = objects[objects.length - 1];\n                if (typeof tmpobj === \"string\") {\n                    objects[objects.length -1] += (txt_esc(this.citation.opt.layout_suffix));\n                } else if (typeof tmpobj === \"object\") {\n                    tmpobj.strings.suffix += (txt_esc(this.citation.opt.layout_suffix));\n                }\n            }\n        }\n        if (buffer.length && \"string\" === typeof composite[0]) {\n            composite.reverse();\n            var tmpstr = composite.pop();\n            if (tmpstr && tmpstr.slice(0, 1) === \",\") {\n                buffer.push(tmpstr);\n            } else if (\"string\" == typeof buffer.slice(-1)[0] && buffer.slice(-1)[0].slice(-1) === \",\") {\n                buffer.push(\" \" + tmpstr);\n            } else if (tmpstr) {\n                buffer.push(txt_esc(this.tmp.splice_delimiter) + tmpstr);\n            }\n        } else {\n            composite.reverse();\n            compie = composite.pop();\n            if (\"undefined\" !== typeof compie) {\n                if (buffer.length && \"string\" === typeof buffer[buffer.length - 1]) {\n                    buffer[buffer.length - 1] += compie.successor_prefix;\n                }\n                buffer.push(compie);\n            }\n        }\n        // Seems odd, but this was unnecessary and broken.\n        //composite.reverse();\n        llen = composite.length;\n        for (ppos = 0; ppos < llen; ppos += 1) {\n            obj = composite[ppos];\n            if (\"string\" === typeof obj) {\n                buffer.push(txt_esc(this.tmp.splice_delimiter) + obj);\n                continue;\n            }\n            compie = composite.pop();\n            if (\"undefined\" !== typeof compie) {\n                buffer.push(compie);\n            }\n        }\n        if (buffer.length === 0 && !inputList[pos][1][\"suppress-author\"]) {\n            empties += 1;\n        }\n        if (buffer.length > 1 && typeof buffer[0] !== \"string\") {\n            buffer = [this.output.renderBlobs(buffer)];\n        }\n        if (buffer.length) {\n            if (\"string\" === typeof buffer[0]) {\n                if (pos > 0) {\n                    buffer[0] = txt_esc(this.tmp.splice_delimiter) + buffer[0];\n                }\n            } else {\n                if (pos > 0) {\n                    buffer[0].splice_prefix = this.tmp.splice_delimiter;\n                } else {\n                    buffer[0].splice_prefix = \"\";\n                }\n            }\n        }\n        objects = objects.concat(buffer);\n    }\n    // print(\"OBJECTS=\"+objects);\n    result += this.output.renderBlobs(objects);\n\n    if (result) {\n        //if (CSL.TERMINAL_PUNCTUATION.indexOf(this.tmp.last_chr) > -1 \n        //    && this.tmp.last_chr === use_layout_suffix.slice(0, 1)) {\n        //    use_layout_suffix = use_layout_suffix.slice(1);\n        //}\n        if (!this.tmp.suppress_decorations) {\n            len = this.citation.opt.layout_decorations.length;\n            for (pos = 0; pos < len; pos += 1) {\n                params = this.citation.opt.layout_decorations[pos];\n                // The \"normal\" formats in some output modes expect\n                // a superior nested decoration environment, and\n                // so should produce no output here.\n                if (params[1] === \"normal\") {\n                    continue;\n                }\n                if (!item || !item[\"author-only\"]) {\n                    result = this.fun.decorate[params[0]][params[1]](this, result);\n                }\n            }\n        }\n    }\n    this.tmp.suppress_decorations = false;\n    if (!result) {\n        if (this.opt.development_extensions.throw_on_empty) {\n            CSL.error(\"Citation would render no content\");\n        } else {\n            result = \"[NO_PRINTED_FORM]\"\n        }\n    }\n    return result;\n};\n\n/*\n * Render a single cite item.\n *\n * This is called on the state object, with a single\n * Item as input.  It iterates exactly once over the style\n * citation tokens, and leaves the result of rendering in\n * the top-level list in the relevant *.opt.output\n * stack, as a list item consisting of a single string.\n *\n * (This is dual-purposed for generating individual\n * entries in a bibliography.)\n */\nCSL.getCite = function (Item, item, prevItemID, blockShadowNumberReset) {\n    var next, error_object;\n    var areaOrig = this.tmp.area;\n    if (item && item[\"author-only\"] && this.intext && this.intext.tokens.length > 0) {\n            this.tmp.area = \"intext\";\n    }\n    this.tmp.cite_renders_content = false;\n    this.tmp.probably_rendered_something = false;\n    this.tmp.prevItemID = prevItemID;\n\n    CSL.citeStart.call(this, Item, item, blockShadowNumberReset);\n    next = 0;\n    this.tmp.name_node = {};\n    this.nameOutput = new CSL.NameOutput(this, Item, item);\n\n    // rerun?\n    while (next < this[this.tmp.area].tokens.length) {\n        next = CSL.tokenExec.call(this, this[this.tmp.area].tokens[next], Item, item);\n    }\n\n    CSL.citeEnd.call(this, Item, item);\n    // Odd place for this, but it seems to fit here\n    if (!this.tmp.cite_renders_content && !this.tmp.just_looking) {\n        if (this.tmp.area === \"bibliography\") {\n            error_object = {\n                index: this.tmp.bibliography_pos,\n                itemID: \"\" + Item.id,\n                error_code: CSL.ERROR_NO_RENDERED_FORM\n            };\n            this.tmp.bibliography_errors.push(error_object);\n        }\n    }\n    this.tmp.area = areaOrig;\n    return \"\" + Item.id;\n};\n\n\nCSL.citeStart = function (Item, item, blockShadowNumberReset) {\n    this.tmp.lang_array = [];\n    if (Item.language) {\n        // Guard against garbage locales in user input\n        var m = Item.language.match(/^([a-zA-Z]+).*/);\n        if (m) {\n            this.tmp.lang_array.push(m[1].toLowerCase());\n        }\n    }\n    this.tmp.lang_array.push(this.opt.lang);\n    if (!blockShadowNumberReset) {\n        this.tmp.shadow_numbers = {};\n    }\n    \n    this.tmp.disambiguate_count = 0;\n    this.tmp.disambiguate_maxMax = 0;\n    this.tmp.same_author_as_previous_cite = false;\n    if (!this.tmp.suppress_decorations) {\n        this.tmp.subsequent_author_substitute_ok = true;\n    } else {\n        this.tmp.subsequent_author_substitute_ok = false;\n    }\n    this.tmp.lastchr = \"\";\n    if (this.tmp.area === \"citation\" && this.citation.opt.collapse && this.citation.opt.collapse.length) {\n        //this.tmp.have_collapsed = \"year\";\n        this.tmp.have_collapsed = true;\n    } else {\n        this.tmp.have_collapsed = false;\n    }\n    this.tmp.render_seen = false;\n    if (this.tmp.disambig_request  && ! this.tmp.disambig_override) {\n        this.tmp.disambig_settings = this.tmp.disambig_request;\n    } else if (this.registry.registry[Item.id] && ! this.tmp.disambig_override) {\n        this.tmp.disambig_request = this.registry.registry[Item.id].disambig;\n        this.tmp.disambig_settings = this.registry.registry[Item.id].disambig;\n    } else {\n        this.tmp.disambig_settings = new CSL.AmbigConfig();\n    }\n    if (this.tmp.area !== 'citation') {\n        if (!this.registry.registry[Item.id]) {\n            this.tmp.disambig_restore = new CSL.AmbigConfig();\n        } else {\n            this.tmp.disambig_restore = CSL.cloneAmbigConfig(this.registry.registry[Item.id].disambig);\n            if (this.tmp.area === 'bibliography' && this.tmp.disambig_settings && this.tmp.disambig_override) {\n                if (this.opt[\"disambiguate-add-names\"]) {\n                    this.tmp.disambig_settings.names = this.registry.registry[Item.id].disambig.names.slice();\n                    if (this.tmp.disambig_request) {\n                        this.tmp.disambig_request.names = this.registry.registry[Item.id].disambig.names.slice();\n                    }\n                }\n                if (this.opt[\"disambiguate-add-givenname\"]) {\n                    // This is weird and delicate and not fully understood\n                    this.tmp.disambig_request = this.tmp.disambig_settings;\n                    this.tmp.disambig_settings.givens = this.registry.registry[Item.id].disambig.givens.slice();\n                    this.tmp.disambig_request.givens = this.registry.registry[Item.id].disambig.givens.slice();\n                    for (var i=0,ilen=this.tmp.disambig_settings.givens.length;i<ilen;i+=1) {\n                        this.tmp.disambig_settings.givens[i] = this.registry.registry[Item.id].disambig.givens[i].slice();\n                    }\n                    for (var i=0,ilen=this.tmp.disambig_request.givens.length;i<ilen;i+=1) {\n                        this.tmp.disambig_request.givens[i] = this.registry.registry[Item.id].disambig.givens[i].slice();\n                    }\n                }\n            }\n        }\n    }\n\n    this.tmp.names_used = [];\n    this.tmp.nameset_counter = 0;\n    this.tmp.years_used = [];\n    this.tmp.names_max.clear();\n    if (!this.tmp.just_looking) {\n        if (!item || item.parallel === \"first\" || !item.parallel) {\n            this.tmp.abbrev_trimmer = {\n                QUASHES: {}\n            };\n        }\n    }\n\n    this.tmp.splice_delimiter = this[this.tmp.area].opt.layout_delimiter;\n    //this.tmp.splice_delimiter = this[this.tmp.area].opt.delimiter;\n\n    this.bibliography_sort.keys = [];\n    this.citation_sort.keys = [];\n\n    this.tmp.has_done_year_suffix = false;\n    this.tmp.last_cite_locale = false;\n    // SAVE PARAMETERS HERE, IF APPROPRIATE\n    // (promiscuous addition of global parameters => death by a thousand cuts)\n    if (!this.tmp.just_looking && item && !item.position && this.registry.registry[Item.id]) {\n        this.tmp.disambig_restore = CSL.cloneAmbigConfig(this.registry.registry[Item.id].disambig);\n    }\n    // XXX This only applied to the \"number\" variable itself? Huh?\n    //this.setNumberLabels(Item);\n    this.tmp.first_name_string = false;\n    this.tmp.authority_stop_last = 0;\n};\n\nCSL.citeEnd = function (Item, item) {\n    // RESTORE PARAMETERS IF APPROPRIATE\n    if (this.tmp.disambig_restore && this.registry.registry[Item.id]) {\n        this.registry.registry[Item.id].disambig.names = this.tmp.disambig_restore.names.slice();\n        this.registry.registry[Item.id].disambig.givens = this.tmp.disambig_restore.givens.slice();\n        for (var i=0,ilen=this.registry.registry[Item.id].disambig.givens.length;i<ilen;i+=1) {\n            this.registry.registry[Item.id].disambig.givens[i] = this.tmp.disambig_restore.givens[i].slice();\n        }\n    }\n    this.tmp.disambig_restore = false;\n\n    if (item && item.suffix) {\n        //this.tmp.last_suffix_used = this.tmp.suffix.value();\n        this.tmp.last_suffix_used = item.suffix;\n    } else {\n        this.tmp.last_suffix_used = \"\";\n    }\n    this.tmp.last_years_used = this.tmp.years_used.slice();\n    this.tmp.last_names_used = this.tmp.names_used.slice();\n    this.tmp.cut_var = false;\n\n    // This is a hack, in a way; I have lost track of where\n    // the disambig (name rendering) settings used for rendering work their way\n    // into the registry.  This resets defaults to the subsequent form,\n    // when first cites are rendered.\n    //if (this.tmp.disambig_restore && this.registry.registry[Item.id]) {\n    //    this.registry.registry[Item.id].disambig = this.tmp.disambig_restore;\n    //}\n    //this.tmp.disambig_restore = false;\n    this.tmp.disambig_request = false;\n\n    this.tmp.cite_locales.push(this.tmp.last_cite_locale);\n\n    if (this.tmp.issued_date && this.tmp.renders_collection_number) {\n        var buf = [];\n        for (var i = this.tmp.issued_date.list.length - 1; i > this.tmp.issued_date.pos; i += -1) {\n            buf.push(this.tmp.issued_date.list.pop());\n        }\n        // Throw away the unwanted blob\n        this.tmp.issued_date.list.pop();\n        // Put the other stuff back\n        for (i = buf.length - 1; i > -1; i += -1) {\n            this.tmp.issued_date.list.push(buf.pop());\n        }\n    }\n    this.tmp.issued_date = false;\n    this.tmp.renders_collection_number = false;\n\n};\n\n/*global CSL: true */\n\nCSL.Engine.prototype.makeBibliography = function (bibsection) {\n    var debug, ret, params, maxoffset, item, len, pos, tok, tokk, tokkk, entry_ids, entry_strings;\n    debug = false;\n    if (!bibsection && (this.bibliography.opt.exclude_types || this.bibliography.opt.exclude_with_fields)) {\n        bibsection = {\n            exclude: []\n        };\n        if (this.bibliography.opt.exclude_types) {\n            for (var i in this.bibliography.opt.exclude_types) {\n                var val = this.bibliography.opt.exclude_types[i];\n                bibsection.exclude.push({\n                    field: \"type\",\n                    value: val\n                });\n            }\n        }\n        if (this.bibliography.opt.exclude_with_fields) {\n            for (var i in this.bibliography.opt.exclude_with_fields) {\n                var field = this.bibliography.opt.exclude_with_fields[i];\n                bibsection.exclude.push({\n                    field: field, value: true\n                });\n            }\n        }\n    }\n    // API change: added in version 1.0.51\n    if (!this.bibliography.tokens.length) {\n        return false;\n    }\n    if (\"string\" === typeof bibsection) {\n        this.opt.citation_number_slug = bibsection;\n        bibsection = false;\n    }\n    //SNIP-START\n    if (debug) {\n        len = this.bibliography.tokens.length;\n        for (pos = 0; pos < len; pos += 1) {\n            tok = this.bibliography.tokens[pos];\n            CSL.debug(\"bibtok: \" + tok.name);\n        }\n        CSL.debug(\"---\");\n        len = this.citation.tokens.length;\n        for (pos = 0; pos < len; pos += 1) {\n            tokk = this.citation.tokens[pos];\n            CSL.debug(\"cittok: \" + tok.name);\n        }\n        CSL.debug(\"---\");\n        len = this.bibliography_sort.tokens.length;\n        for (pos = 0; pos < len; pos += 1) {\n            tokkk = this.bibliography_sort.tokens[pos];\n            CSL.debug(\"bibsorttok: \" + tok.name);\n        }\n    }\n    //SNIP-END\n\n    // For paged returns\n    ret = CSL.getBibliographyEntries.call(this, bibsection);\n    entry_ids = ret[0];\n    entry_strings = ret[1];\n\n    // For paged returns\n    var done = ret[2];\n\n    params = {\n        \"maxoffset\": 0,\n        \"entryspacing\": this.bibliography.opt[\"entry-spacing\"],\n        \"linespacing\": this.bibliography.opt[\"line-spacing\"],\n        \"second-field-align\": false,\n        \"entry_ids\": entry_ids,\n        \"bibliography_errors\": this.tmp.bibliography_errors.slice(),\n        \"done\": done\n    };\n    if (this.bibliography.opt[\"second-field-align\"]) {\n        params[\"second-field-align\"] = this.bibliography.opt[\"second-field-align\"];\n    }\n    maxoffset = 0;\n    len = this.registry.reflist.length;\n    for (pos = 0; pos < len; pos += 1) {\n        item = this.registry.reflist[pos];\n        if (item.offset > params.maxoffset) {\n            params.maxoffset = item.offset;\n        }\n    }\n    if (this.bibliography.opt.hangingindent) {\n        params.hangingindent = this.bibliography.opt.hangingindent;\n    }\n    params.bibstart = this.fun.decorate.bibstart;\n    params.bibend = this.fun.decorate.bibend;\n\n    this.opt.citation_number_slug = false;\n    return [params, entry_strings];\n};\n\n/*\n * Compose individual cites into a single string.\n */\nCSL.getBibliographyEntries = function (bibsection) {\n    var ret, input, include, anymatch, allmatch, bib_entry, res, item, spec, lllen, pppos, topblobs, entry_item_ids, debug, i, ilen, siblings, skips, sortedItems, eyetem, entry_item_data, j, jlen;\n    ret = [];\n    entry_item_data = [];\n    this.tmp.area = \"bibliography\";\n    this.tmp.root = \"bibliography\";\n    this.tmp.last_rendered_name = false;\n    this.tmp.bibliography_errors = [];\n    this.tmp.bibliography_pos = 0;\n    \n    // For paged returns: disable generated entries and\n    // do not fetch full items as a batch (input variable\n    // consists of ids only in this case)\n    if (bibsection && bibsection.page_start && bibsection.page_length) {\n        input = this.registry.getSortedIds();        \n    } else {\n        input = this.refetchItems(this.registry.getSortedIds());\n    }\n    \n    this.tmp.disambig_override = true;\n    function eval_string(a, b) {\n        if (a === b) {\n            return true;\n        }\n        return false;\n    }\n    function eval_list(a, lst) {\n        lllen = lst.length;\n        for (pppos = 0; pppos < lllen; pppos += 1) {\n            if (eval_string(a, lst[pppos])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    function eval_spec(a, b) {\n        if (\"boolean\" === typeof a || !a) {\n            if (a) {\n                return !!b;\n            } else {\n                return !b;\n            }\n        } else {\n            if (\"string\" === typeof b) {\n                return eval_string(a, b);\n            } else if (!b) {\n                return false;\n            } else {\n                return eval_list(a, b);\n            }\n        }\n    }\n\n    skips = {};\n\n    // For paged returns\n    var page_item_count;\n    if (bibsection && bibsection.page_start && bibsection.page_length) {\n        page_item_count = 0;\n        if (bibsection.page_start !== true) {\n            for (i = 0, ilen = input.length; i < ilen; i += 1) {\n                skips[input[i]] = true;\n                if (bibsection.page_start == input[i]) {\n                    break;\n                }\n            }\n        }\n    }\n\n    var processed_item_ids = [];\n\n    var consolidatedIDs = {};\n    this.tmp.container_item_count = {};\n    input = input.filter(o => {\n        var ret = o;\n        if (o.legislation_id) {\n            if (consolidatedIDs[o.legislation_id]) {\n                ret = false;\n            } else {\n                consolidatedIDs[o.legislation_id] = true;\n            }\n        } else if (o.container_id) {\n            if (!this.tmp.container_item_count[o.container_id]) {\n                this.tmp.container_item_count[o.container_id] = 0;\n            }\n            this.tmp.container_item_count[o.container_id]++;\n            if (this.bibliography.opt.consolidate_containers.indexOf(o.type) > -1) {\n                if (consolidatedIDs[o.container_id]) {\n                    ret = false;\n                } else {\n                    consolidatedIDs[o.container_id] = true;\n                }\n            }\n        }\n        return ret;\n    });\n\n    this.tmp.container_item_pos = {};\n\n    for (i = 0, ilen = input.length; i < ilen; i += 1) {\n        \n        // For paged returns\n        if (bibsection && bibsection.page_start && bibsection.page_length) {\n            if (skips[input[i]]) {\n                continue;\n            }\n            item = this.refetchItem(input[i]);\n            if (page_item_count === bibsection.page_length) {\n                break;\n            }\n        } else {\n            item = input[i];\n            if (skips[item.id]) {\n                continue;\n            }\n        }\n        if (bibsection) {\n            include = true;\n            if (bibsection.include) {\n                //\n                // Opt-in: these are OR-ed.\n                //\n                include = false;\n                for (j = 0, jlen = bibsection.include.length; j < jlen; j += 1) {\n                    spec = bibsection.include[j];\n                    if (eval_spec(spec.value, item[spec.field])) {\n                        include = true;\n                        break;\n                    }\n                }\n            } else if (bibsection.exclude) {\n                //\n                // Opt-out: these are also OR-ed.\n                //\n                anymatch = false;\n                for (j = 0, jlen = bibsection.exclude.length; j < jlen; j += 1) {\n                    spec = bibsection.exclude[j];\n                    if (eval_spec(spec.value, item[spec.field])) {\n                        anymatch = true;\n                        break;\n                    }\n                }\n                if (anymatch) {\n                    include = false;\n                }\n            } else if (bibsection.select) {\n                //\n                // Multiple condition opt-in: these are AND-ed.\n                //\n                include = false;\n                allmatch = true;\n                for (j = 0, jlen = bibsection.select.length; j < jlen; j += 1) {\n                    spec = bibsection.select[j];\n                    if (!eval_spec(spec.value, item[spec.field])) {\n                        allmatch = false;\n                    }\n                }\n                if (allmatch) {\n                    include = true;\n                }\n            }\n            if (bibsection.quash) {\n                //\n                // Stop criteria: These are AND-ed.\n                //\n                allmatch = true;\n                for (j = 0, jlen = bibsection.quash.length; j < jlen; j += 1) {\n                    spec = bibsection.quash[j];\n                    if (!eval_spec(spec.value, item[spec.field])) {\n                        allmatch = false;\n                    }\n                }\n                if (allmatch) {\n                    include = false;\n                }\n            }\n            if (!include) {\n                continue;\n            }\n        }\n        //SNIP-START\n        if (debug) {\n            CSL.debug(\"BIB: \" + item.id);\n        }\n\n        if (item.container_id) {\n            if (!this.tmp.container_item_pos[item.container_id]) {\n                this.tmp.container_item_pos[item.container_id] = 0;\n            }\n            this.tmp.container_item_pos[item.container_id]++;\n        }\n        \n        //SNIP-END\n        bib_entry = new CSL.Token(\"group\", CSL.START);\n        bib_entry.decorations = [[\"@bibliography\", \"entry\"]].concat(this.bibliography.opt.layout_decorations);\n        this.output.startTag(\"bib_entry\", bib_entry);\n        if (item.system_id && this.sys.embedBibliographyEntry) {\n            this.output.current.value().item_id = item.system_id;\n        } else {\n            this.output.current.value().system_id = item.id;\n        }\n\n        // 2019-06-25 Hacked to conform to new parallels evaluation method\n        // 2020-04-25 Revised to work with latest, and final, parallel-first/parallel-last attributes\n        entry_item_ids = [];\n        if (this.registry.registry[item.id].master\n            && !(bibsection && bibsection.page_start && bibsection.page_length)) {\n            // Fetch item content\n            sortedItems = [[item, {id: item.id}]];\n            siblings = this.registry.registry[item.id].siblings;\n            for (var j=0,jlen=siblings.length; j<jlen; j++) {\n               sortedItems.push([this.refetchItem(siblings[j]), {id: siblings[j]}]);\n            }\n            // Adjust parameters\n            this.parallel.StartCitation(sortedItems);\n            if (this.registry.registry[item.id].parallel_delimiter_override) {\n                this.output.queue[0].strings.delimiter = this.registry.registry[item.id].parallel_delimiter_override;\n            } else {\n                this.output.queue[0].strings.delimiter = \", \";\n            }\n            this.tmp.term_predecessor = false;\n            this.tmp.cite_index = 0;\n            // Run cites\n            for (j = 0, jlen = sortedItems.length; j < jlen; j += 1) {\n                if (j < (sortedItems.length - 1)) {\n                    this.tmp.parallel_and_not_last = true;\n                } else {\n                    delete this.tmp.parallel_and_not_last;\n                }\n                entry_item_ids.push(\"\" + CSL.getCite.call(this, sortedItems[j][0], sortedItems[j][1]));\n                this.tmp.cite_index++;\n                skips[sortedItems[j][0].id] = true;\n            }\n        } else if (!this.registry.registry[item.id].siblings) {\n            this.tmp.term_predecessor = false;\n            this.tmp.cite_index = 0;\n            entry_item_ids.push(\"\" + CSL.getCite.call(this, item));\n            if (bibsection && bibsection.page_start && bibsection.page_length) {\n                page_item_count += 1;\n            }\n            //skips[item.id] = true;\n        }\n        // For RDF support\n        entry_item_data.push(\"\");\n\n        this.tmp.bibliography_pos += 1;\n\n        processed_item_ids.push(entry_item_ids);\n        //\n        // XXX: loop to render parallels goes here\n        // XXX: just have to mark them somehow ...\n        //\n        this.output.endTag(\"bib_entry\");\n        //\n        // place layout prefix on first blob of each cite, and suffix\n        // on the last non-empty blob of each cite.  there be dragons\n        // here.\n        //\n        if (this.output.queue[0].blobs.length && this.output.queue[0].blobs[0].blobs.length) {\n            // The output queue stuff needs cleaning up.  the result of\n            // output.current.value() is sometimes a blob, sometimes its list\n            // of blobs.  this inconsistency is a source of confusion, and\n            // should be cleaned up across the code base in the first\n            // instance, before making any other changes to output code.\n            if (!this.output.queue[0].blobs[0].blobs[0].strings) {\n                topblobs = this.output.queue[0].blobs;\n            } else {\n                topblobs = this.output.queue[0].blobs[0].blobs;\n            }\n            topblobs[0].strings.prefix = this.bibliography.opt.layout_prefix + topblobs[0].strings.prefix;\n        }\n        for (j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[j]);\n            //print(\"XXX: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n        }\n        for (j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            this.output.adjust.upward(this.output.queue[j]);\n            this.output.adjust.leftward(this.output.queue[j]);\n            this.output.adjust.downward(this.output.queue[j],true);\n            this.output.adjust.fix(this.output.queue[j]);\n            //print(\"OUTPUT: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n        }\n\n        //print(\"DUMP \"+JSON.stringify(this.output.queue, [\"strings\", \"decorations\", \"prefix\", \"suffix\", \"delimiter\", \"blobs\"], 2));\n\n        // XXX Need to account for numeric blobs in input.\n        // XXX No idea how this could have worked previously.\n\n        //print(\"BLOBS \"+this.output.queue[0].blobs[0].blobs);\n\n        //print(\"JSON \"+JSON.stringify(this.output.queue[0].blobs, null, 2));\n\n        res = this.output.string(this, this.output.queue)[0];\n        \n        if (!res && this.opt.update_mode === CSL.NUMERIC) {\n            var err = (ret.length + 1) + \". [CSL STYLE ERROR: reference with no printed form.]\";\n            res = CSL.Output.Formats[this.opt.mode][\"@bibliography/entry\"](this, err);\n        }\n        if (res) {\n            ret.push(res);\n        }\n    }\n\n    var done = false;\n    if (bibsection && bibsection.page_start && bibsection.page_length) {\n        var last_expected_id = input.slice(-1)[0];\n        var last_seen_id = processed_item_ids.slice(-1)[0];\n        if (!last_expected_id || !last_seen_id || last_expected_id == last_seen_id) {\n            done = true;\n        }\n    }\n    this.tmp.disambig_override = false;\n\n    // XXX done\n    return [processed_item_ids, ret, done];\n};\n\n/*global CSL: true */\n\n\nCSL.Engine.prototype.setCitationId = function (citation, force) {\n    var ret, id, direction;\n    ret = false;\n    if (!citation.citationID || force) {\n        id = Math.floor(Math.random() * 100000000000000);\n        while (true) {\n            direction = 0;\n            if (!this.registry.citationreg.citationById[id]) {\n                // In case the ID is used as an HTML identifier in the\n                // calling application.\n                //   https://github.com/Juris-M/citeproc-js/issues/22\n                citation.citationID = \"a\" + id.toString(32);\n                break;\n            } else if (!direction && id < 50000000000000) {\n                direction = 1;\n            } else {\n                direction = -1;\n            }\n            if (direction === 1) {\n                id += 1;\n            } else {\n                id += -1;\n            }\n        }\n        ret = \"\" + id;\n    }\n    this.registry.citationreg.citationById[citation.citationID] = citation;\n    return ret;\n};\n\nCSL.Engine.prototype.rebuildProcessorState = function (citations, mode, uncitedItemIDs) {\n    // Rebuilds the processor from scratch, based on a list of citation\n    // objects. In a dynamic application, once the internal state of processor\n    // is established, citations should edited with individual invocations\n    // of processCitationCluster().\n\n    // citations is a list of citation objects in document order.\n    // mode is one of \"html\", \"text\" or \"rtf\".\n    // uncitedItemIDs is a list of itemIDs or a JS object with itemIDs as keys.\n    // Returns a list of [citationID,noteIndex,string] triples in document order.\n    // Set citation.properties.noteIndex to 0 for in-text citations.\n    // It is not necessary to run updateItems() before this function.\n    if (!citations) {\n        citations = [];\n    }\n    if (!mode) {\n        mode = 'html';\n    }\n    var doneIDs = {};\n    var itemIDs = [];\n    for (var i=0,ilen=citations.length;i<ilen;i+=1) {\n        for (var j=0,jlen=citations[i].citationItems.length;j<jlen;j+=1) {\n            var itemID = \"\" + citations[i].citationItems[j].id;\n            if (!doneIDs[itemID]) {\n                itemIDs.push(itemID);\n            }\n            doneIDs[itemID] = true;\n        }\n    }\n    this.updateItems(itemIDs);\n    var pre = [];\n    var post = [];\n    var ret = [];\n    var oldMode = this.opt.mode;\n    this.setOutputFormat(mode);\n    for (var i=0,ilen=citations.length;i<ilen;i+=1) {\n        // res contains a result report and a list of [index,string] pairs\n        // index begins at 0\n        var res = this.processCitationCluster(citations[i],pre,post,CSL.ASSUME_ALL_ITEMS_REGISTERED);\n        pre.push([citations[i].citationID,citations[i].properties.noteIndex]);\n        for (var j=0,jlen=res[1].length;j<jlen;j+=1) {\n            var index = res[1][j][0];\n            ret[index] = [\n                pre[index][0],\n                pre[index][1],\n                res[1][j][1]\n            ];\n        }\n    }\n    this.updateUncitedItems(uncitedItemIDs);\n    this.setOutputFormat(oldMode);\n    return ret;\n};\n\n\nCSL.Engine.prototype.restoreProcessorState = function (citations) {\n    var i, ilen, j, jlen, item, Item, newitem, citationList, itemList, sortedItems;\n    \n    // This function is deprecated.\n    // Use rebuildProcessorState() instead.\n\n    // Quickly restore state from citation details retained by\n    // calling application.\n    //\n    // if citations are provided, position details and sortkeys \n    // on the citation objects are are assumed to be correct.  Item\n    // data is retrieved, and sortedItems arrays are created and\n    // sorted as required by the current style.\n    //\n    // If citations is an empty list or nil, reset processor to\n    // empty state.\n    citationList = [];\n    itemList = [];\n    if (!citations) {\n        citations = [];\n    }\n    // Adjust citationIDs to avoid duplicates, save off index numbers\n    var indexNumbers = [];\n    var citationIds = {};\n    for (i = 0, ilen = citations.length; i < ilen; i += 1) {\n        if (citationIds[citations[i].citationID]) {\n            this.setCitationId(citations[i], true);\n        }\n        citationIds[citations[i].citationID] = true;\n        indexNumbers.push(citations[i].properties.index);\n    }\n    // Slice citations and sort by their declared index positions, if any,\n    // then reassign index and noteIndex numbers.\n    var oldCitations = citations.slice();\n    oldCitations.sort(\n        function (a,b) {\n            if (a.properties.index < b.properties.index) {\n                return -1;\n            } else if (a.properties.index > b.properties.index) {\n                return 1;\n            } else {\n                return 0;\n            }\n        }\n    );\n    for (i = 0, ilen = oldCitations.length; i < ilen; i += 1) {\n        oldCitations[i].properties.index = i;\n    }\n    for (i = 0, ilen = oldCitations.length; i < ilen; i += 1) {\n        sortedItems = [];\n        for (j = 0, jlen = oldCitations[i].citationItems.length; j < jlen; j += 1) {\n            item = oldCitations[i].citationItems[j];\n            if (\"undefined\" === typeof item.sortkeys) {\n                item.sortkeys = [];\n            }\n            Item = this.retrieveItem(\"\" + item.id);\n            newitem = [Item, item];\n            sortedItems.push(newitem);\n            oldCitations[i].citationItems[j].item = Item;\n            itemList.push(\"\" + item.id);\n        }\n        if (!oldCitations[i].properties.unsorted) {\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n        }\n        oldCitations[i].sortedItems = sortedItems;\n        // Save citation data in registry\n        this.registry.citationreg.citationById[oldCitations[i].citationID] = oldCitations[i];\n    }\n    // Register Items\n    this.updateItems(itemList);\n\n    // Construct citationList from original copy\n    for (i = 0, ilen = citations.length; i < ilen; i += 1) {\n        citationList.push([\"\" + citations[i].citationID, citations[i].properties.noteIndex]);\n    }\n\n    var ret = [];\n    if (citations && citations.length) {\n        // Rendering one citation restores remainder of processor state.\n        // If citations is empty, rest to empty state.\n        ret = this.processCitationCluster(citations[0], [], citationList.slice(1));\n    } else {\n        this.registry = new CSL.Registry(this);\n        this.tmp = new CSL.Engine.Tmp();\n        this.disambiguate = new CSL.Disambiguation(this);\n    }\n    return ret;\n};\n\n\nCSL.Engine.prototype.updateItems = function (idList, nosort, rerun_ambigs, implicitUpdate) {\n    var debug = false;\n    var oldArea = this.tmp.area;\n    var oldRoot = this.tmp.root;\n    var oldExtension = this.tmp.extension;\n    if (this.bibliography_sort.tokens.length === 0) {\n        nosort = true;\n    }\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    this.tmp.extension = \"\";\n    if (!implicitUpdate) {\n        this.tmp.loadedItemIDs = {};\n    }\n    //CSL.debug = print\n    //SNIP-START\n    if (debug) {\n        CSL.debug(\"--> init <--\");\n    }\n    //SNIP-END\n    this.registry.init(idList);\n\n\tif (rerun_ambigs) {\n\t\tfor (var ambig in this.registry.ambigcites) {\n\t\t\tthis.registry.ambigsTouched[ambig] = true;\n\t\t}\n\t}\n\n    this.registry.dodeletes(this.registry.myhash);\n    \n    this.registry.doinserts(this.registry.mylist);\n    \n    this.registry.dorefreshes();\n\n    // *** affects reflist\n    this.registry.rebuildlist(nosort);\n    \n    this.registry.setsortkeys();\n\n    // taints always\n    this.registry.setdisambigs();\n\n    // *** affects reflist\n    this.registry.sorttokens(nosort);\n\n    // *** affects reflist\n    // taints if numbered style\n    this.registry.renumber();\n    \n    // taints always\n    //this.registry.yearsuffix();\n\n    this.tmp.extension = oldExtension;\n    this.tmp.area = oldArea;\n    this.tmp.root = oldRoot;\n\n    return this.registry.getSortedIds();\n};\n\nCSL.Engine.prototype.updateUncitedItems = function (idList, nosort) {\n    var idHash;\n    var oldArea = this.tmp.area;\n    var oldRoot = this.tmp.root;\n    var oldExtension = this.tmp.extension;\n    if (this.bibliography_sort.tokens.length === 0) {\n        nosort = true;\n    }\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    this.tmp.extension = \"\";\n    this.tmp.loadedItemIDs = {};\n    // This should be a utility function\n    if (!idList) {\n        idList = [];\n    }\n    if (\"object\" == typeof idList) {\n        if (\"undefined\" == typeof idList.length) {\n            idHash = idList;\n            idList = [];\n            for (var key in idHash) {\n                idList.push(key);\n            }\n        } else if (\"number\" == typeof idList.length) {\n            idHash = {};\n            for (var i=0,ilen=idList.length;i<ilen;i+=1) {\n                idHash[idList[i]] = true;\n            }\n        }\n    }\n\n    // prepare extended list of items\n    this.registry.init(idList, true);\n\n    // Use purge instead of delete.\n    // this.registry.dodeletes(this.registry.myhash);\n    this.registry.dopurge(idHash);\n\n    // everything else is the same as updateItems()\n    this.registry.doinserts(this.registry.mylist);\n\n    this.registry.dorefreshes();\n\n    this.registry.rebuildlist(nosort);\n\n    this.registry.setsortkeys();\n\n    this.registry.setdisambigs();\n\n    this.registry.sorttokens(nosort);\n\n    this.registry.renumber();\n\n    this.tmp.extension = oldExtension;\n    this.tmp.area = oldArea;\n    this.tmp.root = oldRoot;\n\n    return this.registry.getSortedIds();\n};\n\n/*global CSL: true */\n\nCSL.localeResolve = function (langstr, defaultLocale) {\n    var ret, langlst;\n    if (!defaultLocale) {\n        defaultLocale = \"en-US\";\n    }\n    if (!langstr) {\n        langstr = defaultLocale;\n    }\n    ret = {};\n    //if (\"undefined\" === typeof langstr) {\n    //    langstr = \"en_US\";\n    //}\n    langlst = langstr.split(/[\\-_]/);\n    ret.base = CSL.LANG_BASES[langlst[0]];\n    if (\"undefined\" === typeof ret.base) {\n        //CSL.debug(\"Warning: unknown locale \"+langstr+\", setting fallback to \"+defaultLocale);\n        return {base:defaultLocale, best:langstr, bare:langlst[0]};\n    }\n    if (langlst.length === 1) {\n        ret.generic = true;\n    }\n    if (langlst.length === 1 || langlst[1] === \"x\") {\n        ret.best = ret.base.replace(\"_\", \"-\");\n    } else {\n        ret.best = langlst.slice(0, 2).join(\"-\");\n    }\n    ret.base = ret.base.replace(\"_\", \"-\");\n    ret.bare = langlst[0];\n    return ret;\n};\n\n// Use call to invoke this.\nCSL.Engine.prototype.localeConfigure = function (langspec, beShy) {\n    var localexml;\n    if (beShy && this.locale[langspec.best]) {\n        return;\n    }\n    if (langspec.best === \"en-US\") {\n        localexml = CSL.setupXml(this.sys.retrieveLocale(\"en-US\"));\n        this.localeSet(localexml, \"en-US\", langspec.best);\n    } else if (langspec.best !== \"en-US\") {\n        if (langspec.base !== langspec.best) {\n            localexml = CSL.setupXml(this.sys.retrieveLocale(langspec.base));\n            this.localeSet(localexml, langspec.base, langspec.best);\n        }\n        localexml = CSL.setupXml(this.sys.retrieveLocale(langspec.best));\n        this.localeSet(localexml, langspec.best, langspec.best);        \n    }\n    this.localeSet(this.cslXml, \"\", langspec.best);\n    this.localeSet(this.cslXml, langspec.bare, langspec.best);\n    if (langspec.base !== langspec.best) {\n        this.localeSet(this.cslXml, langspec.base, langspec.best);\n    }\n    this.localeSet(this.cslXml, langspec.best, langspec.best);\n    if (\"undefined\" === typeof this.locale[langspec.best].terms[\"page-range-delimiter\"]) {\n        if ([\"fr\", \"pt\"].indexOf(langspec.best.slice(0, 2).toLowerCase()) > -1) {\n            this.locale[langspec.best].terms[\"page-range-delimiter\"] = \"-\";\n        } else {\n            this.locale[langspec.best].terms[\"page-range-delimiter\"] = \"\\u2013\";\n        }\n    }\n    if (\"undefined\" === typeof this.locale[langspec.best].terms[\"year-range-delimiter\"]) {\n        this.locale[langspec.best].terms[\"year-range-delimiter\"] = \"\\u2013\";\n    }\n    if (\"undefined\" === typeof this.locale[langspec.best].terms[\"citation-range-delimiter\"]) {\n        this.locale[langspec.best].terms[\"citation-range-delimiter\"] = \"\\u2013\";\n    }\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        var localeLists = [\"default-locale\",\"locale-sort\",\"locale-translit\",\"locale-translat\"];\n        for (var i=0,ilen=localeLists.length;i<ilen;i+=1) {\n            for (var j=0,jlen=this.opt[localeLists[i]].length;j<jlen;j+=1) {\n                this.opt[localeLists[i]][j] = this.opt[localeLists[i]][j].toLowerCase();\n            }\n        }\n        this.opt.lang = this.opt.lang.toLowerCase();\n    }\n};\n    \n//\n// XXXXX: Got it.  The locales objects need to be reorganized,\n// with a top-level local specifier, and terms, opts, dates\n// below.\n//\nCSL.Engine.prototype.localeSet = function (myxml, lang_in, lang_out) {\n    var blob, locale, nodes, attributes, pos, term, form, termname, styleopts, date, attrname, len, genderform, target, i, ilen;\n    lang_in = lang_in.replace(\"_\", \"-\");\n    lang_out = lang_out.replace(\"_\", \"-\");\n\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        lang_in = lang_in.toLowerCase();\n        lang_out = lang_out.toLowerCase();\n    }\n\n    if (!this.locale[lang_out]) {\n        this.locale[lang_out] = {};\n        this.locale[lang_out].terms = {};\n        this.locale[lang_out].opts = {};\n        // Set default skip words. Can be overridden in locale by attribute on style-options node.\n        this.locale[lang_out].opts[\"skip-words\"] = CSL.SKIP_WORDS;\n        // Initialise leading noise word to false. Actual assignment is below. Empty by default, can be overridden in locale by attribute on style-options node.\n        if (!this.locale[lang_out].opts[\"leading-noise-words\"]) {\n            this.locale[lang_out].opts[\"leading-noise-words\"] = [];\n        }\n        this.locale[lang_out].dates = {};\n        // For ordinals\n        this.locale[lang_out].ord = {'1.0.1':false,keys:{}};\n        this.locale[lang_out][\"noun-genders\"] = {};\n    }\n\n    //\n    // Xml: Test if node is \"locale\" (nb: ns declarations need to be invoked\n    // on every access to the xml object; bundle this with the functions\n    //\n    locale = myxml.makeXml();\n    if (myxml.nodeNameIs(myxml.dataObj, 'locale')) {\n        locale = myxml.dataObj;\n    } else {\n        //\n        // Xml: get a list of all \"locale\" nodes\n        //\n        nodes = myxml.getNodesByName(myxml.dataObj, \"locale\");\n        var foundLocale = false;\n        for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n            blob = nodes[pos];\n            //\n            // Xml: get locale xml:lang\n            //\n            // Iterate over all locales, but for non-matching nodes,\n            // we set jurisdiction_preference only (processing of the\n            // chosen one will process the attribute there,\n            // separately.\n            if (!foundLocale && myxml.getAttributeValue(blob, 'lang', 'xml') === lang_in) {\n                locale = blob;\n                foundLocale = true;\n            } else {\n                var lang = myxml.getAttributeValue(blob, 'lang', 'xml');\n                var style_options = myxml.getNodesByName(blob, 'style-options');\n                if (lang && style_options && style_options.length) {\n                    var jurispref = myxml.getAttributeValue(style_options[0], 'jurisdiction-preference');\n                    if (jurispref) {\n                        if (!this.locale[lang]) {\n                            this.locale[lang] = {\n                                opts: {}\n                            };\n                        }\n                        this.locale[lang].opts[\"jurisdiction-preference\"] = jurispref.split(/\\s+/);\n                    }\n                }\n            }\n        }\n    }\n    //\n    // Xml: get a list of any cs:type nodes within locale\n    //\n    nodes = myxml.getNodesByName(locale, 'type');\n    for (i = 0, ilen = myxml.numberofnodes(nodes); i < ilen; i += 1) {\n        var typenode = nodes[i];\n        var type = myxml.getAttributeValue(typenode, 'name');\n        var gender = myxml.getAttributeValue(typenode, 'gender');\n        this.opt.gender[type] = gender;\n    }\n    //\n    // Xml: get a list of term nodes within locale\n    //\n\n    // If we are setting CSL 1.0.1 ordinals inside a style, wipe the\n    // slate clean and start over.\n    var hasCslOrdinals101 = myxml.getNodesByName(locale, 'term', 'ordinal').length;\n    if (hasCslOrdinals101) {\n        for (var key in this.locale[lang_out].ord.keys) {\n            delete this.locale[lang_out].terms[key];\n        }\n        this.locale[lang_out].ord = {\"1.0.1\":false,keys:{}};\n    }\n\n    nodes = myxml.getNodesByName(locale, 'term');\n    // Collect ordinals info as for 1.0.1, but save only if 1.0.1 toggle triggers\n    var ordinals101 = {\"last-digit\":{},\"last-two-digits\":{},\"whole-number\":{}};\n    var ordinals101_toggle = false;\n    var genderized_terms = {};\n    for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n        term = nodes[pos];\n        //\n        // Xml: get string value of attribute\n        //\n        termname = myxml.getAttributeValue(term, 'name');\n        if (termname === \"sub verbo\") {\n            termname = \"sub-verbo\";\n        }\n        if (termname.slice(0,7) === \"ordinal\") {\n            if (termname === \"ordinal\") {\n                ordinals101_toggle = true;\n            } else {\n                var match = myxml.getAttributeValue(term, 'match');\n                var termstub = termname.slice(8);\n                var genderform = myxml.getAttributeValue(term, 'gender-form');\n                if (!genderform) {\n                    genderform = \"neuter\";\n                }\n                if (!match) {\n                    match = \"last-two-digits\";\n                    if (termstub.slice(0,1) === \"0\") {\n                        match = \"last-digit\";\n                    }\n                }\n                if (termstub.slice(0,1) === \"0\") {\n                    termstub = termstub.slice(1);\n                }\n                if (!ordinals101[match][termstub]) {\n                    ordinals101[match][termstub] = {};\n                }\n                ordinals101[match][termstub][genderform] = termname;\n            }\n            this.locale[lang_out].ord.keys[termname] = true;\n        }\n        if (\"undefined\" === typeof this.locale[lang_out].terms[termname]) {\n            this.locale[lang_out].terms[termname] = {};\n        }\n        form = \"long\";\n        genderform = false;\n        //\n        // Xml: get string value of form attribute, if any\n        //\n        if (myxml.getAttributeValue(term, 'form')) {\n            form = myxml.getAttributeValue(term, 'form');\n        }\n        //\n        // Xml: get string value of gender attribute, if any\n        // \n        if (myxml.getAttributeValue(term, 'gender-form')) {\n            genderform = myxml.getAttributeValue(term, 'gender-form');\n        }\n        //\n        // Xml: set global gender assignment for variable associated\n        // with term name\n        // \n        if (myxml.getAttributeValue(term, 'gender')) {\n            this.locale[lang_out][\"noun-genders\"][termname] = myxml.getAttributeValue(term, 'gender');\n        }\n        // Work on main segment or gender-specific sub-segment as appropriate\n        if (genderform) {\n            this.locale[lang_out].terms[termname][genderform] = {};\n            this.locale[lang_out].terms[termname][genderform][form] = [];\n            target = this.locale[lang_out].terms[termname][genderform];\n            genderized_terms[termname] = true;\n        } else {\n            this.locale[lang_out].terms[termname][form] = [];\n            target = this.locale[lang_out].terms[termname];\n        }\n        //\n        // Xml: test of existence of node\n        //\n        if (myxml.numberofnodes(myxml.getNodesByName(term, 'multiple'))) {\n            //\n            // Xml: get string value of attribute, plus\n            // Xml: get string value of node content\n            //\n            target[form][0] = myxml.getNodeValue(term, 'single');\n            if (target[form][0].indexOf(\"%s\") > -1) {\n                this.opt.hasPlaceholderTerm = true;\n            }\n            //\n            // Xml: get string value of attribute, plus\n            // Xml: get string value of node content\n            //\n            target[form][1] = myxml.getNodeValue(term, 'multiple');\n            if (target[form][1].indexOf(\"%s\") > -1) {\n                this.opt.hasPlaceholderTerm = true;\n            }\n        } else {\n            //\n            // Xml: get string value of attribute, plus\n            // Xml: get string value of node content\n            //\n            target[form] = myxml.getNodeValue(term);\n            if (target[form].indexOf(\"%s\") > -1) {\n                this.opt.hasPlaceholderTerm = true;\n            }\n        }\n    }\n    if (!this.locale[lang_out].terms.supplement) {\n        this.locale[lang_out].terms.supplement = {};\n    }\n    if (!this.locale[lang_out].terms.supplement[\"long\"]) {\n        this.locale[lang_out].terms.supplement[\"long\"] = [\"supplement\", \"supplements\"];\n    }\n    // If locale had a CSL 1.0.1-style ordinal definition, install the logic object\n    // and iterate over gendered terms, filling in default values for use by getTerm.\n    if (ordinals101_toggle) {\n        for (var ikey in genderized_terms) {\n            var gender_segments = {};\n            var form_segments = 0;\n            for (var jkey in this.locale[lang_out].terms[ikey]) {\n                if ([\"masculine\",\"feminine\"].indexOf(jkey) > -1) {\n                    gender_segments[jkey] = this.locale[lang_out].terms[ikey][jkey];\n                } else {\n                    form_segments += 1;\n                }\n            }\n            if (!form_segments) {\n                if (gender_segments.feminine) {\n                    // Link each feminine form segment to default\n                    // (no need to filter, these will not have gender segments mixed in)\n                    for (var jkey in gender_segments.feminine) {\n                        this.locale[lang_out].terms[ikey][jkey] = gender_segments.feminine[jkey];\n                    }\n                } else if (gender_segments.masculine) {\n                    // Otherwise link each masculine form segment to default \n                    for (var jkey in gender_segments.masculine) {\n                        this.locale[lang_out].terms[ikey][jkey] = gender_segments.masculine[jkey];\n                    }\n                }\n            }\n        }\n        this.locale[lang_out].ord['1.0.1'] = ordinals101;\n    }\n\n    // Iterate over main segments, and fill in any holes in gender-specific data\n    // sub-segments\n    for (termname in this.locale[lang_out].terms) {\n        for (i = 0, ilen = 2; i < ilen; i += 1) {\n            genderform = CSL.GENDERS[i];\n            if (this.locale[lang_out].terms[termname][genderform]) {\n                for (form in this.locale[lang_out].terms[termname]) {\n                    if (!this.locale[lang_out].terms[termname][genderform][form]) {\n                        this.locale[lang_out].terms[termname][genderform][form] = this.locale[lang_out].terms[termname][form];\n                    }\n                }\n            }\n        }\n    }\n    //\n    // Xml: get list of nodes by node type\n    //\n    nodes = myxml.getNodesByName(locale, 'style-options');\n    for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n        if (true) {\n            styleopts = nodes[pos];\n            //\n            // Xml: get list of attributes on a node\n            //\n            attributes = myxml.attributes(styleopts);\n            for (attrname in attributes) {\n                if (attributes.hasOwnProperty(attrname)) {\n                    if (attrname === \"@punctuation-in-quote\" || attrname === \"@limit-day-ordinals-to-day-1\") {\n                        if (attributes[attrname] === \"true\") {\n                            // trim off leading @\n                            this.locale[lang_out].opts[attrname.slice(1)] = true;\n                        } else {\n                            // trim off leading @\n                            this.locale[lang_out].opts[attrname.slice(1)] = false;\n                        }\n                    } else if (attrname === \"@jurisdiction-preference\") {\n                        var jurisdiction_preference = attributes[attrname].split(/\\s+/);\n                        this.locale[lang_out].opts[attrname.slice(1)] = jurisdiction_preference;\n                    } else if (attrname === \"@skip-words\") {\n                        var skip_words = attributes[attrname].split(/\\s*,\\s*/);\n                        this.locale[lang_out].opts[attrname.slice(1)] = skip_words;\n                    } else if (attrname === \"@leading-noise-words\") {\n                        var val = attributes[attrname].split(/\\s*,\\s*/);\n                        this.locale[lang_out].opts[\"leading-noise-words\"] = val;\n                    } else if (attrname === \"@name-as-sort-order\") {\n                        // Fallback is okay here.\n                        this.locale[lang_out].opts[\"name-as-sort-order\"] = {};\n                        var lst = attributes[attrname].split(/\\s+/);\n                        for (var i=0,ilen=lst.length;i<ilen;i+=1) {\n                            this.locale[lang_out].opts[\"name-as-sort-order\"][lst[i]] = true;\n                        }\n                    } else if (attrname === \"@name-as-reverse-order\") {\n                        // Fallback is okay here.\n                        this.locale[lang_out].opts[\"name-as-reverse-order\"] = {};\n                        var lst = attributes[attrname].split(/\\s+/);\n                        for (var i=0,ilen=lst.length;i<ilen;i+=1) {\n                            this.locale[lang_out].opts[\"name-as-reverse-order\"][lst[i]] = true;\n                        }\n                    } else if (attrname === \"@name-never-short\") {\n                        // Here too.\n                        this.locale[lang_out].opts[\"name-never-short\"] = {};\n                        var lst = attributes[attrname].split(/\\s+/);\n                        for (var i=0,ilen=lst.length;i<ilen;i+=1) {\n                            this.locale[lang_out].opts[\"name-never-short\"][lst[i]] = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    //\n    // Xml: get list of nodes by type\n    //\n    nodes = myxml.getNodesByName(locale, 'date');\n    for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n        if (true) {\n            var date = nodes[pos];\n            //\n            // Xml: get string value of attribute\n            //\n            this.locale[lang_out].dates[myxml.getAttributeValue(date, \"form\")] = date;\n        }\n    }\n    //\n    // Xml: get list of nodes by node type\n    //\n    CSL.SET_COURT_CLASSES(this, lang_out, myxml, locale);\n};\n\n\nCSL.getLocaleNames = function (myxml, preferredLocale) {\n    var stylexml = CSL.setupXml(myxml);\n\n    function extendLocaleList(localeList, locale) {\n        var forms = [\"base\", \"best\"];\n        if (locale) {\n            var normalizedLocale = CSL.localeResolve(locale);\n            for (var i=0,ilen=forms.length;i<ilen;i++) {\n                if (normalizedLocale[forms[i]] && localeList.indexOf(normalizedLocale[forms[i]]) === -1) {\n                    localeList.push(normalizedLocale[forms[i]]);\n                }\n            }\n        }\n    }\n    \n    var localeIDs = [\"en-US\"];\n    \n    function sniffLocaleOnOneNodeName(nodeName) {\n        var nodes = stylexml.getNodesByName(stylexml.dataObj, nodeName);\n        for (var i=0,ilen=nodes.length;i<ilen;i++) {\n            var nodeLocales = stylexml.getAttributeValue(nodes[i], \"locale\");\n            if (nodeLocales) {\n                nodeLocales = nodeLocales.split(/ +/);\n                for (var j=0,jlen=nodeLocales.length;j<jlen;j++) {\n                    this.extendLocaleList(localeIDs, nodeLocales[j]);\n                }\n            }\n        }\n    }\n\n    extendLocaleList(localeIDs, preferredLocale);\n\n    var styleNode = stylexml.getNodesByName(stylexml.dataObj, \"style\")[0];\n    var defaultLocale = stylexml.getAttributeValue(styleNode, \"default-locale\");\n    extendLocaleList(localeIDs, defaultLocale);\n\n    var nodeNames = [\"layout\", \"if\", \"else-if\", \"condition\"];\n    for (var i=0,ilen=nodeNames.length;i<ilen;i++) {\n        sniffLocaleOnOneNodeName(stylexml, localeIDs, nodeNames[i]);\n    }\n    return localeIDs;\n};\n\n/*global CSL: true */\n\nCSL.Node = {};\n\nCSL.Node.bibliography = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            state.build.area = \"bibliography\";\n            state.build.root = \"bibliography\";\n            state.build.extension = \"\";\n\n            var func = function(state) {\n                state.tmp.area = \"bibliography\";\n                state.tmp.root = \"bibliography\";\n                state.tmp.extension = \"\";\n            };\n            this.execs.push(func);\n\n        }\n        target.push(this);\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node.choose = {\n    build: function (state, target) {\n        var func;\n        if (this.tokentype === CSL.START) {\n            //open condition\n            func = function (state) {\n                state.tmp.jump.push(undefined, CSL.LITERAL);\n            };\n        }\n        if (this.tokentype === CSL.END) {\n            //close condition\n            func = function (state) {\n                state.tmp.jump.pop();\n            };\n        }\n        this.execs.push(func);\n        target.push(this);\n    },\n\n    configure: function (state, pos) {\n        if (this.tokentype === CSL.END) {\n            state.configure.fail.push((pos));\n            state.configure.succeed.push((pos));\n        } else {\n            state.configure.fail.pop();\n            state.configure.succeed.pop();\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.citation = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            state.build.area = \"citation\";\n            state.build.root = \"citation\";\n            state.build.extension = \"\";\n\n\n            var func = function(state) {\n                state.tmp.area = \"citation\";\n                state.tmp.root = \"citation\";\n                state.tmp.extension = \"\";\n            };\n            this.execs.push(func);\n\n/*\n            state.build.root = \"citation\";\n\n            OK state.fixOpt(this, \"names-delimiter\", \"delimiter\");\n            OK state.fixOpt(this, \"name-delimiter\", \"delimiter\");\n            OK state.fixOpt(this, \"name-form\", \"form\");\n            OK state.fixOpt(this, \"and\", \"and\");\n            OK state.fixOpt(this, \"delimiter-precedes-last\", \"delimiter-precedes-last\");\n            OK state.fixOpt(this, \"delimiter-precedes-et-al\", \"delimiter-precedes-et-al\");\n            OK state.fixOpt(this, \"initialize-with\", \"initialize-with\");\n            OK state.fixOpt(this, \"initialize\", \"initialize\");\n            OK state.fixOpt(this, \"name-as-sort-order\", \"name-as-sort-order\");\n            OK state.fixOpt(this, \"sort-separator\", \"sort-separator\");\n\n            OK state.fixOpt(this, \"et-al-min\", \"et-al-min\");\n            OK state.fixOpt(this, \"et-al-use-first\", \"et-al-use-first\");\n            OK state.fixOpt(this, \"et-al-use-last\", \"et-al-use-last\");\n            state.fixOpt(this, \"et-al-subsequent-min\", \"et-al-subsequent-min\");\n            state.fixOpt(this, \"et-al-subsequent-use-first\", \"et-al-subsequent-use-first\");\n*/\n        }\n        if (this.tokentype === CSL.END) {\n\n            // Open an extra key at first position for use in\n            // grouped sorts.\n            // print(\"in cs:citation END\");\n            state.opt.grouped_sort = state.opt.xclass === \"in-text\" \n                && (state.citation.opt.collapse \n                    && state.citation.opt.collapse.length)\n                || (state.citation.opt.cite_group_delimiter\n                    && state.citation.opt.cite_group_delimiter.length)\n                && state.opt.update_mode !== CSL.POSITION\n                && state.opt.update_mode !== CSL.NUMERIC;\n            \n            if (state.opt.grouped_sort \n                && state.citation_sort.opt.sort_directions.length) {\n                \n                var firstkey = state.citation_sort.opt.sort_directions[0].slice();\n                //print(\"extending sort keys \"+state.citation_sort.opt.sort_directions+\" with \"+firstkey);\n                state.citation_sort.opt.sort_directions = [firstkey].concat(state.citation_sort.opt.sort_directions);\n                // print(\"new key directions in effect: \"+state.citation_sort.opt.sort_directions);\n            }\n            // print(\"creating new comparifier\");\n            state.citation.srt = new CSL.Registry.Comparifier(state, \"citation_sort\");\n        }\n        target.push(this);\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node[\"#comment\"] = {\n       // This is a comment in the CSL file.\n       build: function () {\n        // Save some space in the log files -- no need to mention this, really.\n        // CSL.debug(\"CSL processor warning: comment node reached\");\n       }\n};\n\n/*global CSL: true */\n\nCSL.Node.date = {\n    build: function (state, target) {\n        var func, date_obj, len, pos, part, dpx, parts, mypos, start, end;\n        if (this.tokentype === CSL.START || this.tokentype === CSL.SINGLETON) {\n            // used to collect rendered date part names in node_datepart,\n            // for passing through to node_key, for use in dates embedded\n            // in macros\n            state.dateput.string(state, state.dateput.queue);\n            state.tmp.date_token = CSL.Util.cloneToken(this);\n            state.tmp.date_token.strings.prefix = \"\";\n            state.tmp.date_token.strings.suffix = \"\";\n            state.dateput.openLevel(this);\n            state.build.date_parts = [];\n            state.build.date_variables = this.variables;\n            if (!state.build.extension) {\n                CSL.Util.substituteStart.call(this, state, target);\n            }\n            if (state.build.extension) {\n                func = CSL.dateMacroAsSortKey;\n            } else {\n                func = function (state, Item, item) {\n                    var dp;\n                    state.tmp.element_rendered_ok = false;\n                    state.tmp.donesies = [];\n                    state.tmp.dateparts = [];\n                    dp = [];\n                    //if (this.variables.length && Item[this.variables[0]]){\n                    if (this.variables.length\n                        && !(state.tmp.just_looking\n                             && this.variables[0] === \"accessed\")) {\n                        \n                        date_obj = Item[this.variables[0]];\n                        if (\"undefined\" === typeof date_obj) {\n                            date_obj = {\"date-parts\": [[0]] };\n                            if (state.opt.development_extensions.locator_date_and_revision) {\n                                if (item && this.variables[0] === \"locator-date\" && item[\"locator-date\"]) {\n                                    date_obj = item[\"locator-date\"];\n                                }\n                            }\n                        }\n                        state.tmp.date_object = date_obj;\n                        //\n                        // Call a function here to analyze the\n                        // data and set the name of the date-part that\n                        // should collapse for this range, if any.\n                        //\n                        // (1) build a filtered list, in y-m-d order,\n                        // consisting only of items that are (a) in the\n                        // date-parts and (b) in the *_end data.\n                        // (note to self: remember that season is a\n                        // fallback var when month and day are empty)\n                        \n                        //if (\"undefined\" === typeof this.dateparts) {\n                        //    this.dateparts = [\"year\", \"month\", \"day\"];\n                        //}\n                        len = this.dateparts.length;\n                        for (pos = 0; pos < len; pos += 1) {\n                            part = this.dateparts[pos];\n                            if (\"undefined\" !== typeof state.tmp.date_object[(part +  \"_end\")]) {\n                                dp.push(part);\n                            } else if (part === \"month\" && \"undefined\" !== typeof state.tmp.date_object.season_end) {\n                                dp.push(part);\n                            }\n                        }\n                        dpx = [];\n                        parts = [\"year\", \"month\", \"day\"];\n                        len = parts.length;\n                        for (pos = 0; pos < len; pos += 1) {\n                            if (dp.indexOf(parts[pos]) > -1) {\n                                dpx.push(parts[pos]);\n                            }\n                        }\n                        dp = dpx.slice();\n                        //\n                        // (2) Reverse the list and step through in\n                        // reverse order, popping each item if the\n                        // primary and *_end data match.\n                        mypos = 2;\n                        len = dp.length;\n                        for (pos = 0; pos < len; pos += 1) {\n                            part = dp[pos];\n                            start = state.tmp.date_object[part];\n                            end = state.tmp.date_object[(part + \"_end\")];\n                            if (start !== end) {\n                                mypos = pos;\n                                break;\n                            }\n                        }\n                        \n                        //\n                        // (3) When finished, the first item in the\n                        // list, if any, is the date-part where\n                        // the collapse should occur.\n\n                        // XXXXX: was that it?\n                        state.tmp.date_collapse_at = dp.slice(mypos);\n                        //\n                        // The collapse itself will be done by appending\n                        // string output for the date, less suffix,\n                        // placing a delimiter on output, then then\n                        // doing the *_end of the range, dropping only\n                        // the prefix.  That should give us concise expressions\n                        // of ranges.\n                        //\n                        // Numeric dates should not collapse, though,\n                        // and should probably use a slash delimiter.\n                        // Scope for configurability will remain (all over\n                        // the place), but this will do to get this feature\n                        // started.\n                        //\n                    } else {\n                        state.tmp.date_object = false;\n                    }\n                };\n            }\n            this.execs.push(func);\n\n            // newoutput\n            func = function (state, Item) {\n                if (!Item[this.variables[0]]) {\n                    return;\n                }\n                state.output.startTag(\"date\", this);\n                if (this.variables[0] === \"issued\"\n                    && (Item.type === \"legal_case\" || Item.type === \"legislation\")\n                    && state.opt.disable_duplicate_year_suppression.indexOf(Item.country) === -1\n                    && !state.tmp.extension\n                    && \"\" + Item[\"collection-number\"] === \"\" + state.tmp.date_object.year\n                    && this.dateparts.length === 1\n                    && this.dateparts[0] === \"year\") {\n\n                    // Set up to (maybe) suppress the year if we're not sorting, and\n                    // it's the same as the collection-number, and we would render\n                    // only the year, with not month or day, and this is a legal_case item.\n                    // We save a pointer to the blob parent and its position here. The\n                    // blob will be popped from output if at the end of processing for\n                    // this cite we find that we have rendered the collection-number\n                    // variable also.\n                    for (var key in state.tmp.date_object) {\n                        if (state.tmp.date_object.hasOwnProperty(key)) {\n                            if (key.slice(0, 4) === \"year\") {\n                                state.tmp.issued_date = {};\n                                var lst = state.output.current.mystack.slice(-2)[0].blobs;\n                                state.tmp.issued_date.list = lst;\n                                state.tmp.issued_date.pos = lst.length - 1;\n                            }\n                        }\n                    }\n                }\n            };\n            this.execs.push(func);\n        }\n\n        if (!state.build.extension && (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON)) {\n            // mergeoutput\n            func = function (state, Item) {\n                if (!Item[this.variables[0]]) {\n                    return;\n                }\n                state.output.endTag();\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n\n        if (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON) {\n            if (!state.build.extension) {\n                CSL.Util.substituteEnd.call(this, state, target);\n            }\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"date-part\"] = {\n    build: function (state, target) {\n        var func, pos, len, first_date, value, value_end, real, have_collapsed, invoked, precondition, known_year, bc, ad, bc_end, ad_end, ready, curr, dcurr, number, num, formatter, item;\n        if (!this.strings.form) {\n            this.strings.form = \"long\";\n        }\n        // used in node_date, to send a list of rendering date parts\n        // to node_key, for dates embedded in macros.\n        state.build.date_parts.push(this.strings.name);\n        //\n        // Set delimiter here, if poss.\n        //\n\n        var date_variable = state.build.date_variables[0];\n\n        function formatAndStrip(myform, gender, val) {\n            if (!val) {\n                return val;\n            }\n            val = \"\" + CSL.Util.Dates[this.strings.name][myform](state, val, gender, this.default_locale);\n            if (\"month\" === this.strings.name) {\n                if (state.tmp.strip_periods) {\n                    val = val.replace(/\\./g, \"\");\n                } else {\n                    for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n                        if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                            val = val.replace(/\\./g, \"\");\n                            break;\n                        }\n                    }\n                }\n            }\n            return val;\n        }\n\n        func = function (state, Item) {\n\n            if (!state.tmp.date_object) {\n                return;\n            } else {\n                state.tmp.probably_rendered_something = true;\n            }\n\n            var last_string_output = \"\";\n\n            first_date = true;\n            value = \"\";\n            value_end = \"\";\n            state.tmp.donesies.push(this.strings.name);\n\n            // Render literal only when year is included in date output\n            if (state.tmp.date_object.literal && \"year\" === this.strings.name) {\n                last_string_output = state.tmp.date_object.literal;\n                state.output.append(state.tmp.date_object.literal, this);\n            }\n\n            if (state.tmp.date_object) {\n                value = state.tmp.date_object[this.strings.name];\n                value_end = state.tmp.date_object[(this.strings.name + \"_end\")];\n            }\n            if (\"year\" === this.strings.name && value === 0 && !state.tmp.suppress_decorations) {\n                value = false;\n            }\n            real = !state.tmp.suppress_decorations;\n            have_collapsed = state.tmp.have_collapsed;\n            invoked = state[state.tmp.area].opt.collapse === \"year-suffix\" || state[state.tmp.area].opt.collapse === \"year-suffix-ranged\";\n            precondition = state.opt[\"disambiguate-add-year-suffix\"];\n            if (real && precondition && invoked) {\n                state.tmp.years_used.push(value);\n                known_year = state.tmp.last_years_used.length >= state.tmp.years_used.length;\n                if (known_year && have_collapsed) {\n                    if (state.tmp.last_years_used[(state.tmp.years_used.length - 1)] === value) {\n                        value = false;\n                    }\n                }\n            }\n            if (\"undefined\" !== typeof value) {\n                bc = false;\n                ad = false;\n                bc_end = false;\n                ad_end = false;\n                if (\"year\" === this.strings.name) {\n                    if (parseInt(value, 10) < 500 && parseInt(value, 10) > 0) {\n                        ad = state.getTerm(\"ad\");\n                    }\n                    if (parseInt(value, 10) < 0) {\n                        bc = state.getTerm(\"bc\");\n                        value = (parseInt(value, 10) * -1);\n                    }\n                    if (value_end) {\n                        if (parseInt(value_end, 10) < 500 && parseInt(value_end, 10) > 0) {\n                            ad_end = state.getTerm(\"ad\");\n                        }\n                        if (parseInt(value_end, 10) < 0) {\n                            bc_end = state.getTerm(\"bc\");\n                            value_end = (parseInt(value_end, 10) * -1);\n                        }\n                    }\n                }\n\n                // For gendered locales\n                var monthnameid = \"\"+state.tmp.date_object.month;\n                while (monthnameid.length < 2) {\n                    monthnameid = \"0\"+monthnameid;\n                }\n                monthnameid = \"month-\"+monthnameid;\n                var gender = state.locale[state.opt.lang][\"noun-genders\"][monthnameid];\n                if (this.strings.form) {\n                    var myform = this.strings.form;\n                    var myform_end = this.strings.form;\n                    if (this.strings.name === \"day\") {\n                        if (myform === \"ordinal\" && state.locale[state.opt.lang].opts[\"limit-day-ordinals-to-day-1\"]) {\n                            if (value != 1) {\n                                myform = \"numeric\";\n                            }\n                            if (value_end != 1) {\n                                myform_end = \"numeric\";\n                            }\n                        }\n                    }\n                    value = formatAndStrip.call(this, myform, gender, value);\n                    value_end = formatAndStrip.call(this, myform_end, gender, value_end);\n                }\n                state.output.openLevel(\"empty\");\n                if (state.tmp.date_collapse_at.length) {\n                    //state.output.startTag(this.strings.name,this);\n                    ready = true;\n                    len = state.tmp.date_collapse_at.length;\n                    for (pos = 0; pos < len; pos += 1) {\n                        item = state.tmp.date_collapse_at[pos];\n                        if (state.tmp.donesies.indexOf(item) === -1) {\n                            ready = false;\n                            break;\n                        }\n                    }\n                    if (ready) {\n                        if (\"\" + value_end !== \"0\") {\n                            if (state.dateput.queue.length === 0) {\n                                first_date = true;\n                            }\n\n                            // OK! So if the actual data has no month, day or season,\n                            // and we reach this block, then we can combine the dates\n                            // to a string, run minimial-two, and output the trailing\n                            // year right here. No impact on other functionality.\n                            \n                            if (state.opt[\"year-range-format\"]\n                                && state.opt[\"year-range-format\"] !== \"expanded\"\n                                && !state.tmp.date_object.day\n                                && !state.tmp.date_object.month\n                                && !state.tmp.date_object.season\n                                && this.strings.name === \"year\"\n                                && value && value_end) {\n                                \n                                // second argument adjusts collapse as required for years\n                                // See OSCOLA section 1.3.2\n                                value_end = state.fun.year_mangler(value + \"-\" + value_end, true);\n                                var range_delimiter = state.getTerm(\"year-range-delimiter\");\n                                value_end = value_end.slice(value_end.indexOf(range_delimiter) + 1);\n                            }\n                            last_string_output = value_end;\n                            state.dateput.append(value_end, this);\n                            if (first_date) {\n                                state.dateput.current.value().blobs[0].strings.prefix = \"\";\n                            }\n                        }\n                        last_string_output = value;\n                        state.output.append(value, this);\n                        curr = state.output.current.value();\n                        curr.blobs[(curr.blobs.length - 1)].strings.suffix = \"\";\n                        if (this.strings[\"range-delimiter\"]) {\n                            state.output.append(this.strings[\"range-delimiter\"]);\n                        } else {\n                            state.output.append(state.getTerm(\"year-range-delimiter\"), \"empty\");\n                        }\n                        state.dateput.closeLevel();\n                        dcurr = state.dateput.current.value();\n                        curr.blobs = curr.blobs.concat(dcurr);\n                        // This may leave the stack pointer on a lower level.\n                        // It's not a problem because the stack will be clobbered\n                        // when the queue is initialized by the next cs:date node.\n                        state.dateput.string(state, state.dateput.queue);\n                        state.dateput.openLevel(state.tmp.date_token);\n                        state.tmp.date_collapse_at = [];\n                    } else {\n                        last_string_output = value;\n                        state.output.append(value, this);\n                        // print(\"collapse_at: \"+state.tmp.date_collapse_at);\n                        if (state.tmp.date_collapse_at.indexOf(this.strings.name) > -1) {\n                            //\n                            // Use ghost dateput queue\n                            //\n                            if (\"\" + value_end !== \"0\") {\n                                //\n                                // XXXXX: It's a workaround.  It's ugly.\n                                // There's another one above.\n                                //\n                                if (state.dateput.queue.length === 0) {\n                                    first_date = true;\n                                }\n                                state.dateput.openLevel(\"empty\");\n                                last_string_output = value_end;\n                                state.dateput.append(value_end, this);\n                                if (first_date) {\n                                    state.dateput.current.value().blobs[0].strings.prefix = \"\";\n                                }\n                                if (bc) {\n                                    last_string_output = bc;\n                                    state.dateput.append(bc);\n                                }\n                                if (ad) {\n                                    last_string_output = ad;\n                                    state.dateput.append(ad);\n                                }\n                                state.dateput.closeLevel();\n                            }\n                        }\n                    }\n                } else {\n                    last_string_output = value;\n                    state.output.append(value, this);\n                }\n\n                if (bc) {\n                    last_string_output = bc;\n                    state.output.append(bc);\n                }\n                if (ad) {\n                    last_string_output = ad;\n                    state.output.append(ad);\n                }\n                state.output.closeLevel();\n                //state.output.endTag();\n            } else if (\"month\" === this.strings.name) {\n                // XXX The simpler solution here will be to\n                // directly install season and season_end on\n                // month, with a value of 13, 14, 15, 16, or\n                // (to allow correct ranging with Down Under\n                // dates) 17 or 18.  That will allow ranging\n                // to take place in the normal way.  With this\n                // \"approach\", it doesn't.\n                //\n                // No value for this target variable\n                //\n                if (state.tmp.date_object.season) {\n                    value = \"\" + state.tmp.date_object.season;\n                    if (value && value.match(/^[1-4]$/)) {\n                        // XXXXXXXXXXXXXXXXXXX was replace([false, false, true]);\n                        //state.tmp.group_context.replace([false, false, true]);\n                        state.tmp.group_context.tip.variable_success = true;\n                        last_string_output = \"winter\";\n                        state.output.append(state.getTerm((\"season-0\" + value)), this);\n                    } else if (value) {\n                        last_string_output = value;\n                        state.output.append(value, this);\n                    }\n                }\n            }\n            state.tmp.value = [];\n            if (Item[date_variable] && (value || state.tmp.have_collapsed) && !state.opt.has_year_suffix && \"year\" === this.strings.name && !state.tmp.just_looking) {\n                if (state.registry.registry[Item.id] && state.registry.registry[Item.id].disambig.year_suffix !== false && !state.tmp.has_done_year_suffix) {\n                    state.tmp.has_done_year_suffix = true;\n                    last_string_output = \"x\";\n                    num = parseInt(state.registry.registry[Item.id].disambig.year_suffix, 10);\n                    // first argument is for number particle [a-zA-Z], never present on dates\n                    number = new CSL.NumericBlob(state, false, num, this, Item.id);\n                    this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n                    this.splice_prefix = state[state.build.area].opt.layout_delimiter;\n                    formatter = new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);\n                    number.setFormatter(formatter);\n                    if (state[state.tmp.area].opt.collapse === \"year-suffix-ranged\") {\n                        number.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                    }\n                    if (state[state.tmp.area].opt.cite_group_delimiter) {\n                        number.successor_prefix = state[state.tmp.area].opt.cite_group_delimiter;\n                    } else if (state[state.tmp.area].opt[\"year-suffix-delimiter\"]) {\n                        number.successor_prefix = state[state.tmp.area].opt[\"year-suffix-delimiter\"];\n                    } else {\n                        number.successor_prefix = state[state.tmp.area].opt.layout_delimiter;\n                    }\n                    number.UGLY_DELIMITER_SUPPRESS_HACK = true;\n                    state.output.append(number, \"literal\");\n                }\n            }\n            if (last_string_output && !state.tmp.group_context.tip.condition) {\n                state.tmp.just_did_number = last_string_output.match(/[0-9]$/);\n                if (state.output.current.tip.strings.suffix) {\n                    state.tmp.just_did_number = false;\n                }\n            }\n        };\n        this.execs.push(func);\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node[\"else-if\"] = {\n    //\n    // these function are the same as those in if, might just clone\n    build: function (state, target) {\n        CSL.Conditions.TopNode.call(this, state, target);\n        target.push(this);\n    },\n    configure: function (state, pos) {\n        CSL.Conditions.Configure.call(this, state, pos);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"else\"] = {\n    build: function (state, target) {\n        target.push(this);\n    },\n    configure: function (state, pos) {\n        if (this.tokentype === CSL.START) {\n            state.configure.fail[(state.configure.fail.length - 1)] = pos;\n        }\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node[\"et-al\"] = {\n    build: function (state, target) {\n        if (state.build.area === \"citation\" || state.build.area === \"bibliography\") {\n            var func = function (state) {\n                state.tmp.etal_node = this;\n                if (\"string\" === typeof this.strings.term) {\n                    state.tmp.etal_term = this.strings.term;\n                }\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.group = {\n    build: function (state, target, realGroup) {\n        var func, execs;\n        this.realGroup = realGroup;\n        if (this.tokentype === CSL.START) {\n            CSL.Util.substituteStart.call(this, state, target);\n            if (state.build.substitute_level.value()) {\n                state.build.substitute_level.replace((state.build.substitute_level.value() + 1));\n            }\n            if (!this.juris) {\n                target.push(this);\n            }\n\n            // newoutput\n            func = function (state) {\n                state.output.startTag(\"group\", this);\n                \n                if (this.strings.label_form_override) {\n                    if (!state.tmp.group_context.tip.label_form) {\n                        state.tmp.group_context.tip.label_form = this.strings.label_form_override;\n                    }\n                }\n                \n                if (this.strings.label_capitalize_if_first_override) {\n                    if (!state.tmp.group_context.tip.label_capitalize_if_first) {\n                        state.tmp.group_context.tip.label_capitalize_if_first = this.strings.label_capitalize_if_first_override;\n                    }\n                }\n                \n                if (this.realGroup) {\n                    \n                    if (state.tmp.group_context.tip.condition) {\n                        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, this.strings.prefix, null, this);\n                    }\n                    \n                    var condition = false;\n                    var force_suppress = false;\n\n                    // XXX Can we do something better for length here?\n                    if (state.tmp.group_context.mystack.length) {\n                        state.output.current.value().parent = state.tmp.group_context.tip.output_tip;\n                    }\n                    \n                    // fieldcontextflag\n                    var label_form = state.tmp.group_context.tip.label_form;\n                    if (!label_form) {\n                        label_form = this.strings.label_form_override;\n                    }\n                    \n                    var label_capitalize_if_first = state.tmp.group_context.tip.label_capitalize_if_first;\n                    if (!label_capitalize_if_first) {\n                        label_capitalize_if_first = this.strings.label_capitalize_if_first;\n                    }\n                    if (state.tmp.group_context.tip.condition) {\n                        condition = state.tmp.group_context.tip.condition;\n                        force_suppress = state.tmp.group_context.tip.force_suppress;\n                        //force_suppress: false;\n                    } else if (this.strings.reject) {\n                        condition = {\n                            test: this.strings.reject,\n                            not: true\n                        };\n                    } else if (this.strings.require) {\n                        condition = {\n                            test: this.strings.require,\n                            not: false\n                        };\n                    }\n                    var context = {\n                        old_term_predecessor: state.tmp.term_predecessor,\n                        term_intended: false,\n                        variable_attempt: false,\n                        variable_success: false,\n                        variable_success_parent: state.tmp.group_context.tip.variable_success,\n                        output_tip: state.output.current.tip,\n                        label_form: label_form,\n                        label_static: state.tmp.group_context.tip.label_static,\n                        label_capitalize_if_first: label_capitalize_if_first,\n                        parallel_delimiter_override: this.strings.set_parallel_delimiter_override,\n                        parallel_delimiter_override_on_suppress: this.strings.set_parallel_delimiter_override_on_suppress,\n                        condition: condition,\n                        force_suppress: force_suppress,\n                        done_vars: state.tmp.group_context.tip.done_vars.slice()\n                    };\n                    if(this.non_parallel) {\n                        var non_parallel = state.tmp.group_context.tip.non_parallel;\n                        if (!non_parallel) {\n                            non_parallel = {};\n                        }\n                        Object.assign(non_parallel, this.non_parallel);\n                        context.non_parallel = non_parallel;\n                    }\n                    if(this.parallel_first) {\n                        var parallel_first = state.tmp.group_context.tip.parallel_first;\n                        if (!parallel_first) {\n                            parallel_first = {};\n                        }\n                        Object.assign(parallel_first, this.parallel_first);\n                        context.parallel_first = parallel_first;\n                    }\n                    if(this.parallel_last) {\n                        var parallel_last = state.tmp.group_context.tip.parallel_last;\n                        if (!parallel_last) {\n                            parallel_last = {};\n                        }\n                        Object.assign(parallel_last, this.parallel_last);\n                        context.parallel_last = parallel_last;\n                    }\n                    if (state.tmp.abbrev_trimmer && state.tmp.abbrev_trimmer.LAST_TO_FIRST && context.parallel_last) {\n                        if (!context.parallel_first) {\n                            context.parallel_first = {};\n                        }\n                        for (var varname in state.tmp.abbrev_trimmer.LAST_TO_FIRST) {\n                            if (context.parallel_last[varname]) {\n                                context.parallel_first[varname] = true;\n                                delete context.parallel_last[varname];\n                            }\n                        }\n                    }\n                    \n                    /*\n                    if(this.parallel_last_override) {\n                        var parallel_last_override = state.tmp.group_context.tip.parallel_last_override;\n                        if (!parallel_last_override) {\n                            parallel_last_override = {};\n                        }\n                        Object.assign(parallel_last_override, this.parallel_last_override);\n                        context.parallel_last_override = parallel_last_override;\n                    }\n                     */\n                    state.tmp.group_context.push(context);\n\n                    if (state.tmp.abbrev_trimmer && this.parallel_last_to_first) {\n                        if (!state.tmp.abbrev_trimmer.LAST_TO_FIRST) {\n                            state.tmp.abbrev_trimmer.LAST_TO_FIRST = {};\n                        }\n                        for (var varname in this.parallel_last_to_first) {\n                            state.tmp.abbrev_trimmer.LAST_TO_FIRST[varname] = true;\n                        }\n                    }\n                    \n                    //if (!state.tmp.just_looking) {\n                    //    print(\"       flags=\"+JSON.stringify(state.tmp.group_context.tip, params))\n                    //}\n                }\n            };\n            //\n            // Paranoia.  Assure that this init function is the first executed.\n            execs = [];\n            execs.push(func);\n            this.execs = execs.concat(this.execs);\n\n            // \"Special handling\" for nodes that contain only\n            // publisher and place, with no affixes. For such\n            // nodes only, parallel publisher/place pairs\n            // will be parsed out and properly joined, piggybacking on\n            // join parameters set on cs:citation or cs:bibliography.\n            if (this.strings[\"has-publisher-and-publisher-place\"]) {\n                // Pass variable string values to the closing\n                // tag via a global, iff they conform to expectations.\n                state.build[\"publisher-special\"] = true;\n                if (this.strings[\"subgroup-delimiter\"]) {\n                    // Set the handling function only if name-delimiter\n                    // is set on the parent cs:citation or cs:bibliography\n                    // node.\n                    func = function (state, Item) {\n                        if (Item.publisher && Item[\"publisher-place\"]) {\n                            var publisher_lst = Item.publisher.split(/;\\s*/);\n                            var publisher_place_lst = Item[\"publisher-place\"].split(/;\\s*/);\n                            if (publisher_lst.length > 1\n                                && publisher_lst.length === publisher_place_lst.length) {\n                                state.publisherOutput = new CSL.PublisherOutput(state, this);\n                                state.publisherOutput[\"publisher-list\"] = publisher_lst;\n                                state.publisherOutput[\"publisher-place-list\"] = publisher_place_lst;\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n                }\n            }\n\n            if (this.juris) {\n                // \"Special handling\" for jurisdiction macros\n                // We try to instantiate these as standalone token lists.\n                // If available, the token list is executed,\n                // the result is written directly into output,\n                // and control returns here.\n\n                // So we'll have something like this:\n                // * expandMacro() in util_node.js flags juris- macros\n                //   on build. [DONE]\n                // * Those are picked up here, and\n                //   - A runtime function attempts to fetch and instantiate\n                //     the macros in separate token lists under a segment\n                //     opened for the jurisdiction. We assume that the\n                //     jurisdiction has a full set of macros. That will need\n                //     to be enforced by validation. [DONE HERE, function is TODO]\n                //   - Success or failure is marked in a runtime flag object\n                //     (in citeproc.opt). [DONE]\n                //   - After the instantiation function comes a test, for\n                //     juris- macros only, which either runs diverted code,\n                //     or proceeds as per normal through the token list. [TODO]\n                // I think that's all there is to it.\n                \n                // Code for fetching an instantiating?\n\n                var choose_start = new CSL.Token(\"choose\", CSL.START);\n                CSL.Node.choose.build.call(choose_start, state, target);\n                \n                var if_start = new CSL.Token(\"if\", CSL.START);\n\n                func = (function (macroName) {\n                    return function (Item, item) {\n                        return CSL.INIT_JURISDICTION_MACROS(state, Item, item, macroName);\n                    }\n                }(this.juris));\n                \n                if_start.tests ? {} : if_start.tests = [];\n                if_start.tests.push(func);\n                if_start.test = state.fun.match.any(if_start, state, if_start.tests);\n                target.push(if_start);\n                var text_node = new CSL.Token(\"text\", CSL.SINGLETON);\n                func = function (state, Item, item) {\n                    // This will run the juris- token list.\n                    var itemItem = Item;\n                    if (item && item[\"best-jurisdiction\"] && this.juris === \"juris-locator\") {\n                        itemItem = item;\n                    }\n                    var next = 0;\n                    if (state.juris[itemItem[\"best-jurisdiction\"]][this.juris]) {\n                        while (next < state.juris[itemItem[\"best-jurisdiction\"]][this.juris].length) {\n                            next = CSL.tokenExec.call(state, state.juris[itemItem[\"best-jurisdiction\"]][this.juris][next], Item, item);\n                        }\n                    }\n                };\n                text_node.juris = this.juris;\n                text_node.execs.push(func);\n                target.push(text_node);\n\n                var if_end = new CSL.Token(\"if\", CSL.END);\n                CSL.Node[\"if\"].build.call(if_end, state, target);\n                var else_start = new CSL.Token(\"else\", CSL.START);\n                CSL.Node[\"else\"].build.call(else_start, state, target);\n            }\n        }\n\n        if (this.tokentype === CSL.END) {\n            \n            // Unbundle and print publisher lists\n            // Same constraints on creating the necessary function here\n            // as above. The full content of the group formatting token\n            // is apparently not available on the closing tag here,\n            // hence the global flag on state.build.\n            if (state.build[\"publisher-special\"]) {\n                state.build[\"publisher-special\"] = false;\n                func = function (state) {\n                    if (state.publisherOutput) {\n                        state.publisherOutput.render();\n                        state.publisherOutput = false;\n                    }\n                };\n                this.execs.push(func);\n            }\n            \n            // quashnonfields\n            func = function (state, Item, item) {\n                if (!state.tmp.group_context.tip.condition) {\n                    if (state.output.current.tip.strings.suffix) {\n                        state.tmp.just_did_number = false;\n                    }\n                }\n                state.output.endTag();\n                if (this.realGroup) {\n                    var flags = state.tmp.group_context.pop();\n                    if (flags.parallel_delimiter_override) {\n                        state.tmp.group_context.tip.parallel_delimiter_override = flags.parallel_delimiter_override;\n                        if (!state.tmp.just_looking && state.registry.registry[Item.id].master) {\n                            state.registry.registry[Item.id].parallel_delimiter_override = flags.parallel_delimiter_override;\n                        }\n                    }\n                    if (flags.parallel_delimiter_override_on_suppress) {\n                        state.tmp.group_context.tip.parallel_delimiter_override_on_suppress = flags.parallel_delimiter_override_on_suppress;\n                    }\n                    if (state.tmp.area === \"bibliography_sort\") {\n                        var citationNumberIdx = flags.done_vars.indexOf(\"citation-number\");\n                        if (this.strings.sort_direction && citationNumberIdx > -1 && state.tmp.group_context.length() == 1) {\n                            if (this.strings.sort_direction === CSL.DESCENDING) {\n                                state.bibliography_sort.opt.citation_number_sort_direction = CSL.DESCENDING;\n                            } else {\n                                state.bibliography_sort.opt.citation_number_sort_direction = CSL.ASCENDING;\n                            }\n                            flags.done_vars = flags.done_vars.slice(0, citationNumberIdx).concat(flags.done_vars.slice(citationNumberIdx + 1))\n                        }\n                    }\n                    //var params = [\"condition\", \"variable_success\", \"force_suppress\",\"term_intended\", \"variable_attempt\"]\n                    //if (!state.tmp.just_looking) {\n                    //    print(\"POP parent=\"+JSON.stringify(state.tmp.group_context.tip, params))\n                    //    print(\"    flags=\"+JSON.stringify(flags, params));\n                    //}\n                    if (flags.condition) {\n                        flags.force_suppress = CSL.EVALUATE_GROUP_CONDITION(state, flags);\n                    }\n                    if (state.tmp.group_context.tip.condition) {\n                        state.tmp.group_context.tip.force_suppress = flags.force_suppress;\n                    }\n                            \n                    if (!flags.force_suppress && (flags.variable_success || (flags.term_intended && !flags.variable_attempt))) {\n                        if (!this.isJurisLocatorLabel) {\n                            state.tmp.group_context.tip.variable_success = true;\n                        }\n                        var blobs = state.output.current.value().blobs;\n                        var pos = state.output.current.value().blobs.length - 1;\n\n                        if (!state.tmp.just_looking && (flags.non_parallel || flags.parallel_last || flags.parallel_first || flags.parallel_delimiter_override || flags.parallel_delimiter_override_on_suppress)) {\n                            // flags.parallel_last\n                            // flags.parallel_first\n\n                            // Returns true ONLY if all variables listed on this group are repeats.\n                            var hasRepeat = state.parallel.checkRepeats(flags);\n                            if (hasRepeat) {\n                                if (blobs) {\n                                    blobs.pop();\n                                }\n                            }\n                            if (state.tmp.cite_index > 0 && (hasRepeat || (!flags.parallel_first && !flags.parallel_last && !flags.non_parallel))) {\n                                //state.sys.print(`${state.tmp.cite_index} ${JSON.stringify(state.tmp.suppress_repeats, null, 2)}`)\n                                var info = state.tmp.suppress_repeats[state.tmp.cite_index-1];\n                                if (hasRepeat && flags.parallel_delimiter_override_on_suppress && (info.SIBLING || info.ORPHAN)) {\n                                    state.output.queue.slice(-1)[0].parallel_delimiter = flags.parallel_delimiter_override_on_suppress;\n                                } else if (flags.parallel_delimiter_override && info.SIBLING) {\n                                    state.output.queue.slice(-1)[0].parallel_delimiter = flags.parallel_delimiter_override;\n                                }\n                            }\n                        }\n                    } else {\n                        state.tmp.term_predecessor = flags.old_term_predecessor;\n                        state.tmp.group_context.tip.variable_attempt = flags.variable_attempt;\n                        if (flags.force_suppress && !state.tmp.group_context.tip.condition) {\n                            state.tmp.group_context.tip.variable_attempt = true;\n                            state.tmp.group_context.tip.variable_success = flags.variable_success_parent;\n                        }\n                        if (flags.force_suppress) {\n                            // 2019-04-15\n                            // This is removing variables done within the group we're leaveing from global\n                            // done_vars? How does that make sense?\n                            // Ah. This is a FAILURE. So removing from done_vars allows it to re-render\n                            // later in the cite if desired.\n                            // Currently no tests fail from removing the condition, but leaving it in.\n                            for (var i=0,ilen=flags.done_vars.length;i<ilen;i++) {\n                                var doneVar = flags.done_vars[i];\n                                for (var j=0,jlen=state.tmp.done_vars.length; j<jlen; j++) {\n                                    if (state.tmp.done_vars[j] === doneVar) {\n                                        state.tmp.done_vars = state.tmp.done_vars.slice(0, j).concat(state.tmp.done_vars.slice(j+1));\n                                    }\n                                }\n                            }\n                        }\n                        if (state.output.current.value().blobs) {\n                            state.output.current.value().blobs.pop();\n                        }\n                    }\n                }\n            };\n            this.execs.push(func);\n            \n            if (this.juris) {\n                var else_end = new CSL.Token(\"else\", CSL.END);\n                CSL.Node[\"else\"].build.call(else_end, state, target);\n                var choose_end = new CSL.Token(\"choose\", CSL.END);\n                CSL.Node.choose.build.call(choose_end, state, target);\n            }\n        }\n\n        if (this.tokentype === CSL.END) {\n            if (!this.juris) {\n                target.push(this);\n            }\n            if (state.build.substitute_level.value()) {\n                state.build.substitute_level.replace((state.build.substitute_level.value() - 1));\n            }\n            CSL.Util.substituteEnd.call(this, state, target);\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"if\"] = {\n    build: function (state, target) {\n        CSL.Conditions.TopNode.call(this, state, target);\n        target.push(this);\n    },\n    configure: function (state, pos) {\n        CSL.Conditions.Configure.call(this, state, pos);\n    }\n};\n\n\nCSL.Node[\"conditions\"] = {\n    build: function (state) {\n        if (this.tokentype === CSL.START) {\n            state.tmp.conditions.addMatch(this.match);\n        }\n        if (this.tokentype === CSL.END) {\n            state.tmp.conditions.matchCombine();\n        }\n    }\n};\n\nCSL.Node[\"condition\"] = {\n    build: function (state) {\n        if (this.tokentype === CSL.SINGLETON) {\n            var test = state.fun.match[this.match](this, state, this.tests);\n            state.tmp.conditions.addTest(test);\n        }\n    }\n};\n\nCSL.Conditions = {};\n\nCSL.Conditions.TopNode = function (state) {\n    var func;\n    if (this.tokentype === CSL.START || this.tokentype === CSL.SINGLETON) {\n        if (this.locale) {\n            state.opt.lang = this.locale;\n        }\n        if (!this.tests || !this.tests.length) {\n            // Set up the condition compiler with our current context\n            state.tmp.conditions = new CSL.Conditions.Engine(state, this);\n        } else {\n            // The usual.\n            this.test = state.fun.match[this.match](this, state, this.tests);\n        }\n        if (state.build.substitute_level.value() === 0) {\n            func = function(state) {\n                state.tmp.condition_counter++;\n            }\n            this.execs.push(func);\n        }\n    }\n    if (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON) {\n        if (state.build.substitute_level.value() === 0) {\n            func = function (state) {\n                state.tmp.condition_counter--;\n                if (state.tmp.condition_lang_counter_arr.length > 0) {\n                    var counter = state.tmp.condition_lang_counter_arr.slice(-1)[0];\n                    if (counter === state.tmp.condition_counter) {\n                        state.opt.lang = state.tmp.condition_lang_val_arr.pop();\n                        state.tmp.condition_lang_counter_arr.pop();\n                    }\n                }\n                if (this.locale_default) {\n                    // Open output tag with locale marker\n                    state.output.current.value().old_locale = this.locale_default;\n                    state.output.closeLevel(\"empty\");\n                    state.opt.lang = this.locale_default;\n                }\n            };\n            this.execs.push(func);\n        }\n        // closingjump\n        func = function (state) {\n            var next = this[state.tmp.jump.value()];\n            return next;\n        };\n        this.execs.push(func);\n        if (this.locale_default) {\n            state.opt.lang = this.locale_default;\n        }\n    }\n};\n\nCSL.Conditions.Configure = function (state, pos) {\n    if (this.tokentype === CSL.START) {\n        // jump index on failure\n        this.fail = state.configure.fail.slice(-1)[0];\n        this.succeed = this.next;\n        state.configure.fail[(state.configure.fail.length - 1)] = pos;\n    } else if (this.tokentype === CSL.SINGLETON) {\n        // jump index on failure\n        this.fail = this.next;\n        this.succeed = state.configure.succeed.slice(-1)[0];\n        state.configure.fail[(state.configure.fail.length - 1)] = pos;\n    } else {\n        // jump index on success\n        this.succeed = state.configure.succeed.slice(-1)[0];\n        this.fail = this.next;\n    }\n};\n\nCSL.Conditions.Engine = function (state, token) {\n    this.token = token;\n    this.state = state;\n};\n\nCSL.Conditions.Engine.prototype.addTest = function (test) {\n    this.token.tests ? {} : this.token.tests = [];\n    this.token.tests.push(test);\n};\n\nCSL.Conditions.Engine.prototype.addMatch = function (match) {\n    this.token.match = match;\n};\n\nCSL.Conditions.Engine.prototype.matchCombine = function () {\n    this.token.test = this.state.fun.match[this.token.match](this.token, this.state, this.token.tests);\n};\n\n/*global CSL: true */\n\nCSL.Node.info = {\n    build: function (state) {\n        if (this.tokentype === CSL.START) {\n            state.build.skip = \"info\";\n        } else {\n            state.build.skip = false;\n        }\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node.institution = {\n    build: function (state, target) {\n        if ([CSL.SINGLETON, CSL.START].indexOf(this.tokentype) > -1) {\n\n            var func = function (state) {\n                if (\"string\" === typeof this.strings.delimiter) {\n                    state.tmp.institution_delimiter = this.strings.delimiter;\n                } else {\n                    state.tmp.institution_delimiter = state.tmp.name_delimiter;\n                }\n\n                // This is the same code for the same result as in node_name.js, \n                // but when cs:institution comes on stream, it may produce\n                // different results.\n                if (\"text\" === state.inheritOpt(this, \"and\")) {\n                    this.and_term = state.getTerm(\"and\", \"long\", 0);\n                } else if (\"symbol\" === state.inheritOpt(this, \"and\")) {\n                    if (state.opt.development_extensions.expect_and_symbol_form) {\n                        this.and_term = state.getTerm(\"and\", \"symbol\", 0);\n                    } else {\n                        this.and_term = \"&\";\n                    }\n                } else if (\"none\" === state.inheritOpt(this, \"and\")) {\n                    this.and_term = state.tmp.institution_delimiter;\n                }\n                if (\"undefined\" === typeof this.and_term && state.tmp.and_term) {\n                    // this.and_term = state.getTerm(\"and\", \"long\", 0);\n                    this.and_term = state.tmp.and_term;\n                }\n                if (CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)) {\n                    this.and_prefix_single = \" \";\n                    this.and_prefix_multiple = \", \";\n                    if (\"string\" === typeof state.tmp.institution_delimiter) {\n                        this.and_prefix_multiple = state.tmp.institution_delimiter;\n                    }\n                    this.and_suffix = \" \";\n                } else {\n                    this.and_prefix_single = \"\";\n                    this.and_prefix_multiple = \"\";\n                    this.and_suffix = \"\";\n                }\n                if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"always\") {\n                    this.and_prefix_single = state.tmp.institution_delimiter;\n                } else if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"never\") {\n                    // Slightly fragile: could test for charset here to make\n                    // this more certain.\n                    if (this.and_prefix_multiple) {\n                        this.and_prefix_multiple = \" \";\n                    }\n                }\n                \n                this.and = {};\n                if (\"undefined\" !== typeof this.and_term) {\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.single = state.output.pop();\n                    this.and.single.strings.prefix = this.and_prefix_single;\n                    this.and.single.strings.suffix = this.and_suffix;\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.multiple = state.output.pop();\n                    this.and.multiple.strings.prefix = this.and_prefix_multiple;\n                    this.and.multiple.strings.suffix = this.and_suffix;\n                } else if (\"undefined\" !== this.strings.delimiter) {\n                    this.and.single = new CSL.Blob(state.tmp.institution_delimiter);\n                    this.and.single.strings.prefix = \"\";\n                    this.and.single.strings.suffix = \"\";\n                    this.and.multiple = new CSL.Blob(state.tmp.institution_delimiter);\n                    this.and.multiple.strings.prefix = \"\";\n                    this.and.multiple.strings.suffix = \"\";\n                }\n                state.nameOutput.institution = this;\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n    },\n    configure: function (state) {\n        if ([CSL.SINGLETON, CSL.START].indexOf(this.tokentype) > -1) {\n            state.build.has_institution = true;\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"institution-part\"] = {\n    build: function (state, target) {\n        var func;\n        if (\"long\" === this.strings.name) {\n            if (this.strings[\"if-short\"]) {\n                func = function (state) {\n                    state.nameOutput.institutionpart[\"long-with-short\"] = this;\n                };\n            } else {\n                func = function (state) {\n                    state.nameOutput.institutionpart[\"long\"] = this;\n                };\n            }\n        } else if (\"short\" === this.strings.name) {\n            func = function (state) {\n                state.nameOutput.institutionpart[\"short\"] = this;\n            };\n        }\n        this.execs.push(func);\n        target.push(this);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.key = {\n    build: function (state, target) {\n        \n        target = state[state.build.root + \"_sort\"].tokens;\n\n        var func;\n        var debug = false;\n        var start_key = new CSL.Token(\"key\", CSL.START);\n\n        state.tmp.root = state.build.root;\n\n        // The params object for build and runtime (tmp) really shouldn't have been separated.\n        // Oh, well.\n        start_key.strings[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n        start_key.strings[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n        start_key.strings[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n\n\n        // initialize done vars\n        func = function (state) {\n            state.tmp.done_vars = [];\n        };\n        start_key.execs.push(func);\n\n        // initialize output queue\n        func = function (state) {\n            state.output.openLevel(\"empty\");\n        };\n        start_key.execs.push(func);\n\n        // sort direction\n        var sort_direction = [];\n        if (this.strings.sort_direction === CSL.DESCENDING) {\n            //print(\"sort: descending on \"+state.tmp.area);\n            sort_direction.push(1);\n            sort_direction.push(-1);\n        } else {\n            //print(\"sort: ascending\");\n            sort_direction.push(-1);\n            sort_direction.push(1);\n        }\n        state[state.build.area].opt.sort_directions.push(sort_direction);\n\n        if (CSL.DATE_VARIABLES.indexOf(this.variables[0]) > -1) {\n            state.build.date_key = true;\n        }\n\n        // et al init\n        func = function (state) {\n            state.tmp.sort_key_flag = true;\n            //print(\"== key node function ==\");\n            if (state.inheritOpt(this, \"et-al-min\")) {\n                state.tmp[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n            }\n            if (state.inheritOpt(this, \"et-al-use-first\")) {\n                state.tmp[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n            }\n            if (\"boolean\" === typeof state.inheritOpt(this, \"et-al-use-last\")) {\n                state.tmp[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n                //print(\"  set tmp et-al-use-last: \"+this.strings[\"et-al-use-last\"])\n            }\n        };\n        start_key.execs.push(func);\n        target.push(start_key);\n        \n        //\n        // ops to initialize the key's output structures\n        if (this.variables.length) {\n            var variable = this.variables[0];\n            if (CSL.NAME_VARIABLES.indexOf(variable) > -1) {\n                //\n                // Start tag\n                var names_start_token = new CSL.Token(\"names\", CSL.START);\n                names_start_token.tokentype = CSL.START;\n                names_start_token.variables = this.variables;\n                CSL.Node.names.build.call(names_start_token, state, target);\n                //\n                // Name tag\n                var name_token = new CSL.Token(\"name\", CSL.SINGLETON);\n                name_token.tokentype = CSL.SINGLETON;\n                name_token.strings[\"name-as-sort-order\"] = \"all\";\n                name_token.strings[\"sort-separator\"] = \" \";\n                name_token.strings[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n                name_token.strings[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n                name_token.strings[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n                CSL.Node.name.build.call(name_token, state, target);\n                //\n                // Institution tag\n                var institution_token = new CSL.Token(\"institution\", CSL.SINGLETON);\n                institution_token.tokentype = CSL.SINGLETON;\n                CSL.Node.institution.build.call(institution_token, state, target);\n                //\n                // End tag\n                var names_end_token = new CSL.Token(\"names\", CSL.END);\n                names_end_token.tokentype = CSL.END;\n                CSL.Node.names.build.call(names_end_token, state, target);\n            } else {\n                var single_text = new CSL.Token(\"text\", CSL.SINGLETON);\n                single_text.strings.sort_direction = this.strings.sort_direction;\n                single_text.dateparts = this.dateparts;\n                if (CSL.NUMERIC_VARIABLES.indexOf(variable) > -1) {\n                    // citation-number is virtualized. As a sort key it has no effect on registry\n                    // sort order per se, but if set to DESCENDING, it reverses the sequence of numbers representing\n                    // bib entries.\n                    if (variable === \"citation-number\") {\n                        func = function (state, Item) {\n                            if (state.tmp.area === \"bibliography_sort\") {\n                                if (this.strings.sort_direction === CSL.DESCENDING) {\n                                    state.bibliography_sort.opt.citation_number_sort_direction = CSL.DESCENDING;\n                                } else {\n                                    state.bibliography_sort.opt.citation_number_sort_direction = CSL.ASCENDING;\n                                }\n                            }\n                            if (state.tmp.area === \"citation_sort\" && state.bibliography_sort.tmp.citation_number_map) {\n                                var num = state.bibliography_sort.tmp.citation_number_map[state.registry.registry[Item.id].seq];\n                            } else {\n                                var num = state.registry.registry[Item.id].seq;\n                            }\n                            if (num) {\n                                // Code currently in util_number.js\n                                num = CSL.Util.padding(\"\" + num);\n                            }\n                            state.output.append(num, this);\n                        };\n                    } else {\n                        func = function (state, Item) {\n                            var num = false;\n                            num = Item[variable];\n                            // XXX What if this is NaN?\n                            if (num) {\n                                // Code currently in util_number.js\n                                num = CSL.Util.padding(num);\n                            }\n                            state.output.append(num, this);\n                        };\n                    }\n                } else if (variable === \"citation-label\") {\n                    func = function (state, Item) {\n                        var trigraph = state.getCitationLabel(Item);\n                        state.output.append(trigraph, this);\n                    };\n                } else if (CSL.DATE_VARIABLES.indexOf(variable) > -1) {\n                    func = CSL.dateAsSortKey;\n                    single_text.variables = this.variables;\n                } else if (\"title\" === variable) {\n                    var abbrevfam = \"title\";\n                    var abbrfall = false;\n                    var altvar = false;\n                    var transfall = true;\n                    func = state.transform.getOutputFunction(this.variables, abbrevfam, abbrfall, altvar, transfall);\n                } else if (\"court-class\" === variable) {\n                    func = function(state, Item, item) {\n                        CSL.INIT_JURISDICTION_MACROS(state, Item, item, \"juris-main\")\n                        // true is for sortKey mode\n                        var cls = CSL.GET_COURT_CLASS(state, Item, true);\n                        state.output.append(cls, \"empty\");\n                    }\n                } else {\n                    func = function (state, Item) {\n                        var varval = Item[variable];\n                        state.output.append(varval, \"empty\");\n                    };\n                }\n                single_text.execs.push(func);\n                target.push(single_text);\n            }\n        } else { // macro\n            //\n            // if it's not a variable, it's a macro\n            var token = new CSL.Token(\"text\", CSL.SINGLETON);\n            token.strings.sort_direction = this.strings.sort_direction;\n            token.postponed_macro = this.postponed_macro;\n            CSL.expandMacro.call(state, token, target);\n        }\n        //\n        // ops to output the key string result to an array go\n        // on the closing \"key\" tag before it is pushed.\n        // Do not close the level.\n        var end_key = new CSL.Token(\"key\", CSL.END);\n\n        // Eliminated at revision 1.0.159.\n        // Was causing non-fatal error \"wanted empty but found group\".\n        // Possible contributor to weird \"PAGES\" bug?\n        //func = function (state, Item) {\n        //state.output.closeLevel(\"empty\");\n        //};\n        //end_key.execs.push(func);\n        \n        // store key for use\n        func = function (state) {\n            var keystring = state.output.string(state, state.output.queue);\n            if (state.sys.normalizeUnicode) {\n                keystring = state.sys.normalizeUnicode(keystring);\n            }\n            keystring = keystring ? (keystring.split(\" \").join(state.opt.sort_sep) + state.opt.sort_sep) : \"\";\n            //SNIP-START\n            if (debug) {\n                CSL.debug(\"keystring: \" + keystring + \" \" + typeof keystring);\n            }\n            //print(\"keystring: (\" + keystring + \") \" + typeof keystring + \" \" + state.tmp.area);\n            //SNIP-END\n            //state.sys.print(\"keystring: (\" + keystring + \") \" + typeof keystring + \" \" + state.tmp.area);\n            if (\"\" === keystring) {\n                keystring = undefined;\n            }\n            if (\"string\" !== typeof keystring) {\n                keystring = undefined;\n                //state.tmp.empty_date = false;\n            }\n            state[state[state.tmp.area].root + \"_sort\"].keys.push(keystring);\n            state.tmp.value = [];\n        };\n        end_key.execs.push(func);\n\n        // Set year-suffix key on anything that looks like a date\n        if (state.build.date_key) {\n            if (state.build.area === \"citation\" && state.build.extension === \"_sort\") {\n                // ascending sort always\n                state[state.build.area].opt.sort_directions.push([-1,1]);\n                func = function (state, Item) {\n                    // year-suffix Key\n                    var year_suffix = state.registry.registry[Item.id].disambig.year_suffix;\n                    if (!year_suffix) {\n                        year_suffix = 0;\n                    }\n                    var key = CSL.Util.padding(\"\" + year_suffix);\n                    state[state.tmp.area].keys.push(key);\n                };\n                end_key.execs.push(func);\n            }\n            state.build.date_key = false;\n        }\n\n        // reset key params\n        func = function (state) {\n            // state.tmp.name_quash = new Object();\n\n            // XXX This should work, should be necessary, but doesn't and isn't.\n            //state.output.closeLevel(\"empty\");\n\n            state.tmp[\"et-al-min\"] = undefined;\n            state.tmp[\"et-al-use-first\"] = undefined;\n            state.tmp[\"et-al-use-last\"] = undefined;\n            state.tmp.sort_key_flag = false;\n        };\n        end_key.execs.push(func);\n        target.push(end_key);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.label = {\n    build: function (state, target) {\n        \n        if (this.strings.term) {\n            // Non-names labels\n            var func = function (state, Item, item) {\n                // Must accomplish this without touching strings\n                // shared with the calling application: \"sub verbo\"\n                // and \"sub-verbo\" must both pass, as they stand.\n                //if (item && item.label === \"sub verbo\") {\n                //    item.label = \"sub-verbo\";\n                //}\n                // This is abstracted away, because the same\n                // logic must be run in cs:names.\n                var termtxt = CSL.evaluateLabel(this, state, Item, item);\n                if (item && this.strings.term === \"locator\") {\n\n                    item.section_form_override = this.strings.form;\n\n                }\n                if (termtxt) {\n                    state.tmp.group_context.tip.term_intended = true;\n                }\n                CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, termtxt, null, this);\n                if (termtxt.indexOf(\"%s\") === -1) {\n                    // ^ Suppress output here if we have an embedded term\n                    if (this.strings.capitalize_if_first) {\n                        if (!state.tmp.term_predecessor && !(state.opt[\"class\"] === \"in-text\" && state.tmp.area === \"citation\")) {\n                            termtxt = CSL.Output.Formatters[\"capitalize-first\"](state, termtxt);\n                        }\n                    }\n                    state.output.append(termtxt, this);\n                }\n            };\n            this.execs.push(func);\n        } else {\n            if (!this.strings.form) {\n                this.strings.form = \"long\";\n            }\n            // Names labels\n            // Picked up in names END\n            var namevars = state.build.names_variables[state.build.names_variables.length-1];\n            var namelabels = state.build.name_label[state.build.name_label.length-1];\n            for (var i = 0, ilen = namevars.length; i < ilen; i += 1) {\n                if (!namelabels[namevars[i]]) {\n                    namelabels[namevars[i]] = {};\n                }\n            }\n            if (!state.build.name_flag) {\n                for (var i = 0, ilen = namevars.length; i < ilen; i += 1) {\n                    namelabels[namevars[i]].before = this;\n                }\n            } else {\n                for (var i = 0, ilen = namevars.length; i < ilen; i += 1) {\n                    namelabels[namevars[i]].after = this;\n                }\n            }\n        }\n        target.push(this);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.layout = {\n    build: function (state, target) {\n        var func, prefix_token, suffix_token, tok;\n\n        function setSuffix() {\n            if (state.build.area === \"bibliography\") {\n                suffix_token = new CSL.Token(\"text\", CSL.SINGLETON);\n                func = function(state) {\n                    // Suppress suffix on all but the last item in bibliography parallels\n                    if (!state.tmp.parallel_and_not_last) {\n                        var suffix;\n                        if (state.tmp.cite_affixes[state.tmp.area][state.tmp.last_cite_locale]) {\n                            suffix = state.tmp.cite_affixes[state.tmp.area][state.tmp.last_cite_locale].suffix;\n                        } else {\n                            suffix = state.bibliography.opt.layout_suffix;\n                        }\n\n                        // If @display is used, layout suffix is placed on the last\n                        // immediate child of the layout, which we assume will be a\n                        // @display group node.\n                        var topblob = state.output.current.value();\n                        if (state.opt.using_display) {\n                            topblob.blobs[topblob.blobs.length-1].strings.suffix = suffix;\n                        } else {\n                            topblob.strings.suffix = suffix;\n                        }\n                    }\n                    if (state.bibliography.opt[\"second-field-align\"]) {\n                        // closes bib_other\n                        state.output.endTag(\"bib_other\");\n                    }\n                };\n                suffix_token.execs.push(func);\n                target.push(suffix_token);\n            }\n        }\n\n        if (this.tokentype === CSL.START) {\n\n            if (this.locale_raw) {\n                state.build.current_default_locale = this.locale_raw;\n            } else {\n                state.build.current_default_locale = state.opt[\"default-locale\"];\n            }\n\n            func = function (state, Item, item) {\n                if (state.opt.development_extensions.apply_citation_wrapper\n                    && state.sys.wrapCitationEntry\n                    && !state.tmp.just_looking\n                    && Item.system_id \n                    && state.tmp.area === \"citation\") { \n\n                    var cite_entry = new CSL.Token(\"group\", CSL.START);\n                    cite_entry.decorations = [[\"@cite\", \"entry\"]];\n                    state.output.startTag(\"cite_entry\", cite_entry);\n                    state.output.current.value().item_id = Item.system_id;\n                    if (item) {\n                        state.output.current.value().locator_txt = item.locator_txt;\n                        state.output.current.value().suffix_txt = item.suffix_txt;\n                    }\n                }\n            };\n            this.execs.push(func);\n        }\n\n        // XXX Works, but using state.tmp looks wrong here? We're in the build layer ...\n        if (this.tokentype === CSL.START && !state.tmp.cite_affixes[state.build.area]) {\n            //\n            // done_vars is used to prevent the repeated\n            // rendering of variables\n            //\n            // initalize done vars\n            func = function (state, Item, item) {\n\n                state.tmp.done_vars = [];\n                if (item && item[\"author-only\"]) {\n                    state.tmp.done_vars.push(\"locator\");\n                }\n                if (state.opt.suppressedJurisdictions[Item[\"country\"]]\n                    && Item[\"country\"]\n                    && [\"treaty\", \"patent\"].indexOf(Item.type) === -1) {\n                    \n                    state.tmp.done_vars.push(\"country\");\n                }\n                if (!state.tmp.just_looking && state.registry.registry[Item.id] && state.registry.registry[Item.id].parallel) {\n                    state.tmp.done_vars.push(\"first-reference-note-number\");\n                }\n                // trimmer is not available in getAmbiguousCite\n                if (!state.tmp.just_looking && state.tmp.abbrev_trimmer && Item.jurisdiction) {\n                    for (var field in state.tmp.abbrev_trimmer.QUASHES[Item.jurisdiction]) {\n                        state.tmp.done_vars.push(field);\n                    }\n                }\n\n                //CSL.debug(\" === init rendered_name === \");\n                state.tmp.rendered_name = false;\n            };\n            this.execs.push(func);\n            // set opt delimiter\n            func = function (state) {\n                // just in case\n                state.tmp.sort_key_flag = false;\n            };\n            this.execs.push(func);\n            \n            // reset nameset counter [all nodes]\n            func = function (state) {\n                state.tmp.nameset_counter = 0;\n            };\n            this.execs.push(func);\n\n            func = function (state, Item) {\n                var tok = new CSL.Token();\n                state.output.openLevel(tok);\n            };\n            this.execs.push(func);\n            target.push(this);\n\n            if (state.build.area === \"citation\") {\n                prefix_token = new CSL.Token(\"text\", CSL.SINGLETON);\n                func = function (state, Item, item) {\n                    if (item && item.prefix) {\n                        var prefix = CSL.checkPrefixSpaceAppend(state, item.prefix);\n                        if (!state.tmp.just_looking) {\n                            prefix = state.output.checkNestedBrace.update(prefix);\n                        }\n                        var ignorePredecessor = CSL.checkIgnorePredecessor(state, prefix);\n                        state.output.append(prefix, this, false, ignorePredecessor);\n                    }\n                };\n                prefix_token.execs.push(func);\n                target.push(prefix_token);\n            }\n        }\n\n        // Cast token to be used in one of the configurations below.\n        var my_tok;\n        if (this.locale_raw) {\n            my_tok = new CSL.Token(\"dummy\", CSL.START);\n            my_tok.locale = this.locale_raw;\n            my_tok.strings.delimiter = this.strings.delimiter;\n            my_tok.strings.suffix = this.strings.suffix;\n            if (!state.tmp.cite_affixes[state.build.area]) {\n                state.tmp.cite_affixes[state.build.area] = {};\n            }\n        }\n\n        if (this.tokentype === CSL.START) {\n            state.build.layout_flag = true;\n                            \n            // Only run the following once, to set up the final layout node ...\n            if (!this.locale_raw) {\n                //\n                // save out decorations for flipflop processing [final node only]\n                //\n                state[state.tmp.area].opt.topdecor = [this.decorations];\n                state[(state.tmp.area + \"_sort\")].opt.topdecor = [this.decorations];\n\n                state[state.build.area].opt.layout_prefix = this.strings.prefix;\n                state[state.build.area].opt.layout_suffix = this.strings.suffix;\n                state[state.build.area].opt.layout_delimiter = this.strings.delimiter;\n\n                state[state.build.area].opt.layout_decorations = this.decorations;\n                \n                // Only do this if we're running conditionals\n                if (state.tmp.cite_affixes[state.build.area]) {\n                    // if build_layout_locale_flag is true,\n                    // write cs:else START to the token list.\n                    tok = new CSL.Token(\"else\", CSL.START);\n                    CSL.Node[\"else\"].build.call(tok, state, target);\n                }\n\n            } // !this.locale_raw\n\n            // Conditionals\n            if (this.locale_raw) {\n                if (!state.build.layout_locale_flag) {\n                    // if layout_locale_flag is untrue,\n                    // write cs:choose START and cs:if START\n                    // to the token list.\n                    var choose_tok = new CSL.Token(\"choose\", CSL.START);\n                    CSL.Node.choose.build.call(choose_tok, state, target);\n                    my_tok.name = \"if\";\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"if\"].build.call(my_tok, state, target);\n                } else {\n                    // if build_layout_locale_flag is true,\n                    // write cs:else-if START to the token list.\n                    my_tok.name = \"else-if\";\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"else-if\"].build.call(my_tok, state, target);\n                }\n                // cite_affixes for this node\n                state.tmp.cite_affixes[state.build.area][my_tok.locale] = {};\n                state.tmp.cite_affixes[state.build.area][my_tok.locale].delimiter = this.strings.delimiter;\n                state.tmp.cite_affixes[state.build.area][my_tok.locale].suffix = this.strings.suffix;\n            }\n        }\n        if (this.tokentype === CSL.END) {\n            if (this.locale_raw) {\n                setSuffix();\n                if (!state.build.layout_locale_flag) {\n                    // If layout_locale_flag is untrue, write cs:if END\n                    // to the token list.\n                    my_tok.name = \"if\";\n                    my_tok.tokentype = CSL.END;\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"if\"].build.call(my_tok, state, target);\n                    state.build.layout_locale_flag = true;\n                } else {\n                    // If layout_locale_flag is true, write cs:else-if END\n                    // to the token list.\n                    my_tok.name = \"else-if\";\n                    my_tok.tokentype = CSL.END;\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"else-if\"].build.call(my_tok, state, target);\n                }\n            }\n            if (!this.locale_raw) {\n                setSuffix();\n                // Only add this if we're running conditionals\n                if (state.tmp.cite_affixes[state.build.area]) {\n                    // If layout_locale_flag is true, write cs:else END\n                    // and cs:choose END to the token list.\n                    if (state.build.layout_locale_flag) {\n                        tok = new CSL.Token(\"else\", CSL.END);\n                        CSL.Node[\"else\"].build.call(tok, state, target);\n                        tok = new CSL.Token(\"choose\", CSL.END);\n                        CSL.Node.choose.build.call(tok, state, target);\n                    }\n                }\n                state.build_layout_locale_flag = true;\n                if (state.build.area === \"citation\") {\n                    suffix_token = new CSL.Token(\"text\", CSL.SINGLETON);\n                    func = function (state, Item, item) {\n                        var sp;\n                        if (item && item.suffix) {\n                            var suffix = CSL.checkSuffixSpacePrepend(state, item.suffix);\n                            if (!state.tmp.just_looking) {\n                                suffix = state.output.checkNestedBrace.update(suffix);\n                            }\n                            state.output.append((suffix), this);\n                        }\n                    };\n                    suffix_token.execs.push(func);\n                    target.push(suffix_token);\n                }\n\n                // Closes wrapper token\n                func = function (state) {\n                    state.output.closeLevel();\n                };\n                this.execs.push(func);\n                func = function (state, Item) {\n                    if (state.opt.development_extensions.apply_citation_wrapper\n                        && state.sys.wrapCitationEntry\n                        && !state.tmp.just_looking\n                        && Item.system_id \n                        && state.tmp.area === \"citation\") { \n                        \n                        state.output.endTag(); // closes citation link wrapper\n                    }\n                };\n                this.execs.push(func);\n                target.push(this);\n                state.build.layout_flag = false;\n                state.build.layout_locale_flag = false;\n            } // !this.layout_raw\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.macro = {\n    build: function () {}\n};\n\n/*global CSL: true */\n\nCSL.Node.alternative = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.START);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n            var if_tok = new CSL.Token(\"if\", CSL.START);\n            CSL.Attributes[\"@alternative-node-internal\"].call(if_tok, state);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n            var func = function(state, Item) {\n\n                state.tmp.oldItem = Item;\n                state.tmp.oldLang = state.opt.lang;\n                state.tmp.abort_alternative = true;\n\n                if (Item[\"language-name\"] && Item[\"language-name-original\"]) {\n\n                    var newItem = JSON.parse(JSON.stringify(Item));\n\n                    newItem.language = newItem[\"language-name\"];\n                    var langspec = CSL.localeResolve(newItem.language, state.opt[\"default-locale\"][0]);\n\n                    if (state.opt.multi_layout) {\n                        for (var i in state.opt.multi_layout) {\n                            var locale_list = state.opt.multi_layout[i];\n                            var gotlang = false;\n                            for (var j in locale_list) {\n                                var tryspec = locale_list[j];\n                                if (langspec.best === tryspec.best || langspec.base === tryspec.base || langspec.bare === tryspec.bare) {\n                                    gotlang = locale_list[0].best;\n                                    break;\n                                }\n                            }\n                            if (!gotlang) {\n                                gotlang = state.opt[\"default-locale\"][0];\n                            }\n                            state.opt.lang = gotlang;\n                        }\n                    }\n\n                    for (var key in newItem) {\n                        if ([\"id\", \"type\", \"language\", \"multi\"].indexOf(key) === -1 && key.slice(0, 4) !== \"alt-\") {\n                            if (newItem.multi && newItem.multi._keys[key]) {\n                                var deleteme = true;\n                                for (var lang in newItem.multi._keys[key]) {\n                                    if (langspec.bare === lang.replace(/^([a-zA-Z]+).*/, \"$1\")) {\n                                        deleteme = false;\n                                        break;\n                                    }\n                                }\n                                if (deleteme) {\n                                    delete newItem[key];\n                                }\n                            } else {\n                                delete newItem[key];\n                            }\n                        }\n                    }\n                    for (var key in newItem) {\n                        if (key.slice(0, 4) === \"alt-\") {\n                            newItem[key.slice(4)] = newItem[key];\n                            state.tmp.abort_alternative = false;\n                        } else {\n                            if (newItem.multi && newItem.multi._keys) {\n                                if (!newItem[\"alt-\" + key] && newItem.multi._keys[key]) {\n                                    if (newItem.multi._keys[key][langspec.best]) {\n                                        newItem[key] = newItem.multi._keys[key][langspec.best];\n                                        state.tmp.abort_alternative = false;\n                                    } else if (newItem.multi._keys[key][langspec.base]) {\n                                        newItem[key] = newItem.multi._keys[key][langspec.base];\n                                        state.tmp.abort_alternative = false;\n                                    } else if (newItem.multi._keys[key][langspec.bare]) {\n                                        newItem[key] = newItem.multi._keys[key][langspec.bare];\n                                        state.tmp.abort_alternative = false;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n\n                state.output.openLevel(this);\n                state.registry.refhash[Item.id] = newItem;\n                state.nameOutput = new CSL.NameOutput(state, newItem);\n            };\n            this.execs.push(func);\n            target.push(this);\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.START);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n            var if_tok = new CSL.Token(\"if\", CSL.START);\n            CSL.Attributes[\"@alternative-node-internal\"].call(if_tok, state);\n            var func = function(state) {\n                state.tmp.abort_alternative = true;\n            }\n            if_tok.execs.push(func);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n        } else if (this.tokentype === CSL.END) {\n\n            var if_tok = new CSL.Token(\"if\", CSL.END);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.END);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n            var func = function(state, Item) {\n                state.output.closeLevel();\n                state.registry.refhash[Item.id] = state.tmp.oldItem;\n                state.opt.lang = state.tmp.oldLang;\n                state.nameOutput = new CSL.NameOutput(state, state.tmp.oldItem);\n                state.tmp.abort_alternative = false;\n            };\n            this.execs.push(func);\n            target.push(this);\n\n            var if_tok = new CSL.Token(\"if\", CSL.END);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.END);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n        }\n    }\n};\n\nCSL.Node[\"alternative-text\"] = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.SINGLETON) {\n            // do stuff\n            var func = function(state, Item) {\n                var Item = state.refetchItem(Item.id);\n                CSL.getCite.call(state, Item);\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.NameOutput = function(state, Item, item) {\n    this.debug = false;\n    //SNIP-START\n    if (this.debug) {\n        print(\"(1)\");\n    }\n    //SNIP-END\n    this.state = state;\n    this.Item = Item;\n    this.item = item;\n    this.nameset_base = 0;\n    this.etal_spec = {};\n    this._first_creator_variable = false;\n    this._please_chop = false;\n};\n\nCSL.NameOutput.prototype.init = function (names) {\n    this.requireMatch = names.requireMatch;\n    if (this.state.tmp.term_predecessor) {\n        this.state.tmp.subsequent_author_substitute_ok = false;\n    }\n    if (this.nameset_offset) {\n        this.nameset_base = this.nameset_base + this.nameset_offset;\n    }\n    this.nameset_offset = 0;\n    this.names = names;\n    this.variables = names.variables;\n\n    this.state.tmp.value = [];\n    this.state.tmp.rendered_name = [];\n    this.state.tmp.label_blob = false;\n    this.state.tmp.etal_node = false;\n    this.state.tmp.etal_term = false;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        if (this.Item[this.variables[i]] && this.Item[this.variables[i]].length) {\n            this.state.tmp.value = this.state.tmp.value.concat(this.Item[this.variables[i]]);\n        }\n    }\n    this[\"et-al\"] = undefined;\n    // REMOVE THIS\n    this[\"with\"] = undefined;\n\n    this.name = undefined;\n    // long, long-with-short, short\n    this.institutionpart = {};\n    // family, given\n    //this.namepart = {};\n    // before, after\n    //this.label = {};\n\n    this.state.tmp.group_context.tip.variable_attempt = true;\n\n    this.labelVariable = this.variables[0];\n\n    if (!this.state.tmp.value.length) {\n        return;\n    }\n\n    // Abort and proceed to the next substitution if a match is required,\n    // two variables are called, and they do not match.\n    var checkCommonTerm = this.checkCommonAuthor(this.requireMatch);\n    if (checkCommonTerm) {\n        this.state.tmp.can_substitute.pop();\n        this.state.tmp.can_substitute.push(true);\n        //this.state.tmp.group_context.mystack[this.state.tmp.group_context.mystack.length-1].variable_success = false;\n        for (var i in this.variables) {\n            var idx = this.state.tmp.done_vars.indexOf(this.variables[i]);\n            if (idx > -1) {\n                this.state.tmp.done_vars = this.state.tmp.done_vars.slice(0, idx).concat(this.state.tmp.done_vars.slice(i+1));\n            }\n        }\n        this.state.tmp.common_term_match_fail = true;\n        this.variables = [];\n    }\n};\n\n\nCSL.NameOutput.prototype.reinit = function (names, labelVariable) {\n    this.requireMatch = names.requireMatch;\n    this.labelVariable = labelVariable;\n\n    if (this.state.tmp.can_substitute.value()) {\n        this.nameset_offset = 0;\n        // What-all should be carried across from the subsidiary\n        // names node, and on what conditions? For each attribute,\n        // and decoration, is it an override, or is it additive?\n        this.variables = names.variables;\n        \n        // Not sure why this is necessary. Guards against a memory leak perhaps?\n        var oldval = this.state.tmp.value.slice();\n        this.state.tmp.value = [];\n\n        for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n            if (this.Item[this.variables[i]] && this.Item[this.variables[i]].length) {\n                this.state.tmp.value = this.state.tmp.value.concat(this.Item[this.variables[i]]);\n            }\n        }\n        if (this.state.tmp.value.length) {\n            this.state.tmp.can_substitute.replace(false, CSL.LITERAL);\n        }\n\n        this.state.tmp.value = oldval;\n\n    }\n    // Abort and proceed to the next substitution if a match is required,\n    // two variables are called, and they do not match.\n    var checkCommonTerm = this.checkCommonAuthor(this.requireMatch);\n    if (checkCommonTerm) {\n        this.state.tmp.can_substitute.pop();\n        this.state.tmp.can_substitute.push(true);\n        for (var i in this.variables) {\n            var idx = this.state.tmp.done_vars.indexOf(this.variables[i]);\n            if (idx > -1) {\n                this.state.tmp.done_vars = this.state.tmp.done_vars.slice(0, idx).concat(this.state.tmp.done_vars.slice(i+1));\n            }\n        }\n        this.variables = [];\n    }\n};\n\nCSL.NameOutput.prototype.outputNames = function () {\n    var i, ilen;\n    var variables = this.variables;\n    if (this.institution.and) {\n        if (!this.institution.and.single.blobs || !this.institution.and.single.blobs.length) {\n            this.institution.and.single.blobs = this.name.and.single.blobs;\n        }\n        if (!this.institution.and.multiple.blobs || !this.institution.and.multiple.blobs.length) {\n            this.institution.and.multiple.blobs = this.name.and.multiple.blobs;\n        }\n    }\n\n    this.variable_offset = {};\n    if (this.family) {\n        this.family_decor = CSL.Util.cloneToken(this.family);\n        this.family_decor.strings.prefix = \"\";\n        this.family_decor.strings.suffix = \"\";\n        // Sets text-case value (text-case=\"title\" is suppressed for items\n        // non-English with non-English value in Item.language)\n        for (i = 0, ilen = this.family.execs.length; i < ilen; i += 1) {\n            this.family.execs[i].call(this.family_decor, this.state, this.Item);\n        }\n    } else {\n        this.family_decor = false;\n    }\n\n    if (this.given) {\n        this.given_decor = CSL.Util.cloneToken(this.given);\n        this.given_decor.strings.prefix = \"\";\n        this.given_decor.strings.suffix = \"\";\n        // Sets text-case value (text-case=\"title\" is suppressed for items\n        // non-English with non-English value in Item.language)\n        for (i = 0, ilen = this.given.execs.length; i < ilen; i += 1) {\n            this.given.execs[i].call(this.given_decor, this.state, this.Item);\n        }\n    } else {\n        this.given_decor = false;\n    }\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(2)\");\n    }\n    //SNIP-END\n    // util_names_etalconfig.js\n    this.getEtAlConfig();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(3)\");\n    }\n    //SNIP-END\n    // util_names_divide.js\n    this.divideAndTransliterateNames();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(4)\");\n    }\n    //SNIP-END\n    // util_names_truncate.js\n\n    this.truncatePersonalNameLists();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(5)\");\n    }\n    //SNIP-END\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(6)\");\n    }\n    //SNIP-END\n    // util_names_disambig.js\n    this.disambigNames();\n\n    // util_names_constraints.js\n    this.constrainNames();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(7)\");\n    }\n    //SNIP-END\n    // form=\"count\"\n    if (this.name.strings.form === \"count\") {\n        if (this.state.tmp.extension || this.names_count != 0) {\n            this.state.output.append(this.names_count, \"empty\");\n            this.state.tmp.group_context.tip.variable_success = true;\n        }\n        return;\n    }\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(8)\");\n    }\n    //SNIP-END\n    this.setEtAlParameters();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(9)\");\n    }\n    //SNIP-END\n    this.setCommonTerm(this.requireMatch);\n    //SNIP-START\n    if (this.debug) {\n        print(\"(10)\");\n    }\n    //SNIP-END\n    this.renderAllNames();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(11)\");\n    }\n    //SNIP-END\n    var blob_list = [];\n    for (i = 0, ilen = variables.length; i < ilen; i += 1) {\n        var v = variables[i];\n        var institution_sets = [];\n        var institutions = false;\n        var varblob = null;\n        if (!this.state.opt.development_extensions.spoof_institutional_affiliations) {\n            varblob = this._join([this.freeters[v]], \"\");\n        } else {\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11a)\");\n            }\n            //SNIP-END\n            for (var j = 0, jlen = this.institutions[v].length; j < jlen; j += 1) {\n                institution_sets.push(this.joinPersonsAndInstitutions([this.persons[v][j], this.institutions[v][j]]));\n            }\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11b)\");\n            }\n            //SNIP-END\n            if (this.institutions[v].length) {\n                var pos = this.nameset_base + this.variable_offset[v];\n                if (this.freeters[v].length) {\n                    pos += 1;\n                }\n                institutions = this.joinInstitutionSets(institution_sets, pos);\n            }\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11c)\");\n            }\n            //SNIP-END\n            var varblob = this.joinFreetersAndInstitutionSets([this.freeters[v], institutions]);\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11d)\");\n            }\n            //SNIP-END\n        }\n        if (varblob) {\n            // Apply labels, if any\n            if (!this.state.tmp.extension) {\n                varblob = this._applyLabels(varblob, v);\n            }\n            blob_list.push(varblob);\n        }\n        //SNIP-START\n        if (this.debug) {\n            print(\"(11e)\");\n        }\n        //SNIP-END\n        if (this.common_term) {\n            break;\n        }\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"(12)\");\n    }\n    //SNIP-END\n    this.state.output.openLevel(\"empty\");\n    this.state.output.current.value().strings.delimiter = this.state.inheritOpt(this.names, \"delimiter\", \"names-delimiter\");\n    //SNIP-START\n    if (this.debug) {\n        print(\"(13)\");\n    }\n    //SNIP-END\n    for (i = 0, ilen = blob_list.length; i < ilen; i += 1) {\n        // notSerious\n        this.state.output.append(blob_list[i], \"literal\", true);\n    }\n    if (!this.state.tmp.just_looking && blob_list.length > 0) {\n        this.state.tmp.probably_rendered_something = true;\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"(14)\");\n    }\n    //SNIP-END\n    this.state.output.closeLevel(\"empty\");\n    //SNIP-START\n    if (this.debug) {\n        print(\"(15)\");\n    }\n    //SNIP-END\n    var blob = this.state.output.pop();\n    this.state.tmp.name_node.top = blob;\n    //SNIP-START\n    if (this.debug) {\n        print(\"(16)\");\n    }\n    //SNIP-END\n\n    // Append will drop the names on the floor here if suppress-me is\n    // set on element_trace.\n    // Need to rescue the value for collapse comparison.\n    var namesToken = CSL.Util.cloneToken(this.names);\n    if (this.state.tmp.group_context.tip.condition) {\n        CSL.UPDATE_GROUP_CONTEXT_CONDITION(this.state, this.names.strings.prefix, null, this.names);\n    }\n    this.state.output.append(blob, namesToken);\n    if (this.state.tmp.term_predecessor_name) {\n        this.state.tmp.term_predecessor = true;\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"(17)\");\n    }\n    //SNIP-END\n    // Also used in CSL.Util.substituteEnd (which could do with\n    // some cleanup at this writing).\n    //SNIP-START\n    if (this.debug) {\n        print(\"(18)\");\n    }\n    //SNIP-END\n    if (variables[0] !== \"authority\") {\n        // Just grab the string values in the name\n        var name_node_string = [];\n        var nameobjs = this.Item[variables[0]];\n        if (nameobjs) {\n            for (var i = 0, ilen = nameobjs.length; i < ilen; i += 1) {\n                var substring = CSL.Util.Names.getRawName(nameobjs[i]);\n                if (substring) {\n                    name_node_string.push(substring);\n                }\n            }\n        }\n        name_node_string = name_node_string.join(\", \");\n        if (name_node_string) {\n            this.state.tmp.name_node.string = name_node_string;\n        }\n    }\n    // for classic support\n    // This may be more convoluted than it needs to be. Or maybe not.\n    //\n    // Check for classic abbreviation\n    //\n    // If found, then (1) suppress title rendering, (2) replace the node\n    // with the abbreviation output [and (3) do not run this._collapseAuthor() ?]\n    if (this.state.tmp.name_node.string && !this.state.tmp.first_name_string) {\n        this.state.tmp.first_name_string = this.state.tmp.name_node.string;\n    }\n    if (\"classic\" === this.Item.type) {\n        if (this.state.tmp.first_name_string) {\n            var author_title = [];\n            author_title.push(this.state.tmp.first_name_string);\n            if (this.Item.title) {\n                author_title.push(this.Item.title);\n            }\n            author_title = author_title.join(\", \");\n            if (author_title && this.state.sys.getAbbreviation) {\n                if (this.state.sys.normalizeAbbrevsKey) {\n                    author_title = this.state.sys.normalizeAbbrevsKey(\"classic\", author_title);\n                }\n                this.state.transform.loadAbbreviation(\"default\", \"classic\", author_title, this.Item.language);\n                if (this.state.transform.abbrevs[\"default\"].classic[author_title]) {\n                    this.state.tmp.done_vars.push(\"title\");\n                    this.state.output.append(this.state.transform.abbrevs[\"default\"].classic[author_title], \"empty\", true);\n                    blob = this.state.output.pop();\n\t\t\t\t    this.state.tmp.name_node.top.blobs.pop();\n                    this.state.tmp.name_node.top.blobs.push(blob);\n                }\n            }\n        }\n    }\n\n    // Let's try something clever here.\n    this._collapseAuthor();\n\n    // For name_SubstituteOnNamesSpanNamesSpanFail\n    this.variables = [];\n    \n    // Reset stop-last after rendering\n    this.state.tmp.authority_stop_last = 0;\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(19)\");\n    }\n    //SNIP-END\n};\n\nCSL.NameOutput.prototype._applyLabels = function (blob, v) {\n    var txt;\n    if (!this.label || !this.label[this.labelVariable]) {\n        return blob;\n    }\n    var plural = 0;\n    var num = this.freeters_count[v] + this.institutions_count[v];\n    if (num > 1) {\n        plural = 1;\n    } else {\n        for (var i = 0, ilen = this.persons[v].length; i < ilen; i += 1) {\n            num += this.persons_count[v][i];\n        }\n        if (num > 1) {\n            plural = 1;\n        }\n    }\n    // Some code duplication here, should be factored out.\n    if (this.label[this.labelVariable].before) {\n        if (\"number\" === typeof this.label[this.labelVariable].before.strings.plural) {\n            plural = this.label[this.labelVariable].before.strings.plural;\n        }\n        txt = this._buildLabel(v, plural, \"before\", this.labelVariable);\n        this.state.output.openLevel(\"empty\");\n        this.state.output.append(txt, this.label[this.labelVariable].before, true);\n        this.state.output.append(blob, \"literal\", true);\n        this.state.output.closeLevel(\"empty\");\n        blob = this.state.output.pop();\n    } else if (this.label[this.labelVariable].after) {\n        if (\"number\" === typeof this.label[this.labelVariable].after.strings.plural) {\n            plural = this.label[this.labelVariable].after.strings.plural;\n        }\n        txt = this._buildLabel(v, plural, \"after\", this.labelVariable);\n        this.state.output.openLevel(\"empty\");\n        this.state.output.append(blob, \"literal\", true);\n        this.state.output.append(txt, this.label[this.labelVariable].after, true);\n        this.state.tmp.label_blob = this.state.output.pop();\n        this.state.output.append(this.state.tmp.label_blob,\"literal\",true);\n        this.state.output.closeLevel(\"empty\");\n        blob = this.state.output.pop();\n    }\n    return blob;\n};\n\nCSL.NameOutput.prototype._buildLabel = function (term, plural, position, v) {\n    if (this.common_term) {\n        term = this.common_term;\n    }\n\n    var ret = false;\n    var node = this.label[v][position];\n    if (node) {\n        ret = CSL.castLabel(this.state, node, term, plural, CSL.TOLERANT);\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype._collapseAuthor = function () {\n    var myqueue, mystr, oldchars;\n    // collapse can be undefined, an array of length zero, and probably\n    // other things ... ugh.\n    if (this.state.tmp.name_node.top.blobs.length === 0) {\n        return;\n    }\n    if (this.nameset_base === 0 && this.Item[this.variables[0]] && !this._first_creator_variable) {\n        this._first_creator_variable = this.variables[0];\n    }\n    if ((this.state[this.state.tmp.area].opt.collapse\n            && this.state[this.state.tmp.area].opt.collapse.length)\n        || (this.state[this.state.tmp.area].opt.cite_group_delimiter \n            && this.state[this.state.tmp.area].opt.cite_group_delimiter.length)) {\n\n        if (this.state.tmp.authorstring_request) {\n            // Avoid running this on every call to getAmbiguousCite()?\n            mystr = \"\";\n            myqueue = this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs;\n            oldchars = this.state.tmp.offset_characters;\n            if (myqueue) {\n                mystr = this.state.output.string(this.state, myqueue, false);\n            }\n            // Avoid side-effects on character counting: we're only interested\n            // in the final rendering.\n            this.state.tmp.offset_characters = oldchars;\n            this.state.registry.authorstrings[this.Item.id] = mystr;\n        } else if (!this.state.tmp.just_looking\n                   && !this.state.tmp.suppress_decorations && ((this.state[this.state.tmp.area].opt.collapse && this.state[this.state.tmp.area].opt.collapse.length) || this.state[this.state.tmp.area].opt.cite_group_delimiter && this.state[this.state.tmp.area].opt.cite_group_delimiter)) {\n            // XX1 print(\"RENDER: \"+this.Item.id);\n            mystr = \"\";\n            myqueue = this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs;\n            oldchars = this.state.tmp.offset_characters;\n            if (myqueue) {\n                mystr = this.state.output.string(this.state, myqueue, false);\n            }\n            if (mystr === this.state.tmp.last_primary_names_string) {\n                if (this.item[\"suppress-author\"] || (this.state[this.state.tmp.area].opt.collapse && this.state[this.state.tmp.area].opt.collapse.length)) {\n                    // XX1 print(\"    CUT!\");\n                    this.state.tmp.name_node.top.blobs.pop();\n                    this.state.tmp.name_node.children = [];\n                    // If popped, avoid side-effects on character counting: we're only interested\n                    // in things that actually render.\n                    this.state.tmp.offset_characters = oldchars;\n                }\n                // Needed\n                if (this.state[this.state.tmp.area].opt.cite_group_delimiter && this.state[this.state.tmp.area].opt.cite_group_delimiter) {\n                    this.state.tmp.use_cite_group_delimiter = true;\n                }\n            } else {\n                // XX1 print(\"remembering: \"+mystr);\n                this.state.tmp.last_primary_names_string = mystr;\n                // XXXXX A little more precision would be nice.\n                // This will clobber variable=\"author editor\" as well as variable=\"author\".\n\n                if (this.variables.indexOf(this._first_creator_variable) > -1 && this.item && this.item[\"suppress-author\"] && this.Item.type !== \"legal_case\") {\n                    this.state.tmp.name_node.top.blobs.pop();\n                    this.state.tmp.name_node.children = [];\n                    // If popped, avoid side-effects on character counting: we're only interested\n                    // in things that actually render.\n                    this.state.tmp.offset_characters = oldchars;\n\n                    // A wild guess, but will usually be correct\n                    this.state.tmp.term_predecessor = false;\n                }\n                // Arcane and probably unnecessarily complicated?\n                this.state.tmp.have_collapsed = false;\n                // Needed\n                if (this.state[this.state.tmp.area].opt.cite_group_delimiter && this.state[this.state.tmp.area].opt.cite_group_delimiter) {\n                    this.state.tmp.use_cite_group_delimiter = false;\n                }\n            }\n        }\n    }\n};\n\n/*\nCSL.NameOutput.prototype.suppressNames = function() {\n    suppress_condition = suppress_min && display_names.length >= suppress_min;\n    if (suppress_condition) {\n        continue;\n    }\n}\n*/\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.isPerson = function (value) {\n    if (value.literal\n        || (!value.given && value.family && value.isInstitution)) {\n        \n        return false;\n    } else {\n        return true;\n    }\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.truncatePersonalNameLists = function () {\n    var v, i, ilen, j, jlen, chopvar, values;\n    // XXX Before truncation, make a note of the original number\n    // of names, for use in et-al evaluation.\n    this.freeters_count = {};\n    this.persons_count = {};\n    this.institutions_count = {};\n    // By key is okay here, as we don't care about sequence.\n    for (v in this.freeters) {\n        if (this.freeters.hasOwnProperty(v)) {\n            this.freeters_count[v] = this.freeters[v].length;\n            this.freeters[v] = this._truncateNameList(this.freeters, v);\n        }\n    }\n\n    for (v in this.persons) {\n        if (this.persons.hasOwnProperty(v)) {\n            this.institutions_count[v] = this.institutions[v].length;\n            this._truncateNameList(this.institutions, v);\n            this.persons[v] = this.persons[v].slice(0, this.institutions[v].length);\n            this.persons_count[v] = [];\n            for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n                this.persons_count[v][j] = this.persons[v][j].length;\n                this.persons[v][j] = this._truncateNameList(this.persons, v, j);\n            }\n        }\n    }\n    if (this.state.opt.development_extensions.etal_min_etal_usefirst_hack\n        && this.etal_min === 1 && this.etal_use_first === 1 \n        && !(this.state.tmp.extension\n             || this.state.tmp.just_looking)) {\n        chopvar = v;\n    } else {\n        chopvar = false;\n    }\n    if (chopvar || this._please_chop) {\n        for (i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n            v = this.variables[i];\n            if (this.freeters[v].length) {\n                if (this._please_chop === v) {\n                    this.freeters[v] = this.freeters[v].slice(1);\n                    this.freeters_count[v] += -1;\n                    this._please_chop = false;\n                } else if (chopvar && !this._please_chop) {\n                    this.freeters[v] = this.freeters[v].slice(0, 1);\n                    this.freeters_count[v] = 1;\n                    this.institutions[v] = [];\n                    this.persons[v] = [];\n                    this._please_chop = chopvar;\n                }\n            }\n            for (var j=0,jlen = this.persons[v].length;j<jlen;j++) {\n                if (this.persons[v][j].length) {\n                    if (this._please_chop === v) {\n                        this.persons[v][j] = this.persons[v][j].slice(1);\n                        this.persons_count[v][j] += -1;\n                        this._please_chop = false;\n                        break;\n                    } else if (chopvar && !this._please_chop) {\n                        this.freeters[v] = this.persons[v][j].slice(0, 1);\n                        this.freeters_count[v] = 1;\n                        this.institutions[v] = [];\n                        this.persons[v] = [];\n                        values = [];\n                        this._please_chop = chopvar;\n                        break;\n                    }\n                }\n            }\n            if (this.institutions[v].length) {\n                if (this._please_chop === v) {\n                    this.institutions[v] = this.institutions[v].slice(1);\n                    this.institutions_count[v] += -1;\n                    this._please_chop = false;\n                } else if (chopvar && !this._please_chop) {\n                    this.institutions[v] = this.institutions[v].slice(0, 1);\n                    this.institutions_count[v] = 1;\n                    values = [];\n                    this._please_chop = chopvar;\n                }\n            }\n        }\n    }\n\n    // Transliteration and abbreviation mapping\n\n    // Hmm. This could produce three lists for each nameset:\n    //   - primary (transformed in place)\n    //   - secondary\n    //   - tertiary\n    // with items that produce no result in the secondary and tertiary\n    // transforms set to false. Maybe.\n\n    // Actually that would be insane, so forget it.\n    // What we need is to add suitable parameters to getName(), and merge\n    // the single-name-level operations below into that function. Then the\n    // operation can be applied in util_names_render.js, and the logic\n    // becomes very similar to what we already have running in util_transform.js.\n\n/*\n    for (v in this.freeters) {\n        this._transformNameset(this.freeters[v]);\n    }\n    for (v in this.persons) {\n        for (i = 0, ilen = this.persons[v].length; i < ilen; i += 1) {\n            this._transformNameset(this.persons[v][i]);\n        }\n        this._transformNameset(this.institutions[v]);\n    }\n*/\n\n    // Could also be factored out to a separate function for clarity.\n    // ???? XXX Does this belong?\n    for (i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        if (this.institutions[v].length) {\n            this.nameset_offset += 1;\n        }\n        for (var j=0,jlen=this.persons[v].length;j<jlen;j++) {\n            if (this.persons[v][j].length) {\n                this.nameset_offset += 1;\n            }\n            // this.institutions[v][i] = this._splitInstitution(this.institutions[v][i], v, i);\n        }\n    }\n};\n\nCSL.NameOutput.prototype._truncateNameList = function (container, variable, index) {\n    var lst;\n    if (\"undefined\" === typeof index) {\n        lst = container[variable];\n    } else {\n        lst = container[variable][index];\n    }\n    if (this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names \n        && lst.length > 50 \n        && lst.length > (this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names + 2)) {\n\n        // Preserve the last name in the list, in case we're rendering with a PI ellipsis (et-al-use-last)\n        var limit = this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names;\n        lst = lst.slice(0, limit+1).concat(lst.slice(-1));\n    }\n    return lst;\n};\n\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.divideAndTransliterateNames = function () {\n    var i, ilen, j, jlen;\n    var Item = this.Item;\n    var variables = this.variables;\n    this.varnames = variables.slice();\n    this.freeters = {};\n    this.persons = {};\n    this.institutions = {};\n    for (i = 0, ilen = variables.length; i < ilen; i += 1) {\n        var v = variables[i];\n        this.variable_offset[v] = this.nameset_offset;\n        var values = this._normalizeVariableValue(Item, v);\n        if (this.name.strings[\"suppress-min\"] && values.length >= this.name.strings[\"suppress-min\"]) {\n            values = [];\n        }\n        if (this.name.strings[\"suppress-max\"] && values.length <= this.name.strings[\"suppress-max\"]) {\n            values = [];\n        }\n        this._getFreeters(v, values);\n        this._getPersonsAndInstitutions(v, values);\n        if (this.state.opt.development_extensions.spoof_institutional_affiliations) {\n            if (this.name.strings[\"suppress-min\"] === 0) {\n                this.freeters[v] = [];\n                for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n                    this.persons[v][j] = [];\n                }\n            } else if (this.institution.strings[\"suppress-min\"] === 0) {\n                this.institutions[v] = [];\n                this.freeters[v] = this.freeters[v].concat(this.persons[v]);\n                for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n                    for (var k = 0, klen = this.persons[v][j].length; k < klen; k += 1) {\n                        this.freeters[v].push(this.persons[v][j][k]);\n                    }\n                }\n                this.persons[v] = [];\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._normalizeVariableValue = function (Item, variable) {\n    var names;\n    if (\"string\" === typeof Item[variable] || \"number\" === typeof Item[variable]) {\n        CSL.debug(\"name variable \\\"\" + variable + \"\\\" is string or number, not array. Attempting to fix.\");\n        names = [{literal: Item[variable] + \"\"}];\n    } else if (!Item[variable]) {\n        names = [];\n    } else if (\"number\" !== typeof Item[variable].length) {\n        CSL.debug(\"name variable \\\"\" + variable + \"\\\" is object, not array. Attempting to fix.\");\n        Item[variable] = [Item[variable]];\n        names = Item[variable].slice();\n    } else {\n        names = Item[variable].slice();\n    }\n    return names;\n};\n\nCSL.NameOutput.prototype._getFreeters = function (v, values) {\n    this.freeters[v] = [];\n    if (this.state.opt.development_extensions.spoof_institutional_affiliations) {\n        for (var i=values.length-1;i>-1;i--) {\n            if (this.isPerson(values[i])) {\n                var value = this._checkNickname(values.pop());\n                if (value) {\n                    this.freeters[v].push(value);\n                }\n            } else {\n                break;\n            }\n        }\n    } else {\n        for (var i=values.length-1;i>-1;i--) {\n            var value = values.pop();\n            if (this.isPerson(value)) {\n                var value = this._checkNickname(value);\n            }\n            this.freeters[v].push(value);\n        }\n    }\n    this.freeters[v].reverse();\n    if (this.freeters[v].length) {\n        this.nameset_offset += 1;\n    }\n};\n\nCSL.NameOutput.prototype._getPersonsAndInstitutions = function (v, values) {\n    this.persons[v] = [];\n    this.institutions[v] = [];\n    if (!this.state.opt.development_extensions.spoof_institutional_affiliations) {\n        return;\n    }\n    var persons = [];\n    var has_affiliates = false;\n    var first = true;\n    for (var i = values.length - 1; i > -1; i += -1) {\n        if (this.isPerson(values[i])) {\n            var value = this._checkNickname(values[i]);\n            if (value) {\n                persons.push(value);\n            }\n        } else {\n            has_affiliates = true;\n            this.institutions[v].push(values[i]);\n            if (!first) {\n                persons.reverse();\n                this.persons[v].push(persons);\n                persons = [];\n            }\n            first = false;\n        }\n    }\n    if (has_affiliates) {\n        persons.reverse();\n        this.persons[v].push(persons);\n        this.persons[v].reverse();\n        this.institutions[v].reverse();\n    }\n};\n\nCSL.NameOutput.prototype._clearValues = function (values) {\n    for (var i = values.length - 1; i > -1; i += -1) {\n        values.pop();\n    }\n};\n\nCSL.NameOutput.prototype._checkNickname = function (name) {\n    if ([\"interview\", \"personal_communication\"].indexOf(this.Item.type) > -1) {\n        var author = \"\";\n        author = CSL.Util.Names.getRawName(name);\n        if (author && this.state.sys.getAbbreviation && !(this.item && this.item[\"suppress-author\"])) {\n            var normalizedKey = author;\n            if (this.state.sys.normalizeAbbrevsKey) {\n                // The first argument does not have to be the exact variable name.\n                normalizedKey = this.state.sys.normalizeAbbrevsKey(\"author\", author);\n            }\n            this.state.transform.loadAbbreviation(\"default\", \"nickname\", normalizedKey, this.Item.language);\n            // XXX Why does this have to happen here?\n            var myLocalName = this.state.transform.abbrevs[\"default\"].nickname[normalizedKey];\n            if (myLocalName) {\n                if (myLocalName === \"!here>>>\") {\n                    name = false;\n                } else {\n                    name = {family:myLocalName,given:''};\n                }\n            }\n        }\n    }\n    return name;\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype._purgeEmptyBlobs = function (blobs) {\n    for (var i = blobs.length - 1; i > -1; i += -1) {\n        if (!blobs[i] || blobs[i].length === 0 || !blobs[i].blobs.length) {\n            blobs = blobs.slice(0, i).concat(blobs.slice(i + 1));\n        }\n    }\n    return blobs;\n};\n\nCSL.NameOutput.prototype.joinPersons = function (blobs, pos, j, tokenname) {\n    var ret;\n    blobs = this._purgeEmptyBlobs(blobs);\n    if (!tokenname) {\n        tokenname = \"name\";\n    }\n    if (\"undefined\" === typeof j) {\n        if (this.etal_spec[pos].freeters === 1) {\n           ret = this._joinEtAl(blobs);\n        } else if (this.etal_spec[pos].freeters === 2) {\n            ret = this._joinEllipsis(blobs);\n        } else if (!this.state.tmp.sort_key_flag) {\n            ret = this._joinAnd(blobs);\n        } else {\n            ret = this._join(blobs, this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \"));\n        }\n    } else {\n        if (this.etal_spec[pos].persons[j] === 1) {\n            ret = this._joinEtAl(blobs);\n        } else if (this.etal_spec[pos].persons[j] === 2) {\n            ret = this._joinEllipsis(blobs);\n        } else if (!this.state.tmp.sort_key_flag) {\n            ret = this._joinAnd(blobs);\n        } else {\n            ret = this._join(blobs, this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \"));\n        }\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype.joinInstitutionSets = function (blobs, pos) {\n    var ret;\n    blobs = this._purgeEmptyBlobs(blobs);\n    if (this.etal_spec[pos].institutions === 1) {\n        ret = this._joinEtAl(blobs, \"institution\");\n    } else if (this.etal_spec[pos].institutions === 2) {\n        ret = this._joinEllipsis(blobs, \"institution\");\n    } else {\n        ret = this._joinAnd(blobs);\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype.joinPersonsAndInstitutions = function (blobs) {\n    //\n    blobs = this._purgeEmptyBlobs(blobs);\n    var ret = this._join(blobs, this.state.tmp.name_delimiter);\n    ret.isInstitution = true;\n    return ret;\n};\n\n// LEGACY\n// This should go away eventually\nCSL.NameOutput.prototype.joinFreetersAndInstitutionSets = function (blobs) {\n    // Nothing, one or two, never more\n    blobs = this._purgeEmptyBlobs(blobs);\n    var ret = this._join(blobs, \"[never here]\", this[\"with\"].single, this[\"with\"].multiple);\n    //var ret = this._join(blobs, \"\");\n    return ret;\n};\n\nCSL.NameOutput.prototype._getAfterInvertedName = function(blobs, delimiter, finalJoin) {\n    if (finalJoin && blobs.length > 1) {\n        if (this.state.inheritOpt(this.name, \"delimiter-precedes-last\") === \"after-inverted-name\") {\n            var prevBlob = blobs[blobs.length - 2];\n            if (prevBlob.blobs.length > 0 && prevBlob.blobs[0].isInverted) {\n                finalJoin.strings.prefix = delimiter;\n            }\n        }\n    }\n    return finalJoin;\n}\n\nCSL.NameOutput.prototype._getAndJoin = function (blobs, delimiter) {\n    var finalJoin = false;\n    if (blobs.length > 1) {\n        var singleOrMultiple = \"single\";\n        if (blobs.length > 2) {\n            singleOrMultiple = \"multiple\";\n        }\n        if (blobs[blobs.length - 1].isInstitution) {\n            finalJoin = this.institution.and[singleOrMultiple];\n        } else {\n            finalJoin = this.name.and[singleOrMultiple];\n        }\n        // finalJoin = new CSL.Blob(finalJoin);\n        finalJoin = JSON.parse(JSON.stringify(finalJoin));\n        finalJoin = this._getAfterInvertedName(blobs, delimiter, finalJoin);\n    }\n    return finalJoin;\n};\n\nCSL.NameOutput.prototype._joinEtAl = function (blobs) {\n    var delimiter = this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \");\n    var blob = this._join(blobs, delimiter);\n    \n    // notSerious\n    this.state.output.openLevel(this._getToken(\"name\"));\n    // Delimiter is applied from separately saved source in this case,\n    // for discriminate application of single and multiple joins.\n    this.state.output.current.value().strings.delimiter = \"\";\n    this.state.output.append(blob, \"literal\", true);\n    if (blobs.length > 1) {\n        this.state.output.append(this[\"et-al\"].multiple, \"literal\", true);\n    } else if (blobs.length === 1) {\n        this.state.output.append(this[\"et-al\"].single, \"literal\", true);\n    }\n    this.state.output.closeLevel();\n    return this.state.output.pop();\n};\n\n\nCSL.NameOutput.prototype._joinEllipsis = function (blobs) {\n    var delimiter = this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \");\n    var finalJoin = false;\n    if (blobs.length > 1) {\n        var singleOrMultiple = \"single\";\n        if (blobs.length > 2) {\n            singleOrMultiple = \"multiple\";\n        }\n        finalJoin = JSON.parse(JSON.stringify(this.name.ellipsis[singleOrMultiple]));\n        finalJoin = this._getAfterInvertedName(blobs, delimiter , finalJoin);\n        \n    }\n    return this._join(blobs, delimiter, finalJoin);\n};\n\nCSL.NameOutput.prototype._joinAnd = function (blobs) {\n    var delimiter = this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \");\n    var finalJoin = this._getAndJoin(blobs, delimiter);\n    return this._join(blobs, delimiter, finalJoin);\n};\n\n\nCSL.NameOutput.prototype._join = function (blobs, delimiter, finalJoin) {\n    var i, ilen;\n    if (!blobs) {\n        return false;\n    }\n    blobs = this._purgeEmptyBlobs(blobs);\n    if (!blobs.length) {\n        return false;\n    }\n    if (blobs.length > 1) {\n        if (blobs.length === 2) {\n            if (!finalJoin) {\n                blobs[0].strings.suffix += delimiter;\n            } else {\n                blobs = [blobs[0], finalJoin, blobs[1]];\n            }\n        } else {\n            var offset;\n            if (finalJoin) {\n                offset = 1;\n            } else {\n                offset = 0;\n            }\n            var blob = blobs.pop();\n            for (var i=0,ilen=blobs.length - offset;i<ilen;i++) {\n                blobs[i].strings.suffix += delimiter;\n            }\n            blobs.push(finalJoin);\n            blobs.push(blob);\n        }\n    }\n\n    //this.state.output.openLevel(this._getToken(tokenname));\n    this.state.output.openLevel();\n\n    //this.state.output.openLevel(this._getToken(\"empty\"));\n    // Delimiter is applied from separately saved source in this case,\n    // for discriminate application of single and multiple joins.\n    for (i = 0, ilen = blobs.length; i < ilen; i += 1) {\n        this.state.output.append(blobs[i], false, true);\n    }\n    this.state.output.closeLevel();\n    return this.state.output.pop();\n};\n\n\nCSL.NameOutput.prototype._getToken = function (tokenname) {\n    var token = this[tokenname];\n    if (tokenname === \"institution\") {\n        var newtoken = new CSL.Token();\n        // Which, hmm, is the same thing as \"empty\"\n        // Oh, well.\n        //newtoken.strings.prefix = token.prefix;\n        //newtoken.strings.suffix = token.suffix;\n        return newtoken;\n    }\n    return token;\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.checkCommonAuthor = function(requireMatch) {\n    if (!requireMatch) {\n        return false;\n    }\n    var common_term = false;\n    if (this.variables.length === 2) {\n        var variables = this.variables;\n        var varnames = variables.slice();\n        varnames.sort();\n        common_term = varnames.join(\"\");\n    }\n    if (!common_term) {\n        return false;\n    }\n    var has_term = false;\n    if (this.state.locale[this.state.opt.lang].terms[common_term]) {\n        has_term = true;\n    }\n    if (!has_term) {\n        this.state.tmp.done_vars.push(this.variables[0]);\n        this.state.tmp.done_vars.push(this.variables[1]);\n        return false;\n    }\n    var firstSet = this.Item[this.variables[0]];\n    var secondSet = this.Item[this.variables[1]];\n    var perfectMatch = this._compareNamesets(firstSet, secondSet);\n    if (perfectMatch === true) {\n        this.state.tmp.done_vars.push(this.variables[0]);\n        this.state.tmp.done_vars.push(this.variables[1]);\n    }\n    // This may be counter-intuitive.\n    // This check controls whether we will fail on the this attempt at rendering\n    // and proceed with substitution. If the names match exactly (true), then\n    // we do *not* want to abort and continue with substitution.\n    return !perfectMatch;\n};\n\nCSL.NameOutput.prototype.setCommonTerm = function () {\n    var variables = this.variables;\n    var varnames = variables.slice();\n    varnames.sort();\n    this.common_term = varnames.join(\"\");\n    // When no varnames are on offer\n    if (!this.common_term) {\n        return;\n    }\n    var has_term = false;\n    if (this.label && this.label[this.variables[0]]) {\n        if (this.label[this.variables[0]].before) {\n            has_term = this.state.getTerm(this.common_term, this.label[this.variables[0]].before.strings.form, 0);\n        } else if (this.label[this.variables[0]].after) {\n            has_term = this.state.getTerm(this.common_term, this.label[this.variables[0]].after.strings.form, 0);\n        }\n     }\n\n    // When there is no common term\n    if (!this.state.locale[this.state.opt.lang].terms[this.common_term]\n        || !has_term\n        || this.variables.length < 2) {\n        this.common_term = false;\n        return;\n    }\n    var freeters_offset = 0;\n    for (var i = 0, ilen = this.variables.length - 1; i < ilen; i += 1) {\n        var v = this.variables[i];\n        var vv = this.variables[i + 1];\n        if (this.freeters[v].length || this.freeters[vv].length) {\n            if (this.etal_spec[v].freeters !== this.etal_spec[vv].freeters\n                || !this._compareNamesets(this.freeters[v], this.freeters[vv])) {\n                this.common_term = false;\n                return;\n            }\n            freeters_offset += 1;\n        }\n        if (this.persons[v].length !== this.persons[vv].length) {\n            this.common_term = false;\n            return;\n        }\n        for (var j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            if (this.etal_spec[v].persons[j] !== this.etal_spec[vv].persons[j]\n                || !this._compareNamesets(this.persons[v][j], this.persons[vv][j])) {\n                this.common_term = false;\n                return;\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._compareNamesets = function (base_nameset, nameset) {\n    if (!base_nameset || !nameset || base_nameset.length !== nameset.length) {\n        return false;\n    }\n    for (var i = 0, ilen = nameset.length; i < ilen; i += 1) {\n        for (var j = 0, jlen = CSL.NAME_PARTS.length; j < jlen; j += 1) {\n            var part = CSL.NAME_PARTS[j];\n            if (!base_nameset[i] || base_nameset[i][part] != nameset[i][part]) {\n                return false;\n            }\n        }\n    }\n    return true;\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.constrainNames = function () {\n    // figure out how many names to include, in light of the disambig params\n    //\n    this.names_count = 0;\n    //var pos = 0;\n    var pos;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        pos = this.nameset_base + i;\n        // Constrain independent authors here\n        if (this.freeters[v].length) {\n            this.state.tmp.names_max.push(this.freeters[v].length, \"literal\");\n            this._imposeNameConstraints(this.freeters, this.freeters_count, v, pos);\n            this.names_count += this.freeters[v].length;\n        }\n\n        // Constrain institutions here\n        if (this.institutions[v].length) {\n            this.state.tmp.names_max.push(this.institutions[v].length, \"literal\");\n            this._imposeNameConstraints(this.institutions, this.institutions_count, v, pos);\n            this.persons[v] = this.persons[v].slice(0, this.institutions[v].length);\n            this.names_count += this.institutions[v].length;\n        }\n\n        for (var j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            // Constrain affiliated authors here\n            if (this.persons[v][j].length) {\n                this.state.tmp.names_max.push(this.persons[v][j].length, \"literal\");\n                this._imposeNameConstraints(this.persons[v], this.persons_count[v], j, pos);\n                this.names_count += this.persons[v][j].length;\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._imposeNameConstraints = function (lst, count, key, pos) {\n    // display_names starts as the original length of this list of names.\n    var display_names = lst[key];\n    var discretionary_names_length = this.state.tmp[\"et-al-min\"];\n    \n    // Mappings, to allow existing disambiguation machinery to\n    // remain untouched.\n    if (this.state.tmp.suppress_decorations) {\n        if (this.state.tmp.disambig_request && this.state.tmp.disambig_request.names[pos]) {\n            // Oh. Trouble.\n            // state.tmp.nameset_counter is the number of the nameset\n            // in the disambiguation try-sequence. Ouch.\n            discretionary_names_length = this.state.tmp.disambig_request.names[pos];\n        } else if (count[key] >= this.etal_min) {\n            discretionary_names_length = this.etal_use_first;\n        }\n    } else {\n        if (this.state.tmp.disambig_request \n            && this.state.tmp.disambig_request.names[pos] > this.etal_use_first) {\n\n            if (count[key] < this.etal_min) {\n                discretionary_names_length = count[key];\n            } else {\n                discretionary_names_length = this.state.tmp.disambig_request.names[pos];\n            }\n        } else if (count[key] >= this.etal_min) {\n            //discretionary_names_length = this.state.tmp[\"et-al-use-first\"];\n            discretionary_names_length = this.etal_use_first;\n        }\n        // XXXX: This is a workaround. Under some conditions.\n        // Where namesets disambiguate on one of the two names\n        // dropped here, it is possible for more than one\n        // in-text citation to be close (and indistinguishable)\n        // matches to a single bibliography entry.\n        //\n        // \n        if (this.etal_use_last && discretionary_names_length > (this.etal_min - 2)) {\n            discretionary_names_length = this.etal_min - 2;\n        }\n    }\n    var sane = this.etal_min >= this.etal_use_first;\n    var overlength = count[key] > discretionary_names_length;\n    // This var is used to control contextual join, and\n    // lies about the number of names when forceEtAl is true,\n    // unless normalized.\n    if (discretionary_names_length > count[key]) {\n\n        // Use actual truncated list length, to avoid overrun.\n        discretionary_names_length = display_names.length;\n    }\n    // forceEtAl is relevant when the author list is\n    // truncated to eliminate clutter.\n    if (sane && overlength) {\n        if (this.etal_use_last) {\n            lst[key] = display_names.slice(0, discretionary_names_length).concat(display_names.slice(-1));\n        } else {\n            lst[key] = display_names.slice(0, discretionary_names_length);\n        }\n    }\n    this.state.tmp.disambig_settings.names[pos] = lst[key].length;\n    this.state.disambiguate.padBase(this.state.tmp.disambig_settings);\n    \n\n    // ???\n    //if (!this.state.tmp.disambig_request) {\n    //    this.state.tmp.disambig_settings.givens[pos] = [];\n    //}\n};\n\n// Disambiguate names (the number of names is controlled externally, by successive\n// runs of the processor).\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.disambigNames = function () {\n    var pos;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        pos = this.nameset_base + i;\n        if (this.freeters[v].length) {\n            this._runDisambigNames(this.freeters[v], pos);\n        }\n        // Is this even necessary???\n        if (this.institutions[v].length) {\n            if (\"undefined\" === typeof this.state.tmp.disambig_settings.givens[pos]) {\n                this.state.tmp.disambig_settings.givens[pos] = [];\n            }\n            for (var j=0,jlen=this.institutions[v].length;j<jlen;j+=1) {\n                if (\"undefined\" === typeof this.state.tmp.disambig_settings.givens[pos][j]) {\n                    this.state.tmp.disambig_settings.givens[pos].push(2);\n                }\n            }\n        }\n        for (var j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            if (this.persons[v][j].length) {\n                this._runDisambigNames(this.persons[v][j], pos);\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._runDisambigNames = function (lst, pos) {\n    var chk, myform, myinitials, param, i, ilen, paramx;\n    //if (this.state.tmp.root === \"bibliography\") {\n    //    return;\n    //}\n    for (i = 0, ilen = lst.length; i < ilen; i += 1) {\n        //\n        // register the name in the global names disambiguation\n        // registry\n\n        if (!lst[i].given && !lst[i].family) {\n            continue;\n        }\n\n        myinitials = this.state.inheritOpt(this.name, \"initialize-with\");\n        this.state.registry.namereg.addname(\"\" + this.Item.id, lst[i], i);\n        chk = this.state.tmp.disambig_settings.givens[pos];\n        if (\"undefined\" === typeof chk) {\n            // Holes can appear in the list, probably due to institutional\n            // names that this doesn't touch. Maybe. This fills them up.\n            for (var j = 0, jlen = pos + 1; j < jlen; j += 1) {\n                if (!this.state.tmp.disambig_settings.givens[j]) {\n                    this.state.tmp.disambig_settings.givens[j] = [];\n                }\n            }\n        }\n        chk = this.state.tmp.disambig_settings.givens[pos][i];\n        //if (\"undefined\" !== typeof chk && this.state.tmp.root === 'citation') {\n            //this.state.tmp.disambig_settings.givens[pos] = [];\n            //chk = undefined;\n        //}\n        if (\"undefined\" === typeof chk) {\n            myform = this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\");\n            param = this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, 0, myform, myinitials);\n            this.state.tmp.disambig_settings.givens[pos].push(param);\n        }\n        //\n        // set the display mode default for givennames if required\n        myform = this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\");\n        paramx = this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, 0, myform, myinitials);\n        // this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, 0, myform, myinitials);\n        if (this.state.tmp.disambig_request) {\n            //\n            // fix a request for initials that makes no sense.\n            // can't do this in disambig, because the availability\n            // of initials is not a global parameter.\n            var val = this.state.tmp.disambig_settings.givens[pos][i];\n            // This is limited to by-cite disambiguation.\n            // 2012-09-13: added lst[i].given check to condition\n            if (val === 1 && \n                this.state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\" && \n                (\"undefined\" === typeof this.state.inheritOpt(this.name, \"initialize-with\")\n                 || \"undefined\" === typeof lst[i].given)) {\n                val = 2;\n            }\n            param = val;\n            // 2012-09-13: lst[i].given check protects against personal names\n            // that have no first name element. These were causing an infinite loop,\n            // this prevents that.\n            if (this.state.opt[\"disambiguate-add-givenname\"] && lst[i].given) {\n                param = this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, param, this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\"), this.state.inheritOpt(this.name, \"initialize-with\"));\n            }\n        } else {\n            //\n            // it clicks.  here is where we will put the\n            // call to the names register, to get the floor value\n            // for an individual name.\n            //\n            param = paramx;\n        }\n        // Need to save off the settings based on subsequent\n        // form, when first cites are rendered.\n        if (!this.state.tmp.just_looking && this.item && this.item.position === CSL.POSITION_FIRST) {\n            if (paramx > param) {\n                param = paramx;\n            }\n        }\n        if (!this.state.tmp.sort_key_flag) {\n            this.state.tmp.disambig_settings.givens[pos][i] = param;\n            if (\"string\" === typeof myinitials\n                && (\"undefined\" === typeof this.name.strings[\"initialize\"]\n                    || true === this.name.strings[\"initialize\"])) {\n\n                this.state.tmp.disambig_settings.use_initials = true;\n            }\n        }\n    }\n    //this.state.registry.registry[this.Item.id].disambig.givens = this.state.tmp.disambig_settings.givens.slice();\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.getEtAlConfig = function () {\n    var item = this.item;\n    this[\"et-al\"] = {};\n\n    this.state.output.append(this.etal_term, this.etal_style, true);\n    this[\"et-al\"].single = this.state.output.pop();\n    this[\"et-al\"].single.strings.suffix = this.etal_suffix;\n    this[\"et-al\"].single.strings.prefix = this.etal_prefix_single;\n    \n    this.state.output.append(this.etal_term, this.etal_style, true);\n    this[\"et-al\"].multiple = this.state.output.pop();\n    this[\"et-al\"].multiple.strings.suffix = this.etal_suffix;\n    this[\"et-al\"].multiple.strings.prefix = this.etal_prefix_multiple;\n\n    // Et-al style parameters (may be sidestepped by disambiguation\n    // in util_names_constraints.js)\n    if (\"undefined\" === typeof item) {\n        item = {};\n    }\n    //print(\"== getEtAlConfig() == \"+this.state.tmp.area);\n\n    if (item.position) {\n        if (this.state.inheritOpt(this.name, \"et-al-subsequent-min\")) {\n            // XX\n            this.etal_min = this.state.inheritOpt(this.name, \"et-al-subsequent-min\");\n        } else {\n            // XX\n            this.etal_min = this.state.inheritOpt(this.name, \"et-al-min\");\n        }\n        if (this.state.inheritOpt(this.name, \"et-al-subsequent-use-first\")) {\n            // XX\n            this.etal_use_first = this.state.inheritOpt(this.name, \"et-al-subsequent-use-first\");\n        } else {\n            // XX\n            this.etal_use_first = this.state.inheritOpt(this.name, \"et-al-use-first\");\n        }\n    } else {\n        if (this.state.tmp[\"et-al-min\"]) {\n            this.etal_min = this.state.tmp[\"et-al-min\"];\n        } else {\n            // XX\n            this.etal_min = this.state.inheritOpt(this.name, \"et-al-min\");\n        }\n        if (this.state.tmp[\"et-al-use-first\"]) {\n            this.etal_use_first = this.state.tmp[\"et-al-use-first\"];\n        } else {\n            // XX\n            this.etal_use_first = this.state.inheritOpt(this.name, \"et-al-use-first\");\n        }\n        if (\"boolean\" === typeof this.state.tmp[\"et-al-use-last\"]) {\n            //print(\"  etal_use_last from tmp: \"+this.state.tmp[\"et-al-use-last\"]);\n            this.etal_use_last = this.state.tmp[\"et-al-use-last\"];\n        } else {\n            //print(\"  etal_use_last from name: \"+this.name.strings[\"et-al-use-last\"]);\n            // XX\n            this.etal_use_last = this.state.inheritOpt(this.name, \"et-al-use-last\");\n        }\n        //print(\"  etal_use_last: \"+this.etal_use_last);\n    }\n    // Provided for use as the starting level for disambiguation.\n    if (!this.state.tmp[\"et-al-min\"]) {\n        this.state.tmp[\"et-al-min\"] = this.etal_min;\n    }\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.setEtAlParameters = function () {\n    var i, ilen, j, jlen;\n    for (i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        if (\"undefined\" === typeof this.etal_spec[v]) {\n            this.etal_spec[v] = {freeters:0,institutions:0,persons:[]};\n        }\n        this.etal_spec[this.nameset_base + i] = this.etal_spec[v];\n        if (this.freeters[v].length) {\n            this._setEtAlParameter(\"freeters\", v);\n        }\n        for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            if (\"undefined\" === typeof this.etal_spec[v][j]) {\n                this.etal_spec[v].persons[j] = 0;\n            }\n            this._setEtAlParameter(\"persons\", v, j);\n        }\n        if (this.institutions[v].length) {\n            this._setEtAlParameter(\"institutions\", v);\n        }\n    }\n};\n\nCSL.NameOutput.prototype._setEtAlParameter = function (type, v, j) {\n    var lst, count;\n    if (type === \"persons\") {\n        lst = this.persons[v][j];\n        count = this.persons_count[v][j];\n    } else {\n        lst = this[type][v];\n        count = this[type + \"_count\"][v];\n    }\n    if (lst.length < count && !this.state.tmp.sort_key_flag) {\n        if (this.etal_use_last) {\n            if (type === \"persons\") {\n                this.etal_spec[v].persons[j] = 2;\n            } else {\n                this.etal_spec[v][type] = 2;\n            }\n        } else {\n            if (type === \"persons\") {\n                this.etal_spec[v].persons[j] = 1;\n            } else {\n                this.etal_spec[v][type] = 1;\n            }\n        }\n    } else {\n        if (type === \"persons\") {\n            this.etal_spec[v].persons[j] = 0;\n        } else {\n            this.etal_spec[v][type] = 0;\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.renderAllNames = function () {\n    // Note that et-al/ellipsis parameters are set on the basis\n    // of rendering order through the whole cite.\n    var pos;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n\n        if (this.freeters[v].length || this.institutions[v].length) {\n            if (!this.state.tmp.group_context.tip.condition) {\n                this.state.tmp.just_did_number = false;\n            }\n        }\n        \n        pos = this.nameset_base + i;\n        if (this.freeters[v].length) {\n            this.freeters[v] = this._renderNames(v, this.freeters[v], pos);\n        }\n        for (var j = 0, jlen = this.institutions[v].length; j < jlen; j += 1) {\n            this.persons[v][j] = this._renderNames(v, this.persons[v][j], pos, j);\n        }\n    }\n    this.renderInstitutionNames();\n};\n\nCSL.NameOutput.prototype.renderInstitutionNames = function () {\n    // Institutions are split to string list as\n    // this.institutions[v][\"long\"] and this.institutions[v][\"short\"]\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        for (var j = 0, jlen = this.institutions[v].length; j < jlen; j += 1) {\n            var institution;\n\n            var name = this.institutions[v][j];\n\n            \n\n            // XXX Start here for institutions\n            // Figure out the three segments: primary, secondary, tertiary\n            var j, jlen, localesets;\n            if (this.state.tmp.extension) {\n                localesets = [\"sort\"];\n            } else if (name.isInstitution || name.literal) {\n                // Will never hit this in this function, but preserving\n                // in case we factor this out.\n                localesets = this.state.opt['cite-lang-prefs'].institutions;\n            } else {\n                localesets = this.state.opt['cite-lang-prefs'].persons;\n            }\n\n            var slot = {primary:'locale-orig',secondary:false,tertiary:false};\n\t        if (localesets) {\n\t\t        var slotnames = [\"primary\", \"secondary\", \"tertiary\"];\n\t\t        for (var k = 0, klen = slotnames.length; k < klen; k += 1) {\n\t\t\t        if (localesets.length - 1 <  k) {\n\t\t\t\t        break;\n\t\t\t        }\n                    if (localesets[k]) {\n\t\t\t            slot[slotnames[k]] = 'locale-' + localesets[k];\n                    }\n\t\t        }\n\t        } else {\n\t\t        slot.primary = 'locale-translat';\n\t        }\n\t        if (this.state.tmp.area !== \"bibliography\"\n\t\t        && !(this.state.tmp.area === \"citation\"\n\t\t\t         && this.state.opt.xclass === \"note\"\n\t\t\t         && this.item && !this.item.position)) {\n                \n\t\t        slot.secondary = false;\n\t\t        slot.tertiary = false;\n\t        }\n            // Get normalized name object for a start.\n            // true invokes fallback\n            this.setRenderedName(name);\n\n            // XXXX FROM HERE (instututions)\n            var institution = this._renderInstitutionName(v, name, slot, j);\n\n            //this.institutions[v][j] = this._join(institution, \"\");\n            this.institutions[v][j] = institution;\n        }\n    }\n};\n\nCSL.NameOutput.prototype._renderInstitutionName = function (v, name, slot, j) {\n    var secondary, tertiary, long_style, short_style, institution, institution_short, institution_long;\n    var res = this.getName(name, slot.primary, true);\n    var primary = res.name;\n    var usedOrig = res.usedOrig;\n    if (primary) {\n        //print(\"primary, v, j = \"+primary+\", \"+v+\", \"+j);\n        primary = this.fixupInstitution(primary, v, j);\n    }\n\tsecondary = false;\n\tif (slot.secondary) {\n        res = this.getName(name, slot.secondary, false, usedOrig);\n        var secondary = res.name;\n        usedOrig = res.usedOrig;\n        if (secondary) {\n\t\t\tsecondary = this.fixupInstitution(secondary, v, j);\n        }\n\t}\n    //Zotero.debug(\"XXX [2] secondary: \"+secondary[\"long\"].literal+\", slot.secondary: \"+slot.secondary);\n\ttertiary = false;\n\tif (slot.tertiary) {\n        res = this.getName(name, slot.tertiary, false, usedOrig);\n        tertiary = res.name;\n        if (tertiary) {\n\t\t\ttertiary = this.fixupInstitution(tertiary, v, j);\n        }\n\t}\n    var n = {\n        l: {\n            pri: false,\n            sec: false,\n            ter: false\n        },\n        s: {\n            pri: false,\n            sec: false,\n            ter: false\n        }\n    };\n    if (primary) {\n        n.l.pri = primary[\"long\"];\n        n.s.pri = primary[\"short\"].length ? primary[\"short\"] : primary[\"long\"];\n    }\n    if (secondary) {\n        n.l.sec = secondary[\"long\"];\n        n.s.sec = secondary[\"short\"].length ? secondary[\"short\"] : secondary[\"long\"];\n    }\n    if (tertiary) {\n        n.l.ter = tertiary[\"long\"];\n        n.s.ter = tertiary[\"short\"].length ? tertiary[\"short\"] : tertiary[\"long\"];\n    }\n    switch (this.institution.strings[\"institution-parts\"]) {\n    case \"short\":\n        // No multilingual for pure short form institution names.\n        if (primary[\"short\"].length) {\n            short_style = this._getShortStyle();\n            institution = [this._composeOneInstitutionPart([n.s.pri, n.s.sec, n.s.ter], slot, short_style, v)];\n        } else {\n            // Fail over to long.\n            long_style = this._getLongStyle(primary, v, j);\n            institution = [this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v)];\n        }\n        break;\n    case \"short-long\":\n        long_style = this._getLongStyle(primary, v, j);\n        short_style = this._getShortStyle();\n        institution_short = this._renderOneInstitutionPart(primary[\"short\"], short_style);\n        // true is to include multilingual supplement\n        institution_long = this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v);\n        institution = [institution_short, institution_long];\n        break;\n    case \"long-short\":\n        long_style = this._getLongStyle(primary, v, j);\n        short_style = this._getShortStyle();\n        institution_short = this._renderOneInstitutionPart(primary[\"short\"], short_style);\n        // true is to include multilingual supplement\n        institution_long = this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v);\n        institution = [institution_long, institution_short];\n        break;\n    default:\n        long_style = this._getLongStyle(primary, v, j);\n        // true is to include multilingual supplement\n        institution = [this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v)];\n        break;\n    }\n    var blob = this._join(institution, \" \");\n    if (blob) {\n        blob.isInstitution = true;\n    }\n    this.state.tmp.name_node.children.push(blob);\n    return blob;\n};\n\nCSL.NameOutput.prototype._composeOneInstitutionPart = function (names, slot, style) {\n    var primary = false, secondary = false, tertiary = false, primary_tok, secondary_tok, tertiary_tok;\n    if (names[0]) {\n        primary_tok = CSL.Util.cloneToken(style);\n        if (this.state.opt.citeAffixes[slot.primary]){\n            if (\"<i>\" === this.state.opt.citeAffixes.institutions[slot.primary].prefix) {\n                var hasItalic = false;\n                for (var i = 0, ilen = primary_tok.decorations.length; i < ilen; i += 1) {\n                    if (style.decorations[i][0] === \"@font-style\"\n                        && primary_tok.decorations[i][1] === \"italic\") {\n                        hasItalic = true;\n                    }\n                }\n                if (!hasItalic) {\n                    primary_tok.decorations.push([\"@font-style\", \"italic\"]);\n                }\n            }\n        }\n        primary = this._renderOneInstitutionPart(names[0], primary_tok);\n     }\n    if (names[1]) {\n        secondary = this._renderOneInstitutionPart(names[1], style);\n    }\n    if (names[2]) {\n        tertiary = this._renderOneInstitutionPart(names[2], style);\n    }\n    // Compose\n    var institutionblob;\n    if (secondary || tertiary) {\n        this.state.output.openLevel(\"empty\");\n\n        this.state.output.append(primary);\n\n        secondary_tok = CSL.Util.cloneToken(style);\n        if (slot.secondary) {\n            secondary_tok.strings.prefix = this.state.opt.citeAffixes.institutions[slot.secondary].prefix;\n            secondary_tok.strings.suffix = this.state.opt.citeAffixes.institutions[slot.secondary].suffix;\n            // Add a space if empty\n            if (!secondary_tok.strings.prefix) {\n                secondary_tok.strings.prefix = \" \";\n            }\n        }\n        var secondary_outer = new CSL.Token();\n        secondary_outer.decorations.push([\"@font-style\", \"normal\"]);\n        secondary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n        this.state.output.openLevel(secondary_outer);\n        this.state.output.append(secondary, secondary_tok);\n        this.state.output.closeLevel();\n\n        tertiary_tok = CSL.Util.cloneToken(style);\n        if (slot.tertiary) {\n            tertiary_tok.strings.prefix = this.state.opt.citeAffixes.institutions[slot.tertiary].prefix;\n            tertiary_tok.strings.suffix = this.state.opt.citeAffixes.institutions[slot.tertiary].suffix;\n            // Add a space if empty\n            if (!tertiary_tok.strings.prefix) {\n                tertiary_tok.strings.prefix = \" \";\n            }\n        }\n        var tertiary_outer = new CSL.Token();\n        tertiary_outer.decorations.push([\"@font-style\", \"normal\"]);\n        tertiary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n        this.state.output.openLevel(tertiary_outer);\n        this.state.output.append(tertiary, tertiary_tok);\n        this.state.output.closeLevel();\n\n        this.state.output.closeLevel();\n\n        institutionblob = this.state.output.pop();\n    } else {\n        institutionblob = primary;\n    }\n    return institutionblob;\n};\n\nCSL.NameOutput.prototype._renderOneInstitutionPart = function (blobs, style) {\n    for (var i = 0, ilen = blobs.length; i < ilen; i += 1) {\n        if (blobs[i]) {\n            var str = blobs[i];\n            // XXXXX Cut-and-paste code in multiple locations. This code block should be\n            // collected in a function.\n            // Tag: strip-periods-block\n            if (this.state.tmp.strip_periods) {\n                str = str.replace(/\\./g, \"\");\n            } else {\n                for (var j = 0, jlen = style.decorations.length; j < jlen; j += 1) {\n                    if (\"@strip-periods\" === style.decorations[j][0] && \"true\" === style.decorations[j][1]) {\n                        str = str.replace(/\\./g, \"\");\n                        break;\n                    }\n                }\n            }\n            //this.state.output.append(blobs[i], style, true);\n            this.state.tmp.group_context.tip.variable_success = true;\n            this.state.tmp.can_substitute.replace(false, CSL.LITERAL);\n            if (str === \"!here>>>\") {\n                blobs[i] = false;\n            } else {\n                this.state.output.append(str, style, true);\n                blobs[i] = this.state.output.pop();\n            }\n        }\n    }\n    if (\"undefined\" === typeof this.institution.strings[\"part-separator\"]) {\n        this.institution.strings[\"part-separator\"] = this.state.tmp.name_delimiter;\n    }\n    return this._join(blobs, this.institution.strings[\"part-separator\"]);\n};\n\nCSL.NameOutput.prototype._renderNames = function (v, values, pos, j) {\n    //\n    var ret = false;\n    if (values.length) {\n        var names = [];\n        for (var i = 0, ilen = values.length; i < ilen; i += 1) {\n            var name = values[i];\n            \n            // XXX We'll start here with attempts.\n            // Figure out the three segments: primary, secondary, tertiary\n            var ret, localesets;\n            \n            if (this.state.tmp.extension) {\n                localesets = [\"sort\"];\n            } else if (name.isInstitution || name.literal) {\n                // Will never hit this in this function, but preserving\n                // in case we factor this out.\n                localesets = this.state.opt['cite-lang-prefs'].institutions;\n            } else {\n                localesets = this.state.opt['cite-lang-prefs'].persons;\n            }\n            var slot = {primary:'locale-orig',secondary:false,tertiary:false};\n\t        if (localesets) {\n\t\t        var slotnames = [\"primary\", \"secondary\", \"tertiary\"];\n\t\t        for (var k = 0, klen = slotnames.length; k < klen; k += 1) {\n\t\t\t        if (localesets.length - 1 <  k) {\n\t\t\t\t        break;\n\t\t\t        }\n\t\t\t        slot[slotnames[k]] = 'locale-' + localesets[k];\n\t\t        }\n\t        } else {\n\t\t        slot.primary = 'locale-translat';\n\t        }\n\t        if (this.state.tmp.sort_key_flag || (this.state.tmp.area !== \"bibliography\"\n\t\t        && !(this.state.tmp.area === \"citation\"\n\t\t\t         && this.state.opt.xclass === \"note\"\n\t\t\t         && this.item && !this.item.position))) {\n                \n\t\t        slot.secondary = false;\n\t\t        slot.tertiary = false;\n\t        }\n\n            // primary\n            // true is for fallback\n            this.setRenderedName(name);\n\n            if (!name.literal && !name.isInstitution) {\n                var nameBlob = this._renderPersonalName(v, name, slot, pos, i, j);\n                var nameToken = CSL.Util.cloneToken(this.name);\n                this.state.output.append(nameBlob, nameToken, true);\n                names.push(this.state.output.pop());\n            } else {\n                names.push(this._renderInstitutionName(v, name, slot, j));\n            }\n        }\n        //ret = this._join(names, \"\");\n        ret = this.joinPersons(names, pos, j);\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype._renderPersonalName = function (v, name, slot, pos, i, j) {\n    // XXXX FROM HERE (persons)\n\n    var res = this.getName(name, slot.primary, true);\n    var primary = this._renderOnePersonalName(res.name, pos, i, j);\n\tvar secondary = false;\n\tif (slot.secondary) {\n        res = this.getName(name, slot.secondary, false, res.usedOrig);\n        if (res.name) {\n\t\t\tsecondary = this._renderOnePersonalName(res.name, pos, i, j);\n        }\n\t}\n\tvar tertiary = false;\n\tif (slot.tertiary) {\n        res = this.getName(name, slot.tertiary, false, res.usedOrig);\n        if (res.name) {\n\t\t\ttertiary = this._renderOnePersonalName(res.name, pos, i, j);\n        }\n\t}\n    // Now compose them to a unit\n    var personblob;\n    if (secondary || tertiary) {\n\n        this.state.output.openLevel(\"empty\");\n\n        this.state.output.append(primary);\n\n        var secondary_tok = new CSL.Token();\n        if (slot.secondary) {\n            secondary_tok.strings.prefix = this.state.opt.citeAffixes.persons[slot.secondary].prefix;\n            secondary_tok.strings.suffix = this.state.opt.citeAffixes.persons[slot.secondary].suffix;\n            // Add a space if empty\n            if (!secondary_tok.strings.prefix) {\n                secondary_tok.strings.prefix = \" \";\n            }\n        }\n        this.state.output.append(secondary, secondary_tok);\n\n        var tertiary_tok = new CSL.Token();\n        if (slot.tertiary) {\n            tertiary_tok.strings.prefix = this.state.opt.citeAffixes.persons[slot.tertiary].prefix;\n            tertiary_tok.strings.suffix = this.state.opt.citeAffixes.persons[slot.tertiary].suffix;\n            // Add a space if empty\n            if (!tertiary_tok.strings.prefix) {\n                tertiary_tok.strings.prefix = \" \";\n            }\n        }\n        this.state.output.append(tertiary, tertiary_tok);\n\n        this.state.output.closeLevel();\n\n        personblob = this.state.output.pop();\n    } else {\n        personblob = primary;\n    }\n    return personblob;\n};\n\nCSL.NameOutput.prototype._isRomanesque = function (name) {\n    // 0 = entirely non-romanesque\n    // 1 = mixed content\n    // 2 = pure romanesque\n    var ret = 2;\n    if (!name.family.replace(/\\\"/g, '').match(CSL.ROMANESQUE_REGEXP)) {\n        ret = 0;\n    }\n    if (!ret && name.given && name.given.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)) {\n        ret = 1;\n    }\n    var top_locale;\n    if (ret == 2) {\n        if (name.multi && name.multi.main) {\n            top_locale = name.multi.main.slice(0, 2);\n        } else if (this.Item.language) {\n            top_locale = this.Item.language.slice(0, 2);\n        }\n        if ([\"ja\", \"zh\"].indexOf(top_locale) > -1) {\n            ret = 1;\n        }\n    }\n    //print(\"name: \"+name.given+\", multi: \"+name.multi+\", ret: \"+ret);\n    return ret;\n};\n\nCSL.NameOutput.prototype._renderOnePersonalName = function (value, pos, i, j) {\n    var name = value;\n    var dropping_particle = this._droppingParticle(name, pos, j);\n    var family = this._familyName(name);\n    var non_dropping_particle = this._nonDroppingParticle(name);\n    var givenInfo = this._givenName(name, pos, i);\n    var given = givenInfo.blob;\n    var suffix = this._nameSuffix(name);\n    if (given === false) {\n        dropping_particle = false;\n        suffix = false;\n    }\n    var sort_sep = this.state.inheritOpt(this.name, \"sort-separator\");\n    if (!sort_sep) {\n        sort_sep = \"\";\n    }\n    var suffix_sep;\n    if (name[\"comma-suffix\"]) {\n        suffix_sep = \", \";\n    } else {\n        suffix_sep = \" \";\n    }\n    var romanesque = this._isRomanesque(name);\n    function hasJoiningPunctuation(blob) {\n        if (!blob) {\n            return false;\n        } else if (\"string\" === typeof blob.blobs) {\n            if ([\"\\u2019\", \"\\'\", \"-\", \" \"].indexOf(blob.blobs.slice(-1)) > -1) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            return hasJoiningPunctuation(blob.blobs[blob.blobs.length-1]);\n        }\n    }\n    \n    var has_hyphenated_non_dropping_particle = hasJoiningPunctuation(non_dropping_particle);\n\n    var nbspace;\n    if ([\"fr\", \"ru\", \"cs\"].indexOf(this.state.opt[\"default-locale\"][0].slice(0, 2)) > -1) {\n        nbspace = \"\\u00a0\";\n    } else {\n        nbspace = \" \";\n    }\n\n    var blob, merged, first, second;\n    if (romanesque === 0) {\n        // XXX handle affixes for given and family\n        blob = this._join([non_dropping_particle, family, given], \"\");\n    } else if (romanesque === 1 || name[\"static-ordering\"]) { // entry likes sort order\n        merged = this._join([non_dropping_particle, family], nbspace);\n        blob = this._join([merged, given], \" \");\n    } else if (name[\"reverse-ordering\"]) { // entry likes reverse order\n        merged = this._join([non_dropping_particle, family], nbspace);\n        blob = this._join([given, merged], \" \");\n    } else if (this.state.tmp.sort_key_flag) {\n        // ok with no affixes here\n        if (this.state.opt[\"demote-non-dropping-particle\"] === \"never\") {\n            merged = this._join([non_dropping_particle, family], nbspace);\n            merged = this._join([merged, dropping_particle], \" \");\n            merged = this._join([merged, given], this.state.opt.sort_sep);\n            blob = this._join([merged, suffix], \" \");\n        } else {\n            second = this._join([given, dropping_particle, non_dropping_particle], \" \");\n            merged = this._join([family, second], this.state.opt.sort_sep);\n            blob = this._join([merged, suffix], \" \");\n        }\n    } else if (this.state.inheritOpt(this.name, \"name-as-sort-order\") === \"all\" || (this.state.inheritOpt(this.name, \"name-as-sort-order\") === \"first\" && i === 0 && (j === 0 || \"undefined\" === typeof j))) {\n        //\n        // Discretionary sort ordering and inversions\n        //\n        if ([\"Lord\", \"Lady\"].indexOf(name.given) > -1) {\n            sort_sep = \", \";\n        }\n\n        // XXX Needs a more robust solution than this\n        // XXX See https://forums.zotero.org/discussion/30974/any-idea-why-an-a-author-comes-last-in-the-bibliography/#Item_30\n\n        //if ([\"always\", \"display-and-sort\"].indexOf(this.state.opt[\"demote-non-dropping-particle\"]) > -1 && !has_hyphenated_non_dropping_particle) {\n        if ([\"always\", \"display-and-sort\"].indexOf(this.state.opt[\"demote-non-dropping-particle\"]) > -1) {\n            // Drop non-dropping particle\n            //second = this._join([given, dropping_particle, non_dropping_particle], \" \");\n            second = this._join([given, dropping_particle], (name[\"comma-dropping-particle\"] + \" \"));\n        \n            // This would be a problem with al-Ghazali. Avoided by has_hyphenated_non_dropping_particle check above.\n            second = this._join([second, non_dropping_particle], \" \");\n            if (second && this.given) {\n                second.strings.prefix = this.given.strings.prefix;\n                second.strings.suffix = this.given.strings.suffix;\n            }\n            if (family && this.family) {\n                family.strings.prefix = this.family.strings.prefix;\n                family.strings.suffix = this.family.strings.suffix;\n            }\n            merged = this._join([family, second], sort_sep);\n            blob = this._join([merged, suffix], sort_sep);\n        } else {\n            // Don't drop particle.\n            // Don't do this\n            //if (this.state.tmp.area === \"bibliography\" && !this.state.tmp.term_predecessor && non_dropping_particle) {\n            //    if (!has_hyphenated_non_dropping_particle) {\n            //        non_dropping_particle.blobs = CSL.Output.Formatters[\"capitalize-first\"](this.state, non_dropping_particle.blobs)\n            //    }\n            //}\n            if (has_hyphenated_non_dropping_particle) {\n                first = this._join([non_dropping_particle, family], \"\");\n            } else {\n                first = this._join([non_dropping_particle, family], nbspace);\n            }\n            if (first && this.family) {\n                first.strings.prefix = this.family.strings.prefix;\n                first.strings.suffix = this.family.strings.suffix;\n            }\n\n            second = this._join([given, dropping_particle], (name[\"comma-dropping-particle\"] + \" \"));\n            //second = this._join([given, dropping_particle], \" \");\n            if (second && this.given) {\n                second.strings.prefix = this.given.strings.prefix;\n                second.strings.suffix = this.given.strings.suffix;\n            }\n\n            merged = this._join([first, second], sort_sep);\n            blob = this._join([merged, suffix], sort_sep);\n        }\n        blob.isInverted = true;\n    } else { // plain vanilla\n        if (name[\"dropping-particle\"] && name.family && !name[\"non-dropping-particle\"]) {\n            var dp = name[\"dropping-particle\"];\n            var apostrophes = [\"'\",\"\\u02bc\",\"\\u2019\",\"-\"];\n            if (apostrophes.indexOf(dp.slice(-1)) > -1 && dp.slice(0, -1) !== \"de\") {\n                family = this._join([dropping_particle, family], \"\");\n                dropping_particle = false;\n            }\n        }\n\n        if (has_hyphenated_non_dropping_particle) {\n            second = this._join([non_dropping_particle, family], \"\");\n            second = this._join([dropping_particle, second], nbspace);\n        } else {\n            second = this._join([dropping_particle, non_dropping_particle, family], nbspace);\n        }\n        second = this._join([second, suffix], suffix_sep);\n        if (second && this.family) {\n            second.strings.prefix = this.family.strings.prefix;\n            second.strings.suffix = this.family.strings.suffix;\n        }\n        if (given && this.given) {\n            given.strings.prefix = this.given.strings.prefix;\n            given.strings.suffix = this.given.strings.suffix;\n        }\n        if (second.strings.prefix) {\n            name[\"comma-dropping-particle\"] = \"\";\n        }\n\n        var space;\n        if (this.state.inheritOpt(this.name, \"initialize-with\")\n            && this.state.inheritOpt(this.name, \"initialize-with\").match(/[\\u00a0\\ufeff]/)\n            && givenInfo.initializationLevel === 1) {\n            \n            space = nbspace;\n        } else {\n            space = \" \";\n        }\n        blob = this._join([given, second], (name[\"comma-dropping-particle\"] + space));\n    }\n    // XXX Just generally assume for the present that personal names render something\n    this.state.tmp.group_context.tip.variable_success = true;\n    this.state.tmp.can_substitute.replace(false, CSL.LITERAL);\n    this.state.tmp.term_predecessor = true;\n    // notSerious\n    //this.state.output.append(blob, \"literal\", true);\n    //var ret = this.state.output.pop();\n    this.state.tmp.name_node.children.push(blob);\n    return blob;\n};\n\n/*\n        // Do not include given name, dropping particle or suffix in strict short form of name\n\n        // initialize if appropriate\n*/\n\n// Input names should be touched by _normalizeNameInput()\n// exactly once: this is not idempotent.\nCSL.NameOutput.prototype._normalizeNameInput = function (value) {\n    var name = {\n        literal:value.literal,\n        family:value.family,\n        isInstitution:value.isInstitution,\n        given:value.given,\n        suffix:value.suffix,\n        \"comma-suffix\":value[\"comma-suffix\"],\n        \"non-dropping-particle\":value[\"non-dropping-particle\"],\n        \"dropping-particle\":value[\"dropping-particle\"],\n        \"static-ordering\":value[\"static-ordering\"],\n        \"static-particles\":value[\"static-particles\"],\n        \"reverse-ordering\":value[\"reverse-ordering\"],\n        \"full-form-always\": value[\"full-form-always\"],\n        \"parse-names\":value[\"parse-names\"],\n        \"comma-dropping-particle\": \"\",\n        block_initialize:value.block_initialize,\n        multi:value.multi\n    };\n    this._parseName(name);\n    return name;\n};\n\n// _transformNameset() replaced with enhanced transform.name().\n\nCSL.NameOutput.prototype._stripPeriods = function (tokname, str) {\n    var decor_tok = this[tokname + \"_decor\"];\n    if (str) {\n        if (this.state.tmp.strip_periods) {\n            str = str.replace(/\\./g, \"\");\n        } else  if (decor_tok) {\n            for (var i = 0, ilen = decor_tok.decorations.length; i < ilen; i += 1) {\n                if (\"@strip-periods\" === decor_tok.decorations[i][0] && \"true\" === decor_tok.decorations[i][1]) {\n                    str = str.replace(/\\./g, \"\");\n                    break;\n                }\n            }\n        }\n    }\n    return str;\n};\n\nCSL.NameOutput.prototype._nonDroppingParticle = function (name) {\n    var ndp = name[\"non-dropping-particle\"];\n    if (ndp && this.state.tmp.sort_key_flag) {\n        ndp = ndp.replace(/[\\'\\u2019]/, \"\");\n    }\n    var str = this._stripPeriods(\"family\", ndp);\n    if (this.state.output.append(str, this.family_decor, true)) {\n        return this.state.output.pop();\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._droppingParticle = function (name, pos, j) {\n    var dp = name[\"dropping-particle\"];\n    if (dp && this.state.tmp.sort_key_flag) {\n        dp = dp.replace(/[\\'\\u2019]/, \"\");\n    }\n    var str = this._stripPeriods(\"given\", dp);\n    if (name[\"dropping-particle\"] && name[\"dropping-particle\"].match(/^et.?al[^a-z]$/)) {\n        if (this.state.inheritOpt(this.name, \"et-al-use-last\")) {\n            if (\"undefined\" === typeof j) { \n                this.etal_spec[pos].freeters = 2;\n            } else {\n                this.etal_spec[pos].persons = 2;\n            }\n        } else {\n            if (\"undefined\" === typeof j) { \n                this.etal_spec[pos].freeters = 1;\n            } else {\n                this.etal_spec[pos].persons = 1;\n            }\n        }\n        name[\"comma-dropping-particle\"] = \"\";\n    } else if (this.state.output.append(str, this.given_decor, true)) {\n        return this.state.output.pop();\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._familyName = function (name) {\n    var str = this._stripPeriods(\"family\", name.family);\n    if (this.state.output.append(str, this.family_decor, true)) {\n        return this.state.output.pop();\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._givenName = function (name, pos, i) {\n    var ret;\n    // citation\n    //   use disambig as-is\n    // biblography\n    //   use disambig only if it boosts over the default\n    //   SO WHAT IS THE DEFAULT?\n    //   A: If \"form\" is short, it's 0.\n    //      If \"form\" is long, initialize-with exists (and initialize is not false) it's 1\n    //      If \"form\" is long, and initialize_with does not exist, it's 2.\n    var formIsShort = this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\") !== \"long\";\n    var initializeIsTurnedOn = this.state.inheritOpt(this.name, \"initialize\") !== false;\n    var hasInitializeWith = \"string\" === typeof this.state.inheritOpt(this.name, \"initialize-with\") && !name.block_initialize;\n    var defaultLevel;\n    var useLevel;\n    if (name[\"full-form-always\"]) {\n        useLevel = 2;\n    } else {\n        if (formIsShort) {\n            defaultLevel = 0;\n        } else if (hasInitializeWith) {\n            defaultLevel = 1;\n        } else {\n            defaultLevel = 2;\n        }\n        var requestedLevel = this.state.tmp.disambig_settings.givens[pos][i];\n        if (requestedLevel > defaultLevel) {\n            useLevel = requestedLevel;\n        } else {\n            useLevel = defaultLevel;\n        }\n    }\n    var gdropt = this.state.citation.opt[\"givenname-disambiguation-rule\"];\n   if (gdropt && gdropt.slice(-14) === \"-with-initials\") {\n        hasInitializeWith = true;\n    }\n    if (name.family && useLevel === 1) {\n        if (hasInitializeWith) {\n            var initialize_with = this.state.inheritOpt(this.name, \"initialize-with\", false, \"\");\n            name.given = CSL.Util.Names.initializeWith(this.state, name.given, initialize_with, !initializeIsTurnedOn);\n        } else {\n            name.given = CSL.Util.Names.unInitialize(this.state, name.given);\n        }\n    } else if (useLevel === 0) {\n        return {\n            blob: false\n        }\n    } else if (useLevel === 2) {\n        name.given = CSL.Util.Names.unInitialize(this.state, name.given);\n    }\n\n    var str = this._stripPeriods(\"given\", name.given);\n    var rendered = this.state.output.append(str, this.given_decor, true);\n    if (rendered) {\n        ret = this.state.output.pop();\n\t    return {\n            blob: ret,\n            initializationLevel: useLevel\n        };\n    }\n    return {\n        blob: false\n    };\n};\n\nCSL.NameOutput.prototype._nameSuffix = function (name) {\n\n    var str = name.suffix, ret;\n\n    if (str && \"string\" === typeof this.state.inheritOpt(this.name, \"initialize-with\")) {\n        str = CSL.Util.Names.initializeWith(this.state, str, this.state.inheritOpt(this.name, \"initialize-with\"), true);\n    }\n\n    str = this._stripPeriods(\"family\", str);\n    var toSuffix = '';\n    if (str && str.slice(-1) === '.') {\n\tstr = str.slice(0, -1);\n\ttoSuffix = '.';\n    }\n    var rendered = this.state.output.append(str, \"empty\", true);\n    if (rendered) {\n        ret = this.state.output.pop();\n\tret.strings.suffix = toSuffix + ret.strings.suffix;\n\treturn ret;\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._getLongStyle = function (name) {\n    var long_style;\n    if (name[\"short\"].length) {\n        if (this.institutionpart[\"long-with-short\"]) {\n            long_style = this.institutionpart[\"long-with-short\"];\n        } else {\n            long_style = this.institutionpart[\"long\"];\n        }\n    } else {\n        long_style = this.institutionpart[\"long\"];\n    }\n    if (!long_style) {\n        long_style = new CSL.Token();\n    }\n    return long_style;\n};\n\nCSL.NameOutput.prototype._getShortStyle = function () {\n    var short_style;\n    if (this.institutionpart[\"short\"]) {\n        short_style = this.institutionpart[\"short\"];\n    } else {\n        short_style = new CSL.Token();\n    }\n    return short_style;\n};\n\nCSL.NameOutput.prototype._parseName = function (name) {\n    if (!name[\"parse-names\"] && \"undefined\" !== typeof name[\"parse-names\"]) {\n        return name;\n    }\n    if (name.family && !name.given && name.isInstitution) {\n        name.literal = name.family;\n        name.family = undefined;\n        name.isInstitution = undefined;\n    }\n    var noparse;\n    if (name.family \n        && (name.family.slice(0, 1) === '\"' && name.family.slice(-1) === '\"')\n        || (!name[\"parse-names\"] && \"undefined\" !== typeof name[\"parse-names\"])) {\n\n        name.family = name.family.slice(1, -1);\n        noparse = true;\n        name[\"parse-names\"] = 0;\n    } else {\n        noparse = false;\n    }\n    if (this.state.opt.development_extensions.parse_names) {\n        if (!name[\"non-dropping-particle\"] && name.family && !noparse && name.given) {\n            if (!name[\"static-particles\"]) {\n                CSL.parseParticles(name, true);\n            }\n        }\n    }\n};\n\n/*\n * Return a single name object\n  */\n\n// The interface is a mess, but this should serve.\n\nCSL.NameOutput.prototype.getName = function (name, slotLocaleset, fallback, stopOrig) {\n\n    // Needs to tell us whether we used orig or not.\n    \n    if (stopOrig && slotLocaleset === 'locale-orig') {\n        return {name:false,usedOrig:stopOrig};\n    }\n\n    // Normalize to string\n    if (!name.family) {\n        name.family = \"\";\n    }\n    if (!name.given) {\n        name.given = \"\";\n    }\n\n    // Recognized params are:\n    //  block-initialize\n    //  transliterated\n    //  static-ordering\n    //  full-form-always\n    // All default to false, except for static-ordering, which is initialized\n    // with a sniff.\n    var name_params = {};\n    // Determines the default static-order setting based on the characters\n    // used in the headline field. Will be overridden by locale-based\n    // parameters evaluated against explicit lang tags set on the (sub)field.\n    name_params[\"static-ordering\"] = this.getStaticOrder(name);\n\n    var foundTag = true;\n    var langTag;\n    if (slotLocaleset !== 'locale-orig') {\n        foundTag = false;\n        if (name.multi) {\n            var langTags = this.state.opt[slotLocaleset];\n            for (var i = 0, ilen = langTags.length; i < ilen; i += 1) {\n                langTag = langTags[i];\n                if (name.multi._key[langTag]) {\n                    foundTag = true;\n                    var isInstitution = name.isInstitution;\n                    name = name.multi._key[langTag];\n                    name.isInstitution = isInstitution;\n                    // Set name formatting params\n                    name_params = this.getNameParams(langTag);\n                    name_params.transliterated = true;\n                    break;\n                }\n            }\n        }\n    }\n\n    if (!foundTag) {\n        langTag = false;\n        if (name.multi && name.multi.main) {\n            langTag = name.multi.main;\n        } else if (this.Item.language) {\n            langTag = this.Item.language;\n        }\n        if (langTag) {\n            name_params = this.getNameParams(langTag);\n        }\n    }\n\n    if (!fallback && !foundTag) {\n        return {name:false,usedOrig:stopOrig};\n    }\n    \n    // Normalize to string (again)\n    if (!name.family) {\n        name.family = \"\";\n    }\n    if (!name.given) {\n        name.given = \"\";\n    }\n    if (name.literal) {\n        delete name.family;\n        delete name.given;\n    }\n    // var clone the item before writing into it\n    name = {\n        family:name.family,\n        given:name.given,\n        \"non-dropping-particle\":name[\"non-dropping-particle\"],\n        \"dropping-particle\":name[\"dropping-particle\"],\n        suffix:name.suffix,\n        \"static-ordering\":name_params[\"static-ordering\"],\n        \"static-particles\":name[\"static-particles\"],\n        \"reverse-ordering\":name_params[\"reverse-ordering\"],\n        \"full-form-always\": name_params[\"full-form-always\"],\n        \"parse-names\":name[\"parse-names\"],\n        \"comma-suffix\":name[\"comma-suffix\"],\n        \"comma-dropping-particle\":name[\"comma-dropping-particle\"],\n        transliterated: name_params.transliterated,\n        block_initialize: name_params[\"block-initialize\"],\n        literal:name.literal,\n        isInstitution:name.isInstitution,\n        multi:name.multi\n    };\n    \n    if (!name.literal && (!name.given && name.family && name.isInstitution)) {\n        name.literal = name.family;\n    }\n    if (name.literal) {\n        delete name.family;\n        delete name.given;\n    }\n    name = this._normalizeNameInput(name);\n    var usedOrig;\n    if (stopOrig) {\n        usedOrig = stopOrig;\n    } else {\n        usedOrig = !foundTag;\n    }\n    return {name:name,usedOrig:usedOrig};\n};\n\nCSL.NameOutput.prototype.getNameParams = function (langTag) {\n    var ret = {};\n    var langspec = CSL.localeResolve(this.Item.language, this.state.opt[\"default-locale\"][0]);\n    var try_locale = this.state.locale[langspec.best] ? langspec.best : this.state.opt[\"default-locale\"][0];\n    var name_as_sort_order = this.state.locale[try_locale].opts[\"name-as-sort-order\"];\n    var name_as_reverse_order = this.state.locale[try_locale].opts[\"name-as-reverse-order\"];\n    var name_never_short = this.state.locale[try_locale].opts[\"name-never-short\"];\n    var field_lang_bare = langTag.split(\"-\")[0];\n    if (name_as_sort_order && name_as_sort_order[field_lang_bare]) {\n        ret[\"static-ordering\"] = true;\n        ret[\"reverse-ordering\"] = false;\n    }\n    if (name_as_reverse_order && name_as_reverse_order[field_lang_bare]) {\n        ret[\"reverse-ordering\"] = true;\n        ret[\"static-ordering\"] = false;\n    }\n    if (name_never_short && name_never_short[field_lang_bare]) {\n        ret[\"full-form-always\"] = true;\n    }\n    \n    if (ret[\"static-ordering\"]) {\n        ret[\"block-initialize\"] = true;\n    }\n    return ret;\n};\n\nCSL.NameOutput.prototype.setRenderedName = function (name) {\n    if (this.state.tmp.area === \"bibliography\") {\n        var strname = \"\";\n        for (var j=0,jlen=CSL.NAME_PARTS.length;j<jlen;j+=1) {\n            if (name[CSL.NAME_PARTS[j]]) {\n                strname += name[CSL.NAME_PARTS[j]];\n            }\n        }\n        this.state.tmp.rendered_name.push(strname);\n    }\n};\n\nCSL.NameOutput.prototype.fixupInstitution = function (name, varname, listpos) {\n    if (!name.literal && name.family) {\n        name.literal = name.family;\n        delete name.family;\n    }\n    var longNameStr = name.literal;\n    var shortNameStr = longNameStr;\n    var ret = {\n        \"long\": longNameStr.split(/\\s*\\|\\s*/),\n        \"short\": shortNameStr.split(/\\s*\\|\\s*/),\n    };\n    if (this.state.sys.getAbbreviation) {\n        // Normalize longNameStr and shortNameStr\n        if (this.institution.strings.form === \"short\") {\n            let jurisdiction = this.Item.jurisdiction;\n            jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-entire\", longNameStr, this.Item.language);\n            if (this.state.transform.abbrevs[jurisdiction][\"institution-entire\"][longNameStr]) {\n                longNameStr = this.state.transform.abbrevs[jurisdiction][\"institution-entire\"][longNameStr];\n            } else {\n                jurisdiction = this.Item.jurisdiction;\n                jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-part\", longNameStr, this.Item.language);\n                if (this.state.transform.abbrevs[jurisdiction][\"institution-part\"][longNameStr]) {\n                    longNameStr = this.state.transform.abbrevs[jurisdiction][\"institution-part\"][longNameStr];\n                }\n            }\n            longNameStr = this._quashChecks(jurisdiction, longNameStr);\n        }\n        if ([\"short\", \"short-long\", \"long-short\"].indexOf(this.institution.strings[\"institution-parts\"]) > -1) {\n            let jurisdiction = this.Item.jurisdiction;\n            jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-part\", shortNameStr, this.Item.language);\n            if (this.state.transform.abbrevs[jurisdiction][\"institution-part\"][shortNameStr]) {\n                shortNameStr = this.state.transform.abbrevs[jurisdiction][\"institution-part\"][shortNameStr];\n            }\n            shortNameStr = this._quashChecks(jurisdiction, shortNameStr);\n            if ([\"short-long\", \"long-short\"].indexOf(this.institution.strings[\"institution-parts\"]) > -1) {\n                if (shortNameStr === longNameStr) {\n                    shortNameStr = \"\";\n                }\n            }\n        }\n        // Split abbreviated strings\n        // For pure long, split and we're done.\n        ret[\"long\"] = longNameStr.split(/\\s*\\|\\s*/);\n        // For short, split and then try abbrev with institution-part on each element\n        ret[\"short\"] = shortNameStr.split(/\\s*\\|\\s*/);\n        if ([\"short\", \"short-long\", \"long-short\"].indexOf(this.institution.strings[\"institution-parts\"]) > -1) {\n            for (var j=ret[\"short\"].length-1; j>-1; j--) {\n                let jurisdiction = this.Item.jurisdiction;\n                var abbrevKey = ret[\"short\"][j];\n                jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-part\", abbrevKey, this.Item.language);\n                if (this.state.transform.abbrevs[jurisdiction][\"institution-part\"][abbrevKey]) {\n                    ret[\"short\"][j] = this.state.transform.abbrevs[jurisdiction][\"institution-part\"][abbrevKey];\n                }\n                if (ret[\"short\"][j].indexOf(\"|\") > -1) {\n                    let retShort = ret[\"short\"];\n                    let splitShort = retShort[j].split(/\\s*\\|\\s*/);\n                    ret[\"short\"] = retShort.slice(0, j).concat(splitShort).concat(retShort.slice(j+1));\n                }\n            }\n        }\n        if (this.state.opt.development_extensions.legacy_institution_name_ordering) {\n            ret[\"short\"].reverse();\n        }\n        ret[\"short\"] = this._trimInstitution(ret[\"short\"]);\n        if (this.institution.strings[\"reverse-order\"]) {\n            ret[\"short\"].reverse();\n        }\n        // trimmer is not available in getAmbiguousCite\n        if (!this.state.tmp.just_looking) {\n            if (this.Item.jurisdiction) {\n                let jurisdiction = this.Item.jurisdiction;\n                var trimmer = this.state.tmp.abbrev_trimmer;\n                if (trimmer && trimmer[jurisdiction] && trimmer[jurisdiction][varname]) {\n                    for (var i=0,ilen=ret[\"short\"].length;i<ilen;i++) {\n                        var frag = ret[\"short\"][i];\n                        ret[\"short\"][i] = frag.replace(trimmer[jurisdiction][varname], \"\").trim();\n                    }\n                }\n            }\n        }\n    }\n    if (this.state.opt.development_extensions.legacy_institution_name_ordering) {\n        ret[\"long\"].reverse();\n    }\n    ret[\"long\"] = this._trimInstitution(ret[\"long\"]);\n    if (this.institution.strings[\"reverse-order\"]) {\n        ret[\"long\"].reverse();\n    }\n\n    return ret;\n};\n\n\nCSL.NameOutput.prototype.getStaticOrder = function (name, refresh) {\n    var static_ordering_val = false;\n    if (!refresh && name[\"static-ordering\"]) {\n        static_ordering_val = true;\n    } else if (this._isRomanesque(name) === 0) {\n        static_ordering_val = true;\n    } else if ((!name.multi || !name.multi.main) && this.Item.language && ['vi', 'hu'].indexOf(this.Item.language) > -1) {\n        static_ordering_val = true;\n    } else if (name.multi && name.multi.main && ['vi', 'hu'].indexOf(name.multi.main.slice(0,2)) > -1) {\n        static_ordering_val = true;\n    } else {\n        if (this.state.opt['auto-vietnamese-names']\n            && (CSL.VIETNAMESE_NAMES.exec(name.family + \" \" + name.given)\n                && CSL.VIETNAMESE_SPECIALS.exec(name.family + name.given))) {\n            \n            static_ordering_val = true;\n        }\n    }\n    return static_ordering_val;\n};\n\nCSL.NameOutput.prototype._quashChecks = function (jurisdiction, str) {\n    var str = this.state.transform.quashCheck(jurisdiction, str);\n    // If the abbreviation has date cut-offs, find the most recent\n    // abbreviation within scope.\n    var lst = str.split(/>>[0-9]{4}>>/);\n    var m = str.match(/>>([0-9]{4})>>/);\n    str = lst.pop();\n    var date = this.Item[\"original-date\"] ? this.Item[\"original-date\"] : this.Item[\"issued\"];\n    if (date) {\n        date = parseInt(date.year, 10);\n        date = isNaN(date) ? false : date;\n    }\n    if (date) {\n        if (lst.length > 0) {\n            for (var k=m.length-1; k>0; k--) {\n                if (date >= parseInt(m[k], 10)) {\n                    break;\n                }\n                str = lst.pop();\n            }\n        }\n        str = str.replace(/\\s*\\|\\s*/g, \"|\");\n    }\n    return str;\n}\n\nCSL.NameOutput.prototype._trimInstitution = function (subunits) {\n\t// Oh! Good catch in the tests. This happens before abbrevs.\n    // Won't work that way. Need to do abbrev substitute first,\n    // and apply this separately to long and to short.\n    var use_first = false;\n    var stop_last = false;\n    var use_last = false;\n    var stop_first = false;\n    var s = subunits.slice();\n    if (this.institution) {\n        // If use_first, apply stop_last, then apply use_first;\n        // If use_last, apply stop_first, then apply use_last;\n        if (\"undefined\" !== typeof this.institution.strings[\"use-first\"]) {\n            // this.state.sys.print(\"use-first OK\");\n            use_first = this.institution.strings[\"use-first\"];\n        }\n        if (\"undefined\" !== typeof this.institution.strings[\"use-last\"]) {\n            // this.state.sys.print(\"use-last OK\");\n            use_last = this.institution.strings[\"use-last\"];\n        }\n        if (\"undefined\" !== typeof this.institution.strings[\"stop-first\"]) {\n            // this.state.sys.print(\"stop-first OK\");\n            stop_first = this.institution.strings[\"stop-first\"];\n        }\n        if (\"undefined\" !== typeof this.institution.strings[\"stop-last\"]) {\n            stop_last = this.institution.strings[\"stop-last\"];\n        }\n\n        if (use_first) {\n            if (stop_last) {\n                s = s.slice(0, stop_last * -1);\n            }\n            s = s.slice(0, use_first);\n        }\n        \n        if (use_last) {\n            var ss = subunits.slice();\n            if (use_first) {\n                stop_first = use_first;\n            } else {\n                s = [];\n            }\n            if (stop_first) {\n                ss = ss.slice(stop_first);\n            }\n            ss = ss.slice(use_last * -1);\n            s = s.concat(ss);\n        }\n        subunits = s;\n    }\n    return subunits;\n};\n\n/*global CSL: true */\n\nCSL.PublisherOutput = function (state, group_tok) {\n    this.state = state;\n    this.group_tok = group_tok;\n    this.varlist = [];\n};\n\nCSL.PublisherOutput.prototype.render = function () {\n    this.clearVars();\n    this.composeAndBlob();\n    this.composeElements();\n    this.composePublishers();\n    this.joinPublishers();\n};\n\n\n// XXX Figure out how to adapt this to the House of Lords / House of Commons\n// joint committee case\n\n// name_delimiter\n// delimiter_precedes_last\n// and\n\nCSL.PublisherOutput.prototype.composeAndBlob = function () {\n    this.and_blob = {};\n    var and_term = false;\n    if (this.group_tok.strings.and === \"text\") {\n        and_term = this.state.getTerm(\"and\");\n    } else if (this.group_tok.strings.and === \"symbol\") {\n        and_term = \"&\";\n    }\n    var tok = new CSL.Token();\n    tok.strings.suffix = \" \";\n    tok.strings.prefix = \" \";\n    this.state.output.append(and_term, tok, true);\n    var no_delim = this.state.output.pop();\n\n    tok.strings.prefix = this.group_tok.strings[\"subgroup-delimiter\"];\n    this.state.output.append(and_term, tok, true);\n    var with_delim = this.state.output.pop();\n    \n    this.and_blob.single = false;\n    this.and_blob.multiple = false;\n    if (and_term) {\n        if (this.group_tok.strings[\"subgroup-delimiter-precedes-last\"] === \"always\") {\n            this.and_blob.single = with_delim;\n        } else if (this.group_tok.strings[\"subgroup-delimiter-precedes-last\"] === \"never\") {\n            this.and_blob.single = no_delim;\n            this.and_blob.multiple = no_delim;\n        } else {\n            this.and_blob.single = no_delim;\n            this.and_blob.multiple = with_delim;\n        }\n    }\n};\n\n\nCSL.PublisherOutput.prototype.composeElements = function () {\n    for (var i = 0, ilen = 2; i < ilen; i += 1) {\n        var varname = [\"publisher\", \"publisher-place\"][i];\n        for (var j = 0, jlen = this[\"publisher-list\"].length; j < jlen; j += 1) {\n            var str = this[varname + \"-list\"][j];\n            var tok = this[varname + \"-token\"];\n            // notSerious\n            this.state.output.append(str, tok, true);\n            this[varname + \"-list\"][j] = this.state.output.pop();\n        }\n    }\n};\n\n\nCSL.PublisherOutput.prototype.composePublishers = function () {\n    var blobs;\n    for (var i = 0, ilen = this[\"publisher-list\"].length; i < ilen; i += 1) {\n        blobs = [this[this.varlist[0] + \"-list\"][i], this[this.varlist[1] + \"-list\"][i]];\n        this[\"publisher-list\"][i] = this._join(blobs, this.group_tok.strings.delimiter);\n    }\n};\n\n\nCSL.PublisherOutput.prototype.joinPublishers = function () {\n    var blobs = this[\"publisher-list\"];\n    var publishers = this._join(blobs, this.group_tok.strings[\"subgroup-delimiter\"], this.and_blob.single, this.and_blob.multiple, this.group_tok);\n    this.state.output.append(publishers, \"literal\");\n};\n\n\n// blobs, delimiter, single, multiple, tokenname\n// Tokenname is a key at top level of this object.\nCSL.PublisherOutput.prototype._join = CSL.NameOutput.prototype._join;\nCSL.PublisherOutput.prototype._getToken = CSL.NameOutput.prototype._getToken;\n\n\nCSL.PublisherOutput.prototype.clearVars = function () {\n    this.state.tmp[\"publisher-list\"] = false;\n    this.state.tmp[\"publisher-place-list\"] = false;\n    this.state.tmp[\"publisher-group-token\"] = false;\n    this.state.tmp[\"publisher-token\"] = false;\n    this.state.tmp[\"publisher-place-token\"] = false;\n};\n\n/*global CSL: true */\n\nCSL.evaluateLabel = function (node, state, Item, item) {\n    var myterm;\n    if (\"locator\" === node.strings.term) {\n        if (item && item.label) {\n            if (item.label === \"sub verbo\") {\n                myterm = \"sub-verbo\";\n            } else {\n                myterm = item.label;\n            }\n        }\n        if (!myterm) {\n            myterm = \"page\";\n        }\n    } else {\n        myterm = node.strings.term;\n    }\n    \n    // Plurals detection.\n    var plural = node.strings.plural;\n    if (\"number\" !== typeof plural) {\n        // (node, ItemObject, variable, type)\n        var theItem = (item && node.strings.term === \"locator\") ? item : Item;\n        if (theItem[node.strings.term]) {\n            state.processNumber(false, theItem, node.strings.term, Item.type);\n            plural = state.tmp.shadow_numbers[node.strings.term].plural;\n            if (!state.tmp.shadow_numbers[node.strings.term].labelForm\n                && !state.tmp.shadow_numbers[node.strings.term].labelDecorations) {\n                if (node.strings.form) {\n                    state.tmp.shadow_numbers[node.strings.term].labelForm = node.strings.form;\n                } else if (state.tmp.group_context.tip.label_form) {\n                    state.tmp.shadow_numbers[node.strings.term].labelForm = state.tmp.group_context.tip.label_form;\n                }\n                state.tmp.shadow_numbers[node.strings.term].labelCapitalizeIfFirst = node.strings.capitalize_if_first;\n                state.tmp.shadow_numbers[node.strings.term].labelDecorations = node.decorations.slice();\n            }\n            \n            if ([\"locator\", \"number\", \"page\"].indexOf(node.strings.term) > -1 && state.tmp.shadow_numbers[node.strings.term].label) {\n                myterm = state.tmp.shadow_numbers[node.strings.term].label;\n            }\n            if (node.decorations && state.opt.development_extensions.csl_reverse_lookup_support) {\n                node.decorations.reverse();\n                node.decorations.push([\"@showid\",\"true\", node.cslid]);\n                node.decorations.reverse();\n            }\n        }\n    }\n    return CSL.castLabel(state, node, myterm, plural, CSL.TOLERANT);\n};\n\nCSL.castLabel = function (state, node, term, plural, mode) {\n    var label_form = node.strings.form;\n    var label_capitalize_if_first = node.strings.capitalize_if_first;\n    if (state.tmp.group_context.tip.label_form) {\n        if (label_form === \"static\") {\n            state.tmp.group_context.tip.label_static = true;\n        } else {\n            label_form = state.tmp.group_context.tip.label_form;\n        }\n    }\n\n    if (state.tmp.group_context.tip.label_capitalize_if_first) {\n        label_capitalize_if_first = state.tmp.group_context.tip.label_capitalize_if_first;\n    }\n    var ret = state.getTerm(term, label_form, plural, false, mode, node.default_locale);\n    if (label_capitalize_if_first) {\n        ret = CSL.Output.Formatters[\"capitalize-first\"](state, ret);\n    }\n    // XXXXX Cut-and-paste code in multiple locations. This code block should be\n    // collected in a function.\n    // Tag: strip-periods-block\n    if (state.tmp.strip_periods) {\n        ret = ret.replace(/\\./g, \"\");\n    } else {\n        for (var i = 0, ilen = node.decorations.length; i < ilen; i += 1) {\n            if (\"@strip-periods\" === node.decorations[i][0] && \"true\" === node.decorations[i][1]) {\n                ret = ret.replace(/\\./g, \"\");\n                break;\n            }\n        }\n    }\n    return ret;\n};\n\n/*global CSL: true */\n\nCSL.Node.name = {\n    build: function (state, target) {\n        var func;\n        if ([CSL.SINGLETON, CSL.START].indexOf(this.tokentype) > -1) {\n            var oldTmpRoot;\n            if (\"undefined\" === typeof state.tmp.root) {\n                oldTmpRoot = undefined;\n                state.tmp.root = \"citation\";\n            } else {\n                oldTmpRoot = state.tmp.root;\n            }\n            // Many CSL styles set et-al-[min|use-first]\n            // and et-al-subsequent-[min|use-first] to the same\n            // value.\n            // Set state.opt.update_mode = CSL.POSITION if\n            // et-al-subsequent-min or et-al-subsequent-use-first\n            // are set AND their value differs from their plain\n            // counterparts.\n            if (state.inheritOpt(this, \"et-al-subsequent-min\")\n                && (state.inheritOpt(this, \"et-al-subsequent-min\") !== state.inheritOpt(this, \"et-al-min\"))) {\n                \n                state.opt.update_mode = CSL.POSITION;\n            }\n            if (state.inheritOpt(this, \"et-al-subsequent-use-first\")\n                && (state.inheritOpt(this, \"et-al-subsequent-use-first\") !== state.inheritOpt(this, \"et-al-use-first\"))) {\n                \n                state.opt.update_mode = CSL.POSITION;\n            }\n\n            state.tmp.root = oldTmpRoot;\n\n            func = function (state) {\n                // Et-al (onward processing in node_etal.js and node_names.js)\n                // XXXXX Why is this necessary? This is available on this.name, right?\n                state.tmp.etal_term = \"et-al\";\n\n                // Use default delimiter as fallback, in a way that allows explicit\n                // empty strings.\n                state.tmp.name_delimiter = state.inheritOpt(this, \"delimiter\", \"name-delimiter\", \", \");\n                state.tmp[\"delimiter-precedes-et-al\"] = state.inheritOpt(this, \"delimiter-precedes-et-al\");\n                \n                // And\n                if (\"text\" === state.inheritOpt(this, \"and\")) {\n                    this.and_term = state.getTerm(\"and\", \"long\", 0);\n                } else if (\"symbol\" === state.inheritOpt(this, \"and\")) {\n                    if (state.opt.development_extensions.expect_and_symbol_form) {\n                        this.and_term = state.getTerm(\"and\", \"symbol\", 0);\n                    } else {\n                        this.and_term = \"&\";\n                    }\n                }\n                state.tmp.and_term = this.and_term;\n                if (CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)) {\n                    this.and_prefix_single = \" \";\n                    this.and_prefix_multiple = \", \";\n                    // Workaround to allow explicit empty string\n                    // on cs:name delimiter.\n                    if (\"string\" === typeof state.tmp.name_delimiter) {\n                        this.and_prefix_multiple = state.tmp.name_delimiter;\n                    }\n                    this.and_suffix = \" \";\n\n                    // Really can't inspect these values in the build phase. Sorry.\n                    //state.build.name_delimiter = this.strings.delimiter;\n\n                } else {\n                    this.and_prefix_single = \"\";\n                    this.and_prefix_multiple = \"\";\n                    this.and_suffix = \"\";\n                }\n                if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"always\") {\n                    this.and_prefix_single = state.tmp.name_delimiter;\n                } else if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"never\") {\n                    // Slightly fragile: could test for charset here to make\n                    // this more certain.\n                    if (this.and_prefix_multiple) {\n                        this.and_prefix_multiple = \" \";\n                    }\n                } else if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"after-inverted-name\") {\n                    if (this.and_prefix_single) {\n                        this.and_prefix_single = state.tmp.name_delimiter;\n                    }\n                    if (this.and_prefix_multiple) {\n                        this.and_prefix_multiple = \" \";\n                    }\n                }\n\n                this.and = {};\n                if (state.inheritOpt(this, \"and\")) {\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.single = state.output.pop();\n                    this.and.single.strings.prefix = this.and_prefix_single;\n                    this.and.single.strings.suffix = this.and_suffix;\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.multiple = state.output.pop();\n                    this.and.multiple.strings.prefix = this.and_prefix_multiple;\n                    this.and.multiple.strings.suffix = this.and_suffix;\n                } else if (state.tmp.name_delimiter) {\n                    // This is a little weird, but it works.\n                    this.and.single = new CSL.Blob(state.tmp.name_delimiter);\n                    this.and.single.strings.prefix = \"\";\n                    this.and.single.strings.suffix = \"\";\n                    this.and.multiple = new CSL.Blob(state.tmp.name_delimiter);\n                    this.and.multiple.strings.prefix = \"\";\n                    this.and.multiple.strings.suffix = \"\";\n                }\n\n                this.ellipsis = {};\n                if (state.inheritOpt(this, \"et-al-use-last\")) {\n                    // We use the dedicated Unicode ellipsis character because\n                    // it is recommended by some editors, and can be more easily\n                    // identified for find and replace operations.\n                    // Source: http://en.wikipedia.org/wiki/Ellipsis#Computer_representations\n                    //\n                    \n                    // Eventually, this should be localized as a term in CSL, with some\n                    // mechanism for triggering appropriate punctuation handling around\n                    // the ellipsis placeholder (Polish is a particularly tough case for that).\n                    this.ellipsis_term = \"\\u2026\";\n                    // Similar treatment to \"and\", above, will be needed\n                    // here when this becomes a locale term.\n                    this.ellipsis_prefix_single = \" \";\n                    this.ellipsis_prefix_multiple =  state.inheritOpt(this, \"delimiter\", \"name-delimiter\", \", \");\n                    this.ellipsis_suffix = \" \";\n                    this.ellipsis.single = new CSL.Blob(this.ellipsis_term);\n                    this.ellipsis.single.strings.prefix = this.ellipsis_prefix_single;\n                    this.ellipsis.single.strings.suffix = this.ellipsis_suffix;\n                    this.ellipsis.multiple = new CSL.Blob(this.ellipsis_term);\n                    this.ellipsis.multiple.strings.prefix = this.ellipsis_prefix_multiple;\n                    this.ellipsis.multiple.strings.suffix = this.ellipsis_suffix;\n                }\n\n                // et-al parameters are annoyingly incomprehensible\n                // again.\n                //\n                // Explanation probably just adds a further layer of\n                // irritation, but what's INTENDED here is that\n                // the state.tmp et-al variables are set from the\n                // cs:key element when composing sort keys, and a\n                // macro containing a name can be called from cs:key.\n                // So when cs:key sets et-al attributes, they are\n                // set on state.tmp, and when the key is finished\n                // processing, the state.tmp variables are reset to\n                // undefined. IN THEORY the state.tmp et-al variables\n                // will not be used in other contexts. I hope.\n                //\n                // Anyway, the current tests now seem to pass.\n                if (\"undefined\" === typeof state.tmp[\"et-al-min\"]) {\n                    state.tmp[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n                }\n                if (\"undefined\" === typeof state.tmp[\"et-al-use-first\"]) {\n                    state.tmp[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n                }\n                if (\"undefined\" === typeof state.tmp[\"et-al-use-last\"]) {\n                    //print(\"  setting et-al-use-last from name: \"+this.strings[\"et-al-use-last\"]);\n                    state.tmp[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n                }\n\n                state.nameOutput.name = this;\n            };\n            \n            state.build.name_flag = true;\n\n            this.execs.push(func);\n        }\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node[\"name-part\"] = {\n    build: function (state) {\n        state.build[this.strings.name] = this;\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.names = {\n    build: function (state, target) {\n        var func;\n        // CSL.debug = print;\n\n        if (this.tokentype === CSL.START || this.tokentype === CSL.SINGLETON) {\n            CSL.Util.substituteStart.call(this, state, target);\n            state.build.substitute_level.push(1);\n        }\n        \n        if (this.tokentype === CSL.SINGLETON) {\n            state.build.names_variables[state.build.names_variables.length-1].concat(this.variables);\n            for (var i in this.variables) {\n                var variable = this.variables[i];\n                var name_labels = state.build.name_label[state.build.name_label.length-1];\n                if (Object.keys(name_labels).length) {\n                    name_labels[variable] = name_labels[Object.keys(name_labels)[0]];\n                }\n            }\n            func = function (state) {\n                state.nameOutput.reinit(this, this.variables_real[0]);\n            };\n            this.execs.push(func);\n        }\n\n        if (this.tokentype === CSL.START) {\n\n            state.build.names_flag = true;\n            state.build.name_flag = false;\n            state.build.names_level += 1;\n            state.build.names_variables.push(this.variables);\n            state.build.name_label.push({});\n            // init can substitute\n            // init names\n            func = function (state) {\n                state.tmp.can_substitute.push(true);\n                state.tmp.name_node = {};\n                state.tmp.name_node.children = [];\n                state.nameOutput.init(this);\n            };\n            this.execs.push(func);\n\n        }\n        \n        if (this.tokentype === CSL.END) {\n\n            // Set/reset name blobs if they exist, for processing\n            // by namesOutput()\n            for (var i = 0, ilen = 3; i < ilen; i += 1) {\n                var key = [\"family\", \"given\", \"et-al\"][i];\n                this[key] = state.build[key];\n                if (state.build.names_level === 1) {\n                    state.build[key] = undefined;\n                }\n            }\n            // Labels, if any\n            this.label = state.build.name_label[state.build.name_label.length-1];\n            state.build.names_level += -1;\n            state.build.names_variables.pop();\n            state.build.name_label.pop();\n\n            // The with term. This isn't the right place\n            // for this, but it's all hard-wired at the\n            // moment.\n\n            // \"and\" and \"ellipsis\" are set in node_name.js\n            func = function (state) {\n                // Et-al (strings only)\n                // Blob production has to happen inside nameOutput()\n                // since proper escaping requires access to the output\n                // queue.\n                if (state.tmp.etal_node) {\n                    this.etal_style = state.tmp.etal_node;\n                } else {\n                    this.etal_style = \"empty\";\n                }\n\n                this.etal_term = state.getTerm(state.tmp.etal_term, \"long\", 0);\n                this.etal_prefix_single = \" \";\n                // Should be name delimiter, not hard-wired.\n                this.etal_prefix_multiple = state.tmp.name_delimiter;\n                if (state.tmp[\"delimiter-precedes-et-al\"] === \"always\") {\n                    this.etal_prefix_single = state.tmp.name_delimiter;\n                } else if (state.tmp[\"delimiter-precedes-et-al\"] === \"never\") {\n                    this.etal_prefix_multiple = \" \";\n                } else if (state.tmp[\"delimiter-precedes-et-al\"] === \"after-inverted-name\") {\n                    this.etal_prefix_single = state.tmp.name_delimiter;\n                    this.etal_prefix_multiple = \" \";\n                }\n                this.etal_suffix = \"\";\n                if (!CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)) {\n                    // Not sure what the correct treatment is here, but we should not suppress\n                    // a comma-space.\n                    // https://forums.zotero.org/discussion/76679/delimiter-precedes-et-al-always-dose-not-work-in-locale-zh-cn\n                    if (this.etal_prefix_single === \" \") {\n                        this.etal_prefix_single = \"\";\n                    }\n                    if (this.etal_prefix_multiple === \" \") {\n                        this.etal_prefix_multiple = \"\";\n                    }\n                    if (this.etal_suffix === \" \") {\n                        this.etal_suffix = \"\";\n                    }\n                }\n                // et-al affixes are further adjusted in nameOutput(),\n                // after the term (possibly changed in cs:et-al) is known.\n\n\n                for (var i = 0, ilen = 3; i < ilen; i += 1) {\n                    var key = [\"family\", \"given\"][i];\n                    state.nameOutput[key] = this[key];\n                }\n                state.nameOutput[\"with\"] = this[\"with\"];\n\n                // REMOVE THIS\n                var mywith = \"with\";\n                var with_default_prefix = \"\";\n                var with_suffix = \"\";\n                if (CSL.STARTSWITH_ROMANESQUE_REGEXP.test(mywith)) {\n                    with_default_prefix = \" \";\n                    with_suffix = \" \";\n                }\n                var thewith = {};\n                thewith.single = new CSL.Blob(mywith);\n                thewith.single.strings.suffix = with_suffix;\n                thewith.multiple = new CSL.Blob(mywith);\n                thewith.multiple.strings.suffix = with_suffix;\n                if (state.inheritOpt(state.nameOutput.name, \"delimiter-precedes-last\") === \"always\") {\n                    thewith.single.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                    thewith.multiple.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                } else if (state.inheritOpt(state.nameOutput.name, \"delimiter-precedes-last\") === \"contextual\") {\n                    thewith.single.strings.prefix = with_default_prefix;\n                    thewith.multiple.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                } else if (state.inheritOpt(state.nameOutput.name, \"delimiter-precedes-last\") === \"after-inverted-name\") {\n                    thewith.single.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                    thewith.multiple.strings.prefix = with_default_prefix;\n                } else {\n                    thewith.single.strings.prefix = with_default_prefix;\n                    thewith.multiple.strings.prefix = with_default_prefix;\n                }\n                state.nameOutput[\"with\"] = thewith;\n\n\n                // XXX label style should be set per variable, since they may differ\n                // XXX with full-form nested names constructs\n                state.nameOutput.label = this.label;\n\n                state.nameOutput.etal_style = this.etal_style;\n                state.nameOutput.etal_term = this.etal_term;\n                state.nameOutput.etal_prefix_single = this.etal_prefix_single;\n                state.nameOutput.etal_prefix_multiple = this.etal_prefix_multiple;\n                state.nameOutput.etal_suffix = this.etal_suffix;\n                state.nameOutput.outputNames();\n                state.tmp[\"et-al-use-first\"] = undefined;\n                state.tmp[\"et-al-min\"] = undefined;\n                state.tmp[\"et-al-use-last\"] = undefined;\n            };\n            this.execs.push(func);\n\n            // unsets\n            func = function (state) {\n                if (!state.tmp.can_substitute.pop()) {\n                    state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                }\n                \n                // For posterity ...\n                //\n                // This was enough to fix the issue reported here:\n                //\n                //   http://forums.zotero.org/discussion/25223/citeproc-bug-substitute-doesnt-work-correctly-for-title-macro/\n                //\n                // The remainder of the changes applied in the same patch\n                // relate to a label assignments, which were found to be\n                // buggy while working on the issue. The test covering\n                // both problems is here:\n                //\n                //   https://bitbucket.org/bdarcus/citeproc-test/src/ab136a6aa8f2/processor-tests/humans/substitute_SuppressOrdinaryVariable.txt\n                if (state.tmp.can_substitute.mystack.length === 1) {\n                    state.tmp.can_block_substitute = false;\n                }\n            };\n            this.execs.push(func);\n\n            state.build.name_flag = false;\n        }\n        target.push(this);\n\n        if (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON) {\n            state.build.substitute_level.pop();\n            CSL.Util.substituteEnd.call(this, state, target);\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.number = {\n    build: function (state, target) {\n        var func;\n        CSL.Util.substituteStart.call(this, state, target);\n        //\n        // This should push a rangeable object to the queue.\n        //\n        if (this.strings.form === \"roman\") {\n            this.formatter = state.fun.romanizer;\n        } else if (this.strings.form === \"ordinal\") {\n            this.formatter = state.fun.ordinalizer;\n        } else if (this.strings.form === \"long-ordinal\") {\n            this.formatter = state.fun.long_ordinalizer;\n        }\n        if (\"undefined\" === typeof this.successor_prefix) {\n            this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n        }\n        if (\"undefined\" === typeof this.splice_prefix) {\n            this.splice_prefix = state[state.build.area].opt.layout_delimiter;\n        }\n        // is this needed?\n        //if (\"undefined\" === typeof this.splice_prefix){\n        //    this.splice_prefix = state[state.tmp.area].opt.layout_delimiter;\n        //}\n        //\n        // Whether we actually stick a number object on\n        // the output queue depends on whether the field\n        // contains a pure number.\n        //\n        // push number or text\n        func = function (state, Item, item) {\n            // NOTE: this works because this is the ONLY function in this node.\n            // If further functions are added, they need to start with the same\n            // abort condition.\n            if (this.variables.length === 0) {\n                return;\n            }\n            var varname;\n            varname = this.variables[0];\n            if (\"undefined\" === typeof item) {\n                var item = {};\n            }\n            if ([\"locator\", \"locator-extra\"].indexOf(varname) > -1) {\n                if (state.tmp.just_looking) {\n                    return;\n                }\n                if (!item[varname]) {\n                    return;\n                }\n            } else {\n                if (!Item[varname]) {\n                    return;\n                }\n            }\n\n            if (varname === 'collection-number' && Item.type === 'legal_case') {\n                state.tmp.renders_collection_number = true;\n            }\n            \n            // For bill or legislation items that have a label-form\n            // attribute set on the cs:number node rendering the locator,\n            // the form and pluralism of locator terms are controlled\n            // separately from those of the initial label. Form is\n            // straightforward: the label uses the value set on\n            // the cs:label node that renders it, and the embedded\n            // labels use the value of label-form set on the cs:number\n            // node. Both default to \"long\".\n            //\n            // Pluralism is more complicated. For embedded labels,\n            // pluralism is evaluated using a simple heuristic that\n            // can be found below (it just looks for comma, ampersand etc).\n            // The item.label rendered independently via cs:label\n            // defaults to singular. It is always singular if embedded\n            // labels exist that (when expanded to their valid CSL\n            // value) do not match the value of item.label. Otherwise,\n            // if one or more matching embedded labels exist, the\n            // cs:label is set to plural.\n            //\n            // The code that does all this is divided between this module,\n            // util_static_locator.js, and util_label.js. It's not easy\n            // to follow, but seems to do the job. Let's home for good\n            // luck out there in the wild.\n            \n            var node = this;\n\n            if (state.tmp.group_context.tip.force_suppress) {\n                return false;\n            }\n\n            if ([\"locator\", \"locator-extra\"].indexOf(varname) > -1) {\n                // amazing that we reach this. should abort sooner if no content?\n                state.processNumber.call(state, node, item, varname, Item.type);\n            } else {\n                if (!state.tmp.group_context.tip.condition && Item[varname]) {\n                    state.tmp.just_did_number = (\"\" + Item[varname]).match(/[0-9]$/);\n                }\n                // UPDATE_GROUP_CONTEXT_CONDITION is run by processNumber\n                state.processNumber.call(state, node, Item, varname, Item.type);\n            }\n\n            if (this.substring) {\n                var val = Item[varname].slice(this.substring);\n                state.output.append(val, node);\n            } else {\n                CSL.Util.outputNumericField(state, varname, Item.id);\n            }\n\n            if ([\"locator\", \"locator-extra\"].indexOf(this.variables_real[0]) > -1\n               && !state.tmp.just_looking) {\n                state.tmp.done_vars.push(this.variables_real[0]);\n                state.tmp.group_context.tip.done_vars.push(this.variables_real[0]);\n            }\n        };\n        this.execs.push(func);\n        target.push(this);\n        \n        CSL.Util.substituteEnd.call(this, state, target);\n    }\n};\n\n/*global CSL: true */\n\n/*\n * Yikes, these functions were running out of scope for yonks.\n * now that they are set in the correct token list,\n * they might be useful for things.\n * FB 2013.11.09\n*/\n\nCSL.Node.sort = {\n    build: function (state, target) {\n        target = state[state.build.root + \"_sort\"].tokens;\n        if (this.tokentype === CSL.START) {\n            if (state.build.area === \"citation\") {\n                state.opt.sort_citations = true;\n            }\n            state.build.area = state.build.root + \"_sort\";\n            state.build.extension = \"_sort\";\n            \n            var func = function (state, Item) {\n                //state.tmp.area = state.tmp.root + \"_sort\";\n                //state.tmp.extension = \"_sort\";\n                if (state.opt.has_layout_locale) {\n                    var langspec = CSL.localeResolve(Item.language, state.opt[\"default-locale\"][0]);\n                    var sort_locales = state[state.tmp.area.slice(0,-5)].opt.sort_locales;\n                    var langForItem;\n                    for (var i=0,ilen=sort_locales.length;i<ilen;i+=1) {\n                        langForItem = sort_locales[i][langspec.bare];\n                        if (!langForItem) {\n                            langForItem = sort_locales[i][langspec.best];\n                        }\n                        if (langForItem) {\n                            break;\n                        }\n                    }\n                    if (!langForItem) {\n                        langForItem = state.opt[\"default-locale\"][0];\n                    }\n                    state.tmp.lang_sort_hold = state.opt.lang;\n                    state.opt.lang = langForItem;\n                }\n            };\n            this.execs.push(func);\n            \n        }\n        if (this.tokentype === CSL.END) {\n            state.build.area = state.build.root;\n            state.build.extension = \"\";\n            var func = function (state) {\n                if (state.opt.has_layout_locale) {\n                    state.opt.lang = state.tmp.lang_sort_hold;\n                    delete state.tmp.lang_sort_hold;\n                }\n                //state.tmp.area = state.tmp.root;\n                //state.tmp.extension = \"\";\n            };\n            this.execs.push(func);\n            /*\n            var func = function (state, Item) {\n                state.tmp.area = state.tmp.root;\n                state.tmp.extension = \"\";\n            }\n            this.execs.push(func);\n            */\n        }\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node.substitute = {\n    build: function (state, target) {\n        var func;\n        if (this.tokentype === CSL.START) {\n            /* */\n            // set conditional\n            var choose_start = new CSL.Token(\"choose\", CSL.START);\n            CSL.Node.choose.build.call(choose_start, state, target);\n            var if_singleton = new CSL.Token(\"if\", CSL.SINGLETON);\n            func = function() {\n                if (state.tmp.value.length && !state.tmp.common_term_match_fail) {\n                    return true;\n                }\n                return false;\n            }\n            if_singleton.tests = [func];\n            if_singleton.test = state.fun.match.any(if_singleton, state, if_singleton.tests);\n            target.push(if_singleton);\n\n            func = function (state) {\n                state.tmp.can_block_substitute = true;\n                if (state.tmp.value.length && !state.tmp.common_term_match_fail) {\n                    state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                }\n                state.tmp.common_term_match_fail = false;\n            };\n            this.execs.push(func);\n            target.push(this);\n            /* */\n        }\n        if (this.tokentype === CSL.END) {\n            //var if_end = new CSL.Token(\"if\", CSL.END);\n            //CSL.Node[\"if\"].build.call(if_end, state, target);\n            /* */\n            target.push(this);\n            var choose_end = new CSL.Token(\"choose\", CSL.END);\n            CSL.Node.choose.build.call(choose_end, state, target);\n            /* */\n        }\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node.text = {\n    build: function (state, target) {\n        var func, form, plural, id, num, number, formatter, firstoutput, specialdelimiter, label, suffix, term;\n        if (this.postponed_macro) {\n            var group_start = CSL.Util.cloneToken(this);\n            group_start.name = \"group\";\n            group_start.tokentype = CSL.START;\n            CSL.Node.group.build.call(group_start, state, target);\n\n            CSL.expandMacro.call(state, this, target);\n\n            var group_end = CSL.Util.cloneToken(this);\n            group_end.name = \"group\";\n            group_end.tokentype = CSL.END;\n            if (this.postponed_macro === 'juris-locator-label') {\n                group_end.isJurisLocatorLabel = true;\n            }\n            CSL.Node.group.build.call(group_end, state, target);\n\n        } else {\n            CSL.Util.substituteStart.call(this, state, target);\n            // ...\n            //\n            // Do non-macro stuff\n            \n            // Guess again. this.variables is ephemeral, adjusted by an initial\n            // function set on the node via @variable attribute setup.\n            //variable = this.variables[0];\n            \n            if (!this.variables_real) {\n                this.variables_real = [];\n            }\n            if (!this.variables) {\n                this.variables = [];\n            }\n\n            form = \"long\";\n            plural = 0;\n            if (this.strings.form) {\n                form = this.strings.form;\n            }\n            if (this.strings.plural) {\n                plural = this.strings.plural;\n            }\n            if (\"citation-number\" === this.variables_real[0] || \"year-suffix\" === this.variables_real[0] || \"citation-label\" === this.variables_real[0]) {\n                //\n                // citation-number and year-suffix are super special,\n                // because they are rangeables, and require a completely\n                // different set of formatting parameters on the output\n                // queue.\n                if (this.variables_real[0] === \"citation-number\") {\n\n                    if (state.build.root === \"citation\") {\n                        state.opt.update_mode = CSL.NUMERIC;\n                    }\n                    if (state.build.root === \"bibliography\") {\n                        state.opt.bib_mode = CSL.NUMERIC;\n                    }\n                    //this.strings.is_rangeable = true;\n                    if (\"citation-number\" === state[state.tmp.area].opt.collapse) {\n                        this.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                    }\n                    this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n                    this.splice_prefix = state[state.build.area].opt.layout_delimiter;\n                    func = function (state, Item, item) {\n\n                        id = \"\" + Item.id;\n                        if (!state.tmp.just_looking) {\n                            if (state.tmp.area.slice(-5) === \"_sort\" && this.variables[0] === \"citation-number\") {\n                                if (state.tmp.area === \"bibliography_sort\") {\n                                    state.tmp.group_context.tip.done_vars.push(\"citation-number\");\n                                }\n                                if (state.tmp.area === \"citation_sort\" && state.bibliography_sort.tmp.citation_number_map) {\n                                    var num = state.bibliography_sort.tmp.citation_number_map[state.registry.registry[Item.id].seq];\n                                } else {\n                                    var num = state.registry.registry[Item.id].seq;\n                                }\n                                if (num) {\n                                    // Code currently in util_number.js\n                                    num = CSL.Util.padding(\"\" + num);\n                                }\n                                state.output.append(num, this);\n                                return;\n                            }\n                            if (item && item[\"author-only\"]) {\n                                state.tmp.element_trace.replace(\"suppress-me\");\n                            }\n                            if (state.tmp.area !== \"bibliography_sort\" && state.bibliography_sort.tmp.citation_number_map && state.bibliography_sort.opt.citation_number_sort_direction === CSL.DESCENDING) {\n                                num = state.bibliography_sort.tmp.citation_number_map[state.registry.registry[id].seq];\n                            } else {\n                                num = state.registry.registry[id].seq;\n                            }\n                            if (state.opt.citation_number_slug) {\n                                state.output.append(state.opt.citation_number_slug, this);\n                            } else {\n                                number = new CSL.NumericBlob(state, false, num, this, Item.id);\n                                if (state.tmp.in_cite_predecessor) {\n                                    number.suppress_splice_prefix = true;\n                                }\n                                state.output.append(number, \"literal\");\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n                } else if (this.variables_real[0] === \"year-suffix\") {\n\n                    state.opt.has_year_suffix = true;\n\n                    if (state[state.tmp.area].opt.collapse === \"year-suffix-ranged\") {\n                        //this.range_prefix = \"-\";\n                        this.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                    }\n                    this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n                    if (state[state.tmp.area].opt[\"year-suffix-delimiter\"]) {\n                        this.successor_prefix = state[state.build.area].opt[\"year-suffix-delimiter\"];\n                    }\n                    func = function (state, Item) {\n                        if (state.registry.registry[Item.id] && state.registry.registry[Item.id].disambig.year_suffix !== false && !state.tmp.just_looking) {\n                            //state.output.append(state.registry.registry[Item.id].disambig[2],this);\n                            num = parseInt(state.registry.registry[Item.id].disambig.year_suffix, 10);\n\n                            //if (state[state.tmp.area].opt.collapse === \"year-suffix-ranged\") {\n                            //    //this.range_prefix = \"-\";\n                            //    this.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                            //}\n                            //this.successor_prefix = state[state.tmp.area].opt.layout_delimiter;\n                            if (state[state.tmp.area].opt.cite_group_delimiter) {\n                                this.successor_prefix = state[state.tmp.area].opt.cite_group_delimiter;\n                            }\n                            number = new CSL.NumericBlob(state, false, num, this, Item.id);\n                            formatter = new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);\n                            number.setFormatter(formatter);\n                            state.output.append(number, \"literal\");\n                            firstoutput = false;\n                            // XXX Can we do something better for length here?\n                            for (var i=0,ilen=state.tmp.group_context.mystack.length; i<ilen; i++) {\n                                var flags = state.tmp.group_context.mystack[i];\n                                if (!flags.variable_success && (flags.variable_attempt || (!flags.variable_attempt && !flags.term_intended))) {\n                                    firstoutput = true;\n                                    break;\n                                }\n                            }\n                            specialdelimiter = state[state.tmp.area].opt[\"year-suffix-delimiter\"];\n                            if (firstoutput && specialdelimiter && !state.tmp.sort_key_flag) {\n                                state.tmp.splice_delimiter = state[state.tmp.area].opt[\"year-suffix-delimiter\"];\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n                } else if (this.variables_real[0] === \"citation-label\") {\n                    if (state.build.root === \"bibliography\") {\n                        state.opt.bib_mode = CSL.TRIGRAPH;\n                    }\n                    state.opt.has_year_suffix = true;\n                    func = function (state, Item) {\n                        label = Item[\"citation-label\"];\n                        if (!label) {\n                            label = state.getCitationLabel(Item);\n                        }\n                        if (!state.tmp.just_looking) {\n                            suffix = \"\";\n                            if (state.registry.registry[Item.id] && state.registry.registry[Item.id].disambig.year_suffix !== false) {\n                                num = parseInt(state.registry.registry[Item.id].disambig.year_suffix, 10);\n                                suffix = state.fun.suffixator.format(num);\n                            }\n                            label += suffix;\n                        }\n                        state.output.append(label, this);\n                    };\n                    this.execs.push(func);\n                }\n            } else {\n                if (this.strings.term) {\n                    \n                    // printterm\n                    func = function (state, Item) {\n                        var gender = state.opt.gender[Item.type];\n                        var term = this.strings.term;\n                        term = state.getTerm(term, form, plural, gender, CSL.TOLERANT, this.default_locale);\n                        var myterm;\n                        // if the term is not an empty string, say\n                        // that we rendered a term\n                        if (term !== \"\") {\n                            state.tmp.group_context.tip.term_intended = true;\n                        }\n                        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, term, null, this);\n                        \n                        // capitalize the first letter of a term, if it is the\n                        // first thing rendered in a citation (or if it is\n                        // being rendered immediately after terminal punctuation,\n                        // I guess, actually).\n                        if (!state.tmp.term_predecessor && !(state.opt[\"class\"] === \"in-text\" && state.tmp.area === \"citation\")) {\n                            myterm = CSL.Output.Formatters[\"capitalize-first\"](state, term);\n                            //CSL.debug(\"Capitalize\");\n                        } else {\n                            myterm = term;\n                        }\n                        \n                        // XXXXX Cut-and-paste code in multiple locations. This code block should be\n                        // collected in a function.\n                        // Tag: strip-periods-block\n                        if (state.tmp.strip_periods) {\n                            myterm = myterm.replace(/\\./g, \"\");\n                        } else {\n                            for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n                                if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                                    myterm = myterm.replace(/\\./g, \"\");\n                                    break;\n                                }\n                            }\n                        }\n                        state.output.append(myterm, this);\n                        if (state.tmp.can_block_substitute) {\n                            // Black magic here. This causes the cs:substitution condition to pass,\n                            // blocking further rendering within its scope. \n                            state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                        }\n                    };\n                    this.execs.push(func);\n                    state.build.term = false;\n                    state.build.form = false;\n                    state.build.plural = false;\n                } else if (this.variables_real.length) {\n                    func = function (state, Item) {\n\n                        // If some text variable is rendered, we're not collapsing.\n                        if (this.variables_real[0] !== \"locator\") {\n                            state.tmp.have_collapsed = false;\n                        }\n\n                        if (!state.tmp.group_context.tip.condition && Item[this.variables[0]]) {\n                            state.tmp.just_did_number = false;\n                        }\n                        var val = Item[this.variables[0]];\n                        if (val && !state.tmp.group_context.tip.condition) {\n                            if ((\"\" + val).slice(-1).match(/[0-9]/)) {\n                                state.tmp.just_did_number = true;\n                            } else {\n                                state.tmp.just_did_number = false;\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n\n                    // plain string fields\n\n                    // Deal with multi-fields and ordinary fields separately.\n                    if (CSL.MULTI_FIELDS.indexOf(this.variables_real[0]) > -1\n                        || this.variables_real[0].indexOf(\"-main\") > -1\n                        || this.variables_real[0].indexOf(\"-sub\") > -1\n                        || [\"language-name\", \"language-name-original\"].indexOf(this.variables_real[0]) > -1\n                       ) {\n\n                        // multi-fields\n                        // Initialize transform factory according to whether\n                        // abbreviation is desired.\n                        var abbrevfam = this.variables[0];\n                        var abbrfall = false;\n                        var altvar = false;\n                        var transfall = false;\n                        if (form === \"short\") {\n                            if (this.variables_real[0].slice(-6) !== \"-short\") {\n                                altvar = this.variables_real[0] + \"-short\";\n                            }\n                        } else {\n                            abbrevfam = false;\n                        }\n                        if (state.build.extension) {\n                            // multi-fields for sorting get a sort transform,\n                            // (abbreviated if the short form was selected)\n                            transfall = true;\n                        } else {\n                            transfall = true;\n                            abbrfall = true;\n\t\t\t\t\t\t}\n\n                        func = state.transform.getOutputFunction(this.variables, abbrevfam, abbrfall, altvar, transfall);\n                    } else {\n                        // ordinary fields\n                        if (CSL.CITE_FIELDS.indexOf(this.variables_real[0]) > -1) {\n                            // per-cite fields are read from item, rather than Item\n                            func = function (state, Item, item) {\n                                if (item && item[this.variables[0]]) {\n                                    // Code copied to page variable as well; both\n                                    // become cs:number in MLZ extended schema\n                                    \n                                    // If locator, use cs:number. Otherwise, render\n                                    // normally.\n\n                                    // XXX The code below is pretty-much copied from\n                                    // XXX node_number.js. Should be a common function.\n                                    // XXX BEGIN\n                                    state.processNumber(this, item, this.variables[0], Item.type);\n                                    CSL.Util.outputNumericField(state, this.variables[0], Item.id);\n                                    // XXX END\n\n                                    if ([\"locator\", \"locator-extra\"].indexOf(this.variables_real[0]) > -1\n                                       && !state.tmp.just_looking) { \n                                        state.tmp.done_vars.push(this.variables_real[0]);\n                                    }\n                                }\n                            };\n                        } else  if ([\"page\", \"page-first\", \"chapter-number\", \"collection-number\", \"edition\", \"issue\", \"number\", \"number-of-pages\", \"number-of-volumes\", \"volume\"].indexOf(this.variables_real[0]) > -1) {\n                            // page gets mangled with the correct collapsing\n                            // algorithm\n                            func = function(state, Item) {\n                                state.processNumber(this, Item, this.variables[0], Item.type);\n                                CSL.Util.outputNumericField(state, this.variables[0], Item.id);\n                            };\n                        } else if ([\"URL\", \"DOI\"].indexOf(this.variables_real[0]) > -1) {\n                            func = function (state, Item) {\n                                var value;\n                                if (this.variables[0]) {\n                                    value = state.getVariable(Item, this.variables[0], form);\n                                    if (value) {\n                                        if (this.variables[0] === \"URL\" && form === \"short\") {\n                                            value = value.replace(/(.*\\.[^\\/]+)\\/.*/, \"$1\");\n                                            if (value.match(/\\/\\/www\\./)) {\n                                                value = value.replace(/https?:\\/\\//, \"\");\n                                            }\n                                        }\n                                        // true is for non-suppression of periods\n                                        if (state.opt.development_extensions.wrap_url_and_doi) {\n                                            if (!this.decorations.length || this.decorations[0][0] !== \"@\" + this.variables[0]) {\n                                                // Special-casing to fix https://github.com/Juris-M/citeproc-js/issues/57\n                                                // clone current token, to avoid collateral damage\n                                                var clonetoken = CSL.Util.cloneToken(this);\n                                                // cast a group blob\n                                                var groupblob = new CSL.Blob(null, null, \"url-wrapper\");\n                                                // set the DOI decoration on the blob\n                                                groupblob.decorations.push([\"@DOI\", \"true\"]);\n                                                if (this.variables_real[0] === \"DOI\") {\n                                                    // strip a proper DOI prefix\n                                                    var prefix;\n                                                    if (this.strings.prefix && this.strings.prefix.match(/^.*https:\\/\\/doi\\.org\\/$/)) {\n                                                        value = value.replace(/^https?:\\/\\/doi\\.org\\//, \"\");\n                                                        if (value.match(/^https?:\\/\\//)) {\n                                                            // Do not tamper with another protocol + domain if already set in field value\n                                                            prefix = \"\";\n                                                        } else {\n                                                            // Otherwise https + domain\n                                                            prefix = \"https://doi.org/\";\n                                                        }\n                                                        // set any string prefix on the clone\n                                                        clonetoken.strings.prefix = this.strings.prefix.slice(0, clonetoken.strings.prefix.length-16);\n                                                    }\n                                                    // cast a text blob\n                                                    // set the prefix as the content of the blob\n                                                    var prefixblob = new CSL.Blob(prefix);\n                                                    // cast another text blob\n                                                    // set the value as the content of the second blob\n                                                    var valueblob = new CSL.Blob(value);\n                                                    // append new text token and clone to group token\n                                                    groupblob.push(prefixblob);\n                                                    groupblob.push(valueblob);\n                                                    // append group token to output\n                                                    state.output.append(groupblob, clonetoken, false, false, true);\n                                                } else {\n                                                    var valueblob = new CSL.Blob(value);\n                                                    // append new text token and clone to group token\n                                                    groupblob.push(valueblob);\n                                                    // append group token to output\n                                                    //this.decorations = [[\"@\" + this.variables[0], \"true\"]].concat(this.decorations);\n                                                    state.output.append(groupblob, clonetoken, false, false, true);\n                                                }\n                                            } else {\n                                                state.output.append(value, this, false, false, true);\n                                            }\n                                        } else {\n                                            // This is totally unnecessary, isn't it?\n                                            if (this.decorations.length) {\n                                                for (var i=this.decorations.length-1; i>-1; i--) {\n                                                    if (this.decorations[i][0] === \"@\" + this.variables[0]) {\n                                                        this.decorations = this.decorations.slice(0, i).concat(this.decorations.slice(i+1));\n                                                    }\n                                                }\n                                            }\n                                            state.output.append(value, this, false, false, true);\n                                        }\n                                    }\n                                }\n                            };\n                        } else if (this.variables_real[0] === \"section\") {\n                            // Sections for statutes are special. This is an uncommon\n                            // variable, so we save the cost of the runtime check\n                            // unless it's being used.\n                            func = function (state, Item) {\n                                var value;\n                                value = state.getVariable(Item, this.variables[0], form);\n                                if (value) {\n                                    state.output.append(value, this);\n                                }\n                            };\n                        } else if (this.variables_real[0] === \"hereinafter\") {\n                            func = function (state, Item) {\n                                var value = state.transform.abbrevs[\"default\"][\"hereinafter\"][Item.id];\n                                if (value) {\n                                    state.output.append(value, this);\n                                    state.tmp.group_context.tip.variable_success = true;\n                                }\n                            };\n                        } else {\n                            // anything left over just gets output in the normal way.\n                            func = function (state, Item) {\n                                var value;\n                                if (this.variables[0]) {\n                                    value = state.getVariable(Item, this.variables[0], form);\n                                    if (value) {\n                                        value = \"\" + value;\n                                        value = value.split(\"\\\\\").join(\"\");\n                                        state.output.append(value, this);\n                                    }\n                                }\n                            };\n                        }\n                    }\n                    this.execs.push(func);\n                } else if (this.strings.value) {\n                    // for the text value attribute.\n                    func = function (state) {\n                        state.tmp.group_context.tip.term_intended = true;\n                        // true flags that this is a literal-value term\n                        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, this.strings.value, true, this);\n                        state.output.append(this.strings.value, this);\n                        if (state.tmp.can_block_substitute) {\n                            // Black magic here. This causes the cs:substitution condition to pass,\n                            // blocking further rendering within its scope. \n                            state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                        }\n                    };\n                    this.execs.push(func);\n                    // otherwise no output\n                }\n            }\n            target.push(this);\n            CSL.Util.substituteEnd.call(this, state, target);\n        }\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node.intext = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            state.build.area = \"intext\";\n            state.build.root = \"intext\";\n            state.build.extension = \"\";\n\n            var func = function(state, Item) {\n                state.tmp.area = \"intext\";\n                state.tmp.root = \"intext\";\n                state.tmp.extension = \"\";\n            }\n            this.execs.push(func);\n        }\n        if (this.tokentype === CSL.END) {\n\n            // Do whatever cs:citation does with sorting.\n            state.intext_sort = {\n                opt: {\n                    sort_directions: state.citation_sort.opt.sort_directions\n                }\n            }\n            state.intext.srt = state.citation.srt;\n        }\n        target.push(this);\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Attributes = {};\n\nCSL.Attributes[\"@disambiguate\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    if (arg === \"true\") {\n        state.opt.has_disambiguate = true;\n        var func = function (Item) {\n            if (state.tmp.area === \"bibliography\") {\n                if (state.tmp.disambiguate_count < state.registry.registry[Item.id].disambig.disambiguate) {\n                    state.tmp.disambiguate_count += 1;\n                    return true;\n                }\n            } else {\n                state.tmp.disambiguate_maxMax += 1;\n                if (state.tmp.disambig_settings.disambiguate\n                    && state.tmp.disambiguate_count < state.tmp.disambig_settings.disambiguate) {\n                    state.tmp.disambiguate_count += 1;\n                    return true;\n                }\n            }\n            return false;\n        };\n        this.tests.push(func);\n    } else if (arg === \"check-ambiguity-and-backreference\") {\n        var func = function (Item) {\n            if (state.registry.registry[Item.id].disambig.disambiguate && state.registry.registry[Item.id][\"citation-count\"] > 1) {\n                return true;\n            }\n            return false;\n        };\n        this.tests.push(func);\n    }\n};\n\nCSL.Attributes[\"@is-numeric\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var variables = arg.split(/\\s+/);\n    var maketest = function(variable) {\n        return function (Item, item) {\n            var myitem = Item;\n            if (item && [\"locator\",\"locator-extra\"].indexOf(variable) > -1) {\n                myitem = item;\n            }\n            if (!myitem[variable]) {\n                return false;\n            }\n            if (CSL.NUMERIC_VARIABLES.indexOf(variable) > -1) {\n                if (!state.tmp.shadow_numbers[variable]) {\n                    state.processNumber(false, myitem, variable, Item.type);\n                }\n                if (state.tmp.shadow_numbers[variable].numeric) {\n                    return true;\n                }\n            } else if ([\"title\",\"version\"].indexOf(variable) > -1) {\n                if (myitem[variable].slice(-1) === \"\" + parseInt(myitem[variable].slice(-1), 10)) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n    for (var i=0; i<variables.length; i+=1) {\n        this.tests.push(maketest(variables[i]));\n    }\n};\n\n\nCSL.Attributes[\"@is-uncertain-date\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var variables = arg.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (myvariable) {\n        return function(Item) {\n            if (Item[myvariable] && Item[myvariable].circa) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=variables.length;i<ilen;i+=1) {\n        this.tests.push(maketest(variables[i]));\n    }\n};\n\n\nCSL.Attributes[\"@locator\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trylabels = arg.replace(\"sub verbo\", \"sub-verbo\");\n    trylabels = trylabels.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (trylabel) {\n        return function(Item, item) {\n            var label;\n            state.processNumber(false, item, \"locator\");\n            label = state.tmp.shadow_numbers.locator.label;\n            if (label && trylabel === label) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=trylabels.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trylabels[i]));\n    }\n};\n\n\nCSL.Attributes[\"@position\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var tryposition;\n    state.opt.update_mode = CSL.POSITION;\n    var trypositions = arg.split(/\\s+/);\n    var testSubsequentNear = function (Item, item) {\n        if (item && CSL.POSITION_MAP[item.position] >= CSL.POSITION_MAP[CSL.POSITION_SUBSEQUENT] && item[\"near-note\"]) {\n            return true;\n        }\n        return false;\n    };\n    var testSubsequentNotNear = function (Item, item) {\n        if (item && CSL.POSITION_MAP[item.position] == CSL.POSITION_MAP[CSL.POSITION_SUBSEQUENT] && !item[\"near-note\"]) {\n            return true;\n        }\n        return false;\n    };\n    var maketest = function(tryposition) {\n        return function (Item, item) {\n            if (state.tmp.area === \"bibliography\") {\n                return false;\n            }\n            if (item && \"undefined\" === typeof item.position) {\n                item.position = 0;\n            }\n            if (item && typeof item.position === \"number\") {\n                if (item.position === 0 && tryposition === 0) {\n                    return true;\n                } else if (tryposition > 0 && CSL.POSITION_MAP[item.position] >= CSL.POSITION_MAP[tryposition]) {\n                    return true;\n                }\n            } else if (tryposition === 0) {\n                return true;\n            }\n            return false;\n        };\n    };\n    for (var i=0,ilen=trypositions.length;i<ilen;i+=1) {\n        var tryposition = trypositions[i];\n        if (tryposition === \"first\") {\n            tryposition = CSL.POSITION_FIRST;\n        } else if (tryposition === \"container-subsequent\") {\n            tryposition = CSL.POSITION_CONTAINER_SUBSEQUENT;\n        } else if (tryposition === \"subsequent\") {\n            tryposition = CSL.POSITION_SUBSEQUENT;\n        } else if (tryposition === \"ibid\") {\n            tryposition = CSL.POSITION_IBID;\n        } else if (tryposition === \"ibid-with-locator\") {\n            tryposition = CSL.POSITION_IBID_WITH_LOCATOR;\n        }\n        if (\"near-note\" === tryposition) {\n            this.tests.push(testSubsequentNear);\n        } else if (\"far-note\" === tryposition) {\n            this.tests.push(testSubsequentNotNear);\n        } else {\n            this.tests.push(maketest(tryposition));\n        }\n    }\n};\n\nCSL.Attributes[\"@type\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    // XXX This is ALWAYS composed as an \"any\" match\n    var types = arg.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (mytype) {\n        return function(Item) {\n            var ret = (Item.type === mytype);\n            if (ret) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    var tests = [];\n    for (var i=0,ilen=types.length;i<ilen;i+=1) {\n        tests.push(maketest(types[i]));\n    }\n    this.tests.push(state.fun.match.any(this, state, tests));\n};\n\nCSL.Attributes[\"@variable\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func;\n    this.variables = arg.split(/\\s+/);\n    this.variables_real = this.variables.slice();\n\n    // First the non-conditional code.\n    if (\"label\" === this.name && this.variables[0]) {\n        this.strings.term = this.variables[0];\n    } else if ([\"names\", \"date\", \"text\", \"number\"].indexOf(this.name) > -1) {\n        //\n        // An oddity of variable handling is that this.variables\n        // is actually ephemeral; the full list of variables is\n        // held in the variables_real var, and pushed into this.variables\n        // conditionally in order to suppress repeat renderings of\n        // the same item variable.  [STILL FUNCTIONAL? 2010.01.15]\n        //\n        // set variable names\n        func = function (state, Item, item) {\n            // Clear this.variables in place\n            for (var i = this.variables.length - 1; i > -1; i += -1) {\n                this.variables.pop();\n            }\n            for (var i=0,ilen=this.variables_real.length;i<ilen;i++) {\n                // set variable name if not quashed, and if not the title of a legal case w/suppress-author\n                if (state.tmp.done_vars.indexOf(this.variables_real[i]) === -1 \n// This looks nuts. Why suppress a case name if not required by context?\n//                    && !(item && Item.type === \"legal_case\" && item[\"suppress-author\"] && this.variables_real[i] === \"title\")\n                   ) {\n                    this.variables.push(this.variables_real[i]);\n                }\n                if (state.tmp.can_block_substitute) {\n                    state.tmp.done_vars.push(this.variables_real[i]);\n                }\n            }\n        };\n        this.execs.push(func);\n\n        // check for output\n        func = function (state, Item, item) {\n            var output = false;\n            for (var i=0,ilen=this.variables.length;i<ilen;i++) {\n                var variable = this.variables[i];\n                if ([\"authority\", \"committee\"].indexOf(variable) > -1\n                    && \"string\" === typeof Item[variable]\n                    && \"names\" === this.name) {\n\n                    // Great! So for each of these, we split.\n                    // And we only recombine everything if the length\n                    // of all the splits matches.\n                    \n                    // Preflight\n                    var isValid = true;\n                    var rawNames = Item[variable].split(/\\s*;\\s*/);\n                    var rawMultiNames = {};\n                    if (Item.multi && Item.multi._keys[variable]) {\n                        for (var langTag in Item.multi._keys[variable]) {\n                            rawMultiNames[langTag] = Item.multi._keys[variable][langTag].split(/\\s*;\\s*/);\n                            if (rawMultiNames[langTag].length !== rawNames.length) {\n                                isValid = false;\n                                break;\n                            }\n                        }\n                    }\n                    if (!isValid) {\n                        rawNames = [Item[variable]];\n                        rawMultiNames = Item.multi._keys[variable];\n                    }\n                    for (var j = 0, jlen = rawNames.length; j < jlen; j++) {\n                        var creatorParent = {\n                            literal:rawNames[j],\n                            multi:{\n                                _key:{}\n                            }\n                        };\n                        for (var langTag in rawMultiNames) {\n                            var creatorChild = {\n                                literal:rawMultiNames[langTag][j]\n                            };\n                            creatorParent.multi._key[langTag] = creatorChild;\n                        }\n                        rawNames[j] = creatorParent;\n                    }\n                    Item[variable] = rawNames;\n                }\n                if (this.strings.form === \"short\" && !Item[variable]) {\n                    if (variable === \"title\") {\n                        variable = \"title-short\";\n                    } else if (variable === \"container-title\") {\n                        variable = \"container-title-short\";\n                    }\n                }\n                if (variable === \"year-suffix\") {\n                    // year-suffix always signals that it produces output,\n                    // even when it doesn't. This permits it to be used with\n                    // the \"no date\" term inside a group used exclusively\n                    // to control formatting.\n                    output = true;\n                    break;\n                } else if (CSL.DATE_VARIABLES.indexOf(variable) > -1) {\n                    if (state.opt.development_extensions.locator_date_and_revision && \"locator-date\" === variable) {\n                        // If locator-date is set, it's valid.\n                        output = true;\n                        break;\n                    }\n                    if (Item[variable]) {\n                        for (var key in Item[variable]) {\n                            if (this.dateparts.indexOf(key) === -1 && \"literal\" !== key) {\n                                continue;\n                            }\n                            if (Item[variable][key]) {\n                                output = true;\n                                break;\n                            }\n                        }\n                        if (output) {\n                            break;\n                        }\n                    }\n                } else if (\"locator\" === variable) {\n                    if (item && item.locator) {\n                        output = true;\n                    }\n                    break;\n                } else if (\"locator-extra\" === variable) {\n                    if (item && item[\"locator-extra\"]) {\n                        output = true;\n                    }\n                    break;\n                } else if ([\"citation-number\",\"citation-label\"].indexOf(variable) > -1) {\n                    output = true;\n                    break;\n                } else if (\"first-reference-note-number\" === variable) {\n                    if (item && item[\"first-reference-note-number\"]) {\n                        output = true;\n                    }\n                    break;\n                } else if (\"first-container-reference-note-number\" === variable) {\n                    if (item && item[\"first-container-reference-note-number\"]) {\n                        output = true;\n                    }\n                    break;\n                } else if (\"hereinafter\" === variable) {\n                    if (state.transform.abbrevs[\"default\"].hereinafter[Item.id]\n                        && state.sys.getAbbreviation\n                        && Item.id) {\n\t\t\t\t\t\t\n                        output = true;\n                    }\n                    break;\n                } else if (\"object\" === typeof Item[variable]) {\n                    break;\n                } else if (\"string\" === typeof Item[variable] && Item[variable]) {\n                    output = true;\n                    break;\n                } else if (\"number\" === typeof Item[variable]) {\n                    output = true;\n                    break;\n                }\n                if (output) {\n                    break;\n                }\n            }\n            //print(\"-- VAR: \"+variable);\n            //flag = state.tmp.group_context.tip;\n            if (output) {\n                for (var i=0,ilen=this.variables_real.length;i<ilen;i++) {\n                    var variable = this.variables_real[i];\n                    if (variable !== \"citation-number\" || state.tmp.area !== \"bibliography\") {\n                        state.tmp.cite_renders_content = true;\n                    }\n                    //print(\"  setting [2] to true based on: \" + arg);\n                    state.tmp.group_context.tip.variable_success = true;\n                    // For util_substitute.js, subsequent-author-substitute\n                    if (state.tmp.can_substitute.value() \n                        && state.tmp.area === \"bibliography\"\n                        && \"string\" === typeof Item[variable]) {\n\n                        state.tmp.name_node.top = state.output.current.value();\n                        state.tmp.rendered_name.push(Item[variable]);\n                    }\n                }\n                state.tmp.can_substitute.replace(false,  CSL.LITERAL);\n            } else {\n                //print(\"  setting [1] to true based on: \" + arg);\n                state.tmp.group_context.tip.variable_attempt = true;\n            }\n            //state.tmp.group_context.replace(flag);\n        };\n        this.execs.push(func);\n    } else if ([\"if\",  \"else-if\", \"condition\"].indexOf(this.name) > -1) {\n        // Strip off any boolean prefix.\n        // Now the conditionals.\n        var maketest = function (variable) {\n            return function(Item,item){\n                var myitem = Item;\n                if (item && [\"locator\", \"locator-extra\", \"first-reference-note-number\", \"first-container-reference-note-number\", \"locator-date\"].indexOf(variable) > -1) {\n                    myitem = item;\n                }\n                // We don't run loadAbbreviation() here; it is run by the application-supplied\n                // retrieveItem() if hereinafter functionality is to be used, so this key will\n                // always exist in memory, possibly with a nil value.\n                if (variable === \"hereinafter\" && state.sys.getAbbreviation && myitem.id) {\n                    if (state.transform.abbrevs[\"default\"].hereinafter[myitem.id]) {\n                        return true;\n                    }\n                } else if (myitem[variable]) {\n                    if (\"number\" === typeof myitem[variable] || \"string\" === typeof myitem[variable]) {\n                        return true;\n                    } else if (\"object\" === typeof myitem[variable]) {\n                        //\n                        // this will turn true only for hash objects\n                        // that have at least one attribute, or for a\n                        // non-zero-length list\n                        //\n                        for (var key in myitem[variable]) {\n                            if (myitem[variable][key]) {\n                                return true;\n                            }\n                        }\n                    }\n                }\n                return false;\n            };\n        };\n        for (var i=0,ilen=this.variables.length;i<ilen;i+=1) {\n            this.tests.push(maketest(this.variables[i]));\n        }\n    }\n};\n\n\nCSL.Attributes[\"@page\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trylabels = arg.replace(\"sub verbo\", \"sub-verbo\");\n    trylabels = trylabels.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (trylabel) {\n        return function(Item) {\n            var label;\n            state.processNumber(false, Item, \"page\", Item.type);\n            if (!state.tmp.shadow_numbers.page.label) {\n                label = \"page\";\n            } else if (state.tmp.shadow_numbers.page.label === \"sub verbo\") {\n                label = \"sub-verbo\";\n            } else {\n                label = state.tmp.shadow_numbers.page.label;\n            }\n            if (state.tmp.shadow_numbers.page.values.length > 0) {\n                if (state.tmp.shadow_numbers.page.values[0].gotosleepability) {\n                    state.tmp.shadow_numbers.page.values[0].labelVisibility = false;\n                }\n            }\n            if (trylabel === label) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=trylabels.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trylabels[i]));\n    }\n};\n\n\n// a near duplicate of code above\nCSL.Attributes[\"@number\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trylabels = arg.split(/\\s+/);\n    var maketest = function(trylabel) {\n        return function (Item) {\n            var label;\n            state.processNumber(false, Item, \"number\", Item.type);\n            if (!state.tmp.shadow_numbers.number.label) {\n                label = \"number\";\n            } else {\n                label = state.tmp.shadow_numbers.number.label;\n            }\n            if (trylabel === label) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=trylabels.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trylabels[i]));\n    }\n};\n\nCSL.Attributes[\"@jurisdiction\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var tryjurisdictions = arg.split(/\\s+/);\n    \n    // This forces a match=any method, similar to @type\n    var maketests = function (tryjurisdictions) {\n        return function(Item) {\n            if (!Item.jurisdiction) {\n                return false;\n            }\n            var jurisdiction = Item.jurisdiction;\n            for (var i=0,ilen=tryjurisdictions.length;i<ilen;i++) {\n                if (jurisdiction === tryjurisdictions[i]) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n    this.tests.push(maketests(tryjurisdictions));\n};\n\nCSL.Attributes[\"@country\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trycountries = arg.split(/\\s+/);\n    \n    // This forces a match=any method, similar to @type\n    var maketests = function (trycountries) {\n        return function(Item) {\n            if (!Item.country) {\n                return false;\n            }\n            var country = Item.country;\n            for (var i=0,ilen=trycountries.length;i<ilen;i++) {\n                if (country === trycountries[i]) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n    this.tests.push(maketests(trycountries));\n};\n\nCSL.Attributes[\"@context\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func = function () {\n        if ([\"bibliography\", \"citation\"].indexOf(arg) > -1) {\n\t\t    var area = state.tmp.area.slice(0, arg.length);\n\t\t    if (area === arg) {\n\t\t\t    return true;\n\t\t    }\n\t\t    return false;\n        } else if (\"alternative\" === arg) {\n            return !!state.tmp.abort_alternative;\n        }\n    };\n    this.tests.push(func);\n};\n\nCSL.Attributes[\"@has-year-only\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trydates = arg.split(/\\s+/);\n    var maketest = function (trydate) {\n        return function(Item) {\n            var date = Item[trydate];\n            if (!date || date.month || date.season) {\n                return false;\n            } else {\n                return true;\n            }\n        };\n    };\n    for (var i=0,ilen=trydates.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trydates[i]));\n    }\n};\n\nCSL.Attributes[\"@has-to-month-or-season\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trydates = arg.split(/\\s+/);\n    var maketest = function (trydate) {\n        return function(Item) {\n            var date = Item[trydate];\n            if (!date || (!date.month && !date.season) || date.day) {\n                return false;\n            } else {\n                return true;\n            }\n        };\n    };\n    for (var i=0,ilen=trydates.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trydates[i]));\n    }\n};\n\nCSL.Attributes[\"@has-day\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trydates = arg.split(/\\s+/);\n    var maketest = function (trydate) {\n        return function(Item) {\n            var date = Item[trydate];\n            if (!date || !date.day) {\n                return false;\n            } else {\n                return true;\n            }\n        };\n    };\n    for (var i=0,ilen=trydates.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trydates[i]));\n    }\n};\n\nCSL.Attributes[\"@is-plural\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func = function (Item) {\n        var nameList = Item[arg];\n        if (nameList && nameList.length) {\n            var persons = 0;\n            var institutions = 0;\n            var last_is_person = false;\n            for (var i = 0, ilen = nameList.length; i < ilen; i += 1) {\n                if (state.opt.development_extensions.spoof_institutional_affiliations\n                    && (nameList[i].literal || (nameList[i].isInstitution && nameList[i].family && !nameList[i].given))) {\n                    institutions += 1;\n                    last_is_person = false;\n                } else {\n                    persons += 1;\n                    last_is_person = true;\n                }\n            }\n            if (persons > 1) {\n                return true;\n            } else if (institutions > 1) {\n                return true;\n            } else if (institutions && last_is_person) {\n                return true;\n            }\n        }\n        return false;\n    };\n    this.tests.push(func);\n};\n\nCSL.Attributes[\"@is-multiple\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func = function (Item) {\n        var val = (\"\" + Item[arg]);\n        var lst = val.split(/(?:,\\s|\\s(?:tot\\sen\\smet|ldz|oraz|and|bis|||och|a|do|en|et|in|ir|ja|og|sa|to|un|und|s|i|i|u|y||e|a||-|)\\s||\\&)/);\n        if (lst.length > 1) {\n            return true;\n        }\n        return false;\n    };\n    this.tests.push(func);\n};\n\n\n\n\nCSL.Attributes[\"@locale\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var ret, langspec, lang, lst, i, ilen;\n    // Style default\n    var locale_default = state.opt[\"default-locale\"][0];\n\n    if (this.name === \"layout\") {\n        // For layout\n        this.locale_raw = arg;\n        if (this.tokentype === CSL.START) {\n            if (!state.opt.multi_layout) {\n                state.opt.multi_layout = [];\n            }\n            var locale_data = [];\n            // Register the primary locale in the set, and others that \"map\" to it, \n            // so that they can be used when generating sort keys. See node_sort.js.\n            // Not idempotent. Only do this once.\n            var locales = arg.split(/\\s+/);\n            var sort_locale = {};\n            var localeMaster = CSL.localeResolve(locales[0], locale_default);\n            locale_data.push(localeMaster);\n            if (localeMaster.generic) {\n                sort_locale[localeMaster.generic] = localeMaster.best;\n            } else {\n                sort_locale[localeMaster.best] = localeMaster.best;\n            }\n            for (var i=1,ilen=locales.length;i<ilen;i+=1) {\n                var localeServant = CSL.localeResolve(locales[i], locale_default);\n                locale_data.push(localeServant);\n                if (localeServant.generic) {\n                    sort_locale[localeServant.generic] = localeMaster.best;\n                } else {\n                    sort_locale[localeServant.best] = localeMaster.best;\n                }\n\n            }\n            state[state.build.area].opt.sort_locales.push(sort_locale);\n            state.opt.multi_layout.push(locale_data);\n        }\n        state.opt.has_layout_locale = true;\n    } else {\n        // For if and if-else\n\n        // Split argument\n        lst = arg.split(/\\s+/);\n\n        // Expand each list element\n        var locale_bares = [];\n        for (i = 0, ilen = lst.length; i < ilen; i += 1) {\n            // Parse out language string\n            lang = lst[i];\n        \n            // Analyze the locale\n            langspec = CSL.localeResolve(lang, locale_default);\n            if (lst[i].length === 2) {\n                // For fallback\n                locale_bares.push(langspec.bare);\n            }\n            // Load the locale terms etc.\n            // (second argument causes immediate return if locale already exists)\n            state.localeConfigure(langspec, true);\n            \n            // Replace string with locale spec object\n            lst[i] = langspec;\n        }\n        // Locales to test\n        var locale_list = lst.slice();\n\n        // check for variable value\n        // Closure probably not necessary here.\n        var maketest = function (locale_list, locale_default,locale_bares) {\n            return function (Item) {\n                var res;\n                ret = [];\n                res = false;\n                var langspec = false;\n\n                var lang;\n                if (!Item.language) {\n                    lang = locale_default;\n                } else {\n                    lang = Item.language;\n                }\n                langspec = CSL.localeResolve(lang, locale_default);\n                for (i = 0, ilen = locale_list.length; i < ilen; i += 1) {\n                    if (langspec.best === locale_list[i].best) {\n                        state.tmp.condition_lang_counter_arr.push(state.tmp.condition_counter);\n                        state.tmp.condition_lang_val_arr.push(state.opt.lang);\n                        state.opt.lang = locale_list[0].best;\n                        res = true;\n                        break;\n                    }\n                }\n                if (!res && locale_bares.indexOf(langspec.bare) > -1) {\n                    state.tmp.condition_lang_counter_arr.push(state.tmp.condition_counter);\n                    state.tmp.condition_lang_val_arr.push(state.opt.lang);\n                    state.opt.lang = locale_list[0].best;\n                    res = true;\n                }\n                return res;\n            };\n        };\n        this.tests.push(maketest(locale_list,locale_default,locale_bares));\n    }\n};\n\nCSL.Attributes[\"@alternative-node-internal\"] = function (state) {\n    if (!this.tests) {this.tests = []; };\n    var maketest = function () {\n        return function() {\n            return !state.tmp.abort_alternative;\n        };\n    };\n    var me = this;\n    this.tests.push(maketest(me));\n};\n\nCSL.Attributes[\"@locale-internal\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var langspec, lang, lst, i, ilen;\n        // For if and if-else\n\n        // Split argument\n        lst = arg.split(/\\s+/);\n\n        // Expand each list element\n        this.locale_bares = [];\n        for (i = 0, ilen = lst.length; i < ilen; i += 1) {\n            // Parse out language string\n            lang = lst[i];\n        \n            // Analyze the locale\n            langspec = CSL.localeResolve(lang, state.opt[\"default-locale\"][0]);\n            if (lst[i].length === 2) {\n                // For fallback\n                this.locale_bares.push(langspec.bare);\n            }\n            // Load the locale terms etc.\n            state.localeConfigure(langspec);\n            \n            // Replace string with locale spec object\n            lst[i] = langspec;\n        }\n        // Set locale tag on node\n        this.locale_default = state.opt[\"default-locale\"][0];\n        // The locale to set on node children if match is successful\n        this.locale = lst[0].best;\n        // Locales to test\n        this.locale_list = lst.slice();\n        \n        // check for variable value\n        // Closure probably not necessary here.\n        var maketest = function (me) {\n            return function (Item) {\n                var ret, res;\n                ret = [];\n                res = false;\n                var langspec = false;\n                if (Item.language) {\n                    lang = Item.language;\n                    langspec = CSL.localeResolve(lang, state.opt[\"default-locale\"][0]);\n                    if (langspec.best === state.opt[\"default-locale\"][0]) {\n                        langspec = false;\n                    }\n                }\n                if (langspec) {\n                    // We attempt to match a specific locale from the\n                    // list of parameters.  If that fails, we fall back\n                    // to the base locale of the first element.  The\n                    // locale applied is always the first local \n                    // in the list of parameters (or base locale, for a \n                    // single two-character language code) \n                    for (i = 0, ilen = me.locale_list.length; i < ilen; i += 1) {\n                        if (langspec.best === me.locale_list[i].best) {\n                            state.opt.lang = me.locale;\n                            state.tmp.last_cite_locale = me.locale;\n                            // Set empty group open tag with locale set marker\n                            state.output.openLevel(\"empty\");\n                            state.output.current.value().new_locale = me.locale;\n                            res = true;\n                            break;\n                        }\n                    }\n                    if (!res && me.locale_bares.indexOf(langspec.bare) > -1) {\n                        state.opt.lang = me.locale;\n                        state.tmp.last_cite_locale = me.locale;\n                        // Set empty group open tag with locale set marker\n                        state.output.openLevel(\"empty\");\n                        state.output.current.value().new_locale = me.locale;\n                        res = true;\n                    }\n                }\n                return res;\n            };\n        };\n        var me = this;\n        this.tests.push(maketest(me));\n};\n\n\nCSL.Attributes[\"@court-class\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n\tvar tryclasses = arg.split(/\\s+/);\n    var maketest = function (tryclass) {\n        return function(Item) {\n            var cls = CSL.GET_COURT_CLASS(state, Item);\n            if (cls === tryclass) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=tryclasses.length; i<ilen; i++) {\n        this.tests.push(maketest(tryclasses[i]));\n    }\n};\n\nCSL.Attributes[\"@container-multiple\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n\tvar retval = \"true\" === arg ? true : false;\n    var maketest = function (retval) {\n        return function(Item) {\n            if (!state.tmp.container_item_count[Item.container_id]) {\n                return !retval;\n            } else if (state.tmp.container_item_count[Item.container_id] > 1) {\n                return retval;\n            }\n            return !retval;\n        };\n    };\n    this.tests.push(maketest(retval));\n};\n\nCSL.Attributes[\"@container-subsequent\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n\tvar retval = \"true\" === arg ? true : false;\n    var maketest = function (retval) {\n        return function(Item) {\n            if (state.tmp.container_item_pos[Item.container_id] > 1) {\n                return retval;\n            }\n            return !retval;\n        };\n    };\n    this.tests.push(maketest(retval));\n};\n\nCSL.Attributes[\"@has-subunit\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var maketest = function(namevar) {\n        return function (Item) {\n            var subunit_count = 0;\n            for (var i in Item[namevar]) {\n                var name = Item[namevar][i];\n                if (!name.given) {\n                    var institution = name.literal ? name.literal : name.family;\n                    var length = institution.split(\"|\").length;\n                    if (subunit_count === 0 || length < subunit_count) {\n                        subunit_count = length;\n                    }\n                }\n            }\n            return (subunit_count > 1);\n        };\n    };\n    this.tests.push(maketest(arg));\n}\n\nCSL.Attributes[\"@cite-form\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var maketest = function(citeForm) {\n        return function (Item) {\n            if (Item[\"cite-form\"] === citeForm) {\n                return true;\n            }\n            return false;\n        };\n    };\n    this.tests.push(maketest(arg));\n}\n\nCSL.Attributes[\"@disable-duplicate-year-suppression\"] = function (state, arg) {\n\tstate.opt.disable_duplicate_year_suppression = arg.split(/\\s+/);\n}\n\nCSL.Attributes[\"@consolidate-containers\"] = function (state, arg) {\n    CSL.Attributes[\"@track-containers\"](state, arg);\n    var args = arg.split(/\\s+/);\n    state.bibliography.opt.consolidate_containers = args;\n}\n\nCSL.Attributes[\"@track-containers\"] = function (state, arg) {\n    var args = arg.split(/\\s+/);\n    if (!state.bibliography.opt.track_container_items) {\n        state.bibliography.opt.track_container_items = [];\n    }\n    if (!state.bibliography.opt.consolidate_containers) {\n        state.bibliography.opt.consolidate_containers = [];\n    }\n    state.bibliography.opt.track_container_items = state.bibliography.opt.track_container_items.concat(args);\n}\n\n// These are not evaluated as conditions immediately: they only\n// set parameters that are picked up during processing.\nCSL.Attributes[\"@parallel-first\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    if (!state.opt.track_repeat) {\n        state.opt.track_repeat = {};\n    }\n    this.parallel_first = {};\n    for (var i in vars) {\n        var v = vars[i];\n        this.parallel_first[v] = true;\n        state.opt.track_repeat[v] = true;\n    }\n};\nCSL.Attributes[\"@parallel-last\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    if (!state.opt.track_repeat) {\n        state.opt.track_repeat = {};\n    }\n    this.parallel_last = {};\n    for (var i in vars) {\n        var v = vars[i];\n        this.parallel_last[v] = true;\n        state.opt.track_repeat[v] = true;\n    }\n};\nCSL.Attributes[\"@parallel-last-to-first\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    this.parallel_last_to_first = {};\n    for (var i=0,ilen=vars.length;i<ilen;i++) {\n        this.parallel_last_to_first[vars[i]] = true;\n    }\n};\nCSL.Attributes[\"@parallel-delimiter-override\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    this.strings.set_parallel_delimiter_override = arg;\n};\nCSL.Attributes[\"@parallel-delimiter-override-on-suppress\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    this.strings.set_parallel_delimiter_override_on_suppress = arg;\n};\nCSL.Attributes[\"@no-repeat\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    if (!state.opt.track_repeat) {\n        state.opt.track_repeat = {};\n    }\n    this.non_parallel = {};\n    for (var i in vars) {\n        var v = vars[i];\n        this.non_parallel[v] = true;\n        state.opt.track_repeat[v] = true;\n    }\n};\n\nCSL.Attributes[\"@require\"] = function (state, arg) {\n    state.opt.use_context_condition = true;\n    this.strings.require = arg;\n\n    // Introduced to constrain rendering of the group with a\n    // requirement that it either render an alpha term via cs:label or\n    // cs:text at least once, or render without any label. That\n    // behaviour is invoked with \"label-empty-or-alpha\" as arg.\n\n    // This attribute is a complement to @label-form and modular\n    // jurisdiction support, as it makes macros that adapt to shifting\n    // local term definitions possible.\n};\n\nCSL.Attributes[\"@reject\"] = function (state, arg) {\n    state.opt.use_context_condition = true;\n    this.strings.reject = arg;\n\n    // Introduced to constrain rendering of the group with a\n    // requirement that it render some label via cs:label or cs:text,\n    // and that it NOT be alpha. That behaviour is invoked with\n    // \"label-empty-or-alpha\" as arg.\n\n    // This attribute is a complement to @label-form and modular\n    // jurisdiction support, as it makes macros that adapt to shifting\n    // local term definitions possible.\n};\n\nCSL.Attributes[\"@require-comma-on-symbol\"] = function (state, arg) {\n    state.opt.require_comma_on_symbol = arg;\n}\n\nCSL.Attributes[\"@gender\"] = function (state, arg) {\n    this.gender = arg;\n};\n\nCSL.Attributes[\"@cslid\"] = function (state, arg) {\n    // @cslid is a noop\n    // The value set on this attribute is used to\n    // generate reverse lookup wrappers on output when \n    // this.development_extensions.csl_reverse_lookup_support is\n    // set to true in state.js (there is no runtime option,\n    // it must be set in state.js)\n    //\n    // See the @showid method in the html output\n    // section of formats.js for the function that\n    // renders the wrappers.\n    this.cslid = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@capitalize-if-first\"] = function (state, arg) {\n    this.strings.capitalize_if_first_override = arg;\n};\n\nCSL.Attributes[\"@label-capitalize-if-first\"] = function (state, arg) {\n    this.strings.label_capitalize_if_first_override = arg;\n};\n\nCSL.Attributes[\"@label-form\"] = function (state, arg) {\n    this.strings.label_form_override = arg;\n};\n\nCSL.Attributes[\"@part-separator\"] = function (state, arg) {\n    this.strings[\"part-separator\"] = arg;\n};\n\nCSL.Attributes[\"@leading-noise-words\"] = function (state, arg) {\n    this[\"leading-noise-words\"] = arg;\n};\n\nCSL.Attributes[\"@name-never-short\"] = function (state, arg) {\n    this[\"name-never-short\"] = arg;\n};\n\nCSL.Attributes[\"@class\"] = function (state, arg) {\n    state.opt[\"class\"] = arg;\n};\n\nCSL.Attributes[\"@version\"] = function (state, arg) {\n    state.opt.version = arg;\n};\n\n/**\n * Store the value attribute on the token.\n * @name CSL.Attributes.@value\n * @function\n */\nCSL.Attributes[\"@value\"] = function (state, arg) {\n    this.strings.value = arg;\n};\n\n\n/**\n * Store the name attribute (of a macro or term node)\n * on the state object.\n * <p>For reference when the closing node of a macro\n * or locale definition is encountered.</p>\n * @name CSL.Attributes.@name\n * @function\n */\nCSL.Attributes[\"@name\"] = function (state, arg) {\n    this.strings.name = arg;\n};\n\n/**\n * Store the form attribute (of a term node) on the state object.\n * <p>For reference when the closing node of a macro\n * or locale definition is encountered.</p>\n * @name CSL.Attributes.@form\n * @function\n */\nCSL.Attributes[\"@form\"] = function (state, arg) {\n    this.strings.form = arg;\n};\n\nCSL.Attributes[\"@date-parts\"] = function (state, arg) {\n    this.strings[\"date-parts\"] = arg;\n};\n\nCSL.Attributes[\"@range-delimiter\"] = function (state, arg) {\n    this.strings[\"range-delimiter\"] = arg;\n};\n\n/**\n * Store macro tokens in a buffer on the state object.\n * <p>For reference when the enclosing text token is\n * processed.</p>\n * @name CSL.Attributes.@macro\n * @function\n */\nCSL.Attributes[\"@macro\"] = function (state, arg) {\n    this.postponed_macro = arg;\n};\n\n/*\n * CSL.Attributes[\"@prefer-jurisdiction\"] = function (state, arg) {\n *    this.prefer_jurisdiction = true;\n * };\n */\n\nCSL.Attributes[\"@term\"] = function (state, arg) {\n    if (arg === \"sub verbo\") {\n        this.strings.term = \"sub-verbo\";\n    } else {\n        this.strings.term = arg;\n    }\n};\n\n\n/*\n * Ignore xmlns attribute.\n * <p>This should always be <p>http://purl.org/net/xbiblio/csl</code>\n * anyway.  At least for the present we will blindly assume\n * that it is.</p>\n * @name CSL.Attributes.@xmlns\n * @function\n */\nCSL.Attributes[\"@xmlns\"] = function () {};\n\n\n/*\n * Store language attribute to a buffer field.\n * <p>Will be placed in the appropriate location\n * when the element is processed.</p>\n * @name CSL.Attributes.@lang\n * @function\n */\nCSL.Attributes[\"@lang\"] = function (state, arg) {\n    if (arg) {\n        state.build.lang = arg;\n    }\n};\n\n\n// Used as a flag during dates processing\nCSL.Attributes[\"@lingo\"] = function () {};\n\n// Used as a flag during dates processing\nCSL.Attributes[\"@macro-has-date\"] = function () {\n    this[\"macro-has-date\"] = true;\n};\n\n/*\n * Store suffix string on token.\n * @name CSL.Attributes.@suffix\n * @function\n */\nCSL.Attributes[\"@suffix\"] = function (state, arg) {\n    this.strings.suffix = arg;\n};\n\n\n/*\n * Store prefix string on token.\n * @name CSL.Attributes.@prefix\n * @function\n */\nCSL.Attributes[\"@prefix\"] = function (state, arg) {\n    this.strings.prefix = arg;\n};\n\n\n/*\n * Store delimiter string on token.\n * @name CSL.Attributes.@delimiter\n * @function\n */\nCSL.Attributes[\"@delimiter\"] = function (state, arg) {\n    this.strings.delimiter = arg;\n};\n\n\n/*\n * Store match evaluator on token.\n */\nCSL.Attributes[\"@match\"] = function (state, arg) {\n    this.match = arg;\n};\n\n\nCSL.Attributes[\"@names-min\"] = function (state, arg) {\n    var val = parseInt(arg, 10);\n    if (state[state.build.area].opt.max_number_of_names < val) {\n        state[state.build.area].opt.max_number_of_names = val;\n    }\n    this.strings[\"et-al-min\"] = val;\n};\n\nCSL.Attributes[\"@names-use-first\"] = function (state, arg) {\n    this.strings[\"et-al-use-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@names-use-last\"] = function (state, arg) {\n    if (arg === \"true\") {\n        this.strings[\"et-al-use-last\"] = true;\n    } else {\n        this.strings[\"et-al-use-last\"] = false;\n    }\n};\n\nCSL.Attributes[\"@sort\"] = function (state, arg) {\n    if (arg === \"descending\") {\n        this.strings.sort_direction = CSL.DESCENDING;\n    }\n};\n\nCSL.Attributes[\"@plural\"] = function (state, arg) {\n    // Accepted values of plural attribute differ on cs:text\n    // and cs:label nodes.\n    if (\"always\" === arg || \"true\" === arg) {\n        this.strings.plural = 1;\n    } else if (\"never\" === arg || \"false\" === arg) {\n        this.strings.plural = 0;\n    } else if (\"contextual\" === arg) {\n        this.strings.plural = false;\n    }\n};\n\nCSL.Attributes[\"@has-publisher-and-publisher-place\"] = function () {\n    this.strings[\"has-publisher-and-publisher-place\"] = true;\n};\n\nCSL.Attributes[\"@publisher-delimiter-precedes-last\"] = function (state, arg) {\n    this.strings[\"publisher-delimiter-precedes-last\"] = arg;\n};\n\nCSL.Attributes[\"@publisher-delimiter\"] = function (state, arg) {\n    this.strings[\"publisher-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@publisher-and\"] = function (state, arg) {\n    this.strings[\"publisher-and\"] = arg;\n};\n\nCSL.Attributes[\"@givenname-disambiguation-rule\"] = function (state, arg) {\n    if (CSL.GIVENNAME_DISAMBIGUATION_RULES.indexOf(arg) > -1) {\n        state.citation.opt[\"givenname-disambiguation-rule\"] = arg;\n    }\n};\n\nCSL.Attributes[\"@collapse\"] = function (state, arg) {\n    // only one collapse value will be honoured.\n    if (arg) {\n        state[this.name].opt.collapse = arg;\n    }\n};\n\nCSL.Attributes[\"@cite-group-delimiter\"] = function (state, arg) {\n    if (arg) {\n        state[state.tmp.area].opt.cite_group_delimiter = arg;\n    }\n};\n\n\n\nCSL.Attributes[\"@names-delimiter\"] = function (state, arg) {\n    state.setOpt(this, \"names-delimiter\", arg);\n};\n\nCSL.Attributes[\"@name-form\"] = function (state, arg) {\n    state.setOpt(this, \"name-form\", arg);\n};\n\nCSL.Attributes[\"@subgroup-delimiter\"] = function (state, arg) {\n    this.strings[\"subgroup-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@subgroup-delimiter-precedes-last\"] = function (state, arg) {\n    this.strings[\"subgroup-delimiter-precedes-last\"] = arg;\n};\n\n\nCSL.Attributes[\"@name-delimiter\"] = function (state, arg) {\n    state.setOpt(this, \"name-delimiter\", arg);\n};\n\nCSL.Attributes[\"@et-al-min\"] = function (state, arg) {\n    var val = parseInt(arg, 10);\n    if (state[state.build.area].opt.max_number_of_names < val) {\n        state[state.build.area].opt.max_number_of_names = val;\n    }\n    state.setOpt(this, \"et-al-min\", val);\n};\n\nCSL.Attributes[\"@et-al-use-first\"] = function (state, arg) {\n    state.setOpt(this, \"et-al-use-first\", parseInt(arg, 10));\n};\n\nCSL.Attributes[\"@et-al-use-last\"] = function (state, arg) {\n    if (arg === \"true\") {\n        state.setOpt(this, \"et-al-use-last\", true);\n    } else {\n        state.setOpt(this, \"et-al-use-last\", false);\n    }\n};\n\nCSL.Attributes[\"@et-al-subsequent-min\"] = function (state, arg) {\n    var val = parseInt(arg, 10);\n    if (state[state.build.area].opt.max_number_of_names < val) {\n        state[state.build.area].opt.max_number_of_names = val;\n    }\n    state.setOpt(this, \"et-al-subsequent-min\", val);\n};\n\nCSL.Attributes[\"@et-al-subsequent-use-first\"] = function (state, arg) {\n    state.setOpt(this, \"et-al-subsequent-use-first\", parseInt(arg, 10));\n};\n\nCSL.Attributes[\"@suppress-min\"] = function (state, arg) {\n    this.strings[\"suppress-min\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@suppress-max\"] = function (state, arg) {\n    this.strings[\"suppress-max\"] = parseInt(arg, 10);\n};\n\n\nCSL.Attributes[\"@and\"] = function (state, arg) {\n    state.setOpt(this, \"and\", arg);\n};\n\nCSL.Attributes[\"@delimiter-precedes-last\"] = function (state, arg) {\n    state.setOpt(this, \"delimiter-precedes-last\", arg);\n};\n\nCSL.Attributes[\"@delimiter-precedes-et-al\"] = function (state, arg) {\n    state.setOpt(this, \"delimiter-precedes-et-al\", arg);\n};\n\nCSL.Attributes[\"@initialize-with\"] = function (state, arg) {\n    state.setOpt(this, \"initialize-with\", arg);\n};\n\nCSL.Attributes[\"@initialize\"] = function (state, arg) {\n    if (arg === \"false\") {\n        state.setOpt(this, \"initialize\", false);\n    }\n};\n\nCSL.Attributes[\"@name-as-reverse-order\"] = function (state, arg) {\n    this[\"name-as-reverse-order\"] = arg;\n};\n\nCSL.Attributes[\"@name-as-sort-order\"] = function (state, arg) {\n    if (this.name === \"style-options\") {\n        this[\"name-as-sort-order\"] = arg;\n    } else {\n        state.setOpt(this, \"name-as-sort-order\", arg);\n    }\n};\n\nCSL.Attributes[\"@sort-separator\"] = function (state, arg) {\n    state.setOpt(this, \"sort-separator\", arg);\n};\n\nCSL.Attributes[\"@require-match\"] = function (state, arg) {\n    if (arg === \"true\") {\n        this.requireMatch = true;\n    }\n};\n\nCSL.Attributes[\"@exclude-types\"] = function (state, arg) {\n    state.bibliography.opt.exclude_types = arg.split(/\\s+/);\n};\n\nCSL.Attributes[\"@exclude-with-fields\"] = function (state, arg) {\n    state.bibliography.opt.exclude_with_fields = arg.split(/\\s+/);\n};\n\n\nCSL.Attributes[\"@year-suffix-delimiter\"] = function (state, arg) {\n    state[this.name].opt[\"year-suffix-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@after-collapse-delimiter\"] = function (state, arg) {\n    state[this.name].opt[\"after-collapse-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@subsequent-author-substitute\"] = function (state, arg) {\n    state[this.name].opt[\"subsequent-author-substitute\"] = arg;\n};\n\nCSL.Attributes[\"@subsequent-author-substitute-rule\"] = function (state, arg) {\n    state[this.name].opt[\"subsequent-author-substitute-rule\"] = arg;\n};\n\nCSL.Attributes[\"@disambiguate-add-names\"] = function (state, arg) {\n    if (arg === \"true\") {\n        state.opt[\"disambiguate-add-names\"] = true;\n    }\n};\n\nCSL.Attributes[\"@disambiguate-add-givenname\"] = function (state, arg) {\n    if (arg === \"true\") {\n        state.opt[\"disambiguate-add-givenname\"] = true;\n    }\n};\n\nCSL.Attributes[\"@disambiguate-add-year-suffix\"] = function (state, arg) {\n    if (arg === \"true\" && state.opt.xclass !== \"numeric\") {\n        state.opt[\"disambiguate-add-year-suffix\"] = true;\n    }\n};\n\n\nCSL.Attributes[\"@second-field-align\"] = function (state, arg) {\n    if (arg === \"flush\" || arg === \"margin\") {\n        state[this.name].opt[\"second-field-align\"] = arg;\n    }\n};\n\n\nCSL.Attributes[\"@hanging-indent\"] = function (state, arg) {\n    if (arg === \"true\") {\n        if (state.opt.development_extensions.hanging_indent_legacy_number) {\n            state[this.name].opt.hangingindent = 2;\n\t    } else {\n            state[this.name].opt.hangingindent = true;\n\t    }\n    }\n};\n\n\nCSL.Attributes[\"@line-spacing\"] = function (state, arg) {\n    if (arg && arg.match(/^[.0-9]+$/)) {\n        state[this.name].opt[\"line-spacing\"] = parseFloat(arg, 10);\n    }\n};\n\n\nCSL.Attributes[\"@entry-spacing\"] = function (state, arg) {\n    if (arg && arg.match(/^[.0-9]+$/)) {\n        state[this.name].opt[\"entry-spacing\"] = parseFloat(arg, 10);\n    }\n};\n\n\nCSL.Attributes[\"@near-note-distance\"] = function (state, arg) {\n    state[this.name].opt[\"near-note-distance\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@substring\"] = function (state, arg) {\n    this.substring = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@text-case\"] = function (state, arg) {\n    var func = function (state, Item) {\n        if (arg === \"normal\") {\n            this.text_case_normal = true;\n        } else {\n            this.strings[\"text-case\"] = arg;\n            if (arg === \"title\") {\n                if (Item.jurisdiction) {\n                    this.strings[\"text-case\"] = \"passthrough\";\n                }\n            }\n        }\n    };\n    this.execs.push(func);\n};\n\n\nCSL.Attributes[\"@page-range-format\"] = function (state, arg) {\n    state.opt[\"page-range-format\"] = arg;\n};\n\n\nCSL.Attributes[\"@year-range-format\"] = function (state, arg) {\n    state.opt[\"year-range-format\"] = arg;\n};\n\n\nCSL.Attributes[\"@default-locale\"] = function (state, arg) {\n    if (this.name === 'style') {\n        var lst, len, pos, m, ret;\n        //\n        // Workaround for Internet Exploder 6 (doesn't recognize\n        // groups in str.split(/something(braced-group)something/)\n        //\n        var m = arg.match(/-x-(sort|translit|translat)-/g);\n        if (m) {\n            for (pos = 0, len = m.length; pos < len; pos += 1) {\n                m[pos] = m[pos].replace(/^-x-/, \"\").replace(/-$/, \"\");\n            }\n        }\n        lst = arg.split(/-x-(?:sort|translit|translat)-/);\n        ret = [lst[0]];\n        for (pos = 1, len = lst.length; pos < len; pos += 1) {\n            ret.push(m[pos - 1]);\n            ret.push(lst[pos]);\n        }\n        lst = ret.slice();\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            state.opt[(\"locale-\" + lst[pos])].push(lst[(pos + 1)].replace(/^\\s*/g, \"\").replace(/\\s*$/g, \"\"));\n        }\n        if (lst.length) {\n            state.opt[\"default-locale\"] = lst.slice(0, 1);\n        } else {\n            state.opt[\"default-locale\"] = [\"en\"];\n        }\n    } else if (arg === \"true\") {\n        this.default_locale = true;\n    }\n};\n\nCSL.Attributes[\"@default-locale-sort\"] = function (state, arg) {\n    state.opt[\"default-locale-sort\"] = arg;\n};\n\nCSL.Attributes[\"@demote-non-dropping-particle\"] = function (state, arg) {\n    state.opt[\"demote-non-dropping-particle\"] = arg;\n};\n\nCSL.Attributes[\"@initialize-with-hyphen\"] = function (state, arg) {\n    if (arg === \"false\") {\n        state.opt[\"initialize-with-hyphen\"] = false;\n    }\n};\n\nCSL.Attributes[\"@institution-parts\"] = function (state, arg) {\n    this.strings[\"institution-parts\"] = arg;\n};\n\nCSL.Attributes[\"@if-short\"] = function (state, arg) {\n    if (arg === \"true\") {\n        this.strings[\"if-short\"] = true;\n    }\n};\n\nCSL.Attributes[\"@substitute-use-first\"] = function (state, arg) {\n    this.strings[\"substitute-use-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@use-first\"] = function (state, arg) {\n    this.strings[\"use-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@use-last\"] = function (state, arg) {\n    this.strings[\"use-last\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@stop-first\"] = function (state, arg) {\n    this.strings[\"stop-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@stop-last\"] = function (state, arg) {\n    this.strings[\"stop-last\"] = parseInt(arg, 10) * -1;\n};\n\n\nCSL.Attributes[\"@reverse-order\"] = function (state, arg) {\n    if (\"true\" === arg) {\n        this.strings[\"reverse-order\"] = true;\n    }\n};\n\nCSL.Attributes[\"@display\"] = function (state, arg) {\n    if (state.bibliography.tokens.length === 2) {\n        state.opt.using_display = true;\n    }\n    this.strings.cls = arg;\n};\n\n\n/*global CSL: true */\n\n\n/**\n * String stack object.\n * <p>Numerous string stacks are used to track nested\n * parameters at runtime.  This class provides methods\n * that remove some of the aggravation of managing\n * them.</p>\n * @class\n */\nCSL.Stack = function (val, literal) {\n    this.mystack = [];\n    if (literal || val) {\n        this.mystack.push(val);\n    }\n    this.tip = this.mystack[0];\n};\n\n/**\n * Push a value onto the stack.\n * <p>This just does what it says.</p>\n */\nCSL.Stack.prototype.push = function (val, literal) {\n    if (literal || val) {\n        this.mystack.push(val);\n    } else {\n        this.mystack.push(\"\");\n    }\n    this.tip = this.mystack[this.mystack.length - 1];\n};\n\n/**\n * Clear the stack\n */\nCSL.Stack.prototype.clear = function () {\n    this.mystack = [];\n    this.tip = {};\n};\n\n/**\n * Replace the top value on the stack.\n * <p>This removes some ugly syntax from the\n * main code.</p>\n */\nCSL.Stack.prototype.replace = function (val, literal) {\n    //\n    // safety fix after a bug was chased down.  Rhino\n    // JS will process a negative index without error (!).\n    if (this.mystack.length === 0) {\n        CSL.error(\"Internal CSL processor error: attempt to replace nonexistent stack item with \" + val);\n    }\n    if (literal || val) {\n        this.mystack[(this.mystack.length - 1)] = val;\n    } else {\n        this.mystack[(this.mystack.length - 1)] = \"\";\n    }\n    this.tip = this.mystack[this.mystack.length - 1];\n};\n\n\n/**\n * Remove the top value from the stack.\n * <p>Just does what it says.</p>\n */\nCSL.Stack.prototype.pop = function () {\n    var ret = this.mystack.pop();\n    if (this.mystack.length) {\n        this.tip = this.mystack[this.mystack.length - 1];\n    } else {\n        this.tip = {};\n    }\n    return ret;\n};\n\n\n/**\n * Return the top value on the stack.\n * <p>Removes a little hideous complication from\n * the main code.</p>\n */\nCSL.Stack.prototype.value = function () {\n    return this.mystack.slice(-1)[0];\n};\n\n\n/**\n * Return length (depth) of stack.\n * <p>Used to identify if there is content to\n * be handled on the stack</p>\n */\nCSL.Stack.prototype.length = function () {\n    return this.mystack.length;\n};\n\n/*global CSL: true */\n\n/**\n * Initializes the parallel cite tracking arrays\n */\nCSL.Parallel = function (state) {\n    this.state = state;\n};\n\nCSL.Parallel.prototype.StartCitation = function (sortedItems, out) {\n    // This array carries the repeat markers used in rendering the cite.\n    this.state.tmp.suppress_repeats = [];\n    if (sortedItems.length < 2) return;\n    var idxEnd = 0;\n    var parallelMatchList = false;\n    var siblingRanges = [];\n\n    for (var i=0,ilen=sortedItems.length-1;i<ilen;i++) {\n        var currItem = sortedItems[i][0];\n        var nextItem = sortedItems[i+1][0];\n        var freshMatchList = false;\n        var info = {};\n        if (sortedItems[i][0].seeAlso && sortedItems[i][0].seeAlso.length > 0 && !parallelMatchList) {\n            freshMatchList = true;\n            parallelMatchList = [sortedItems[i][0].id].concat(sortedItems[i][0].seeAlso);\n            var tempMatchList = parallelMatchList.slice();\n            var remainder = sortedItems.slice(i);\n            remainder[0][1].parallel = \"first\";\n            for (var j=0,jlen=remainder.length;j<jlen;j++) {\n                var itemID = remainder[j][0].id;\n                var ididx = tempMatchList.indexOf(itemID);\n                idxEnd = false;\n                if (ididx === -1) {\n                    idxEnd = (i+j-1);\n                } else if ((i+j) === (sortedItems.length-1)) {\n                    idxEnd = (i+j);\n                }\n                if (idxEnd) {\n                    siblingRanges.push([i, idxEnd]);\n                    break;\n                } else {\n                    tempMatchList = tempMatchList.slice(0, ididx).concat(tempMatchList.slice(ididx+1));\n                }\n            }\n        }\n        // parallelMatchList/freshMatchList relate only to parallels.\n        // no-repeat non-parallels are handled in a separate block.\n        if (i > 0 && freshMatchList) {\n            this.state.tmp.suppress_repeats[i-1].START = true;\n            freshMatchList = false;\n        }\n        for (var varname in this.state.opt.track_repeat) {\n            if (!currItem[varname] || !nextItem[varname]) {\n                // Go ahead and render any value with an empty partner\n                info[varname] = false;\n            } else if (\"string\" === typeof nextItem[varname] || \"number\" === typeof nextItem[varname]) {\n                // Simple comparison of string values\n                if (varname === \"title\" && currItem[\"title-short\"] && nextItem[\"title-short\"]) {\n                    var currVal = currItem[\"title-short\"];\n                    var nextVal = nextItem[\"title-short\"];\n                } else {\n                    var currVal = currItem[varname];\n                    var nextVal = nextItem[varname];\n                }\n                if (currVal == nextVal) {\n                    info[varname] = true;\n                } else {\n                    info[varname] = false;\n                }\n            } else if (\"undefined\" === typeof currItem[varname].length) {\n                // If a date, use only the year\n                info[varname] = false;\n                var currYear = currItem[varname].year;\n                var nextYear = nextItem[varname].year;\n                if (currYear && nextYear) {\n                    if (currYear == nextYear) {\n                        info[varname] = true;\n                    }\n                }\n            } else {\n                // If a creator value, kludge it\n                var currVal = JSON.stringify(currItem[varname]);\n                var nextVal = JSON.stringify(nextItem[varname]);\n                if (currVal === nextVal) {\n                    info[varname] = true;\n                } else {\n                    info[varname] = false;\n                }\n            }\n        }\n        if (!parallelMatchList) {\n            info.ORPHAN = true;\n        }\n        if (idxEnd === i) {\n            info.END = true;\n            parallelMatchList = false;\n        }\n        this.state.tmp.suppress_repeats.push(info);\n    }\n    \n    // if (!this.state.tmp.just_looking) {\n    //     this.state.sys.print(`${JSON.stringify(this.state.tmp.suppress_repeats, null, 2)}`);\n    // }\n    \n    // Set no-repeat info here?\n    for (var j=0,jlen=siblingRanges.length;j<jlen;j++) {\n        var masterID = sortedItems[siblingRanges[j][0]][0].id;\n        this.state.registry.registry[masterID].master = true;\n        this.state.registry.registry[masterID].siblings = [];\n        var start = siblingRanges[j][0];\n        var end = siblingRanges[j][1];\n        for (var k=start; k<end; k++) {\n            this.state.tmp.suppress_repeats[k].SIBLING = true;\n            var siblingID = sortedItems[k+1][0].id;\n            sortedItems[k+1][1].parallel = \"other\";\n            this.state.registry.registry[masterID].siblings.push(siblingID);\n        }\n    }\n    // this.state.sys.print(JSON.stringify(this.state.tmp.suppress_repeats, null, 2));\n};\n\nCSL.Parallel.prototype.checkRepeats = function(params) {\n    var idx = this.state.tmp.cite_index;\n    if (this.state.tmp.suppress_repeats) {\n        if (params.parallel_first && Object.keys(params.parallel_first).length > 0) {\n            var arr = [{}].concat(this.state.tmp.suppress_repeats);\n            var ret = true;\n            for (var varname in params.parallel_first) {\n                if (!arr[idx][varname] || arr[idx].START) {\n                    // true --> suppress the entry\n                    // Test here evaluates as \"all\", not \"any\"\n                    ret = false;\n                }\n            }\n            return ret;\n        }\n        if (params.parallel_last && Object.keys(params.parallel_last).length > 0) {\n            var arr = this.state.tmp.suppress_repeats.concat([{}]);\n            var ret = Object.keys(params.parallel_last).length > 0 ? true : false;\n            for (var varname in params.parallel_last) {\n                if (!arr[idx][varname] || arr[idx].END) {\n                    // \"all\" match, as above.\n                    ret = false;\n                }\n            }\n            return ret;\n        }\n        if (params.non_parallel && Object.keys(params.non_parallel).length > 0) {\n            var arr = [{}].concat(this.state.tmp.suppress_repeats);\n            var ret = true;\n            for (var varname in params.non_parallel) {\n                if (!arr[idx][varname]) {\n                    ret = false;\n                }\n            }\n            return ret;\n        }\n    }\n    return false;\n};\n\n/*global CSL: true */\n\n\nCSL.Util = {};\n\nCSL.Util.Match = function () {\n\n    this.any = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0, ilen=tests.length; i < ilen; i += 1) {\n                var result = tests[i](Item, item);\n                if (result) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n\n    this.none = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0,ilen=tests.length;i<ilen;i+=1) {\n                var result = tests[i](Item,item);\n                if (result) {\n                    return false;\n                }\n            }\n            return true;\n        };\n    };\n\n    this.all = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0,ilen=tests.length;i<ilen;i+=1) {\n                var result = tests[i](Item,item);\n                if (!result) {\n                    return false;\n                }\n            }\n            return true;\n        };\n    };\n\n    this[undefined] = this.all;\n\n    this.nand = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0,ilen=tests.length;i<ilen;i+=1) {\n                var result = tests[i](Item,item);\n                if (!result) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n\n};\n\n/*global CSL: true */\n\n/*\n * Fields can be transformed by translation/transliteration, or by\n * abbreviation.  Transformations are performed in that order.\n *\n * Renderings of original, translated or transliterated content\n * (followed by abbreviation if requested) are placed in the primary\n * output slot or the (implicitly punctuated) secondary and tertiary\n * output slots according to the settings registered in the\n * state.opt['cite-lang-prefs'] arrays. The array has six segments:\n * 'persons', 'institutions', 'titles', 'journals', 'publishers', and\n * 'places'. Each segment always contains at least one item, and may\n * hold values 'orig', 'translit' or 'translat'. The array defaults to\n * a single item 'orig'.\n *\n * All multilingual variables are associated with segments,\n * with the exception of 'edition' and 'genre'. These two\n * exceptions are always rendered with the first matching\n * language form found in state.opt['locale-translit'] or, if\n * composing a sort key, state.opt['locale-sort']. No secondary\n * slot rendering is performed for this two variables.\n *\n * The balance of multilingual variables are rendered with\n * the first matching value in the transform locales spec\n * (no transform, state.opt['locale-translit'], or \n * state.opt['locale-translat']) mapped to the target\n * slot.\n *\n * Full primary+secondary+tertiary rendering is performed only in\n * note-style citations and the bibliography.  In-text citations are\n * rendered in the primary output slot only, following the same spec\n * parameters.\n *\n *   Optional setters:\n *     .setAbbreviationFallback(); fallback flag\n *       (if true, a failed abbreviation will fallback to long)\n *\n *     .setAlternativeVariableName(): alternative variable name in Item,\n *       for use as a fallback abbreviation source\n *\n * Translation/transliteration\n *\n *   Optional setter:\n *     .setTransformFallback():\n *       default flag (if true, the original field value will be used as a fallback)\n *\n * The getTextSubField() method may be used to obtain a string transform\n * of a field, without abbreviation, as needed for setting sort keys\n * (for example).\n *\n */\n\nCSL.Transform = function (state) {\n    // Abbreviation families\n    this.abbrevs = {};\n    this.abbrevs[\"default\"] = new state.sys.AbbreviationSegments();\n\n    function getCountryOrJurisdiction(variable, normalizedKey, quashCountry) {\n        var value = \"\";\n        if (state.sys.getHumanForm) {\n            if (variable === \"country\") {\n                value = state.sys.getHumanForm(normalizedKey.toLowerCase(), false, true);\n                value = value.split(\"|\")[0];\n            } else if (variable === \"jurisdiction\") {\n                value = state.sys.getHumanForm(normalizedKey.toLowerCase(), false, true);\n                if (!quashCountry) {\n                    value = value.split(\"|\").slice(1).join(\", \");\n                } else {\n                    // Bare country name is rendered by \"country\", not \"jurisdiction\"\n                    value = \"\";\n                }\n            }\n\t    }\n\t    return value;\n    }\n    \n    // Internal function\n    function abbreviate(state, tok, Item, altvar, basevalue, family_var, use_field) {\n\n        var value = \"\";\n        var myabbrev_family = CSL.FIELD_CATEGORY_REMAP[family_var];\n        var preferredJurisdiction;\n        if (!myabbrev_family) {\n            return basevalue;\n        }\n\n        var variable = family_var;\n        var normalizedKey = basevalue;\n\n        if (state.sys.normalizeAbbrevsKey) {\n            normalizedKey = state.sys.normalizeAbbrevsKey(family_var, basevalue);\n        }\n        var quashCountry = false;\n        if (variable === \"jurisdiction\" && normalizedKey) {\n            quashCountry = normalizedKey.indexOf(\":\") === -1;\n        }\n        // Fix up jurisdiction codes\n        if ([\"jurisdiction\", \"country\"].indexOf(family_var) > -1 && basevalue === basevalue.toLowerCase()) {\n            normalizedKey = basevalue.toUpperCase();\n        }\n        \n        \n        // Lazy retrieval of abbreviations.\n        if (state.sys.getAbbreviation) {\n\n            if ([\"jurisdiction\", \"country\", \"language-name\", \"language-name-original\"].indexOf(variable) > -1) {\n                preferredJurisdiction = \"default\";\n            } else if (Item.jurisdiction) {\n                preferredJurisdiction = Item.jurisdiction;\n            } else {\n                preferredJurisdiction = \"default\";\n            }\n            var jurisdiction = state.transform.loadAbbreviation(preferredJurisdiction, myabbrev_family, normalizedKey, Item.language);\n\n            // Some rules:\n            // # variable === \"country\"\n            // (1) If an abbreviation is associated with the code, then:\n            //     (a) return the abbreviated form if form=\"short\"\n            // (2) Otherwise:\n            //     (a) return the human-readable country name, or whatever is there if it's not a code\n            // # variable === \"jurisdiction\"\n            // (1) If !!getHumanForm(jurisdictionID, false, false):\n            //     (a) If the code is top-level (i.e. a country):\n            //         (i) return nothing -- this is what the \"country\" variable is for.\n            //     (b) otherwise:\n            //         (i) If an abbreviation is associated with the code, then:\n            //             (A) return the abbreviated form\n            //         (ii) Otherwise\n            //             (A) return the human-readable form, with the country name & code removed from the front\n            // (2) Otherwise:\n            //     (a) abbreviate as per normal.\n            // # other variables\n            // (1) Abbreviate as per normal.\n\n            if (state.transform.abbrevs[jurisdiction][myabbrev_family] && normalizedKey) {\n                // Safe to test presence of abbrev against raw object in this block\n                var abbrev = state.transform.abbrevs[jurisdiction][myabbrev_family][normalizedKey];\n                if (tok.strings.form === \"short\" && abbrev) {\n                    if (quashCountry) {\n                        value = \"\";\n                    } else {\n                        value = abbrev;\n                    }\n                } else {\n\t                value = getCountryOrJurisdiction(variable, normalizedKey, quashCountry);\n                }\n            }\n        }\n        \n        // Was for: \n        if (!value \n            && (!state.opt.development_extensions.require_explicit_legal_case_title_short || Item.type !== 'legal_case') \n            && altvar && Item[altvar] && use_field) {\n            value = Item[altvar];\n        }\n        if (!value && !state.sys.getAbbreviation && state.sys.getHumanForm) {\n\t        value = getCountryOrJurisdiction(variable, normalizedKey, quashCountry);\n\t    }\n        if (!value && !quashCountry && (!state.sys.getHumanForm || variable !== \"jurisdiction\")) {\n            value = basevalue;\n        }\n        if (state.opt.development_extensions.force_title_abbrev_fallback) {\n            if (variable === \"title\" && value === basevalue && Item[\"title-short\"]) {\n                value = Item[\"title-short\"];\n            }\n        }\n        return value;\n    }\n\n    function getFieldLocale(Item,field) {\n        var ret = state.opt[\"default-locale\"][0].slice(0, 2);\n        var localeRex;\n        if (state.opt.development_extensions.strict_text_case_locales) {\n            localeRex = new RegExp(\"^([a-zA-Z]{2})(?:$|-.*| .*)\");\n        } else {\n            localeRex = new RegExp(\"^([a-zA-Z]{2})(?:$|-.*|.*)\");\n        }\n        if (Item.language) {\n            var m = (\"\" + Item.language).match(localeRex);\n            if (m) {\n                ret = m[1];\n            } else {\n                // Set garbage to \"Klingon\".\n                ret = \"tlh\";\n            }\n        }\n        if (Item.multi && Item.multi && Item.multi.main && Item.multi.main[field]) {\n            ret = Item.multi.main[field];\n        }\n        if (!state.opt.development_extensions.strict_text_case_locales\n            || state.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n\n            ret = ret.toLowerCase();\n        }\n        return ret;\n    }\n\n    // Internal functions\n    function getTextSubField (Item, field, locale_type, use_default, stopOrig, family_var) {\n        var opt, o, ret, opts;\n        var usedOrig = stopOrig;\n        var usingOrig = false;\n\n        if (!Item[field]) {\n            return {\n                name:\"\",\n                usedOrig:stopOrig,\n                token: CSL.Util.cloneToken(this)\n            };\n        }\n        // If form=\"short\" is selected (\"family_var\" is a misnomer\n        // here, it means short-form requested), and the variable\n        // has a short-form partner (i.e. it is in array\n        // VARIABLES_WITH_SHORT_FORM), then it is run here as *-short\".\n        var stickyLongForm = false;\n        if (CSL.VARIABLES_WITH_SHORT_FORM.indexOf(field) > -1\n            && family_var) {\n\n            field = field + \"-short\";\n            stickyLongForm = true;\n        }\n        var breakMe = false;\n        var firstValue = null;\n        var fieldsToTry = [];\n        if (field.slice(-6) === \"-short\") {\n            fieldsToTry.push(field);\n            fieldsToTry.push(field.slice(0, -6))\n        } else {\n            fieldsToTry.push(field);\n        }\n\n        for (var h=0,hlen=fieldsToTry.length; h<hlen; h++) {\n            var variantMatch = false;\n            var field = fieldsToTry[h];\n\n            ret = {name:\"\", usedOrig:stopOrig,locale:getFieldLocale(Item,field)};\n\n            opts = state.opt[locale_type] ? state.opt[locale_type].slice() : [];\n            var hasVal = false;\n\n            if (locale_type === 'locale-orig') {\n                if (!stopOrig) {\n                    ret.name = Item[field];\n                    ret.usedOrig = false;\n                }\n                hasVal = true;\n                usingOrig = true;\n            } else if (use_default && (\"undefined\" === typeof opts || opts.length === 0)) {\n                // If we want the original, or if we don't have any specific guidance and we \n                // definitely want output, just return the original value.\n                ret.name = Item[field];\n                ret.usedOrig = true;\n                hasVal = true;\n                usingOrig = true;\n            }\n\n            if (!hasVal) {\n                for (var i = 0, ilen = opts.length; i < ilen; i += 1) {\n                    opt = opts[i];\n                    o = opt.split(/[\\-_]/)[0];\n                    if (opt && Item.multi && Item.multi._keys[field] && Item.multi._keys[field][opt]) {\n                        ret.name = Item.multi._keys[field][opt];\n                        ret.locale = opt;\n                        hasVal = true;\n                        variantMatch = true;\n                        usingOrig = false;\n                        break;\n                    } else if (o && Item.multi && Item.multi._keys[field] && Item.multi._keys[field][o]) {\n                        ret.name = Item.multi._keys[field][o];\n                        ret.locale = o;\n                        hasVal = true;\n                        variantMatch = true;\n                        usingOrig = false;\n                        break;\n                    }\n                }\n                if (!ret.name && use_default) {\n                    ret = {name:Item[field], usedOrig:true, locale:getFieldLocale(Item,field)};\n                    usingOrig = true;\n                }\n            }\n            ret.token = CSL.Util.cloneToken(this);\n            if (h === 0) {\n                if (variantMatch) {\n                    ret.found_variant_ok = true;\n                }\n                firstValue = ret;\n                if (!stickyLongForm && (\"undefined\" === typeof opts || opts.length === 0)) {\n                    breakMe = true;\n                }\n                if (variantMatch) {\n                    breakMe = true;\n                }\n            } else {\n                if (!stickyLongForm && !variantMatch && firstValue) {\n                    ret = firstValue;\n                    field = fieldsToTry[0];\n                } else if (variantMatch) {\n                    ret.found_variant_ok = true;\n                }\n            }\n            if ([\"title\", \"container-title\"].indexOf(field) > -1) {\n                if (!usedOrig\n                    && (!ret.token.strings[\"text-case\"]\n                        || ret.token.strings[\"text-case\"] === \"sentence\"\n                        || ret.token.strings[\"text-case\"] === \"normal\")) {\n                    var locale = state.opt.lang;\n                    var lang;\n                    if (usingOrig) {\n                        lang = false;\n                    } else {\n                        lang = ret.locale;\n                    }\n                    var seg = field.slice(0,-5);\n                    var sentenceCase = ret.token.strings[\"text-case\"] === \"sentence\" ? true : false;\n                    ret.name = CSL.titlecaseSentenceOrNormal(state, Item, seg, lang, sentenceCase);\n                    delete ret.token.strings[\"text-case\"];\n                }\n            }\n            if (breakMe) {\n                break;\n            }\n        }\n        return ret;\n    }\n    this.getTextSubField = getTextSubField;\n    \n    // Setter for abbreviation lists\n    // This initializes a single abbreviation based on known\n    // data.\n    function loadAbbreviation(jurisdiction, category, orig, lang) {\n        if (!jurisdiction) {\n            jurisdiction = \"default\";\n        }\n        var country = jurisdiction.split(\":\")[0];\n        var domain = CSL.getAbbrevsDomain(state, country, lang);\n        if (domain) {\n            jurisdiction += (\"@\" + domain);\n        }\n        if (!orig) {\n            if (!state.transform.abbrevs[jurisdiction]) {\n                state.transform.abbrevs[jurisdiction] = new state.sys.AbbreviationSegments();\n            }\n            if (!state.transform.abbrevs[jurisdiction][category]) {\n                state.transform.abbrevs[jurisdiction][category] = {};\n            }\n            return jurisdiction;\n        }\n        // The getAbbreviation() function should check the\n        // external DB for the content key. If a value exists\n        // in this[category] and no value exists in DB, the entry\n        // in memory is left untouched. If a value does exist in\n        // DB, the memory value is created.\n        //\n        // See testrunner_stdrhino.js for an example.\n        if (state.sys.getAbbreviation) {\n            jurisdiction = state.sys.getAbbreviation(state.opt.styleID, state.transform.abbrevs, jurisdiction, category, orig);\n            if (!jurisdiction) {\n                jurisdiction = \"default\";\n                if (domain) {\n                    jurisdiction += (\"@\" + domain);\n                }\n            }\n        }\n        return jurisdiction;\n    }\n    this.loadAbbreviation = loadAbbreviation;\n\n    function publisherCheck (tok, Item, primary, family_var) {\n        var varname = tok.variables[0];\n        if (state.publisherOutput && primary) {\n            if ([\"publisher\",\"publisher-place\"].indexOf(varname) === -1) {\n                return false;\n            } else {\n                // In this case, the publisher bundle will be rendered\n                // at the close of the group, by the closing group node.\n                state.publisherOutput[varname + \"-token\"] = tok;\n                state.publisherOutput.varlist.push(varname);\n                var lst = primary.split(/;\\s*/);\n                if (lst.length === state.publisherOutput[varname + \"-list\"].length) {\n                    state.publisherOutput[varname + \"-list\"] = lst;\n                }\n                // Abbreviate each of the items in the list here!\n                for (var i = 0, ilen = lst.length; i < ilen; i += 1) {\n                    lst[i] = abbreviate(state, tok, Item, false, lst[i], family_var, true);\n                }\n                state.tmp[varname + \"-token\"] = tok;\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function citeFormCheck(Item, value) {\n        var m = value.match(/^#([0-9]+).*>>>/);\n        if (m && m[1]) {\n            Item[\"cite-form\"] = m[1];\n        }\n    }\n    \n    // The name transform code is placed here to keep similar things\n    // in one place.  Obviously this module could do with a little\n    // tidying up.\n    function quashCheck(jurisdiction, value) {\n        var m = value.match(/^(?:#[0-9]+)*(?:!((?:[-_a-z]+(?:(?:.*)))(?:,(?:[-_a-z]+(?:(?:.*))))*))*>>>/);\n        if (m) {\n            value = value.slice(m[0].length);\n            if (m[1]) {\n                var fields = m[1].split(\",\");\n                for (var i = 0, ilen = fields.length; i < ilen; i += 1) {\n                    var rawField = fields[i];\n                    var mm = rawField.match(/^([-_a-z]+)(?:\\:(.*))*$/);\n                    var field = mm[1];\n                    // trimmer is not available in getAmbiguousCite\n                    var trimmer = state.tmp.abbrev_trimmer;\n                    if (mm[2]) {\n                        if (trimmer && jurisdiction) {\n                            if (!trimmer[jurisdiction]) {\n                                trimmer[jurisdiction] = {};\n                            }\n                            trimmer[jurisdiction][field] = mm[2];\n                        }\n                    } else if (state.tmp.done_vars.indexOf(field) === -1) {\n                        if (trimmer && jurisdiction) {\n                            if (!trimmer.QUASHES[jurisdiction]) {\n                                trimmer.QUASHES[jurisdiction] = {};\n                            }\n                            trimmer.QUASHES[jurisdiction][field] = true;\n                        }\n                        state.tmp.done_vars.push(field);\n                    }\n                }\n            }\n        }\n        return value;\n    }\n    this.quashCheck = quashCheck;\n\n    // Return function appropriate to selected options\n    function getOutputFunction(variables, family_var, abbreviation_fallback, alternative_varname) {\n        // var mytoken;\n\n        // Set the primary_locale and secondary_locale lists appropriately.\n        // No instance helper function for this; everything can be derived\n        // from processor settings and rendering context.\n\n        var localesets;\n        var langPrefs = CSL.LangPrefsMap[variables[0]];\n        if (!langPrefs) {\n            localesets = false;\n        } else {\n            localesets = state.opt['cite-lang-prefs'][langPrefs];\n        }\n\n        return function (state, Item, item) {\n            var primary, primary_locale, secondary, secondary_locale, tertiary, tertiary_locale, primary_tok;\n            if (!variables[0] || (!Item[variables[0]] && !Item[alternative_varname])) {\n                return null;\n            }\n            //\n            // Exploring the edges here.\n            // \"suppress-author\" for string variables (mostly titles).\n            //\n            if (!state.tmp.just_looking && item && item[\"suppress-author\"]) {\n                if (!state.tmp.probably_rendered_something && state.tmp.can_substitute.length() > 1) {\n                    return null;\n                }\n            }\n            var slot = {primary:false, secondary:false, tertiary:false};\n            if (state.tmp.area.slice(-5) === \"_sort\") {\n                slot.primary = 'locale-sort';\n            } else {\n                if (localesets && localesets.length === 1 && localesets[0] === \"locale-orig\") {\n                    slot.primary = \"locale-orig\";\n                    localesets = false;\n                } else if (localesets && !state.tmp.multi_layout) {\n                    var slotnames = [\"primary\", \"secondary\", \"tertiary\"];\n                    for (var i = 0, ilen = slotnames.length; i < ilen; i += 1) {\n                        if (localesets.length - 1 <  i) {\n                            break;\n                        }\n                        if (localesets[i]) {\n                            slot[slotnames[i]] = 'locale-' + localesets[i];\n                        }\n                    }\n                } else {\n                    slot.primary = 'locale-orig';\n                }\n            }\n            \n            if (variables[0] === \"title-short\" \n                || (state.tmp.area !== \"bibliography\"\n                    && !(state.tmp.area === \"citation\"\n                         && state.opt.xclass === \"note\"\n                         && item && !item.position))) {\n                \n                slot.secondary = false;\n                slot.tertiary = false;\n            }\n\n            if (state.tmp.multi_layout) {\n                slot.secondary = false;\n                slot.tertiary = false;\n            }\n            \n            // Problem for multilingual: we really should be\n            // checking for sanity on the basis of the output\n            // strings to be actually used. (also below)\n            if (state.tmp[\"publisher-list\"]) {\n                if (variables[0] === \"publisher\") {\n                    state.tmp[\"publisher-token\"] = this;\n                } else if (variables[0] === \"publisher-place\") {\n                    state.tmp[\"publisher-place-token\"] = this;\n                }\n                return null;\n            }\n            \n            // tmp.lang_array carries the current locale IDs of the style\n            // and the item. Field-level locale IDs are added here, so\n            // we clone it to allow reset.\n            var oldLangArray = state.tmp.lang_array.slice();\n\n            // True is for transform fallback\n            var res = getTextSubField.call(this, Item, variables[0], slot.primary, true, null, family_var);\n            primary = res.name;\n            primary_locale = res.locale;\n            var primary_tok = res.token;\n            var primaryUsedOrig = res.usedOrig;\n            if (family_var && !res.found_variant_ok) {\n                primary = abbreviate(state, primary_tok, Item, alternative_varname, primary, family_var, true);\n                // Suppress subsequent use of another variable if requested by\n                // hack syntax in this abbreviation short form.\n                if (primary) {\n                    // We run quash-check in getAmbiguousCite, to possibly pick up a cite-form value.\n                    citeFormCheck(Item, primary);\n                    if (!state.tmp.just_looking) {\n                        primary = quashCheck(Item.jurisdiction, primary);\n                    }\n                }\n            }\n            if (publisherCheck(this, Item, primary, family_var)) {\n                state.tmp.lang_array = oldLangArray;\n                return null;\n            }\n\n            // No fallback for secondary and tertiary\n            secondary = false;\n            tertiary = false;\n            var secondary_tok;\n            var tertiary_tok;\n            if (slot.secondary) {\n                res = getTextSubField.call(this, Item, variables[0], slot.secondary, false, res.usedOrig, null, family_var);\n                secondary = res.name;\n                secondary_locale = res.locale;\n                secondary_tok = res.token;\n                if (family_var && !res.found_variant_ok) {\n                    if (secondary) {\n                        // The abbreviate() function could use a cleanup, after Zotero correct to use title-short\n                        secondary = abbreviate(state, secondary_tok, Item, false, secondary, family_var, true);\n                    }\n                }\n                //print(\"XXX secondary_locale: \"+secondary_locale);\n            }\n            if (slot.tertiary) {\n                res = getTextSubField.call(this, Item, variables[0], slot.tertiary, false, res.usedOrig, null, family_var);\n                tertiary = res.name;\n                tertiary_locale = res.locale;\n                tertiary_tok = res.token;\n                if (family_var && !res.found_variant_ok) {\n                    if (tertiary) {\n                        // The abbreviate() function could use a cleanup, after Zotero correct to use title-short\n                        tertiary = abbreviate(state, tertiary_tok, Item, false, tertiary, family_var, true);\n                    }\n                }\n                //print(\"XXX tertiary_locale: \"+tertiary_locale);\n            }\n            \n            // Decoration of primary (currently translit only) goes here\n            var primaryPrefix;\n            if (slot.primary === \"locale-translit\") {\n                primaryPrefix = state.opt.citeAffixes[langPrefs][slot.primary].prefix;\n            }                \n            // XXX This should probably protect against italics at higher\n            // levels.\n\n            if (primaryPrefix === \"<i>\" && variables[0] === 'title' && !primaryUsedOrig) {\n                var hasItalic = false;\n                for (var i = 0, ilen = primary_tok.decorations.length; i < ilen; i += 1) {\n                    if (primary_tok.decorations[i][0] === \"@font-style\"\n                        && primary_tok.decorations[i][1] === \"italic\") {\n                        \n                        hasItalic = true;\n                    }\n                }\n                if (!hasItalic) {\n                    primary_tok.decorations.push([\"@font-style\", \"italic\"]);\n                }\n            }\n\n            //print(\"XXX \"+primary_tok.strings[\"text-case\"]);\n            if (primary_locale !== \"en\" && primary_tok.strings[\"text-case\"] === \"title\") {\n                primary_tok.strings[\"text-case\"] = \"passthrough\";\n            }\n            \n            if (\"title\" === variables[0]) {\n                primary = CSL.demoteNoiseWords(state, primary, this[\"leading-noise-words\"]);\n            }\n            if (secondary || tertiary) {\n\n                state.output.openLevel(\"empty\");\n\n                // A little too aggressive maybe.\n                primary_tok.strings.suffix = primary_tok.strings.suffix.replace(/[ .,]+$/,\"\");\n                if (primary_locale) {\n                    state.tmp.lang_array = [primary_locale].concat(oldLangArray);\n                }\n                CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, null, null, primary_tok, primary_tok.strings.prefix + primary);\n                state.output.append(primary, primary_tok);\n                state.tmp.probably_rendered_something = true;\n\n                if (primary === secondary) {\n                    secondary = false;\n                }\n                if (secondary) {\n                    secondary_tok.strings.prefix = state.opt.citeAffixes[langPrefs][slot.secondary].prefix;\n                    secondary_tok.strings.suffix = state.opt.citeAffixes[langPrefs][slot.secondary].suffix;\n                    // Add a space if empty\n                    if (!secondary_tok.strings.prefix) {\n                        secondary_tok.strings.prefix = \" \";\n                    }\n                    // Remove quotes\n                    for (var i = secondary_tok.decorations.length - 1; i > -1; i += -1) {\n                        if (['@quotes/true', '@font-style/italic', '@font-style/oblique', '@font-weight/bold'].indexOf(secondary_tok.decorations[i].join('/')) > -1) {\n                            secondary_tok.decorations = secondary_tok.decorations.slice(0, i).concat(secondary_tok.decorations.slice(i + 1));\n                        }\n                    }\n                    if (secondary_locale !== \"en\" && secondary_tok.strings[\"text-case\"] === \"title\") {\n                        secondary_tok.strings[\"text-case\"] = \"passthrough\";\n                    }\n                    if (secondary_locale) {\n                        state.tmp.lang_array = [secondary_locale].concat(oldLangArray);\n                    }\n                    var secondary_outer = new CSL.Token();\n                    secondary_outer.decorations.push([\"@font-style\", \"normal\"]);\n                    secondary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n                    state.output.openLevel(secondary_outer);\n                    state.output.append(secondary, secondary_tok);\n                    state.output.closeLevel();\n\n                    var blob_obj = state.output.current.value();\n                    var blobs_pos = state.output.current.value().blobs.length - 1;\n                    // Suppress supplementary multilingual info on subsequent\n                    // partners of a parallel cite?\n                }\n                if (primary === tertiary) {\n                    tertiary = false;\n                }\n                \n                if (tertiary) {\n                    tertiary_tok.strings.prefix = state.opt.citeAffixes[langPrefs][slot.tertiary].prefix;\n                    tertiary_tok.strings.suffix = state.opt.citeAffixes[langPrefs][slot.tertiary].suffix;\n                    // Add a space if empty\n                    if (!tertiary_tok.strings.prefix) {\n                        tertiary_tok.strings.prefix = \" \";\n                    }\n                    // Remove quotes\n                    for (var i = tertiary_tok.decorations.length - 1; i > -1; i += -1) {\n                        if (['@quotes/true', '@font-style/italic', '@font-style/oblique', '@font-weight/bold'].indexOf(tertiary_tok.decorations[i].join('/')) > -1) {\n                            tertiary_tok.decorations = tertiary_tok.decorations.slice(0, i).concat(tertiary_tok.decorations.slice(i + 1));\n                        }\n                    }\n                    if (tertiary_locale !== \"en\" && tertiary_tok.strings[\"text-case\"] === \"title\") {\n                        tertiary_tok.strings[\"text-case\"] = \"passthrough\";\n                    }\n                    if (tertiary_locale) {\n                        state.tmp.lang_array = [tertiary_locale].concat(oldLangArray);\n                    }\n                    var tertiary_outer = new CSL.Token();\n                    tertiary_outer.decorations.push([\"@font-style\", \"normal\"]);\n                    tertiary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n                    state.output.openLevel(tertiary_outer);\n                    state.output.append(tertiary, tertiary_tok);\n                    state.output.closeLevel();\n\n                    var blob_obj = state.output.current.value();\n                    var blobs_pos = state.output.current.value().blobs.length - 1;\n                    // Suppress supplementary multilingual info on subsequent\n                    // partners of a parallel cite?\n                    // See note above.\n                }\n\n                state.output.closeLevel();\n            } else {\n                if (primary_locale) {\n                    state.tmp.lang_array = [primary_locale].concat(oldLangArray);\n                }\n                CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, null, null, primary_tok, primary_tok.strings.prefix + primary);\n                state.output.append(primary, primary_tok);\n                state.tmp.probably_rendered_something = true;\n            }\n\n            state.tmp.lang_array = oldLangArray;\n                \n            if (state.tmp.can_block_substitute) {\n                state.tmp.name_node.children.push(state.output.current.value());\n            }\n            return null;\n        };\n    }\n    this.getOutputFunction = getOutputFunction;\n};\n\n/*global CSL: true */\n\n/**\n * Style token.\n * <p>This class provides the tokens that define\n * the runtime version of the style.  The tokens are\n * instantiated by {@link CSL.Core.Build}, but the token list\n * must be post-processed with\n * {@link CSL.Core.Configure} before it can be used to generate\n * citations.</p>\n * @param {String} name The node name represented by this token.\n * @param {Int} tokentype A flag indicating whether this token\n * marks the start of a node, the end of a node, or is a singleton.\n * @class\n */\nCSL.Token = function (name, tokentype, conditional) {\n    /**\n     * Name of the element.\n     * <p>This corresponds to the element name of the\n     * relevant tag in the CSL file.\n     */\n    this.name = name;\n    /**\n     * Strings and other static content specific to the element.\n     */\n    this.strings = {};\n    this.strings.delimiter = undefined;\n    this.strings.prefix = \"\";\n    this.strings.suffix = \"\";\n    /**\n     * Formatting parameters.\n     * <p>This is a placeholder at instantiation.  It is\n     * replaced by the result of {@link CSL.setDecorations}\n     * when the tag is created and configured during {@link CSL.Core.Build}\n     * by {@link CSL.XmlToToken}.  The parameters for particular\n     * formatting attributes are stored as string arrays, which\n     * map to formatting functions at runtime,\n     * when the output format is known.  Note that the order in which\n     * parameters are registered is fixed by the constant\n     * {@link CSL.FORMAT_KEY_SEQUENCE}.\n     */\n    this.decorations = [];\n    this.variables = [];\n    /**\n     * Element functions.\n     * <p>Functions implementing the styling behaviour of the element\n     * are pushed into this array in the {@link CSL.Core.Build} phase.\n     */\n    this.execs = [];\n    /**\n     * Token type.\n     * <p>This is a flag constant indicating whether the token represents\n     * a start tag, an end tag, or is a singleton.</p>\n     */\n    this.tokentype = tokentype;\n\n    // Conditional attributes added to bare tokens at runtime\n    \n    /**\n     * Condition evaluator.\n     * <p>This is a placeholder that receives a single function, and is\n     * only relevant for a conditional branching tag (<code>if</code> or\n     * <code>else-if</code>).  The function implements the argument to\n     * the <code>match=</code> attribute (<code>any</code>, <code>all</code>\n     * or <code>none</code>), by executing the functions registered in the\n     * <code>tests</code> array (see below), and reacting accordingly.  This\n     * function is invoked by the execution wrappers found in\n     * {@link CSL.Engine}.</p>\n     */\n    // this.evaluator = false;\n    /**\n     * Conditions.\n     * <p>Functions that evaluate to true or false, implementing\n     * various posisble attributes to the conditional branching tags,\n     * are registered here during {@link CSL.Core.Build}.\n     * </p>\n     */\n    // this.tests = [];\n    /**\n     * Jump point on success.\n     * <p>This holds the list jump point to be used when the\n     * <code>evaluator</code> function of a conditional tag\n     * returns true (success).  The jump index value is set during the\n     * back-to-front token pass performed during {@link CSL.Core.Configure}.\n     * </p>\n     */\n    // this.succeed = false;\n    /**\n     * Jump point on failure.\n     * <p>This holds the list jump point to be used when the\n     * <code>evaluator</code> function of a conditional tag\n     * returns false (failure).  Jump index values are set during the\n     * back-to-front token pass performed during {@link CSL.Core.Configure}.\n     * </p>\n     */\n    // this.fail = false;\n    /**\n     * Index of next token.\n     * <p>This holds the index of the next token in the\n     * token list, which is the default \"jump-point\" for ordinary\n     * processing.  Jump index values are set during the\n     * back-to-front token pass performed during {@link CSL.Core.Configure}.\n     * </p>\n     */\n    // this.next = false;\n};\n\n// Have needed this for yonks\nCSL.Util.cloneToken = function (token) {\n    var newtok, key, pos, len;\n    if (\"string\" === typeof token) {\n        return token;\n    }\n    newtok = new CSL.Token(token.name, token.tokentype);\n    for (var key in token.strings) {\n        if (token.strings.hasOwnProperty(key)) {\n            newtok.strings[key] = token.strings[key];\n        }\n    }\n    if (token.decorations) {\n        newtok.decorations = [];\n        for (pos = 0, len = token.decorations.length; pos < len; pos += 1) {\n            newtok.decorations.push(token.decorations[pos].slice());\n        }\n    }\n    if (token.variables) {\n        newtok.variables = token.variables.slice();\n    }\n    // Probably overkill; this is only used for cloning formatting\n    // tokens.\n    if (token.execs) {\n        newtok.execs = token.execs.slice();\n        if (token.tests) {\n            newtok.tests = token.tests.slice();\n        }\n    }\n    return newtok;\n};\n\n/*global CSL: true */\n\n/**\n * Ambiguous Cite Configuration Object\n * @class\n */\nCSL.AmbigConfig = function () {\n    this.maxvals = [];\n    this.minval = 1;\n    this.names = [];\n    this.givens = [];\n    this.year_suffix = false;\n    this.disambiguate = 0;\n};\n\n/*global CSL: true */\n\nCSL.Blob = function (str, token, levelname) {\n    var len, pos, key;\n    this.levelname = levelname;\n    //print(levelname);\n    if (token) {\n        this.strings = {\"prefix\":\"\",\"suffix\":\"\"};\n        for (var key in token.strings) {\n            if (token.strings.hasOwnProperty(key)) {\n                this.strings[key] = token.strings[key];\n            }\n        }\n        this.decorations = [];\n        if (token.decorations === undefined) {\n            len = 0;\n        } else {\n            len = token.decorations.length;\n        }\n        for (pos = 0; pos < len; pos += 1) {\n            this.decorations.push(token.decorations[pos].slice());\n        }\n    } else {\n        this.strings = {};\n        this.strings.prefix = \"\";\n        this.strings.suffix = \"\";\n        this.strings.delimiter = \"\";\n        this.decorations = [];\n    }\n    if (\"string\" === typeof str) {\n        this.blobs = str;\n    } else if (str) {\n        this.blobs = [str];\n    } else {\n        this.blobs = [];\n    }\n    this.alldecor = [this.decorations];\n};\n\n\nCSL.Blob.prototype.push = function (blob) {\n    if (\"string\" === typeof this.blobs) {\n        CSL.error(\"Attempt to push blob onto string object\");\n    } else if (false !== blob) {\n        blob.alldecor = blob.alldecor.concat(this.alldecor);\n        this.blobs.push(blob);\n    }\n};\n\n/*global CSL: true */\n\n/**\n * An output instance object representing a number or a range\n *\n * with attributes next and start, and\n * methods isRange(), renderStart(), renderEnd() and renderRange().\n * At render time, the output queue will perform optional\n * collapsing of these objects in the queue, according to\n * configurable options, and apply any decorations registered\n * in the object to the output elements.\n * @namespace Range object and friends.\n */\n\nCSL.NumericBlob = function (state, particle, num, mother_token, id) {\n    // item id is used to assure that prefix delimiter is invoked only\n    // when joining blobs across items\n    this.id = id;\n    this.alldecor = [];\n    this.num = num;\n    this.particle = particle;\n    this.blobs = num.toString();\n    this.status = CSL.START;\n    this.strings = {};\n    if (mother_token) {\n        if (mother_token.strings[\"text-case\"]) {\n            var textCase = mother_token.strings[\"text-case\"];\n            this.particle = CSL.Output.Formatters[textCase](state, this.particle);\n            this.blobs = CSL.Output.Formatters[textCase](state, this.blobs);\n        }\n        this.gender = mother_token.gender;\n        this.decorations = mother_token.decorations;\n        this.strings.prefix = mother_token.strings.prefix;\n        this.strings.suffix = mother_token.strings.suffix;\n        this.strings[\"text-case\"] = mother_token.strings[\"text-case\"];\n        this.successor_prefix = mother_token.successor_prefix;\n        this.range_prefix = mother_token.range_prefix;\n        this.splice_prefix = mother_token.splice_prefix;\n        this.formatter = mother_token.formatter;\n        if (!this.formatter) {\n            this.formatter =  new CSL.Output.DefaultFormatter();\n        }\n        if (this.formatter) {\n            this.type = this.formatter.format(1);\n        }\n    } else {\n        this.decorations = [];\n        this.strings.prefix = \"\";\n        this.strings.suffix = \"\";\n        this.successor_prefix = \"\";\n        this.range_prefix = \"\";\n        this.splice_prefix = \"\";\n        this.formatter = new CSL.Output.DefaultFormatter();\n    }\n};\n\n\nCSL.NumericBlob.prototype.setFormatter = function (formatter) {\n    this.formatter = formatter;\n    this.type = this.formatter.format(1);\n};\n\n\nCSL.Output.DefaultFormatter = function () {};\n\nCSL.Output.DefaultFormatter.prototype.format = function (num) {\n    return num.toString();\n};\n\nCSL.NumericBlob.prototype.checkNext = function (next,start) {\n    if (start) {\n        this.status = CSL.START;\n        if (\"object\" === typeof next) {\n            if (next.num === (this.num + 1)) {\n                next.status = CSL.SUCCESSOR;\n            } else {\n                next.status = CSL.SEEN;\n            }\n        }\n    } else if (! next || !next.num || this.type !== next.type || next.num !== (this.num + 1)) {\n        if (this.status === CSL.SUCCESSOR_OF_SUCCESSOR) {\n            this.status = CSL.END;\n        }\n        if (\"object\" === typeof next) { \n           next.status = CSL.SEEN;\n        }\n    } else { // next number is in the sequence\n        if (this.status === CSL.START || this.status === CSL.SEEN) {\n            next.status = CSL.SUCCESSOR;\n        } else if (this.status === CSL.SUCCESSOR || this.status === CSL.SUCCESSOR_OF_SUCCESSOR) {\n            if (this.range_prefix) {\n                next.status = CSL.SUCCESSOR_OF_SUCCESSOR;\n                this.status = CSL.SUPPRESS;\n            } else {\n                next.status = CSL.SUCCESSOR;\n            }\n        }\n        // wakes up the correct delimiter.\n        //if (this.status === CSL.SEEN) {\n        //    this.status = CSL.SUCCESSOR;\n        //}\n    }\n};\n\n\nCSL.NumericBlob.prototype.checkLast = function (last) {\n    // Used to adjust final non-range join\n    if (this.status === CSL.SEEN \n    || (last.num !== (this.num - 1) && this.status === CSL.SUCCESSOR)) {\n        this.status = CSL.SUCCESSOR;\n        return true;\n    }\n    return false;\n};\n\n/*global CSL: true */\n\nCSL.Util.fixDateNode = function (parent, pos, node) {\n    var form, variable, datexml, subnode, partname, attr, val, prefix, suffix, children, subchildren, display, cslid;\n    \n    var lingo = this.cslXml.getAttributeValue(node, \"lingo\");\n\n    var default_locale = this.cslXml.getAttributeValue(node, \"default-locale\");\n\n    // Raise date flag, used to control inclusion of year-suffix key in sorts\n    // This may be a little reckless: not sure what happens on no-date conditions\n    this.build.date_key = true;\n\n    form = this.cslXml.getAttributeValue(node, \"form\");\n    var lingo;\n    if (default_locale) {\n        lingo = this.opt[\"default-locale\"][0];\n    } else {\n        lingo = this.cslXml.getAttributeValue(node, \"lingo\");\n    }\n\n    if (!this.getDate(form, default_locale)) {\n        return parent;\n    }\n\n    var dateparts = this.cslXml.getAttributeValue(node, \"date-parts\");\n\n    variable = this.cslXml.getAttributeValue(node, \"variable\");\n    prefix = this.cslXml.getAttributeValue(node, \"prefix\");\n    suffix = this.cslXml.getAttributeValue(node, \"suffix\");\n    display = this.cslXml.getAttributeValue(node, \"display\");\n    cslid = this.cslXml.getAttributeValue(node, \"cslid\");\n\n    //\n    // Xml: Copy a node\n    //\n    datexml = this.cslXml.nodeCopy(this.getDate(form, default_locale));\n    this.cslXml.setAttribute(datexml, 'lingo', this.opt.lang);\n    this.cslXml.setAttribute(datexml, 'form', form);\n    this.cslXml.setAttribute(datexml, 'date-parts', dateparts);\n    this.cslXml.setAttribute(datexml, \"cslid\", cslid);\n    //\n    // Xml: Set attribute\n    //\n    this.cslXml.setAttribute(datexml, 'variable', variable);\n    this.cslXml.setAttribute(datexml, 'default-locale', default_locale);\n    //\n    // Xml: Set flag\n    //\n    if (prefix) {\n        //\n        // Xml: Set attribute\n        //\n        this.cslXml.setAttribute(datexml, \"prefix\", prefix);\n    }\n    if (suffix) {\n        //\n        // Xml: Set attribute\n        //\n        this.cslXml.setAttribute(datexml, \"suffix\", suffix);\n    }\n    if (display) {\n        //\n        // Xml: Set attribute\n        //\n        this.cslXml.setAttribute(datexml, \"display\", display);\n    }\n    //\n    // Step through any date-part children of the layout date node,\n    // and lay their attributes onto the corresponding node in the\n    // locale template node copy.\n    //\n    // tests: language_BaseLocale\n    // tests: date_LocalizedTextInStyleLocaleWithTextCase\n    //\n    children = this.cslXml.children(datexml);\n    for (var key in children) {\n        subnode = children[key];\n        if (\"date-part\" === this.cslXml.nodename(subnode)) {\n            partname = this.cslXml.getAttributeValue(subnode, \"name\");\n            if (default_locale) {\n                this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(datexml, \"date-part\", partname, \"@default-locale\", \"true\");\n            }\n        }\n    }\n\n    children = this.cslXml.children(node);\n    for (var key in children) {\n        subnode = children[key];\n        if (\"date-part\" === this.cslXml.nodename(subnode)) {\n            partname = this.cslXml.getAttributeValue(subnode, \"name\");\n            subchildren = this.cslXml.attributes(subnode);\n            for (attr in subchildren) {\n                if (\"@name\" === attr) {\n                    continue;\n                }\n                if (lingo && lingo !== this.opt.lang) {\n                    if ([\"@suffix\", \"@prefix\", \"@form\"].indexOf(attr) > -1) {\n                        continue;\n                    }\n                }\n                val = subchildren[attr];\n                this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(datexml, \"date-part\", partname, attr, val);\n            }\n        }\n    }\n    \n    if (\"year\" === this.cslXml.getAttributeValue(node, \"date-parts\")) {\n\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'month');\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'day');\n        \n    } else if (\"year-month\" === this.cslXml.getAttributeValue(node, \"date-parts\")) {\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'day');\n    } else if (\"month-day\" === this.cslXml.getAttributeValue(node, \"date-parts\")) {\n        //\n        // Xml: Get child nodes\n        //\n        var childNodes = this.cslXml.children(datexml);\n        for (var i=1,ilen=this.cslXml.numberofnodes(childNodes);i<ilen;i++) {\n            //\n            // Xml: Get attribute value (for string comparison)\n            //\n            if (this.cslXml.getAttributeValue(childNodes[i], 'name') === \"year\") {\n                //\n                // Xml: Set attribute value\n                //\n                this.cslXml.setAttribute(childNodes[i-1], \"suffix\", \"\");\n                break;\n            }\n        }\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'year');\n    }\n    return this.cslXml.insertChildNodeAfter(parent, node, pos, datexml);\n};\n\n/*global CSL: true */\n\nCSL.dateMacroAsSortKey = function (state, Item) {\n    CSL.dateAsSortKey.call(this, state, Item, true);\n};\n\n\nCSL.dateAsSortKey = function (state, Item, isMacro) {\n    var dp, elem, value, e, yr, prefix, i, ilen;\n    var variable = this.variables[0];\n    var macroFlag = \"empty\";\n    if (isMacro && state.tmp.extension) {\n        macroFlag = \"macro-with-date\";\n    }\n    dp = Item[variable];\n    if (\"undefined\" === typeof dp) {\n        dp = {\"date-parts\": [[0]] };\n    }\n    if (\"undefined\" === typeof this.dateparts) {\n        this.dateparts = [\"year\", \"month\", \"day\"];\n    }\n    if (dp.raw) {\n        dp = state.fun.dateparser.parseDateToArray(dp.raw);\n    } else if (dp[\"date-parts\"]) {\n        dp = state.dateParseArray(dp);\n    }\n    if (\"undefined\" === typeof dp) {\n        dp = {};\n    }\n    if (dp.year) {\n        for (i = 0, ilen = CSL.DATE_PARTS_INTERNAL.length; i < ilen; i += 1) {\n            elem = CSL.DATE_PARTS_INTERNAL[i];\n            value = 0;\n            e = elem;\n            if (e.slice(-4) === \"_end\") {\n                e = e.slice(0, -4);\n            }\n            if (dp[elem] && this.dateparts.indexOf(e) > -1) {\n                value = dp[elem];\n            }\n            if (elem.slice(0, 4) === \"year\") {\n                yr = CSL.Util.Dates[e].numeric(state, value);\n                var prefix = \"1\";\n                if (yr[0] === \"-\") {\n                    prefix = \"0\";\n                    yr = yr.slice(1);\n                    yr = 9999 - parseInt(yr, 10);\n                }\n                state.output.append(CSL.Util.Dates[elem.slice(0, 4)].numeric(state, (prefix + yr)), macroFlag);\n            } else {\n                value = CSL.Util.Dates[e][\"numeric-leading-zeros\"](state, value);\n                // Ugh.\n                if (!value) {\n                    value = \"00\";\n                }\n                state.output.append(value, macroFlag);\n            }\n        }\n    }\n};\n\nCSL.Engine.prototype.dateParseArray = function (date_obj) {\n    var ret, field, dp, exts;\n    ret = {};\n    for (field in date_obj) {\n        if (field === \"date-parts\") {\n            dp = date_obj[\"date-parts\"];\n            if (dp.length > 1) {\n                if (dp[0].length !== dp[1].length) {\n                    CSL.error(\"CSL data error: element mismatch in date range input.\");\n                }\n            }\n            exts = [\"\", \"_end\"];\n            for (var i = 0, ilen = dp.length; i < ilen; i += 1) {\n                for (var j = 0, jlen = CSL.DATE_PARTS.length; j < jlen; j += 1) {\n                    if (isNaN(parseInt(dp[i][j], 10))) {\n                        ret[(CSL.DATE_PARTS[j] + exts[i])] = undefined;\n                    } else {\n                        ret[(CSL.DATE_PARTS[j] + exts[i])] = parseInt(dp[i][j], 10);\n                    }\n                }\n            }\n        } else if (date_obj.hasOwnProperty(field)) {\n\n            // XXXX: temporary workaround\n\n            if (field === \"literal\" && \"object\" === typeof date_obj.literal && \"string\" === typeof date_obj.literal.part) {\n                CSL.debug(\"Warning: fixing up weird literal date value\");\n                ret.literal = date_obj.literal.part;\n            } else {\n                ret[field] = date_obj[field];\n            }\n        }\n    }\n    return ret;\n};\n\n/*global CSL: true */\n\nCSL.Util.Names = {};\n\nCSL.Util.Names.compareNamesets = CSL.NameOutput.prototype._compareNamesets;\n\n/**\n * Un-initialize a name (quash caps after first character)\n */\nCSL.Util.Names.unInitialize = function (state, name) {\n    var i, ilen, namelist, punctlist, ret;\n    if (!name) {\n        return \"\";\n    }\n    namelist = name.split(/(?:\\-|\\s+)/);\n    punctlist = name.match(/(\\-|\\s+)/g);\n    ret = \"\";\n    for (i = 0, ilen = namelist.length; i < ilen; i += 1) {\n        // if (CSL.ALL_ROMANESQUE_REGEXP.exec(namelist[i].slice(0,-1)) \n        //    && namelist[i] \n        //    && namelist[i] !== namelist[i].toUpperCase()) {\n\n            // More or less like this, to address the following fault report:\n            // http://forums.zotero.org/discussion/17610/apsa-problems-with-capitalization-of-mc-mac-etc/\n\n            // Leaving the name string untouched because name capitalization is varied and wonderful.\n            // https://github.com/Juris-M/citeproc-js/issues/43\n            \n            //namelist[i] = namelist[i].slice(0, 1) + namelist[i].slice(1, 2).toLowerCase() + namelist[i].slice(2);\n        // }\n        ret += namelist[i];\n        if (i < ilen - 1) {\n            ret += punctlist[i];\n        }\n    }\n    return ret;\n};\n\n/**\n * Initialize a name.\n */\nCSL.Util.Names.initializeWith = function (state, name, terminator, normalizeOnly) {\n    var i, ilen, mm, lst, ret;\n    if (!name) {\n        return \"\";\n    }\n    if (!terminator) {\n        terminator = \"\";\n    }\n    if ([\"Lord\", \"Lady\"].indexOf(name) > -1\n        || (!name.replace(/^(?:<[^>]+>)*/, \"\").match(CSL.STARTSWITH_ROMANESQUE_REGEXP)\n            && !terminator.match(\"%s\"))) {\n        return name;\n    }\n\n    if (state.opt[\"initialize-with-hyphen\"] === false) {\n        name = name.replace(/\\-/g, \" \");\n    }\n\n    // We need to suss out what is a set of initials or abbreviation,\n    // so that they can be selectively normalized. Steps might be:\n    //   (1) Split the string\n    //   (2) Step through the string, deleting periods and, if initalize=\"false\", then\n    //       (a) note abbreviations and initials (separately).\n    //   (3) If initialize=\"false\" then:\n    //       (a) Do the thing below, but only pushing terminator; or else\n    //       (b) Do the thing below\n\n    name = name.replace(/\\s*\\-\\s*/g, \"-\").replace(/\\s+/g, \" \");\n    name = name.replace(/-([a-z])/g, \"\\u2013$1\");\n\n    for (var i=name.length-2; i>-1; i += -1) {\n        if (name.slice(i, i+1) === \".\" && name.slice(i+1, i+2) !== \" \") {\n            name = name.slice(0, i) + \". \" + name.slice(i+1);\n        }\n    }\n\n    // (1) Split the string\n    var nameSplits = CSL.Output.Formatters.nameDoppel.split(name);\n    var namelist = [];\n    namelist = [nameSplits.strings[0]];\n\n    if (nameSplits.tags.length === 0) {\n        var mmm = namelist[0].match(/[^\\.]+$/);\n        if (mmm && mmm[0].length === 1 && mmm[0] !== mmm[0].toLowerCase()) {\n            namelist[0] += \".\";\n        }\n    }\n\n    for (i = 1, ilen = nameSplits.strings.length; i < ilen; i += 1) {\n        namelist.push(nameSplits.tags[i - 1]);\n        namelist.push(nameSplits.strings[i]);\n    }\n\n    // Use doInitializeName or doNormalizeName, depending on requirements.\n    if (normalizeOnly) {\n        ret = this.doNormalize(state, namelist, terminator);\n    } else {\n        ret = this.doInitialize(state, namelist, terminator);\n    }\n    ret = ret.replace(/\\u2013([a-z])/g, \"-$1\");\n    return ret;\n};\n\nCSL.Util.Names.notag = function(str) {\n    return str.replace(/^(?:<[^>]+>)*/, \"\");\n};\n\nCSL.Util.Names.mergetag = function(state, tagstr, newstr) {\n    var m = tagstr.match(/(?:-*<[^>]+>-*)/g);\n    if (!m) {\n        return newstr;\n    } else {\n        tagstr = m.join(\"\");\n    }\n    m = newstr.match(/^(.*[^\\s])*(\\s+)$/);\n    if (m) {\n        m[1] = m[1] ? m[1] : \"\";\n        newstr = m[1] + tagstr + m[2];\n    } else {\n        newstr = newstr + tagstr;\n    }\n    return newstr;\n};\n\nCSL.Util.Names.tagonly = function(state, str) {\n    var m = str.match(/(?:<[^>]+>)+/);\n    if (!m) {\n        return str;\n    } else {\n        return m.join(\"\");\n    }\n};\n\nCSL.Util.Names.doNormalize = function (state, namelist, terminator) {\n    var i, ilen;\n    // namelist is a flat list of given-name elements and space-like separators between them\n    terminator = terminator ? terminator : \"\";\n    // Flag elements that look like abbreviations\n    var isAbbrev = [];\n    for (i = 0, ilen = namelist.length; i < ilen; i += 1) {\n        if (this.notag(namelist[i]).length > 1 && this.notag(namelist[i]).slice(-1) === \".\") {\n            // namelist[i] = namelist[i].slice(0, -1);\n            namelist[i] = namelist[i].replace(/^(.*)\\.(.*)$/, \"$1$2\");\n            isAbbrev.push(true);\n        } else if (namelist[i].length === 1 && namelist[i].toUpperCase() === namelist[i]) {\n            isAbbrev.push(true);\n        } else {\n            isAbbrev.push(false);\n        }\n    }\n    // Step through the elements of the givenname array\n    for (i = 0, ilen = namelist.length; i < ilen; i += 2) {\n        // If the element is not an abbreviation, leave it and its trailing spaces alone\n        if (isAbbrev[i]) {\n            // For all elements but the last\n            if (i < namelist.length - 2) {\n                // Start from scratch on space-like things following an abbreviation\n                namelist[i + 1] = this.tagonly(state, namelist[i+1]);\n                if (!isAbbrev[i+2]) {\n                    namelist[i + 1] = this.tagonly(state, namelist[i+1]) + \" \";\n                }\n                \n                // Add the terminator to the element\n                // If the following element is not a single-character abbreviation, remove a trailing zero-width non-break space, if present\n                // These ops may leave some duplicate cruft in the elements and separators. This will be cleaned at the end of the function.\n                if (namelist[i + 2].length > 1) {\n                    namelist[i+1] = terminator.replace(/\\ufeff$/, \"\") + namelist[i+1];\n                } else {\n                    namelist[i+1] = this.mergetag(state, namelist[i+1], terminator);\n                }\n            }\n            // For the last element (if it is an abbreviation), just append the terminator\n            if (i === namelist.length - 1) {\n                namelist[i] = namelist[i] + terminator;\n            }\n        }\n    }\n    // Remove trailing cruft and duplicate spaces, and return\n    return namelist.join(\"\").replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020\\ufeff\\u00a0]+$/,\"\").replace(/\\s*\\-\\s*/g, \"-\").replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020]+/g, \" \");\n};\n\nCSL.Util.Names.doInitialize = function (state, namelist, terminator) {\n    var i, ilen, m, j, jlen, lst, n;\n    for (i = 0, ilen = namelist.length; i < ilen; i += 2) {\n        n = namelist[i];\n        if (!n) {\n            continue;\n        }\n        m = n.match(CSL.NAME_INITIAL_REGEXP);\n        if (!m && (!n.match(CSL.STARTSWITH_ROMANESQUE_REGEXP) && n.length > 1 && terminator.match(\"%s\"))) {\n            m = n.match(/(.)(.*)/);\n        }\n        if (m && m[2] && m[3]) {\n            m[1] = m[1] + m[2];\n            m[2] = \"\";\n        }\n        if (m && m[1].slice(0, 1) === m[1].slice(0, 1).toUpperCase()) {\n            var extra = \"\";\n            if (m[2]) {\n                var s = \"\";\n                lst = m[2].split(\"\");\n                for (j = 0, jlen = lst.length; j < jlen; j += 1) {\n                    var c = lst[j];\n                    if (c === c.toUpperCase()) {\n                        s += c;\n                    } else {\n                        break;\n                    }\n                }\n                if (s.length < m[2].length) {\n                    extra = CSL.toLocaleLowerCase.call(state, s);\n                }\n            }\n            namelist[i] = m[1] + extra;\n            if (i < (ilen - 1)) {\n                if (terminator.match(\"%s\")) {\n                    namelist[i] = terminator.replace(\"%s\", namelist[i]);\n                } else {\n                    if (namelist[i + 1].indexOf(\"-\") > -1) {\n                        namelist[i + 1] = this.mergetag(state, namelist[i+1].replace(\"-\", \"\"), terminator) + \"-\";\n                    } else {\n                        namelist[i + 1] = this.mergetag(state, namelist[i+1], terminator);\n                    }\n                }\n            } else {\n                if (terminator.match(\"%s\")) {\n                    namelist[i] = terminator.replace(\"%s\", namelist[i]);\n                } else {\n                    namelist.push(terminator);\n                }\n            }\n        } else if (n.match(CSL.ROMANESQUE_REGEXP) && (!m || !m[3])) {\n            namelist[i] = \" \" + n;\n        }\n    }\n    var ret = namelist.join(\"\");\n    ret = ret.replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020\\ufeff\\u00a0]+$/,\"\").replace(/\\s*\\-\\s*/g, \"-\").replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020]+/g, \" \");\n    return ret;\n};\n\nCSL.Util.Names.getRawName = function (name) {\n    var ret = [];\n    if (name.literal) {\n        ret.push(name.literal);\n    } else {\n        if (name.given) {\n            ret.push(name.given);\n        }\n        if (name.family) {\n            ret.push(name.family);\n        }\n    }\n    return ret.join(\" \");\n};\n\n/*global CSL: true */\n\n/**\n * Date mangling functions.\n * @namespace Date construction utilities\n */\nCSL.Util.Dates = {};\n\n/**\n * Year manglers\n * <p>short, long</p>\n */\nCSL.Util.Dates.year = {};\n\n/**\n * Convert year to long form\n * <p>This just passes the number back as a string.</p>\n */\nCSL.Util.Dates.year[\"long\"] = function (state, num) {\n    if (!num) {\n        if (\"boolean\" === typeof num) {\n            num = \"\";\n        } else {\n            num = 0;\n        }\n    }\n    return num.toString();\n};\n\n/**\n * Crudely convert to Japanese Imperial form.\n * <p>Returns the result as a string.</p>\n */\nCSL.Util.Dates.year.imperial = function (state, num, end) {\n    var year = \"\";\n    if (!num) {\n        if (\"boolean\" === typeof num) {\n            num = \"\";\n        } else {\n            num = 0;\n        }\n    }\n    end = end ? \"_end\" : \"\";\n    var month = state.tmp.date_object[\"month\" + end];\n    month = month ? \"\"+month : \"1\";\n    while (month.length < 2) {\n        month = \"0\" + month;\n    }\n    var day = state.tmp.date_object[\"day\" + end];\n    day = day ? \"\"+day : \"1\";\n    while (day.length < 2) {\n        day = \"0\" + day;\n    }\n    var date = parseInt(num + month + day, 10);\n    var label;\n    var offset;\n    if (date >= 18680908 && date < 19120730) {\n        label = '\\u660e\\u6cbb';\n        offset = 1867;\n    } else if (date >= 19120730 && date < 19261225) {\n        label = '\\u5927\\u6b63';\n        offset = 1911;\n    } else if (date >= 19261225 && date < 19890108) {\n        label = '\\u662d\\u548c';\n        offset = 1925;\n    } else if (date >= 19890108) {\n        label = '\\u5e73\\u6210';\n        offset = 1988;\n    }\n    // This entire \"imperial\" code block should be cut. Scraped input\n    // for this will be too ratty to be useful anyway.\n    if (label && offset) {\n        var normalizedKey = label;\n        if (state.sys.normalizeAbbrevsKey) {\n            // The first argument does not need to specify the exact variable\n            // name.\n            normalizedKey = state.sys.normalizeAbbrevsKey(\"number\", label);\n        }\n        if (!state.transform.abbrevs['default']['number'][normalizedKey]) {\n            // loadAbbreviation normally takes an item as fourth argument.\n            // It is not available here, \n            state.transform.loadAbbreviation('default', \"number\", normalizedKey, null);\n        }\n        if (state.transform.abbrevs['default']['number'][normalizedKey]) {\n            label = state.transform.abbrevs['default']['number'][normalizedKey];\n        }\n        year = label + (num - offset);\n    }\n    return year;\n};\n\n/**\n * Convert year to short form\n * <p>Just crops any 4-digit year to the last two digits.</p>\n */\nCSL.Util.Dates.year[\"short\"] = function (state, num) {\n    num = num.toString();\n    if (num && num.length === 4) {\n        return num.substr(2);\n    }\n};\n\n\n/**\n * Convert year to short form\n * <p>Just crops any 4-digit year to the last two digits.</p>\n */\nCSL.Util.Dates.year.numeric = function (state, num) {\n    var m, pre;\n    num = \"\" + num;\n    var m = num.match(/([0-9]*)$/);\n    if (m) {\n        pre = num.slice(0, m[1].length * -1);\n        num = m[1];\n    } else {\n        pre = num;\n        num = \"\";\n    }\n    while (num.length < 4) {\n        num = \"0\" + num;\n    }\n    return (pre + num);\n};\n\n\n/*\n * MONTH manglers\n * normalize\n * long, short, numeric, numeric-leading-zeros\n */\nCSL.Util.Dates.normalizeMonth = function (num, useSeason) {\n    var ret;\n    if (!num) {\n        num = 0;\n    }\n    num = \"\" + num;\n    if (!num.match(/^[0-9]+$/)) {\n        num = 0;\n    }\n    num = parseInt(num, 10);\n    if (useSeason) {\n        var res = {stub: \"month-\", num: num};\n        if (res.num < 1 || res.num > 24) {\n            res.num = 0;\n        } else {\n            while (res.num > 16) {\n                res.num = res.num - 4;\n            }\n            if (res.num > 12) {\n                res.stub = \"season-\";\n                res.num = res.num - 12;\n            }\n        }\n        ret = res;\n    } else {\n        if (num < 1 || num > 12) {\n            num = 0;\n        }\n        ret = num;\n    }\n    return ret;\n};\n\nCSL.Util.Dates.month = {};\n\n/**\n * Convert month to numeric form\n * <p>This just passes the number back as a string.</p>\n */\nCSL.Util.Dates.month.numeric = function (state, num) {\n    var num = CSL.Util.Dates.normalizeMonth(num);\n    if (!num) {\n        num = \"\";\n    }\n    return num;\n};\n\n/**\n * Convert month to numeric-leading-zeros form\n * <p>This just passes the number back as string padded with zeros.</p>\n */\nCSL.Util.Dates.month[\"numeric-leading-zeros\"] = function (state, num) {\n    var num = CSL.Util.Dates.normalizeMonth(num);\n    if (!num) {\n        num = \"\";\n    } else {\n        num = \"\" + num;\n        while (num.length < 2) {\n            num = \"0\" + num;\n        }\n    }\n    return num;\n};\n\n/**\n * Convert month to long form\n * <p>This passes back the month of the locale in long form.</p>\n */\n\n// Gender is not currently used. Is it needed?\n\nCSL.Util.Dates.month[\"long\"] = function (state, num, gender, forceDefaultLocale) {\n    var res = CSL.Util.Dates.normalizeMonth(num, true);\n    var num = res.num;\n    if (!num) {\n        num = \"\";\n    } else {\n        num = \"\" + num;\n        while (num.length < 2) {\n            num = \"0\" + num;\n        }\n        num = state.getTerm(res.stub + num, \"long\", 0, 0, false, forceDefaultLocale);\n    }\n    return num;\n};\n\n/**\n * Convert month to long form\n * <p>This passes back the month of the locale in short form.</p>\n */\n\n// See above.\n\nCSL.Util.Dates.month[\"short\"] = function (state, num, gender, forceDefaultLocale) {\n    var res = CSL.Util.Dates.normalizeMonth(num, true);\n    var num = res.num;\n    if (!num) {\n        num = \"\";\n    } else {\n        num = \"\" + num;\n        while (num.length < 2) {\n            num = \"0\" + num;\n        }\n        num = state.getTerm(res.stub + num, \"short\", 0, 0, false, forceDefaultLocale);\n    }\n    return num;\n};\n\n/*\n * DAY manglers\n * numeric, numeric-leading-zeros, ordinal\n */\nCSL.Util.Dates.day = {};\n\n/**\n * Convert day to numeric form\n * <p>This just passes the number back as a string.</p>\n */\nCSL.Util.Dates.day.numeric = function (state, num) {\n    return num.toString();\n};\n\nCSL.Util.Dates.day[\"long\"] = CSL.Util.Dates.day.numeric;\n\n/**\n * Convert day to numeric-leading-zeros form\n * <p>This just passes the number back as a string padded with zeros.</p>\n */\nCSL.Util.Dates.day[\"numeric-leading-zeros\"] = function (state, num) {\n    if (!num) {\n        num = 0;\n    }\n    num = num.toString();\n    while (num.length < 2) {\n        num = \"0\" + num;\n    }\n    return num.toString();\n};\n\n/**\n * Convert day to ordinal form\n * <p>This will one day pass back the number as a string with the\n * ordinal suffix appropriate to the locale.  For the present,\n * it just does what is most of the time right for English.</p>\n */\nCSL.Util.Dates.day.ordinal = function (state, num, gender) {\n    return state.fun.ordinalizer.format(num, gender);\n};\n\n/*global CSL: true */\n\n/**\n * Helper functions for constructing sort keys.\n * @namespace Sort key utilities\n */\nCSL.Util.Sort = {};\n\n/**\n * Strip prepositions from a string\n * <p>Used when generating sort keys.</p>\n */\nCSL.Util.Sort.strip_prepositions = function (str) {\n    var m;\n    if (\"string\" === typeof str) {\n        m = str.match(/^(([aA]|[aA][nN]|[tT][hH][eE])\\s+)/);\n    }\n    if (m) {\n        str = str.substr(m[1].length);\n    }\n    return str;\n};\n\n/*global CSL: true */\n\nCSL.Util.substituteStart = function (state, target) {\n    var element_trace, display, bib_first, func, choose_start, if_start, nodetypes;\n    func = function (state, Item, item) {\n        for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n            if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                state.tmp.strip_periods += 1;\n                break;\n            }\n        }\n    };\n    this.execs.push(func);\n    if (this.decorations && state.opt.development_extensions.csl_reverse_lookup_support) {\n        this.decorations.reverse();\n        this.decorations.push([\"@showid\",\"true\", this.cslid]);\n        this.decorations.reverse();\n    }\n    //\n    // Contains body code for both substitute and first-field/remaining-fields\n    // formatting.\n    //\n\n    nodetypes = [\"number\", \"date\", \"names\"];\n    if ((\"text\" === this.name && !this.postponed_macro) || nodetypes.indexOf(this.name) > -1) {\n        element_trace = function (state, Item, item) {\n            if (state.tmp.element_trace.value() === \"author\" || \"names\" === this.name) {\n                if (!state.tmp.just_looking && item && item[\"author-only\"] && state.tmp.area !== \"intext\") {\n                    if (!state.tmp.probably_rendered_something) {\n                    } else {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n                if (!state.tmp.just_looking && item && item[\"suppress-author\"]) {\n                    if (!state.tmp.probably_rendered_something) {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n            }\n            else if (\"date\" === this.name) {\n                if (!state.tmp.just_looking && item && item[\"author-only\"] && state.tmp.area !== \"intext\") {\n                    if (state.tmp.probably_rendered_something) {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n                /*\n                if (!state.tmp.just_looking && item && item[\"suppress-author\"]) {\n                    if (state.tmp.probably_rendered_something) {\n                        //state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n                */\n            } else {\n                if (!state.tmp.just_looking && item && item[\"author-only\"] && state.tmp.area !== \"intext\") {\n                    // XXX can_block_substitute probably is doing nothing here. The value is always true.\n                    if (!state.tmp.probably_rendered_something && state.tmp.can_block_substitute) {\n                    } else {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                } else if (item && item[\"suppress-author\"]) {\n                    state.tmp.element_trace.push(\"do-not-suppress-me\");\n                }\n            }\n        };\n        this.execs.push(element_trace);\n    }\n    display = this.strings.cls;\n    this.strings.cls = false;\n    if (state.build.render_nesting_level === 0) {\n        //\n        // The markup formerly known as @bibliography/first\n        //\n        // Separate second-field-align from the generic display logic.\n        // There will be some code replication, but not in the\n        // assembled style.\n        //\n        if (state.build.area === \"bibliography\" && state.bibliography.opt[\"second-field-align\"]) {\n            bib_first = new CSL.Token(\"group\", CSL.START);\n            bib_first.decorations = [[\"@display\", \"left-margin\"]];\n            func = function (state, Item) {\n                if (!state.tmp.render_seen) {\n                    bib_first.strings.first_blob = Item.id;\n                    state.output.startTag(\"bib_first\", bib_first);\n                }\n            };\n            bib_first.execs.push(func);\n            target.push(bib_first);\n        } else if (CSL.DISPLAY_CLASSES.indexOf(display) > -1) {\n            bib_first = new CSL.Token(\"group\", CSL.START);\n            bib_first.decorations = [[\"@display\", display]];\n            func = function (state, Item) {\n                bib_first.strings.first_blob = Item.id;\n                state.output.startTag(\"bib_first\", bib_first);\n            };\n            bib_first.execs.push(func);\n            target.push(bib_first);\n        }\n        state.build.cls = display;\n    }\n    state.build.render_nesting_level += 1;\n    // Should this be render_nesting_level, with the increment\n    // below? ... ?\n    if (state.build.substitute_level.value() === 1) {\n        //\n        // All top-level elements in a substitute environment get\n        // wrapped in conditionals.  The substitute_level variable\n        // is a stack, because spanned names elements (with their\n        // own substitute environments) can be nested inside\n        // a substitute environment.\n        //\n        // (okay, we use conditionals a lot more than that.\n        // we slot them in for author-only as well...)\n        choose_start = new CSL.Token(\"choose\", CSL.START);\n        CSL.Node.choose.build.call(choose_start, state, target);\n        if_start = new CSL.Token(\"if\", CSL.START);\n        //\n        // Set a test of the shadow if token to skip this\n        // macro if we have acquired a name value.\n\n        // check for variable\n        func = function () {\n            if (state.tmp.can_substitute.value()) {\n                return true;\n            }\n            return false;\n        };\n        if_start.tests ? {} : if_start.tests = [];\n        if_start.tests.push(func);\n        if_start.test = state.fun.match.any(this, state, if_start.tests);\n        target.push(if_start);\n    }\n\n    if (state.sys.variableWrapper\n        && this.variables_real\n        && this.variables_real.length) {\n\n        func = function (state, Item, item) {\n            if (!state.tmp.just_looking && !state.tmp.suppress_decorations) {\n                // Attach item data and variable names.\n                // Do with them what you will.\n                var variable_entry = new CSL.Token(\"text\", CSL.START);\n                variable_entry.decorations = [[\"@showid\", \"true\"]];\n                state.output.startTag(\"variable_entry\", variable_entry);\n                var position = null;\n                if (item) {\n                    position = item.position;\n                }\n                if (!position) {\n                    position = 0;\n                }\n                var positionMap = [\n                    \"first\",\n                    \"container-subsequent\",\n                    \"subsequent\",\n                    \"ibid\",\n                    \"ibid-with-locator\"\n                ];\n                var noteNumber = 0;\n                if (item && item.noteIndex) {\n                    noteNumber = item.noteIndex;\n                }\n                var firstReferenceNoteNumber = 0;\n                if (item && item['first-reference-note-number']) {\n                    firstReferenceNoteNumber = item['first-reference-note-number'];\n                }\n                var firstContainerReferenceNoteNumber = 0;\n                if (item && item['first-container-reference-note-number']) {\n                    firstContainerReferenceNoteNumber = item['first-container-reference-note-number'];\n                }\n                var citationNumber = 0;\n                // XXX Will this EVER happen?\n                if (item && item['citation-number']) {\n                    citationNumber = item['citation-number'];\n                }\n                var index = 0;\n                if (item && item.index) {\n                    index = item.index;\n                }\n                var params = {\n                    itemData: Item,\n                    variableNames: this.variables,\n                    context: state.tmp.area,\n                    xclass: state.opt.xclass,\n                    position: positionMap[position],\n                    \"note-number\": noteNumber,\n                    \"first-reference-note-number\": firstReferenceNoteNumber,\n                    \"first-container-reference-note-number\": firstContainerReferenceNoteNumber,\n                    \"citation-number\": citationNumber,\n                    \"index\": index,\n                    \"mode\": state.opt.mode\n                };\n                state.output.current.value().params = params;\n            }\n        };\n        this.execs.push(func);\n    }\n};\n\n\nCSL.Util.substituteEnd = function (state, target) {\n    var func, bib_first_end, bib_other, if_end, choose_end, author_substitute, str;\n\n    if (state.sys.variableWrapper\n        && (this.hasVariable || (this.variables_real && this.variables_real.length))) {\n        \n        func = function (state) {\n            if (!state.tmp.just_looking && !state.tmp.suppress_decorations) {\n                state.output.endTag(\"variable_entry\");\n            }\n        };\n        this.execs.push(func);\n    }\n\n    func = function (state) {\n        for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n            if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                state.tmp.strip_periods += -1;\n                break;\n            }\n        }\n    };\n    this.execs.push(func);\n\n    state.build.render_nesting_level += -1;\n    if (state.build.render_nesting_level === 0) {\n        if (state.build.cls) {\n            func = function (state) {\n                state.output.endTag(\"bib_first\");\n            };\n            this.execs.push(func);\n            state.build.cls = false;\n        } else if (state.build.area === \"bibliography\" && state.bibliography.opt[\"second-field-align\"]) {\n            bib_first_end = new CSL.Token(\"group\", CSL.END);\n            // first func end\n            func = function (state) {\n                if (!state.tmp.render_seen) {\n                    state.output.endTag(\"bib_first\"); // closes bib_first\n                }\n            };\n            bib_first_end.execs.push(func);\n            target.push(bib_first_end);\n            bib_other = new CSL.Token(\"group\", CSL.START);\n            bib_other.decorations = [[\"@display\", \"right-inline\"]];\n            func = function (state) {\n                if (!state.tmp.render_seen) {\n                    state.tmp.render_seen = true;\n                    state.output.startTag(\"bib_other\", bib_other);\n                }\n            };\n            bib_other.execs.push(func);\n            target.push(bib_other);\n        }\n    }\n    if (state.build.substitute_level.value() === 1) {\n        if_end = new CSL.Token(\"if\", CSL.END);\n        target.push(if_end);\n        choose_end = new CSL.Token(\"choose\", CSL.END);\n        CSL.Node.choose.build.call(choose_end, state, target);\n    }\n\n    if (\"names\" === this.name || (\"text\" === this.name && this.variables_real !== \"title\")) {\n        author_substitute = new CSL.Token(\"text\", CSL.SINGLETON);\n        var substitution_name = this.name;\n        func = function (state, Item) {\n            if (state.tmp.area !== \"bibliography\") {\n                return;\n            }\n            if (\"string\" !== typeof state.bibliography.opt[\"subsequent-author-substitute\"]) {\n                return;\n            }\n            if (this.variables_real && !Item[this.variables_real]) {\n                return;\n            }\n            // The logic of these two is not obvious. The effect is to enable placeholder substitution\n            // on a text macro name substitution, without printing both the text macro AND the placeholder.\n            // See https://forums.zotero.org/discussion/comment/350407\n            if (this.variables_real && substitution_name === \"names\") {\n                return;\n            }\n\n            var subrule = state.bibliography.opt[\"subsequent-author-substitute-rule\"];\n            var i, ilen;\n            //var text_esc = CSL.getSafeEscape(state);\n            var printing = !state.tmp.suppress_decorations;\n            if (printing && state.tmp.subsequent_author_substitute_ok) {\n                if (state.tmp.rendered_name) {\n                    if (\"partial-each\" === subrule || \"partial-first\" === subrule) {\n                        var dosub = true;\n                        var rendered_name = [];\n                        // This is a wee bit risky, as we're assuming that the name\n                        // children and the list of stringified names are congruent.\n                        // That *should* always be true, but you never know.\n                        for (i = 0, ilen = state.tmp.name_node.children.length; i < ilen; i += 1) {\n                            var name = state.tmp.rendered_name[i];\n                            if (dosub\n                                && state.tmp.last_rendered_name && state.tmp.last_rendered_name.length > (i - 1)\n                                && name && !name.localeCompare(state.tmp.last_rendered_name[i])) {\n                                str = new CSL.Blob(state[state.tmp.area].opt[\"subsequent-author-substitute\"]);\n                                state.tmp.name_node.children[i].blobs = [str];\n                                if (\"partial-first\" === subrule) {\n                                    dosub = false;\n                                }\n                            } else {\n                                dosub = false;\n                            }\n                            rendered_name.push(name);\n                        }\n                        // might want to slice this?\n                        state.tmp.last_rendered_name = rendered_name;\n                    } else if (\"complete-each\" === subrule) {\n                        var rendered_name = state.tmp.rendered_name.join(\",\");\n                        if (rendered_name) {\n                            if (state.tmp.last_rendered_name && !rendered_name.localeCompare(state.tmp.last_rendered_name)) {\n                                for (i = 0, ilen = state.tmp.name_node.children.length; i < ilen; i += 1) {\n                                    str = new CSL.Blob(state[state.tmp.area].opt[\"subsequent-author-substitute\"]);\n                                    state.tmp.name_node.children[i].blobs = [str];\n                                }\n                            }\n                            state.tmp.last_rendered_name = rendered_name;\n                        }\n                    } else {\n                        var rendered_name = state.tmp.rendered_name.join(\",\");\n                        if (rendered_name) {\n                            if (state.tmp.last_rendered_name && !rendered_name.localeCompare(state.tmp.last_rendered_name)) {\n                                str = new CSL.Blob(state[state.tmp.area].opt[\"subsequent-author-substitute\"]);\n                                if (state.tmp.label_blob) {\n                                    state.tmp.name_node.top.blobs = [str,state.tmp.label_blob];\n                                } else if (state.tmp.name_node.top.blobs.length) {\n                                    state.tmp.name_node.top.blobs[0].blobs = [str];\n                                } else {\n                                    state.tmp.name_node.top.blobs = [str];\n                                }\n                                state.tmp.substituted_variable = substitution_name;\n                            }\n                            state.tmp.last_rendered_name = rendered_name;\n                        }\n                    }\n                    state.tmp.subsequent_author_substitute_ok = false;\n                }\n            }\n        };\n        this.execs.push(func);\n    }\n\n    if ((\"text\" === this.name && !this.postponed_macro) || [\"number\", \"date\", \"names\"].indexOf(this.name) > -1) {\n        // element trace\n        func = function (state, Item) {\n            // element_trace is a mess, but it's trying to do something simple.\n            // A queue append is done, and element_trace.value() returns \"suppress-me\"\n            // the append is aborted. That's it.\n            // It seems only to be used on numeric elements of numeric styles ATM.\n            // If used only for that purpose, it could be greatly simplified.\n            // If cleaned up, it could do more interesting things, like control\n            // the suppression of names set later than first position.\n            if (state.tmp.element_trace.mystack.length>1) {\n                state.tmp.element_trace.pop();\n            }\n        };\n        this.execs.push(func);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Util.padding = function (num) {\n    var m = num.match(/\\s*(-{0,1}[0-9]+)/);\n    if (m) {\n        num = parseInt(m[1], 10);\n        if (num < 0) {\n            num = 99999999999999999999 + num;\n        }\n        num = \"\" + num;\n        while (num.length < 20) {\n            num = \"0\" + num;\n        }\n    }\n    return num;\n};\n\nCSL.Util.LongOrdinalizer = function () {};\n\nCSL.Util.LongOrdinalizer.prototype.init = function (state) {\n    this.state = state;\n};\n\nCSL.Util.LongOrdinalizer.prototype.format = function (num, gender) {\n    if (num < 10) {\n        num = \"0\" + num;\n    }\n    // Argument true means \"loose\".\n    var ret = CSL.Engine.getField(\n        CSL.LOOSE, \n        this.state.locale[this.state.opt.lang].terms,\n        \"long-ordinal-\" + num,\n        \"long\", \n        0, \n        gender\n    );\n    if (!ret) {\n        ret = this.state.fun.ordinalizer.format(num, gender);\n    }\n    // Probably too optimistic -- what if only renders in _sort?\n    this.state.tmp.cite_renders_content = true;\n    return ret;\n};\n\n\nCSL.Util.Ordinalizer = function (state) {\n    this.state = state;\n    this.suffixes = {};\n};\n\nCSL.Util.Ordinalizer.prototype.init = function () {\n    if (!this.suffixes[this.state.opt.lang]) {\n        this.suffixes[this.state.opt.lang] = {};\n        for (var i = 0, ilen = 3; i < ilen; i += 1) {\n            var gender = [undefined, \"masculine\", \"feminine\"][i];\n            this.suffixes[this.state.opt.lang][gender] = [];\n            for (var j = 1; j < 5; j += 1) {\n                var ordinal = this.state.getTerm(\"ordinal-0\" + j, \"long\", false, gender);\n                if (\"undefined\" === typeof ordinal) {\n                    delete this.suffixes[this.state.opt.lang][gender];\n                    break;\n                }\n                this.suffixes[this.state.opt.lang][gender].push(ordinal);\n            }\n        }\n    }\n};\n\nCSL.Util.Ordinalizer.prototype.format = function (num, gender) {\n    var str;\n    num = parseInt(num, 10);\n    str = \"\" + num;\n    var suffix = \"\";\n    var trygenders = [];\n    if (gender) {\n        trygenders.push(gender);\n    }\n    trygenders.push(\"neuter\");\n    if (this.state.locale[this.state.opt.lang].ord[\"1.0.1\"]) {\n        suffix = this.state.getTerm(\"ordinal\",false,0,gender);\n        var trygender;\n        for (var i = 0, ilen = trygenders.length; i < ilen; i += 1) {\n            trygender = trygenders[i];\n            var ordinfo = this.state.locale[this.state.opt.lang].ord[\"1.0.1\"];\n            if (ordinfo[\"whole-number\"][str] && ordinfo[\"whole-number\"][str][trygender]) {\n                suffix = this.state.getTerm(this.state.locale[this.state.opt.lang].ord[\"1.0.1\"][\"whole-number\"][str][trygender],false,0,gender);\n            } else if (ordinfo[\"last-two-digits\"][str.slice(str.length - 2)] && ordinfo[\"last-two-digits\"][str.slice(str.length - 2)][trygender]) {\n                suffix = this.state.getTerm(this.state.locale[this.state.opt.lang].ord[\"1.0.1\"][\"last-two-digits\"][str.slice(str.length - 2)][trygender],false,0,gender);\n            } else if (ordinfo[\"last-digit\"][str.slice(str.length - 1)] && ordinfo[\"last-digit\"][str.slice(str.length - 1)][trygender]) {\n                suffix = this.state.getTerm(this.state.locale[this.state.opt.lang].ord[\"1.0.1\"][\"last-digit\"][str.slice(str.length - 1)][trygender],false,0,gender);\n            }\n            if (suffix) {\n                break;\n            }\n        }\n    } else {\n        if (!gender) {\n            // XXX hack to prevent crash on CSL 1.0 styles.\n            // Reported by Carles.\n            gender = undefined;\n        }\n        this.state.fun.ordinalizer.init();\n        if ((num / 10) % 10 === 1 || (num > 10 && num < 20)) {\n            suffix = this.suffixes[this.state.opt.lang][gender][3];\n        } else if (num % 10 === 1 && num % 100 !== 11) {\n            suffix = this.suffixes[this.state.opt.lang][gender][0];\n        } else if (num % 10 === 2 && num % 100 !== 12) {\n            suffix = this.suffixes[this.state.opt.lang][gender][1];\n        } else if (num % 10 === 3 && num % 100 !== 13) {\n            suffix = this.suffixes[this.state.opt.lang][gender][2];\n        } else {\n            suffix = this.suffixes[this.state.opt.lang][gender][3];\n        }\n    }\n    str = str += suffix;\n    return str;\n};\n\nCSL.Util.Romanizer = function () {};\n\nCSL.Util.Romanizer.prototype.format = function (num) {\n    var ret, pos, n, numstr, len;\n    ret = \"\";\n    if (num < 6000) {\n        numstr = num.toString().split(\"\");\n        numstr.reverse();\n        pos = 0;\n        n = 0;\n        len = numstr.length;\n        for (pos = 0; pos < len; pos += 1) {\n            n = parseInt(numstr[pos], 10);\n            ret = CSL.ROMAN_NUMERALS[pos][n] + ret;\n        }\n    }\n    return ret;\n};\n\n\n/**\n * Create a suffix formed from a list of arbitrary characters of arbitrary length.\n * <p>This is a <i>lot</i> harder than it seems.</p>\n */\nCSL.Util.Suffixator = function (slist) {\n    if (!slist) {\n        slist = CSL.SUFFIX_CHARS;\n    }\n    this.slist = slist.split(\",\");\n};\n\n/**\n * The format method.\n * <p>This method is used in generating ranges.  Every numeric\n * formatter (of which Suffixator is one) must be an instantiated\n * object with such a \"format\" method.</p>\n */\n\nCSL.Util.Suffixator.prototype.format = function (N) {\n    // Many thanks to Avram Lyon for this code, and good\n    // riddance to the several functions that it replaces.\n    var X;\n    N += 1;\n    var key = \"\";\n    do {\n        X = ((N % 26) === 0) ? 26 : (N % 26);\n        var key = this.slist[X-1] + key;\n        N = (N - X) / 26;\n    } while ( N !== 0 );\n    return key;\n};\n\n\nCSL.Engine.prototype.processNumber = function (node, ItemObject, variable) {\n    //print(\"** processNumber() ItemObject[variable]=\"+ItemObject[variable]);\n    var val;\n\n    var me = this;\n\n    var realVariable = variable;\n    variable = (variable === \"page-first\") ? \"page\" : variable;\n\n    var fullformAnd = \",\\\\s+and\\\\s+|\\\\s+and\\\\s+\";\n    if (this.opt.lang.slice(0, 2) !== \"en\") {\n        fullformAnd += \"|,\\\\s+\" + this.getTerm(\"and\") + \"\\\\s+|\\\\s+\" + this.getTerm(\"and\") + \"\\\\s+\";\n    }\n    var symbolAnd = \"\\\\s*&\\\\s*\";\n    var andRex = new RegExp(\"^\" + symbolAnd+ \"$\");\n    var joinerMatchRex = new RegExp(\"(\" + symbolAnd + \"|\" + fullformAnd + \"|;\\\\s+|,\\\\s+|\\\\s*\\\\\\\\*[\\\\-\\\\u2013]+\\\\s*)\", \"g\");\n    var joinerSplitRex = new RegExp(\"(?:\" + symbolAnd + \"|\" + fullformAnd + \"|;\\\\s+|,\\\\s+|\\\\s*\\\\\\\\*[\\\\-\\\\u2013]+\\\\s*)\");\n\n    // This guesses whether the symbol form is defined or not.\n    // It's the best we can do, because when locales are built, all of the\n    // holes are filled explictly with fallback values: the symbol form is never undefined.\n    var localeAnd = this.getTerm(\"and\");\n    var localeAmpersand = this.getTerm(\"and\", \"symbol\");\n    if (localeAnd === localeAmpersand) {\n        localeAmpersand = \"&\";\n    }\n\n    // XXXX shadow_numbers should carry an array of objects with\n    // XXXX full data for each. The test of a number should be\n    // XXXX a separate function, possibly supported by a splitter\n    // XXXX method also used here. Keep code for each action in one place,\n    // XXXX to prevent debugging from becoming a nightmare.\n\n    // The capture pattern below would apply affixes to all sub-elements,\n    // which is not what we want. Sub-elements should nest within, or\n    // affixes should be edited. The latter is probably easier to handle.\n    \n    // values = [\n    //   {\n    //     label: \"sec.\",\n    //     label-form: \"plural\",\n    //     value: 100,\n    //     styling: [object],\n    //     numeric: true\n    //     joiningSuffix: \" & \",\n    //   },\n    //   {\n    //     label: \"sec.\",\n    //     label-form: \"none\",\n    //     value: 103,\n    //     styling: [object],\n    //     numeric: true,\n    //     joiningSuffix: \"\"\n    //   }\n    // ]\n    \n    function normalizeFieldValue(str) {\n        str = str.trim();\n        var m = str.match(/^([^ ]+)/);\n        if (m && !CSL.STATUTE_SUBDIV_STRINGS[m[1]]) {\n            var embeddedLabel = null;\n            if ([\"locator\", \"locator-extra\", \"page\"].indexOf(variable) > -1) {\n                if (ItemObject.label) {\n                    embeddedLabel = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[ItemObject.label];\n                } else {\n                    embeddedLabel = \"p.\";\n                }\n            } else {\n                embeddedLabel = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[variable];\n            }\n            if (embeddedLabel) {\n                str = embeddedLabel + \" \" + str;\n            }\n        }\n        return str;\n    }\n    \n\n    function composeNumberInfo(origLabel, label, val, joiningSuffix, parsePosition) {\n        joiningSuffix = joiningSuffix ? joiningSuffix : \"\";\n        var info = {};\n\n        if (!label && !CSL.STATUTE_SUBDIV_STRINGS_REVERSE[variable]) {\n            label = \"var:\"+ variable;\n        }\n\n        if (label) {\n            var m = label.match(/(\\s*)([^\\s]+)(\\s*)/);\n            if (realVariable === \"page\" && parsePosition === 0 && [\"p.\", \"pp.\"].indexOf(m[2]) === -1) {\n                info.gotosleepability = true;\n                info.labelVisibility = true;\n            } else {\n                info.labelVisibility = false;\n            }\n            info.label = m[2];\n            info.origLabel = origLabel;\n            info.labelSuffix = m[3] ? m[3] : \"\";\n            info.plural = 0;\n        }\n        \n        var m = val.match(/^([0-9]*[a-zA-Z]+0*)?([0-9]+(?:[a-zA-Z]*|[-,a-zA-Z]+))$/);\n        //var m = val.match(/^([0-9]*[a-zA-Z]0*)([0-9]+(?:[a-zA-Z]*|[-,a-zA-Z]+))$/);\n        if (m) {\n            info.particle = m[1] ? m[1] : \"\";\n            info.value = m[2];\n        } else {\n            info.particle = \"\";\n            info.value = val;\n        }\n        info.joiningSuffix = joiningSuffix.replace(/\\s*-\\s*/, \"-\");\n        return info;\n    }\n\n    function fixupSubsections(elems) {\n        // This catches things like p. 12a-c, recombining content to yield\n        // numeric true despite the hyphen.\n        for (var i=elems.length-2;i>-1;i-=2) {\n            if (elems[i] === \"-\"\n               && elems[i-1].match(/^(?:(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z])\\.  *)*[0-9]+[,a-zA-Z]+$/)\n               && elems[i+1].match(/^[,a-zA-Z]+$/)) {\n                elems[i-1] = elems.slice(i-1,i+2).join(\"\");\n                elems = elems.slice(0,i).concat(elems.slice(i+2));\n            }\n        }\n        return elems;\n    }\n\n    function parseString(str, defaultLabel) {\n        defaultLabel = defaultLabel ? defaultLabel : \"\";\n        \n        str = normalizeFieldValue(str, defaultLabel);\n\n        var jmrex, jsrex, mystr;\n        if (\"page\" === variable) {\n            if (str.indexOf(\"\\u2013\") > -1) {\n                str = str.replace(/\\u2013/g, \"-\");\n            }\n        }\n        if (str.indexOf(\"\\\\-\") > -1) {\n            jmrex = new RegExp(joinerMatchRex.source.replace(\"\\\\-\", \"\"));\n            jsrex = new RegExp(joinerSplitRex.source.replace(\"\\\\-\", \"\"));\n            var lst = str.split(\"\\\\-\");\n            for (var i=0,ilen=lst.length;i<ilen;i++) {\n                lst[i] = lst[i].replace(/\\-/g, \"\\u2013\");\n            }\n            mystr = lst.join(\"\\\\-\");\n            mystr = mystr.replace(/\\\\/g, \"\");\n        } else {\n            jmrex = joinerMatchRex;\n            jsrex = joinerSplitRex;\n            mystr = str;\n        }\n        // jmrex = joinerMatchRex;\n        // jsrex = joinerSplitRex;\n        \n        // Split chunks and collate delimiters.\n        var elems = [];\n        var m = mystr.match(jmrex);\n        if (m) {\n            var lst = mystr.split(jsrex);\n            for (var i=0, ilen=m.length; i<ilen; i++) {\n                if (m[i].match(andRex)) {\n                    if (lst[i].match(/[a-zA-Z]$/) && lst[i].match(/^[a-zA-Z]/)) {\n                        m[i] = localeAmpersand;\n                    } else {\n                        m[i] = \" \" + localeAmpersand + \" \";\n                    }\n                }\n            }\n            var recombine = false;\n            for (var i in lst) {\n                if ((\"\" + lst[i]).replace(/^[a-z]\\.\\s+/, \"\").match(/[^\\s0-9ivxlcmIVXLCM]/)) {\n                    //recombine = true;\n                    break;\n                }\n            }\n            if (recombine) {\n                elems = [mystr];\n            } else {\n                for (var i=0,ilen=lst.length-1; i<ilen; i++) {\n                    elems.push(lst[i]);\n                    elems.push(m[i]);\n                }\n                elems.push(lst[lst.length-1]);\n                //print(\"ELEMS: \"+elems);\n                elems = fixupSubsections(elems);\n                //print(\"  fixup: \"+elems);\n            }\n        } else {\n            var elems = [mystr];\n        }\n        // Split elements within each chunk build list of value objects.\n        var values = [];\n        var label = defaultLabel;\n        var origLabel = \"\";\n        for (var i=0,ilen=elems.length;i<ilen;i += 2) {\n            \n            // AHA! HERE'S THE CULPRIT!!!\n            // Words up to four characters are treated as honorary short-form labels.\n            // Some valid labels are longer than four chars, so we stir those in explicitly\n            \n            var m = elems[i].match(/((?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\\.| ) *)/g);\n            if (m) {\n                var lst = elems[i].split(/(?:(?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\\.| ) *)/);\n                // Head off disaster by merging parsed labels on non-numeric values into content\n                for (var j=lst.length-1;j>0;j--) {\n                    if (lst[j-1] && (!lst[j].match(/^[0-9]+([-;,:a-zA-Z]*)$/) || !lst[j-1].match(/^[0-9]+([-;,:a-zA-Z]*)$/))) {\n                        lst[j-1] = lst[j-1] + m[j-1] + lst[j];\n                        lst = lst.slice(0,j).concat(lst.slice(j+1));\n                        m = m.slice(0,j-1).concat(m.slice(j));\n                    }\n                }\n                // merge bad leading label into content\n                if (m.length > 0) {\n                    var slug = m[0].trim();\n                    var notAlabel = !CSL.STATUTE_SUBDIV_STRINGS[slug]\n                        || \"undefined\" === typeof me.getTerm(CSL.STATUTE_SUBDIV_STRINGS[slug])\n                        || ([\"locator\", \"number\", \"locator-extra\", \"page\"].indexOf(variable) === -1 && CSL.STATUTE_SUBDIV_STRINGS[slug] !== variable);\n                    if (notAlabel) {\n                        if (i === 0) {\n                            m = m.slice(1);\n                            lst[0] = lst[0] + \" \" + slug + \" \" + lst[1];\n                            lst = lst.slice(0,1).concat(lst.slice(2));\n                        }\n                    } else {\n                        origLabel = slug;\n                    }\n                }\n\n                for (var j=0,jlen=lst.length; j<jlen; j++) {\n                    if (lst[j] || j === (lst.length-1)) {\n                        var filteredOrigLabel;\n                        label = m[j-1] ? m[j-1] : label;\n                        if (origLabel === label.trim()) {\n                            filteredOrigLabel = \"\";\n                        } else {\n                            filteredOrigLabel = origLabel;\n                        }\n                        //var origLabel = j > 1 ? m[j-1] : \"\";\n                        mystr = lst[j] ? lst[j].trim() : \"\";\n                        if (j === (lst.length-1)) {\n                            values.push(composeNumberInfo(filteredOrigLabel, label, mystr, elems[i+1], i));\n                        } else {\n                            values.push(composeNumberInfo(filteredOrigLabel, label, mystr, null, i));\n                        }\n                    }\n                }\n            } else {\n                var filteredOrigLabel;\n                if (origLabel === label.trim()) {\n                    filteredOrigLabel = \"\";\n                } else {\n                    filteredOrigLabel = origLabel;\n                }\n                values.push(composeNumberInfo(filteredOrigLabel, label, elems[i], elems[i+1]));\n            }\n        }\n        return values;\n    }\n\n    function setSpaces(values) {\n        // Add space joins (is this really right?)\n        for (var i=0,ilen=values.length-1;i<ilen;i++) {\n            if (!values[i].joiningSuffix && values[i+1].label) {\n                values[i].joiningSuffix = \" \";\n            }\n        }\n    }\n\n    function fixNumericAndCount(values, i, currentLabelInfo) {\n        var master = values[currentLabelInfo.pos];\n        var val = values[i].value;\n        var isEscapedHyphen = master.joiningSuffix === \"\\\\-\";\n        if (val.particle && val.particle !== master.particle) {\n            currentLabelInfo.collapsible = false;\n        }\n        var mVal = val.match(/^[0-9]+([-,:a-zA-Z]*)$/);\n        var mCurrentLabel = master.value.match(/^(?:[0-9]+|[ixv]+)([-,:a-zA-Z]*|\\-[\\-0-9]+)$/);\n        if (!val || !mVal || !mCurrentLabel || isEscapedHyphen) {\n            currentLabelInfo.collapsible = false;\n            if (!val || !mCurrentLabel) {\n                currentLabelInfo.numeric = false;\n            }\n            if (isEscapedHyphen) {\n                currentLabelInfo.count--;\n            }\n        }\n        if ((mVal && mVal[1]) || (mCurrentLabel && mCurrentLabel[1])) {\n            currentLabelInfo.collapsible = false;\n        }\n        if (undefined === values[i].collapsible) {\n            for (var j=i,jlen=i+currentLabelInfo.count;j<jlen;j++) {\n                if (isNaN(parseInt(values[j].value)) && !values[j].value.match(/^[ivxlcmIVXLCM]+$/)) {\n                    values[j].collapsible = false;\n                } else {\n                    values[j].collapsible = true;\n                }\n            }\n            currentLabelInfo.collapsible = values[i].collapsible;\n        }\n        var isCollapsible = currentLabelInfo.collapsible;\n        for (var j=currentLabelInfo.pos,jlen=(currentLabelInfo.pos + currentLabelInfo.count); j<jlen; j++) {\n            if (currentLabelInfo.count > 1 && isCollapsible) {\n                values[j].plural = 1;\n            }\n            values[j].numeric = currentLabelInfo.numeric;\n            values[j].collapsible = currentLabelInfo.collapsible;\n        }\n    }\n\n    function fixLabelVisibility(values, groupStartPos, currentLabelInfo) {\n        if (currentLabelInfo.label.slice(0, 4) !== \"var:\") {\n            if (currentLabelInfo.pos === 0) {\n                if ([\"locator\", \"number\", \"locator-extra\", \"page\"].indexOf(variable) > -1) {\n                    // Actually, shouldn't we do this always?\n                    if (\"undefined\" === typeof me.getTerm(CSL.STATUTE_SUBDIV_STRINGS[currentLabelInfo.label])) {\n                        values[currentLabelInfo.pos].labelVisibility = true;\n                    }\n                }\n                // If there is an explicit\n                // label embedded at the start of a field that\n                // does not match the context, it should be\n                // marked for rendering.\n                if ([\"locator\", \"number\", \"locator-extra\", \"page\"].indexOf(variable) === -1) {\n                    if (CSL.STATUTE_SUBDIV_STRINGS[currentLabelInfo.label] !== variable) {\n                        values[0].labelVisibility = true;\n                    }\n                }\n            } else {\n                // Also, mark initial mid-field labels for\n                // rendering.\n                //if (values[i-1].label !== values[i].label && currentLabelInfo.label.slice(0, 4) !== \"var:\") {\n                values[currentLabelInfo.pos].labelVisibility = true;\n                //}\n            }\n        }\n    }\n    \n    function setPluralsAndNumerics(values) {\n        if (values.length === 0) {\n            return;\n        }\n        var groupStartPos = 0;\n        var groupCount = 1;\n        \n        for (var i=1,ilen=values.length;i<ilen;i++) {\n            var lastVal = values[i-1];\n            var thisVal = values[i];\n            if (lastVal.label === thisVal.label && lastVal.particle === lastVal.particle) {\n                groupCount++;\n            } else {\n                var currentLabelInfo = JSON.parse(JSON.stringify(values[groupStartPos]));\n                currentLabelInfo.pos = groupStartPos;\n                currentLabelInfo.count = groupCount;\n                currentLabelInfo.numeric = true;\n                fixNumericAndCount(values, groupStartPos, currentLabelInfo);\n                if (lastVal.label !== thisVal.label) {\n                    fixLabelVisibility(values, groupStartPos, currentLabelInfo);\n                }\n                groupStartPos = i;\n                groupCount = 1;\n            }\n        }\n        // Not sure why this repetition is necessary?\n        var currentLabelInfo = JSON.parse(JSON.stringify(values[groupStartPos]));\n        currentLabelInfo.pos = groupStartPos;\n        currentLabelInfo.count = groupCount;\n        currentLabelInfo.numeric = true;\n        fixNumericAndCount(values, groupStartPos, currentLabelInfo);\n        fixLabelVisibility(values, groupStartPos, currentLabelInfo);\n        if (values.length && values[0].numeric && variable.slice(0, 10) === \"number-of-\") {\n            if (parseInt(ItemObject[realVariable], 10) > 1) {\n                values[0].plural = 1;\n            }\n        }\n    }        \n\n    function stripHyphenBackslash(joiningSuffix) {\n        return joiningSuffix.replace(\"\\\\-\", \"-\");\n    }\n\n    function setStyling(values) {\n        var masterNode = CSL.Util.cloneToken(node);\n        var masterStyling = new CSL.Token();\n        if (!me.tmp.just_looking) {\n            // Per discussion @ https://discourse.citationstyles.org/t/formatting-attributes-and-hyphen/1518\n            masterStyling.decorations = masterNode.decorations;\n            masterNode.decorations = [];\n            //for (var j=masterNode.decorations.length-1;j>-1;j--) {\n            //    if (masterNode.decorations[j][0] === \"@quotes\") {\n            //        // Add to styling\n            //        masterStyling.decorations = masterStyling.decorations.concat(masterNode.decorations.slice(j, j+1));\n            //        // Remove from node\n            //        masterNode.decorations = masterNode.decorations.slice(0, j).concat(masterNode.decorations.slice(j+1));\n            //    }\n            //}\n            masterStyling.strings.prefix = masterNode.strings.prefix;\n            masterNode.strings.prefix = \"\";\n            masterStyling.strings.suffix = masterNode.strings.suffix;\n            masterNode.strings.suffix = \"\";\n        }\n        var masterLabel = values.length ? values[0].label : null;\n        if (values.length) {\n            for (var i=0,ilen=values.length; i<ilen; i++) {\n                var val = values[i];\n                // Clone node, make styling parameters on each instance sane.\n                var newnode = CSL.Util.cloneToken(masterNode);\n                newnode.gender = node.gender;\n                if (masterLabel === val.label) {\n                    newnode.formatter = node.formatter;\n                }\n                if (val.numeric) {\n                    newnode.successor_prefix = val.successor_prefix;\n                }\n                newnode.strings.suffix = newnode.strings.suffix + stripHyphenBackslash(val.joiningSuffix);\n                val.styling = newnode;\n            }\n            if (!me.tmp.just_looking) {\n                if (values[0].value.slice(0,1) === \"\\\"\" && values[values.length-1].value.slice(-1) === \"\\\"\") {\n                    values[0].value = values[0].value.slice(1);\n                    values[values.length-1].value = values[values.length-1].value.slice(0,-1);\n                    masterStyling.decorations.push([\"@quotes\", true]);\n                }\n            }\n        }\n        return masterStyling;\n    }\n\n    function checkTerm(variable, val) {\n        var ret = true;\n        if ([\"locator\", \"locator-extra\", \"page\"].indexOf(variable) > -1) {\n            var label;\n            if (val.origLabel) {\n                label = val.origLabel;\n            } else {\n                label = val.label;\n            }\n            ret = !!me.getTerm(CSL.STATUTE_SUBDIV_STRINGS[label]);\n        }\n        return ret;\n    }\n\n    function checkPage(variable, val) {\n        return \"page\" === variable\n            || ([\"locator\", \"locator-extra\"].indexOf(variable) > -1 && ([\"p.\"].indexOf(val.label) > -1 || [\"p.\"].indexOf(val.origLabel) > -1));\n    }\n    \n    function fixupRangeDelimiter(variable, val, rangeDelimiter, isNumeric) {\n        var isPage = checkPage(variable, val);\n        var hasTerm = checkTerm(variable, val);\n        if (hasTerm && rangeDelimiter === \"-\") {\n            if (isNumeric) {\n                if (isPage || [\"locator\", \"locator-extra\", \"issue\", \"volume\", \"edition\", \"number\"].indexOf(variable) > -1) {\n                    rangeDelimiter = me.getTerm(\"page-range-delimiter\");\n                    if (!rangeDelimiter) {\n                        rangeDelimiter = \"\\u2013\";\n                    }\n                }\n                if (variable === \"collection-number\") {\n                    rangeDelimiter = me.getTerm(\"year-range-delimiter\");\n                    if (!rangeDelimiter) {\n                        rangeDelimiter = \"\\u2013\";\n                    }\n                }\n            }\n        }\n        //if (rangeDelimiter === \"\\\\-\") {\n        //    rangeDelimiter = \"-\";\n        //}\n        return rangeDelimiter;\n    }\n\n    function manglePageNumbers(values, i, currentInfo) {\n        if (i<1) {\n            return;\n        }\n        if (currentInfo.count !== 2) {\n            return;\n        }\n        if (values[i-1].particle !== values[i].particle) {\n            return;\n        }\n        if (values[i-1].joiningSuffix !== \"-\") {\n            currentInfo.count = 1;\n            return;\n        }\n        if (!me.opt[\"page-range-format\"] && (parseInt(values[i-1].value, 10) > parseInt(values[i].value, 10))) {\n            values[i-1].joiningSuffix = fixupRangeDelimiter(variable, values[i], values[i-1].joiningSuffix, true);\n            return;\n        }\n        var val = values[i];\n\n        var isPage = checkPage(variable, val);\n        var str;\n        if (isPage && !isNaN(parseInt(values[i-1].value)) && !isNaN(parseInt(values[i].value))) {\n            str = values[i-1].particle + values[i-1].value + \" - \" + values[i].particle + values[i].value;\n            str = me.fun.page_mangler(str);\n        } else {\n            // if ((\"\" + values[i-1].value).match(/[0-9]$/) && (\"\" + values[i].value).match(/^[0-9]/)) {\n            if ((\"\" + values[i-1].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/) && (\"\" + values[i].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/)) {\n                values[i-1].joiningSuffix = me.getTerm(\"page-range-delimiter\");\n            }\n            str = values[i-1].value + stripHyphenBackslash(values[i-1].joiningSuffix) + values[i].value;\n        }\n        var m = str.match(/^((?:[0-9]*[a-zA-Z]+0*))?([0-9]+[a-z]*)(\\s*[^0-9]+\\s*)([-,a-zA-Z]?0*)([0-9]+[a-z]*)$/);\n        // var m = str.match(/^((?:[0-9]*[a-zA-Z]+0*))?([0-9]+[a-z]*)(\\s*[^0-9]+\\s*)([-,a-zA-Z]?0*)([0-9]+[a-z]*)$/);\n        if (m) {\n            var rangeDelimiter = m[3];\n            rangeDelimiter = fixupRangeDelimiter(variable, val, rangeDelimiter, values[i].numeric);\n            values[i-1].particle = m[1];\n            values[i-1].value = m[2];\n            values[i-1].joiningSuffix = rangeDelimiter;\n            values[i].particle = m[4];\n            values[i].value = m[5];\n        }\n        currentInfo.count = 0;\n    }\n    \n    function fixRanges(values) {\n\n        if (!node) {\n            return;\n        }\n        if ([\"page\", \"chapter-number\", \"collection-number\", \"edition\", \"issue\", \"number\", \"number-of-pages\", \"number-of-volumes\", \"volume\", \"locator\", \"locator-extra\"].indexOf(variable) === -1) {\n            return;\n        }\n\n        var currentInfo = {\n            count: 0,\n            label: null,\n            lastHadRangeDelimiter: false\n        };\n\n        for (var i=0,ilen=values.length; i<ilen; i++) {\n            var val = values[i];\n            if (!val.collapsible) {\n                currentInfo.count = 0;\n                currentInfo.label = null;\n                var isNumeric = val.numeric;\n                val.joiningSuffix = fixupRangeDelimiter(variable, val, val.joiningSuffix, isNumeric);\n            } else if (currentInfo.label === val.label && val.joiningSuffix === \"-\") {\n                // So if there is a hyphen here, and none previous, reset to 1\n                currentInfo.count = 1;\n            } else if (currentInfo.label === val.label && val.joiningSuffix !== \"-\") {\n                // If there is NO hyphen here, count up\n                currentInfo.count++;\n                if (currentInfo.count === 2) {\n                    manglePageNumbers(values, i, currentInfo);\n                }\n            } else if (currentInfo.label !== val.label) {\n                // If the label doesn't match and count is 2, process\n                currentInfo.label = val.label;\n                currentInfo.count = 1;\n            } else {\n                // Safety belt: label doesn't match and count is some other value, so reset to 1\n                // This never happens, though.\n                currentInfo.count = 1;\n                currentInfo.label = val.label;\n            }\n        }\n        // Finally clear, if needed\n        if (currentInfo.count === 2) {\n            manglePageNumbers(values, values.length-1, currentInfo);\n        }\n    }\n\n    function setVariableParams(shadow_numbers, realVariable, values) {\n        var obj = shadow_numbers[realVariable];\n        if (values.length) {\n            obj.numeric = values[0].numeric;\n            obj.collapsible = values[0].collapsible;\n            obj.plural = values[0].plural;\n            obj.label = CSL.STATUTE_SUBDIV_STRINGS[values[0].label];\n            if (variable === \"number\" && obj.label === \"issue\" && me.getTerm(\"number\")) {\n                obj.label = \"number\";\n            }\n        }\n    }\n\n    // Split out the labels and values.\n\n    // short-circuit if object exists: if numeric, set styling, no other action\n    if (node && this.tmp.shadow_numbers[realVariable] && this.tmp.shadow_numbers[realVariable].values.length) {\n        var values = this.tmp.shadow_numbers[realVariable].values;\n        fixRanges(values);\n        //if (!this.tmp.shadow_numbers[variable].masterStyling && !this.tmp.just_looking) {\n            this.tmp.shadow_numbers[realVariable].masterStyling = setStyling(values);\n        //}\n        return;\n    }\n\n    // info.styling = node;\n\n    // This carries value, pluralization and numeric info for use in other contexts.\n    // XXX We used to use one set of params for the entire variable value.\n    // XXX Now params are set on individual objects, of which there may be several after parsing.\n    if (!this.tmp.shadow_numbers[realVariable]) {\n        this.tmp.shadow_numbers[realVariable] = {\n            values:[]\n        };\n    }\n    //this.tmp.shadow_numbers[variable].values = [];\n    //this.tmp.shadow_numbers[variable].plural = 0;\n    //this.tmp.shadow_numbers[variable].numeric = false;\n    //this.tmp.shadow_numbers[variable].label = false;\n\n    if (!ItemObject) {\n        return;\n    }\n\n    // Possibly apply multilingual transform\n    var languageRole = CSL.LangPrefsMap[variable];\n    if (languageRole) {\n        var localeType = this.opt[\"cite-lang-prefs\"][languageRole][0];\n        val = this.transform.getTextSubField(ItemObject, realVariable, \"locale-\"+localeType, true);\n        val = val.name;\n    } else {\n        val = ItemObject[realVariable];\n    }\n\n    if (val && realVariable === \"number\" && ItemObject.type === \"legal_case\") {\n        val = val.replace(/[\\\\]*-/g, \"\\\\-\");\n    }\n\n    // XXX HOLDING THIS\n    // Apply short form ONLY if first element tests is-numeric=false\n    if (val && this.sys.getAbbreviation) {\n        // RefMe bug report: print(\"XX D'oh! (3): \"+num);\n        // true as the fourth argument suppresses update of the UI\n\n        // No need for this.\n        //val = (\"\" + val).replace(/^\\\"/, \"\").replace(/\\\"$/, \"\");\n        if (this.sys.normalizeAbbrevsKey) {\n            var normval = this.sys.normalizeAbbrevsKey(realVariable, val);\n        } else {\n            var normval = val;\n        }\n        var jurisdiction = this.transform.loadAbbreviation(ItemObject.jurisdiction, \"number\", normval, ItemObject.language);\n        if (this.transform.abbrevs[jurisdiction].number) {\n            if (this.transform.abbrevs[jurisdiction].number[normval]) {\n                val = this.transform.abbrevs[jurisdiction].number[normval];\n            } else {\n                \n                // *** This is terrible ***\n                \n                // Strings rendered via cs:number should not be added to the abbreviations\n                // UI unless they test non-numeric. The test happens below.\n                if (\"undefined\" !== typeof this.transform.abbrevs[jurisdiction].number[normval]) {\n                    delete this.transform.abbrevs[jurisdiction].number[normval];\n                }\n            }\n        }\n    }\n\n    //   {\n    //     label: \"sec.\",\n    //     labelForm: \"plural\",\n    //     labelVisibility: true,\n    //     value: 100,\n    //     styling: [object],\n    //     numeric: true\n    //     joiningSuffix: \" & \",\n    //   },\n\n    // Process only if there is a value.\n    if (\"undefined\" !== typeof val && (\"string\" === typeof val || \"number\" === typeof val)) {\n        if (\"number\" === typeof val) {\n            val = \"\" + val;\n        }\n        var defaultLabel = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[variable];\n\n        if (this.tmp.shadow_numbers[realVariable].values.length === 0) {\n            // XXX\n            var values = parseString(val, defaultLabel);\n\n            setSpaces(values);\n            //print(\"setSpaces(): \"+JSON.stringify(values, null, 2));\n\n            setPluralsAndNumerics(values);\n            //print(\"setPluralsAndNumerics(): \"+JSON.stringify(values, null, 2));\n\n            for (var obj of values) {\n                if (!obj.numeric) obj.plural = 0;\n            }\n            this.tmp.shadow_numbers[realVariable].values = values;\n            // me.sys.print(JSON.stringify(values))\n\n            if (node) {\n                fixRanges(values);\n                \n                this.tmp.shadow_numbers[realVariable].masterStyling = setStyling(values);\n                // me.sys.print(\"setStyling(): \"+JSON.stringify(values, null, 2));\n            }\n            setVariableParams(this.tmp.shadow_numbers, realVariable, values);\n        }\n        \n        // hack in support for non-numeric numerics like \"91 Civ. 5442 (RPP)|91 Civ. 5471\"\n        var info = this.tmp.shadow_numbers[realVariable];\n        if (variable === \"number\") {\n            if (info.values.length === 1 && info.values[0].value.indexOf(\"|\") > -1) {\n                info.values[0].value = info.values[0].value.replace(/\\|/g, \", \");\n                info.values[0].numeric = true;\n                info.values[0].plural = 1;\n                info.values[0].collapsible = false;\n                info.numeric = true;\n                info.plural = 1;\n                info.collapsible = false;\n            }\n        }\n        if (info.values.length === 1) {\n            if (info.values[0].value.match(/^[0-9]+(?:\\/[0-9]+)+$/)) {\n                info.values[0].numeric = true;\n                info.values[0].plural = 0;\n                info.values[0].collapsible = false;\n                info.numeric = true;\n                info.plural = 0;\n                info.collapsible = false;\n            }\n        }\n        if (variable === \"page\") {\n            if (info.values.length > 0) {\n                if (info.values[0].gotosleepability) {\n                    info.labelForm = \"short\";\n                }\n            }\n        }\n        //this.sys.print(\"OK \"+JSON.stringify(values, [\"label\", \"origLabel\", \"labelSuffix\", \"particle\", \"collapsible\", \"value\", \"numeric\", \"joiningSuffix\", \"labelVisibility\", \"plural\"], 2));\n    }\n};\n\nCSL.Util.outputNumericField = function(state, varname, itemID) {\n\n    state.output.openLevel(state.tmp.shadow_numbers[varname].masterStyling);\n    var masterStyling = state.tmp.shadow_numbers[varname].masterStyling;\n    var nums = state.tmp.shadow_numbers[varname].values;\n    var masterLabel = nums.length ? nums[0].label : null;\n    var labelForm = state.tmp.shadow_numbers[varname].labelForm;\n    var tryStatic = state.tmp.group_context.tip.label_static;\n    var embeddedLabelForm;\n    if (labelForm) {\n        embeddedLabelForm = labelForm;\n    } else {\n        embeddedLabelForm = \"short\";\n        //labelForm = \"short\";\n    }\n    var labelCapitalizeIfFirst = state.tmp.shadow_numbers[varname].labelCapitalizeIfFirst;\n    var labelDecorations = state.tmp.shadow_numbers[varname].labelDecorations;\n    var lastLabelName = null;\n\n    for (var i=0,ilen=nums.length;i<ilen;i++) {\n        var num = nums[i];\n        var label = \"\";\n        var labelName;\n        if (num.label) {\n            if ('var:' === num.label.slice(0,4)) {\n                labelName = num.label.slice(4);\n            } else {\n                labelName = CSL.STATUTE_SUBDIV_STRINGS[num.label];\n            }\n            if (labelName) {\n                // Simplify this some day.\n                if (num.label === masterLabel) {\n                    if (tryStatic) {\n                        label = state.getTerm(labelName, \"static\", num.plural);\n                        if (label.indexOf(\"%s\") === -1) {\n                            label = \"\";\n                        }\n                    }\n                    if (!label) {\n                        label = state.getTerm(labelName, labelForm, num.plural);\n                    }\n                } else {\n                    if (tryStatic) {\n                        label = state.getTerm(labelName, \"static\", num.plural);\n                        if (label.indexOf(\"%s\") === -1) {\n                            label = \"\";\n                        }\n                    }\n                    if (!label) {\n                        label = state.getTerm(labelName, embeddedLabelForm, num.plural);\n                    }\n                }\n                if (labelCapitalizeIfFirst) {\n                    label = CSL.Output.Formatters[\"capitalize-first\"](state, label);\n                }\n            }\n        }\n        var labelPlaceholderPos = -1;\n        if (label) {\n            labelPlaceholderPos = label.indexOf(\"%s\");\n        }\n        var numStyling = CSL.Util.cloneToken(num.styling);\n        numStyling.formatter = num.styling.formatter;\n        numStyling.type = num.styling.type;\n        numStyling.num = num.styling.num;\n        numStyling.gender = num.styling.gender;\n        \n        if (labelPlaceholderPos > 0 && labelPlaceholderPos < (label.length-2)) {\n            numStyling.strings.prefix += label.slice(0,labelPlaceholderPos);\n            numStyling.strings.suffix = label.slice(labelPlaceholderPos+2) + numStyling.strings.suffix;\n        } else if (num.labelVisibility) {\n            if (!label) {\n                label = num.label;\n                labelName = num.label;\n            }\n            if (labelPlaceholderPos > 0) {\n                var prefixLabelStyling = new CSL.Token();\n                prefixLabelStyling.decorations = labelDecorations;\n                state.output.append(label.slice(0,labelPlaceholderPos), prefixLabelStyling);\n            } else if (labelPlaceholderPos === (label.length-2) || labelPlaceholderPos === -1) {\n                // And add a trailing delimiter.\n                state.output.append(label+num.labelSuffix, \"empty\");\n            }\n        }\n        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, masterStyling.strings.prefix, null, masterStyling, `${num.particle}${num.value}`);\n        if (num.collapsible) {\n            var blob;\n            if (num.value.match(/^[1-9][0-9]*$/)) {\n                blob = new CSL.NumericBlob(state, num.particle, parseInt(num.value, 10), numStyling, itemID);\n            } else {\n                blob = new CSL.NumericBlob(state, num.particle, num.value, numStyling, itemID);\n            }\n            if (\"undefined\" === typeof blob.gender) {\n                blob.gender = state.locale[state.opt.lang][\"noun-genders\"][varname];\n            }\n            state.output.append(blob, \"literal\");\n        } else {\n            state.output.append(num.particle + num.value, numStyling);\n        }\n        if (labelPlaceholderPos === 0 && labelPlaceholderPos < (label.length-2)) {\n            // Only and always if this is the last entry of this label\n            if (lastLabelName === null) {\n                lastLabelName = labelName;\n            }\n            if (labelName !== lastLabelName || i === (nums.length-1)) {\n                var suffixLabelStyling = new CSL.Token();\n                suffixLabelStyling.decorations = labelDecorations;\n                state.output.append(label.slice(labelPlaceholderPos+2), suffixLabelStyling);\n            }\n        }\n        lastLabelName = labelName;\n        state.tmp.term_predecessor = true;\n    }\n    state.output.closeLevel();\n};\n\n/*global CSL: true */\n\nCSL.Util.PageRangeMangler = {};\n\nCSL.Util.PageRangeMangler.getFunction = function (state, rangeType) {\n    var rangerex, pos, len, stringify, listify, expand, minimize, minimize_internal, chicago, lst, m, b, e, ret, begin, end, ret_func;\n    \n    var range_delimiter = state.getTerm(rangeType + \"-range-delimiter\");\n\n    rangerex = /([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)\\s*(?:\\u2013|-)\\s*([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)/;\n\n    stringify = function (lst) {\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            if (\"object\" === typeof lst[pos]) {\n                lst[pos] = lst[pos].join(\"\");\n            }\n        }\n        var ret = lst.join(\"\");\n        ret = ret.replace(/([^\\\\])\\-/g, \"$1\"+state.getTerm(rangeType + \"-range-delimiter\"));\n        return ret;\n    };\n\n    listify = function (str) {\n        var m, lst, ret;\n        // Normalized delimiter form, for use in regexps\n        var hyphens = \"\\\\s+\\\\-\\\\s+\";\n        // Normalize delimiters to hyphen wrapped in single spaces\n        var this_range_delimiter = range_delimiter === \"-\" ? \"\" : range_delimiter;\n        var delimRex = new RegExp(\"([^\\\\\\\\])[-\" + this_range_delimiter + \"\\\\u2013]\", \"g\");\n        str = str.replace(delimRex, \"$1 - \").replace(/\\s+-\\s+/g, \" - \");\n        // Workaround for Internet Explorer\n        //var rexm = new RegExp(\"((?:[0-9]*[a-zA-Z]+)?[0-9]+\" + hyphens + \"(?:[0-9]*[a-zA-Z]+)?[0-9]+)\", \"g\");\n        //var rexlst = new RegExp(\"(?:[0-9]*[a-zA-Z]+)?[0-9]+\" + hyphens + \"(?:[0-9]*[a-zA-Z]+)?[0-9]+\");\n        var rexm = new RegExp(\"((?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*\" + hyphens + \"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*)\", \"g\");\n        var rexlst = new RegExp(\"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*\" + hyphens + \"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*\");\n        m = str.match(rexm);\n        lst = str.split(rexlst);\n        if (lst.length === 0) {\n            ret = m;\n        } else {\n            ret = [lst[0]];\n            for (pos = 1, len = lst.length; pos < len; pos += 1) {\n                ret.push(m[pos - 1].replace(/\\s*\\-\\s*/g, \"-\"));\n                ret.push(lst[pos]);\n            }\n        }\n        return ret;\n    };\n\n    expand = function (str) {\n        str = \"\" + str;\n        lst = listify(str);\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            m = lst[pos].match(rangerex);\n            if (m) {\n                if (!m[3] || m[1] === m[3]) {\n                    if (m[4].length < m[2].length) {\n                        m[4] = m[2].slice(0, (m[2].length - m[4].length)) + m[4];\n                    }\n                    if (parseInt(m[2], 10) < parseInt(m[4], 10)) {\n                        m[3] = range_delimiter + (m[1] ? m[1] : \"\");\n                        lst[pos] = m.slice(1);\n                    }\n                }\n            }\n            if (\"string\" === typeof lst[pos]) {\n                lst[pos] = lst[pos].replace(/\\-/g, range_delimiter);\n            }\n        }\n        return lst;\n    };\n\n    minimize = function (lst, minchars, isyear) {\n        len = lst.length;\n        for (var i = 1, ilen = lst.length; i < ilen; i += 2) {\n            if (\"object\" === typeof lst[i]) {\n                lst[i][3] = minimize_internal(lst[i][1], lst[i][3], minchars, isyear);\n                if (lst[i][2].slice(1) === lst[i][0]) {\n                    lst[i][2] = range_delimiter;\n                }\n            }\n        }\n        return stringify(lst);\n    };\n\n    minimize_internal = function (begin, end, minchars, isyear) {\n        if (!minchars) {\n            minchars = 0;\n        }\n        b = (\"\" + begin).split(\"\");\n        e = (\"\" + end).split(\"\");\n        ret = e.slice();\n        ret.reverse();\n        if (b.length === e.length) {\n            for (var i = 0, ilen = b.length; i < ilen; i += 1) {\n                if (b[i] === e[i] && ret.length > minchars) {\n                    ret.pop();\n                } else {\n                    if (minchars && isyear && ret.length === 3) {\n                        var front = b.slice(0, i);\n                        front.reverse();\n                        ret = ret.concat(front);\n                    }\n                    break;\n                }\n            }\n        }\n        ret.reverse();\n        return ret.join(\"\");\n    };\n\n    chicago = function (lst) {\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            if (\"object\" === typeof lst[pos]) {\n                m = lst[pos];\n                begin = parseInt(m[1], 10);\n                end = parseInt(m[3], 10);\n                if (begin > 100 && begin % 100 && parseInt((begin / 100), 10) === parseInt((end / 100), 10)) {\n                    m[3] = \"\" + (end % 100);\n                } else if (begin >= 10000) {\n                    m[3] = \"\" + (end % 1000);\n                }\n            }\n            if (m[2].slice(1) === m[0]) {\n                m[2] = range_delimiter;\n            }\n        }\n        return stringify(lst);\n    };\n\n    //\n    // The top-level option handlers.\n    //\n    var sniff = function (str, func, minchars, isyear) {\n        var ret;\n\t\tstr = \"\" + str;\n\t\tvar lst = expand(str);\n        var ret = func(lst, minchars, isyear);\n        return ret;\n    };\n    if (!state.opt[rangeType + \"-range-format\"]) {\n        ret_func = function (str) {\n            //return str.replace(\"-\", \"\\u2013\", \"g\");\n            return sniff(str, stringify);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"expanded\") {\n        ret_func = function (str) {\n            return sniff(str, stringify);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"minimal\") {\n        ret_func = function (str) {\n            return sniff(str, minimize);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"minimal-two\") {\n        ret_func = function (str, isyear) {\n            return sniff(str, minimize, 2, isyear);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"chicago\") {\n        ret_func = function (str) {\n            return sniff(str, chicago);\n        };\n    }\n\n    return ret_func;\n};\n\n\n/*global CSL: true */\n\n// Use a state machine\n\n// Okay, good!\n// Needs some tweaks:\n// 1. First pass: quotes only\n//    Special: Convert all sandwiched single-quote markup to apostrophe\n// 2. Second pass: tags\n\nCSL.Util.FlipFlopper = function(state) {\n    \n    /**\n     * INTERNAL\n     */\n\n    var _nestingState = [];\n\n    var _nestingData = {\n        \"<span class=\\\"nocase\\\">\": {\n            type: \"nocase\",\n            opener: \"<span class=\\\"nocase\\\">\",\n            closer: \"</span>\",\n            attr: null,\n            outer: null,\n            flipflop: null\n        },\n        \"<span class=\\\"nodecor\\\">\": {\n            type: \"nodecor\",\n            opener: \"<span class=\\\"nodecor\\\">\",\n            closer: \"</span>\",\n            attr: \"@class\",\n            outer: \"nodecor\",\n            flipflop: {\n                \"nodecor\": \"nodecor\"\n            }\n        },\n        \"<span style=\\\"font-variant:small-caps;\\\">\": {\n            type: \"tag\",\n            opener: \"<span style=\\\"font-variant:small-caps;\\\">\",\n            closer: \"</span>\",\n            attr: \"@font-variant\",\n            outer: \"small-caps\",\n            flipflop: {\n                \"small-caps\": \"normal\",\n                \"normal\": \"small-caps\"\n            }\n        },\n        \"<sc>\": {\n            type: \"tag\",\n            opener: \"<sc>\",\n            closer: \"</sc>\",\n            attr: \"@font-variant\",\n            outer: \"small-caps\",\n            flipflop: {\n                \"small-caps\": \"normal\",\n                \"normal\": \"small-caps\"\n            }\n        },\n        \"<i>\": {\n            type: \"tag\",\n            opener: \"<i>\",\n            closer: \"</i>\",\n            attr: \"@font-style\",\n            outer: \"italic\",\n            flipflop: {\n                \"italic\": \"normal\",\n                \"normal\": \"italic\"\n            }\n        },\n        \"<b>\": {\n            type: \"tag\",\n            opener: \"<b>\",\n            closer: \"</b>\",\n            attr: \"@font-weight\",\n            outer: \"bold\",\n            flipflop: {\n                \"bold\": \"normal\",\n                \"normal\": \"bold\"\n            }\n        },\n        \"<sup>\": {\n            type: \"tag\",\n            opener: \"<sup>\",\n            closer: \"</sup>\",\n            attr: \"@vertical-align\",\n            outer: \"sup\",\n            flipflop: {\n                \"sub\": \"sup\",\n                \"sup\": \"sup\"\n            }\n        },\n        \"<sub>\": {\n            type: \"tag\",\n            opener: \"<sub>\",\n            closer: \"</sub>\",\n            attr: \"@vertical-align\",\n            outer: \"sub\",\n            flipflop: {\n                \"sup\": \"sub\",\n                \"sub\": \"sub\"\n            }\n        },\n        \" \\\"\": {\n            type: \"quote\",\n            opener: \" \\\"\",\n            closer: \"\\\"\",\n            attr: \"@quotes\",\n            outer: \"true\",\n            flipflop: {\n                \"true\": \"inner\",\n                \"inner\": \"true\",\n                \"false\": \"true\"\n            }\n        },\n        \" \\'\": {\n            type: \"quote\",\n            opener: \" \\'\",\n            closer: \"\\'\",\n            attr: \"@quotes\",\n            outer: \"inner\",\n            flipflop: {\n                \"true\": \"inner\",\n                \"inner\": \"true\",\n                \"false\": \"true\"\n            }\n        }\n    };\n\n    _nestingData[\"(\\\"\"] = _nestingData[\" \\\"\"];\n    _nestingData[\"(\\'\"] = _nestingData[\" \\'\"];\n\n    var localeOpenQuote = state.getTerm(\"open-quote\");\n    var localeCloseQuote = state.getTerm(\"close-quote\");\n    var localeOpenInnerQuote = state.getTerm(\"open-inner-quote\");\n    var localeCloseInnerQuote = state.getTerm(\"close-inner-quote\");\n\n    // If locale uses straight quotes, do not register them. All will be well.\n    // Otherwise, clone straight-quote data, and adjust.\n    if (localeOpenQuote && localeCloseQuote && [\" \\\"\",\" \\'\",\"\\\"\",\"\\'\"].indexOf(localeOpenQuote) === -1) {\n        _nestingData[localeOpenQuote] = JSON.parse(JSON.stringify(_nestingData[\" \\\"\"]));\n        _nestingData[localeOpenQuote].opener = localeOpenQuote;\n        _nestingData[localeOpenQuote].closer = localeCloseQuote;\n    }\n    \n    if (localeOpenInnerQuote && localeCloseInnerQuote && [\" \\\"\",\" \\'\",\"\\\"\",\"\\'\"].indexOf(localeOpenInnerQuote) === -1) {\n        _nestingData[localeOpenInnerQuote] = JSON.parse(JSON.stringify(_nestingData[\" \\'\"]));\n        _nestingData[localeOpenInnerQuote].opener = localeOpenInnerQuote;\n        _nestingData[localeOpenInnerQuote].closer = localeCloseInnerQuote;\n    }\n    \n    function _setOuterQuoteForm(quot) {\n        var flip = {\n            \" \\'\": \" \\\"\",\n            \" \\\"\": \" \\'\",\n            \"(\\\"\": \"(\\'\",\n            \"(\\'\": \"(\\\"\"\n        };\n        _nestingData[quot].outer = \"true\";\n        _nestingData[flip[quot]].outer = \"inner\";\n    }\n    \n    function _getNestingOpenerParams(opener) {\n        var openers = [];\n        var keys = Object.keys(_nestingData);\n        for (var i = 0, l = keys.length; i < l; i++) {\n            var key = keys[i];\n            if (_nestingData[opener].type !== \"quote\" || !_nestingData[opener]) {\n                openers.push(key);\n            }\n        }\n        var ret = _nestingData[opener];\n        ret.opener = new RegExp(\"^(?:\" + openers.map(function(str){\n            return str.replace(\"(\", \"\\\\(\");\n        }).join(\"|\") + \")\");\n        return ret;\n    }\n\n    var _nestingParams = (function() {\n        var ret = {};\n        var keys = Object.keys(_nestingData);\n        for (var i = 0, l = keys.length; i < l; i++) {\n            var key = keys[i];\n            ret[key] = _getNestingOpenerParams(key);\n        }\n        return ret;\n    }());\n\n    var _tagRex = (function() {\n        var openers = [];\n        var closers = [];\n        var vals = {};\n        for (var opener in _nestingParams) {\n            openers.push(opener);\n            vals[_nestingParams[opener].closer] = true;\n        }\n        var keys = Object.keys(vals);\n        for (var i = 0, l = keys.length; i < l; i++) {\n            var closer = keys[i];\n            closers.push(closer);\n        }\n\n        var all = openers.concat(closers).map(function(str){\n            return str.replace(\"(\", \"\\\\(\");\n        }).join(\"|\");\n\n        return {\n            matchAll: new RegExp(\"((?:\" + all + \"))\", \"g\"),\n            splitAll: new RegExp(\"(?:\" + all + \")\", \"g\"),\n            open: new RegExp(\"(^(?:\" + openers.map(function(str){\n                return str.replace(\"(\", \"\\\\(\");\n            }).join(\"|\") + \")$)\"),\n            close: new RegExp(\"(^(?:\" + closers.join(\"|\") + \")$)\"),\n        };\n    }());\n\n    function _tryOpen(tag, pos) {\n        var params = _nestingState[_nestingState.length - 1];\n        if (!params || tag.match(params.opener)) {\n            _nestingState.push({\n                type: _nestingParams[tag].type,\n                opener: _nestingParams[tag].opener,\n                closer: _nestingParams[tag].closer,\n                pos: pos\n            });\n            return false;\n        } else {\n            _nestingState.pop();\n            _nestingState.push({\n                type: _nestingParams[tag].type,\n                opener: _nestingParams[tag].opener,\n                closer: _nestingParams[tag].closer,\n                pos: pos\n            });\n            return {\n                fixtag: params.pos\n            };\n        }\n    }\n    \n    function _tryClose(tag, pos) {\n        var params = _nestingState[_nestingState.length - 1];\n        if (params && tag === params.closer) {\n            _nestingState.pop();\n            if (params.type === \"nocase\") {\n                return {\n                    nocase: {\n                        open: params.pos,\n                        close: pos\n                    }\n                };\n            } else {\n                return false;\n            }\n        } else {\n            if (params) {\n                return {\n                    fixtag: params.pos\n                };\n            } else {\n                return {\n                    fixtag: pos\n                };\n            }\n        }\n    }\n    \n    function _pushNestingState(tag, pos) {\n        if (tag.match(_tagRex.open)) {\n            return _tryOpen(tag, pos);\n        } else {\n            return _tryClose(tag, pos);\n        }\n    }\n    \n    function _doppelString(str) {\n        var forcedSpaces = [];\n        // Normalize markup\n        str = str.replace(/(<span)\\s+(style=\\\"font-variant:)\\s*(small-caps);?\\\"[^>]*(>)/g, \"$1 $2$3;\\\"$4\");\n        str = str.replace(/(<span)\\s+(class=\\\"no(?:case|decor)\\\")[^>]*(>)/g, \"$1 $2$3\");\n\n        var match = str.match(_tagRex.matchAll);\n        if (!match) {\n            return {\n                tags: [],\n                strings: [str],\n                forcedSpaces: []\n            };\n        }\n        var split = str.split(_tagRex.splitAll);\n\n        for (var i=0,ilen=match.length-1;i<ilen;i++) {\n            if (_nestingData[match[i]]) {\n                if (split[i+1] === \"\" && [\"\\\"\", \"'\"].indexOf(match[i+1]) > -1) {\n                    match[i+1] = \" \" + match[i+1];\n                    forcedSpaces.push(true);\n                } else {\n                    forcedSpaces.push(false);\n                }\n            }\n        }\n        return {\n            tags: match,\n            strings: split,\n            forcedSpaces: forcedSpaces\n        };\n    }\n\n    var TagReg = function(blob) {\n        var _stack = [];\n        this.set = function (tag) {\n            var attr = _nestingData[tag].attr;\n            var decor = null;\n            for (var i=_stack.length-1;i>-1;i--) {\n                var _decor = _stack[i];\n                if (_decor[0] === attr) {\n                    decor = _decor;\n                    break;\n                }\n            }\n            if (!decor) {\n                var allTheDecor = [state[state.tmp.area].opt.layout_decorations].concat(blob.alldecor);\n                outer:\n                for (var i=allTheDecor.length-1;i>-1;i--) {\n                    var decorset = allTheDecor[i];\n                    if (!decorset) {\n                        continue;\n                    }\n                    for (var j=decorset.length-1;j>-1;j--) {\n                        var _decor = decorset[j];\n                        if (_decor[0] === attr) {\n                            decor = _decor;\n                            break outer;\n                        }\n                    }\n                }\n            }\n            if (!decor) {\n                decor = [attr, _nestingData[tag].outer];\n            } else {\n                decor = [attr, _nestingData[tag].flipflop[decor[1]]];\n            }\n            _stack.push(decor);\n        };\n        this.pair = function () {\n            return _stack[_stack.length-1];\n        };\n        this.pop = function () {\n            _stack.pop();\n        };\n    };\n    \n    function _apostropheForce(tag, str) {\n        if (tag === \"\\'\") {\n            if (str && str.match(/^[^\\,\\.\\?\\:\\;\\ ]/)) {\n                return \"\\u2019\";\n            }\n        } else if (tag === \" \\'\" && str && str.match(/^[\\ ]/)) {\n            return \" \\u2019\";\n        }\n        return false;\n    }\n\n    function _undoppelToQueue(blob, doppel, leadingSpace) {\n        var firstString = true;\n        var tagReg = new TagReg(blob);\n        blob.blobs = [];\n        function Stack (blob) {\n            this.stack = [blob];\n            this.latest = blob;\n            this.addStyling = function(str, decor) {\n                if (firstString) {\n                    if (str.slice(0, 1) === \" \") {\n                        str = str.slice(1);\n                    }\n                    if (str.slice(0, 1) === \" \") {\n                        str = str.slice(1);\n                    }\n                    firstString = false;\n                }\n                this.latest = this.stack[this.stack.length-1];\n                if (decor) {\n                    if (\"string\" === typeof this.latest.blobs) {\n                        var child = new CSL.Blob();\n                        child.blobs = this.latest.blobs;\n                        child.alldecor = this.latest.alldecor.slice();\n                        this.latest.blobs = [child];\n                    }\n                    var tok = new CSL.Token();\n                    var newblob = new CSL.Blob(null, tok);\n                    newblob.alldecor = this.latest.alldecor.slice();\n                    \n                    // AHA! Bad naming. There is _decorset from the list, and\n                    // there WAS decorset that we are building. Dumb. Fix the\n                    // names and fix it up.\n                    \n                    if (decor[0] === \"@class\" && decor[1] === \"nodecor\") {\n                        var newdecorset = [];\n                        var seen = {};\n                        var allTheDecor = [state[state.tmp.area].opt.layout_decorations].concat(newblob.alldecor);\n                        for (var i=allTheDecor.length-1;i>-1;i--) {\n                            var _decorset = allTheDecor[i];\n                            if (!_decorset) {\n                                continue;\n                            }\n                            for (var j=_decorset.length-1;j>-1;j--) {\n                                var _olddecor = _decorset[j];\n                                if ([\"@font-weight\", \"@font-style\", \"@font-variant\"].indexOf(_olddecor[0]) > -1\n                                    && !seen[_olddecor[0]]) {\n                                    \n                                    if (decor[1] !== \"normal\") {\n                                        newblob.decorations.push([_olddecor[0], \"normal\"]);\n                                        newdecorset.push([_olddecor[0], \"normal\"]);\n                                    }\n                                    seen[_olddecor[0]] = true;\n                                }\n                            }\n                        }\n                        newblob.alldecor.push(newdecorset);\n                        \n                    } else {\n                        newblob.decorations.push(decor);\n                        newblob.alldecor.push([decor]);\n                    }\n                    this.latest.blobs.push(newblob);\n                    this.stack.push(newblob);\n                    this.latest = newblob;\n                    if (str) {\n                        var tok = new CSL.Token();\n                        var newblob = new CSL.Blob(null, tok);\n                        newblob.blobs = str;\n                        newblob.alldecor = this.latest.alldecor.slice();\n                        this.latest.blobs.push(newblob);\n                    }\n                } else {\n                    if (str) {\n                        var child = new CSL.Blob();\n                        child.blobs = str;\n                        child.alldecor = this.latest.alldecor.slice();\n                        this.latest.blobs.push(child);\n                    }\n                }\n            };\n            this.popStyling = function() {\n                this.stack.pop();\n            };\n        }\n        var stack = new Stack(blob);\n        if (doppel.strings.length) {\n            var str = doppel.strings[0];\n            if (leadingSpace) {\n                str = \" \" + str;\n            }\n            stack.addStyling(str);\n        }\n        for (var i=0,ilen=doppel.tags.length;i<ilen;i++) {\n            var tag = doppel.tags[i];\n            var str = doppel.strings[i+1];\n            if (tag.match(_tagRex.open)) {\n                tagReg.set(tag);\n                stack.addStyling(str, tagReg.pair());\n            } else {\n                tagReg.pop();\n                stack.popStyling();\n                stack.addStyling(str);\n            }\n        }\n    }\n\n    /**\n     * PUBLIC\n     */\n\n    this.processTags = function (blob) {\n        var str = blob.blobs;\n        var leadingSpace = false;\n        if (str.slice(0, 1) === \" \" && !str.match(/^\\s+[\\'\\\"]/)) {\n            leadingSpace = true;\n        }\n        var rex = new RegExp(\"(\" + CSL.ROMANESQUE_REGEXP.source + \")\\u2019(\" + CSL.ROMANESQUE_REGEXP.source + \")\", \"g\");\n        var str = \" \" + str.replace(rex, \"$1\\'$2\");\n        var doppel = _doppelString(str);\n        if (doppel.tags.length === 0) {\n            return;\n        }\n        var quoteFormSeen = false;\n        \n    \tfor (var i=0,ilen=doppel.tags.length;i<ilen;i++) {\n            var tag = doppel.tags[i];\n            var str = doppel.strings[i+1];\n            var apostrophe = _apostropheForce(tag, str);\n            if (apostrophe) {\n                doppel.strings[i+1] = apostrophe + doppel.strings[i+1];\n                doppel.tags[i] = \"\";\n            } else {\n                var tagInfo;\n                while (true) {\n                    tagInfo = _pushNestingState(tag, i);\n                    if (tagInfo) {\n                        if (Object.keys(tagInfo).indexOf(\"fixtag\") > -1) {\n                            if (tag.match(_tagRex.close)\n                                && tag === \"\\'\") {\n                                \n                                doppel.strings[i+1] = \"\\u2019\" + doppel.strings[i+1];\n                                doppel.tags[i] = \"\";\n                            } else {\n                                var failedTag = doppel.tags[tagInfo.fixtag];\n                                if (doppel.forcedSpaces[tagInfo.fixtag-1]) {\n                                    failedTag = failedTag.slice(1);\n                                }\n                                doppel.strings[tagInfo.fixtag+1] = failedTag + doppel.strings[tagInfo.fixtag+1];\n                                doppel.tags[tagInfo.fixtag] = \"\";\n                            }\n                            if (_nestingState.length > 0) {\n                                if (tag !== \"\\'\") {\n                                    _nestingState.pop();\n                                } else {\n                                    break;\n                                }\n                            } else {\n                                break;\n                            }\n                        } else if (tagInfo.nocase) {\n                            doppel.tags[tagInfo.nocase.open] = \"\";\n                            doppel.tags[tagInfo.nocase.close] = \"\";\n                            break;\n                        } else {\n                            break;\n                        }\n                    } else {\n                        break;\n                    }\n                }\n                if (tagInfo && (tagInfo.fixtag|| tagInfo.fixtag === 0)) {\n                    doppel.strings[i+1] = doppel.tags[i] + doppel.strings[i+1];\n                    doppel.tags[i] = \"\";\n                }\n            }\n        }\n        // Stray tags are neutralized here\n        for (var i=_nestingState.length-1;i>-1;i--) {\n            var tagPos = _nestingState[i].pos;\n            var tag = doppel.tags[tagPos];\n            if (tag === \" \\'\" || tag === \"\\'\") {\n\n                doppel.strings[tagPos+1] = \" \\u2019\" + doppel.strings[tagPos+1];\n            } else {\n                doppel.strings[tagPos+1] = doppel.tags[tagPos] + doppel.strings[tagPos+1];\n            }\n            doppel.tags[tagPos] = \"\";\n            _nestingState.pop();\n        }\n        for (var i=doppel.tags.length-1;i>-1;i--) {\n            if (!doppel.tags[i]) {\n                doppel.tags = doppel.tags.slice(0,i).concat(doppel.tags.slice(i+1));\n                doppel.strings[i] = doppel.strings[i] + doppel.strings[i+1];\n                doppel.strings = doppel.strings.slice(0,i+1).concat(doppel.strings.slice(i+2));\n            }\n        }\n        // Sniff initial (outer) quote form (single or double) and configure parser\n        // Also add leading spaces.\n        for (var i=0,ilen=doppel.tags.length;i<ilen;i++) {\n            var tag = doppel.tags[i];\n            var forcedSpace = doppel.forcedSpaces[i-1];\n            if ([\" \\\"\", \" \\'\", \"(\\\"\", \"(\\'\"].indexOf(tag) > -1) {\n                if (!quoteFormSeen) {\n                    _setOuterQuoteForm(tag);\n                    quoteFormSeen = true;\n                }\n                if (!forcedSpace) {\n                    doppel.strings[i] += tag.slice(0, 1);\n                }\n            }\n        }\n        //print(JSON.stringify(doppel, null, 2))\n        //print(_undoppelString(doppel));\n        _undoppelToQueue(blob, doppel, leadingSpace);\n    };\n};\n\n/*global CSL: true */\n\nCSL.Output.Formatters = (function () {\n    var rexStr = \"(?:\\u2018|\\u2019|\\u201C|\\u201D| \\\"| \\'|\\\"|\\'|[-\\u2013\\u2014\\/.,;?!:]|\\\\[|\\\\]|\\\\(|\\\\)|<span style=\\\"font-variant: small-caps;\\\">|<span class=\\\"no(?:case|decor)\\\">|<\\/span>|<\\/?(?:i|sc|b|sub|sup)>)\";\n    var tagDoppel = new CSL.Doppeler(rexStr, function(str) {\n        return str.replace(/(<span)\\s+(class=\\\"no(?:case|decor)\\\")[^>]*(>)/g, \"$1 $2$3\").replace(/(<span)\\s+(style=\\\"font-variant:)\\s*(small-caps);?(\\\")[^>]*(>)/g, \"$1 $2 $3;$4$5\");\n    });\n    var rexNameStr = \"(?:[-\\\\s]*<\\\\/*(?:span\\s+class=\\\"no(?:case|decor)\\\"|i|sc|b|sub|sup)>[-\\\\s]*|[-\\\\s]+)\";\n    var nameDoppel = new CSL.Doppeler(rexNameStr);\n    \n    var wordDoppel = new CSL.Doppeler(\"(?:[\\u00A0\\u0020\\u00A0\\u2000-\\u200B\\u205F\\u3000]+)\");\n    \n    /**\n     * INTERNAL\n     */\n\n    var _tagParams = {\n        \"<span style=\\\"font-variant: small-caps;\\\">\": \"</span>\",\n        \"<span class=\\\"nocase\\\">\": \"</span>\",\n        \"<span class=\\\"nodecor\\\">\": \"</span>\",\n        \"<sc>\": \"</sc>\",\n        \"<sub>\": \"</sub>\",\n        \"<sup>\": \"</sup>\"\n    };\n\n    function _capitalise (word) {\n        // Weird stuff is (.) transpiled with regexpu\n        //   https://github.com/mathiasbynens/regexpu\n        var m = word.match(/(^\\s*)((?:[\\0-\\t\\x0B\\f\\x0E-\\u2027\\u202A-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF]))(.*)/);\n        // Do not uppercase lone Greek letters\n        // (No case transforms in Greek citations, but chars used in titles to science papers)\n        if (m && !(m[2].match(/^[\\u0370-\\u03FF]$/) && !m[3])) {\n            return m[1] + CSL.toLocaleUpperCase.call(this, m[2]) + m[3];\n        }\n        return word;\n    }\n\n    function _textcaseEngine(config, string) {\n        if (!string) {\n            return \"\";\n        }\n        config.doppel = tagDoppel.split(string);\n        var quoteParams = {\n            \" \\\"\": {\n                opener: \" \\'\",\n                closer: \"\\\"\"\n            },\n            \" \\'\": {\n                opener: \" \\\"\",\n                closer: \"\\'\"\n            },\n            \"\\u2018\": {\n                opener: \"\\u2018\",\n                closer: \"\\u2019\"\n            },\n            \"\\u201C\": {\n                opener: \"\\u201C\",\n                closer: \"\\u201D\"\n            },\n        };\n        function tryOpen(tag, pos) {\n            if (config.quoteState.length === 0 || tag === config.quoteState[config.quoteState.length - 1].opener) {\n                config.quoteState.push({\n                    opener: quoteParams[tag].opener,\n                    closer: quoteParams[tag].closer,\n                    pos: pos\n                });\n                return false;\n            } else {\n                var prevPos = config.quoteState[config.quoteState.length-1].pos;\n                config.quoteState.pop();\n                config.quoteState.push({\n                    opener: quoteParams[tag].opener,\n                    closer: quoteParams[tag].closer,\n                    positions: pos\n                });\n                return prevPos;\n            }\n        }\n        function tryClose(tag, pos) {\n            if (config.quoteState.length > 0 && tag === config.quoteState[config.quoteState.length - 1].closer) {\n                config.quoteState.pop();\n            } else {\n                return pos;\n            }\n        }\n        function pushQuoteState(tag, pos) {\n            var isOpener = [\"\\u201C\", \"\\u2018\", \" \\\"\", \" \\'\"].indexOf(tag) > -1 ? true : false;\n            if (isOpener) {\n                return tryOpen(tag, pos);\n            } else {\n                return tryClose(tag, pos);\n            }\n        }\n        function quoteFix (tag, positions) {\n            var m = tag.match(/(^(?:\\u2018|\\u2019|\\u201C|\\u201D|\\\"|\\')|(?: \\\"| \\')$)/);\n            if (m) {\n                return pushQuoteState(m[1], positions);\n            }\n        }\n        // Run state machine\n        if (config.doppel.strings.length && config.doppel.strings[0].trim()) {\n            config.doppel.strings[0] = config.capitaliseWords(config.doppel.strings[0], 0, config.doppel.tags[0]);\n        }\n\n    \tfor (var i=0,ilen=config.doppel.tags.length;i<ilen;i++) {\n            var tag = config.doppel.tags[i];\n            var str = config.doppel.strings[i+1];\n\n            if (config.tagState !== null) {\n                // Evaluate tag state for current string\n                if (_tagParams[tag]) {\n                    config.tagState.push(_tagParams[tag]);\n                } else if (config.tagState.length && tag === config.tagState[config.tagState.length - 1]) {\n                    config.tagState.pop();\n                }\n            }\n\n            if (config.afterPunct !== null) {\n                // Evaluate punctuation state of current string\n                if (tag.match(/[\\!\\?\\:]$/)) {\n                    config.afterPunct = true;\n                }\n            }\n\n            // Process if outside tag scope, else noop for upper-casing\n            if (config.tagState.length === 0) {\n                config.doppel.strings[i+1] = config.capitaliseWords(str, i+1, config.doppel,config.doppel.tags[i+1]);\n                \n            } else if (config.doppel.strings[i+1].trim()) {\n                config.lastWordPos = null;\n            }\n            \n            if (config.quoteState !== null) {\n                // Evaluate quote state of current string and fix chars that have flown\n                var quotePos = quoteFix(tag, i);\n                if (quotePos || quotePos === 0) {\n                    var origChar = config.doppel.origStrings[quotePos+1].slice(0, 1);\n                    config.doppel.strings[quotePos+1] = origChar + config.doppel.strings[quotePos+1].slice(1);\n                    config.lastWordPos = null;\n                }\n            }\n\n            // If there was a printable string, unset first-word and after-punctuation\n            if (config.isFirst) {\n                if (str.trim()) {\n                    config.isFirst = false;\n                }\n            }\n            if (config.afterPunct) {\n                if (str.trim()) {\n                    config.afterPunct = false;\n                }\n            }\n        }\n        if (config.quoteState) {\n            for (var i=0,ilen=config.quoteState.length;i<ilen;i++) {\n                var quotePos = config.quoteState[i].pos;\n                // Test for quotePos avoids a crashing error:\n                //   https://github.com/citation-style-language/test-suite/blob/master/processor-tests/humans/flipflop_OrphanQuote.txt\n                if (typeof quotePos !== 'undefined') {\n                    var origChar = config.doppel.origStrings[quotePos+1].slice(0, 1);\n                    config.doppel.strings[quotePos+1] = origChar + config.doppel.strings[quotePos+1].slice(1);\n                }\n            }\n        }\n        // Specially capitalize the last word if necessary (invert stop-word list)\n        if (config.lastWordPos) {\n            var lastWords = wordDoppel.split(config.doppel.strings[config.lastWordPos.strings]);\n            var lastWord = lastWords.strings[config.lastWordPos.words];\n            if (lastWord.length > 1 && CSL.toLocaleLowerCase.call(this, lastWord).match(config.skipWordsRex)) {\n                lastWord = _capitalise.call(this, lastWord);\n                lastWords.strings[config.lastWordPos.words] = lastWord;\n            }\n            config.doppel.strings[config.lastWordPos.strings] = wordDoppel.join(lastWords);\n        }\n\n        // Recombine the string\n        return tagDoppel.join(config.doppel);\n    }\n\n    /**\n     * PUBLIC\n     */\n\n    /**\n     * A noop that just delivers the string.\n     */\n    function passthrough (state, str) {\n        return str;\n    }\n\n    /**\n     * Force all letters in the string to lowercase, skipping nocase spans\n     */\n    function lowercase(state, string) {\n        var config = {\n            quoteState: null,\n            capitaliseWords: function(str) {\n                var words = str.split(\" \");\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        words[i] = CSL.toLocaleLowerCase.call(state, word);\n                    }\n                }\n                return words.join(\" \");\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: null\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    /**\n     * Force all letters in the string to uppercase.\n     */\n    function uppercase(state, string) {\n        var config = {\n            quoteState: null,\n            capitaliseWords: function(str) {\n                var words = str.split(\" \");\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        // Okay.\n                        // So we need to pick up an array of locales from state.tmp.\n                        // This function is invoked in the context of queue.js, so\n                        // the item is not available here. Three levels to be included\n                        // in the array:\n                        // 1. Field language tag, if any\n                        // 2. Item language tag, if any\n                        // 3. Value of state.opt.lang\n                        words[i] = CSL.toLocaleUpperCase.call(state, word);\n                    }\n                }\n                return words.join(\" \");\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: null\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    /**\n     * Similar to <b>capitalize_first</b>, but force the\n     * subsequent characters to lowercase.\n     */\n    function sentence(state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str) {\n                var words = str.split(\" \");\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        if (config.isFirst) {\n                            words[i] = _capitalise.call(state, word);\n                            config.isFirst = false;\n                        } else {\n                            words[i] = CSL.toLocaleLowerCase.call(state, word);\n                        }\n                    }\n                }\n                return words.join(\" \");\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: true\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    function title(state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str, i, followingTag) {\n                if (str.trim()) {\n                    var wordle = wordDoppel.split(str);\n                    var words = wordle.strings;\n                    for (var j=0,jlen=words.length;j<jlen;j++) {\n                        var word = words[j];\n                        if (!word) {\n                            continue;\n                        }\n                        let lcase = CSL.toLocaleLowerCase.call(state, word);\n                        let capitalize = false;\n                        if (word.length > 1 && !lcase.match(config.skipWordsRex)) {\n                            // Capitalize every word that is not a stop-word\n                            capitalize = true;\n                        } else if (j === (words.length - 1) && followingTag === \"-\") {\n                            capitalize = true;\n                        } else if (config.isFirst) {\n                            // Capitalize first word, even if a stop-word\n                            capitalize = true;\n                        } else if (config.afterPunct) {\n                            // Capitalize after punctuation\n                            capitalize = true;\n                        }\n                        // Don't capitalize if word already contains capitalization\n                        if (capitalize && word === lcase) {\n                            words[j] = _capitalise.call(state, word);\n                        }\n                        config.afterPunct = false;\n                        config.isFirst = false;\n                        config.lastWordPos = {\n                            strings: i,\n                            words: j\n                        };\n                    }\n                    str = wordDoppel.join(wordle);\n                }\n                return str;\n            },\n            skipWordsRex: state.locale[state.opt.lang].opts[\"skip-words-regexp\"],\n            tagState: [],\n            afterPunct: false,\n            isFirst: true\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n    \n    \n    /**\n     * Force capitalization of the first letter in the string, leave\n     * the rest of the characters untouched.\n     */\n    function capitalizeFirst(state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str) {\n                var wordle = wordDoppel.split(str);\n                var words = wordle.strings;\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        if (config.isFirst) {\n                            // Don't capitalize if word already contains capitalization\n                            if (word === CSL.toLocaleLowerCase.call(state, word)) {\n                                words[i] = _capitalise.call(state, word);\n                            }\n                            config.isFirst = false;\n                            break;\n                        }\n                    }\n                }\n                return wordDoppel.join(wordle);\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: true\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    /**\n     * Force the first letter of each space-delimited\n     * word in the string to uppercase, and leave the remainder\n     * of the string untouched.  Single characters are forced\n     * to uppercase.\n     */\n    function capitalizeAll (state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str) {\n                var wordle = wordDoppel.split(str);\n                var words = wordle.strings;\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        // Don't capitalize if word already contains capitalization\n                        if (word === CSL.toLocaleLowerCase.call(state, word)) {\n                            words[i] = _capitalise.call(state, word);\n                        }\n                    }\n                }\n                return wordDoppel.join(wordle);\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: null\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n    return {\n        nameDoppel: nameDoppel,\n        passthrough: passthrough,\n        lowercase: lowercase,\n        uppercase: uppercase,\n        sentence: sentence,\n        title: title,\n        \"capitalize-first\": capitalizeFirst,\n        \"capitalize-all\": capitalizeAll\n    };\n}());\n\n/*global CSL: true */\n\n\n/**\n * Output specifications.\n * @class\n */\nCSL.Output.Formats = function () {};\n\n/**\n * HTML output format specification.\n * <p>The headline says it all.  The source code for this\n * object can be used as a template for producing other\n * output modes.</p>\n */\nCSL.Output.Formats.prototype.html = {\n    //\n    // text_escape: Format-specific function for escaping text destined\n    // for output.  Takes the text to be escaped as sole argument.  Function\n    // will be run only once across each portion of text to be escaped, it\n    // need not be idempotent.\n    //\n    \"text_escape\": function (text) {\n        // Numeric entities, in case the output is processed as\n        // xml in an environment in which HTML named entities are\n        // not declared.\n        if (!text) {\n            text = \"\";\n        }\n        return text.replace(/&/g, \"&#38;\")\n            .replace(/</g, \"&#60;\")\n            .replace(/>/g, \"&#62;\")\n            .replace(/\\s\\s/g, \"\\u00A0 \")\n            .replace(CSL.SUPERSCRIPTS_REGEXP,\n                     function(aChar) {\n                         // return \"&#60;sup&#62;\" + CSL.SUPERSCRIPTS[aChar] + \"&#60;/sup&#62;\";\n                         return \"<sup>\" + CSL.SUPERSCRIPTS[aChar] + \"</sup>\";\n                     });\n    },\n    \"bibstart\": \"<div class=\\\"csl-bib-body\\\">\\n\",\n    \"bibend\": \"</div>\",\n    \"@font-style/italic\": \"<i>%%STRING%%</i>\",\n    \"@font-style/oblique\": \"<em>%%STRING%%</em>\",\n    \"@font-style/normal\": \"<span style=\\\"font-style:normal;\\\">%%STRING%%</span>\",\n    \"@font-variant/small-caps\": \"<span style=\\\"font-variant:small-caps;\\\">%%STRING%%</span>\",\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-variant/normal\": \"<span style=\\\"font-variant:normal;\\\">%%STRING%%</span>\",\n    \"@font-weight/bold\": \"<b>%%STRING%%</b>\",\n    \"@font-weight/normal\": \"<span style=\\\"font-weight:normal;\\\">%%STRING%%</span>\",\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": \"<span style=\\\"text-decoration:none;\\\">%%STRING%%</span>\",\n    \"@text-decoration/underline\": \"<span style=\\\"text-decoration:underline;\\\">%%STRING%%</span>\",\n    \"@vertical-align/sup\": \"<sup>%%STRING%%</sup>\",\n    \"@vertical-align/sub\": \"<sub>%%STRING%%</sub>\",\n    \"@vertical-align/baseline\": \"<span style=\\\"baseline\\\">%%STRING%%</span>\",\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            //\n            // Mostly right by being wrong (for apostrophes)\n            //\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    //\"@bibliography/body\": function (state,str){\n    //    return \"<div class=\\\"csl-bib-body\\\">\\n\"+str+\"</div>\";\n    //},\n    \"@cite/entry\": function (state, str) {\n        return state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function (state, str) {\n        // Test for this.item_id to add decorations to\n        // bibliography output of individual entries.\n        //\n        // Full item content can be obtained from\n        // state.registry.registry[id].ref, using\n        // CSL variable keys.\n        //\n        // Example:\n        //\n        //   print(state.registry.registry[this.item_id].ref[\"title\"]);\n        //\n        // At present, for parallel citations, only the\n        // id of the master item is supplied on this.item_id.\n        var insert = \"\";\n        if (state.sys.embedBibliographyEntry) {\n            insert = state.sys.embedBibliographyEntry(this.item_id) + \"\\n\";\n        }\n        return \"  <div class=\\\"csl-entry\\\">\" + str + \"</div>\\n\" + insert;\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n\\n    <div class=\\\"csl-block\\\">\" + str + \"</div>\\n\";\n    },\n    \"@display/left-margin\": function (state, str) {\n        return \"\\n    <div class=\\\"csl-left-margin\\\">\" + str + \"</div>\";\n    },\n    \"@display/right-inline\": function (state, str) {\n        return \"<div class=\\\"csl-right-inline\\\">\" + str + \"</div>\\n  \";\n    },\n    \"@display/indent\": function (state, str) {\n        return \"<div class=\\\"csl-indent\\\">\" + str + \"</div>\\n  \";\n    },\n    \"@showid/true\": function (state, str, cslid) {\n        if (!state.tmp.just_looking && ! state.tmp.suppress_decorations) {\n            if (cslid) {\n                return \"<span class=\\\"\" + state.opt.nodenames[cslid] + \"\\\" cslid=\\\"\" + cslid + \"\\\">\" + str + \"</span>\";\n            } else if (this.params && \"string\" === typeof str) {\n                var prePunct = \"\";\n                if (str) {\n                    var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                    prePunct = m[1];\n                    str = m[2];\n                }\n                var postPunct = \"\";\n                if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                    postPunct = str.slice(-1);\n                    str = str.slice(0,-1);\n                }\n                return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n            } else {\n                return str;\n            }\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        return \"<a href=\\\"\" + str + \"\\\">\" + str + \"</a>\";\n    },\n    \"@DOI/true\": function (state, str) {\n        var doiurl = str;\n        if (!str.match(/^https?:\\/\\//)) {\n            doiurl = \"https://doi.org/\" + str;\n        }\n        return \"<a href=\\\"\" + doiurl + \"\\\">\" + str + \"</a>\";\n    }\n};\n\n/**\n * Plain text output specification.\n *\n * (Code contributed by Simon Kornblith, Center for History and New Media,\n * George Mason University.)\n */\nCSL.Output.Formats.prototype.text = {\n    //\n    // text_escape: Format-specific function for escaping text destined\n    // for output.  Takes the text to be escaped as sole argument.  Function\n    // will be run only once across each portion of text to be escaped, it\n    // need not be idempotent.\n    //\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text;\n    },\n    \"bibstart\": \"\",\n    \"bibend\": \"\",\n    \"@font-style/italic\": false,\n    \"@font-style/oblique\": false,\n    \"@font-style/normal\": false,\n    \"@font-variant/small-caps\": false,\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-variant/normal\": false,\n    \"@font-weight/bold\": false,\n    \"@font-weight/normal\": false,\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": false,\n    \"@text-decoration/underline\": false,\n    \"@vertical-align/baseline\": false,\n    \"@vertical-align/sup\": false,\n    \"@vertical-align/sub\": false,\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            //\n            // Mostly right by being wrong (for apostrophes)\n            //\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    //\"@bibliography/body\": function (state,str){\n    //    return \"<div class=\\\"csl-bib-body\\\">\\n\"+str+\"</div>\";\n    //},\n    \"@cite/entry\": function (state, str) {\n\t\treturn state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function (state, str) {\n        return str+\"\\n\";\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n\"+str;\n    },\n    \"@display/left-margin\": function (state, str) {\n        return str;\n    },\n    \"@display/right-inline\": function (state, str) {\n        return str;\n    },\n    \"@display/indent\": function (state, str) {\n        return \"\\n    \"+str;\n    },\n    \"@showid/true\": function (state, str) {\n        return str;\n    },\n    \"@URL/true\": function (state, str) {\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        return str;\n    }\n};\n\n/**\n * Plain text output specification.\n *\n * (Code contributed by Simon Kornblith, Center for History and New Media,\n * George Mason University.)\n */\nCSL.Output.Formats.prototype.rtf = {\n    //\n    // text_escape: Format-specific function for escaping text destined\n    // for output.  Takes the text to be escaped as sole argument.  Function\n    // will be run only once across each portion of text to be escaped, it\n    // need not be idempotent.\n    //\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text\n        .replace(/([\\\\{}])/g, \"\\\\$1\")\n        .replace(CSL.SUPERSCRIPTS_REGEXP,\n                 function(aChar) {\n                     return \"\\\\super \" + CSL.SUPERSCRIPTS[aChar] + \"\\\\nosupersub{}\";\n                 })\n        .replace(/[\\u007F-\\uFFFF]/g,\n                 function(aChar) { return \"\\\\uc0\\\\u\"+aChar.charCodeAt(0).toString()+\"{}\"; })\n        .split(\"\\t\").join(\"\\\\tab{}\");\n    },\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-style/italic\":\"{\\\\i{}%%STRING%%}\",\n    \"@font-style/normal\":\"{\\\\i0{}%%STRING%%}\",\n    \"@font-style/oblique\":\"{\\\\i{}%%STRING%%}\",\n    \"@font-variant/small-caps\":\"{\\\\scaps %%STRING%%}\",\n    \"@font-variant/normal\":\"{\\\\scaps0{}%%STRING%%}\",\n    \"@font-weight/bold\":\"{\\\\b{}%%STRING%%}\",\n    \"@font-weight/normal\":\"{\\\\b0{}%%STRING%%}\",\n    \"@font-weight/light\":false,\n    \"@text-decoration/none\":false,\n    \"@text-decoration/underline\":\"{\\\\ul{}%%STRING%%}\",\n    \"@vertical-align/baseline\":false,\n    \"@vertical-align/sup\":\"\\\\super %%STRING%%\\\\nosupersub{}\",\n    \"@vertical-align/sub\":\"\\\\sub %%STRING%%\\\\nosupersub{}\",\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return CSL.Output.Formats.rtf.text_escape(state.getTerm(\"open-quote\"));\n        }\n        return CSL.Output.Formats.rtf.text_escape(state.getTerm(\"open-quote\")) + str + CSL.Output.Formats.rtf.text_escape(state.getTerm(\"close-quote\"));\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return CSL.Output.Formats.rtf.text_escape(\"\\u2019\");\n        }\n        return CSL.Output.Formats.rtf.text_escape(state.getTerm(\"open-inner-quote\")) + str + CSL.Output.Formats.rtf.text_escape(state.getTerm(\"close-inner-quote\"));\n    },\n    \"@quotes/false\": false,\n    \"bibstart\":\"{\\\\rtf \",\n    \"bibend\":\"}\",\n    \"@display/block\": \"\\\\line{}%%STRING%%\\\\line\\r\\n\",\n    \"@cite/entry\": function (state, str) {\n        // If wrapCitationEntry does not exist, cite/entry \n        // is not applied.\n\t\treturn state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function(state,str){\n        return str;\n    },\n    \"@display/left-margin\": function(state,str){\n        return str+\"\\\\tab \";\n    },\n    \"@display/right-inline\": function (state, str) {\n        return str+\"\\r\\n\";\n    },\n    \"@display/indent\": function (state, str) {\n        return \"\\n\\\\tab \"+str+\"\\\\line\\r\\n\";\n    },\n    \"@showid/true\": function (state, str) {\n        if (!state.tmp.just_looking && ! state.tmp.suppress_decorations) {\n            var prePunct = \"\";\n            if (str) {\n                var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                prePunct = m[1];\n                str = m[2];\n            }\n            var postPunct = \"\";\n            if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                postPunct = str.slice(-1);\n                str = str.slice(0,-1);\n            }\n            return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        return str;\n    }\n};\n\n/*\n\n    This does not seem to work in Zotero plugins. For some reason the scope of the link does not\n    close when interpreted by the LibreOffice. Perhaps this creates a field within a field,\n    and that is not allowed?\n\n    \"@URL/true\": function (state, str) {\n        return \"\\\\field{\\\\*\\\\fldinst{HYPERLINK \\\"\" + str + \"\\\"}}{\\\\fldrslt{\"+ str +\"}}\";\n    },\n    \"@DOI/true\": function (state, str) {\n        return \"\\\\field{\\\\*\\\\fldinst{HYPERLINK \\\"https://doi.org/\" + str + \"\\\"}}{\\\\fldrslt{\"+ str +\"}}\";\n    }\n*/\n\n/**\n * AsciiDoc output specification.\n *\n * See http://asciidoc.org/ or https://asciidoctor.org/\n */\nCSL.Output.Formats.prototype.asciidoc = {\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text.replace(\"*\", \"pass:[*]\", \"g\")\n            .replace(\"_\", \"pass:[_]\", \"g\")\n            .replace(\"#\", \"pass:[#]\", \"g\")\n            .replace(\"^\", \"pass:[^]\", \"g\")\n            .replace(\"~\", \"pass:[~]\", \"g\")\n            .replace(\"[[\", \"pass:[[[]\", \"g\")\n            .replace(\"  \", \"&#160; \", \"g\")\n            .replace(CSL.SUPERSCRIPTS_REGEXP, function(aChar) {\n                return \"^\" + CSL.SUPERSCRIPTS[aChar] + \"^\";\n            });\n    },\n    \"bibstart\": \"\",\n    \"bibend\": \"\",\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-style/italic\": \"__%%STRING%%__\",\n    \"@font-style/oblique\": \"__%%STRING%%__\",\n    \"@font-style/normal\": false,\n    \"@font-variant/small-caps\": \"[small-caps]#%%STRING%%#\",\n    \"@font-variant/normal\": false,\n    \"@font-weight/bold\": \"**%%STRING%%**\",\n    \"@font-weight/normal\": false,\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": false,\n    \"@text-decoration/underline\": \"[underline]##%%STRING%%##\",\n    \"@vertical-align/sup\": \"^^%%STRING%%^^\",\n    \"@vertical-align/sub\": \"~~%%STRING%%~~\",\n    \"@vertical-align/baseline\": false,\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return \"``\";\n        }\n        return \"``\" + str + \"''\";\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return \"`\";\n        }\n        return \"`\" + str + \"'\";\n    },\n    \"@quotes/false\": false,\n    \"@cite/entry\": function (state, str) {\n        // if wrapCitationEntry does not exist, cite/entry is not applied\n        return state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n    },\n    \"@bibliography/entry\": function (state, str) {\n        return str + \"\\n\";\n    },\n    \"@display/block\": function (state, str) {\n        return str;\n    },\n    \"@display/left-margin\": function (state, str) {\n        return str;\n    },\n    \"@display/right-inline\": function (state, str) {\n        return \" \" + str;\n    },\n    \"@display/indent\": function (state, str) {\n        return \" \" + str;\n    },\n    \"@showid/true\": function (state, str) {\n        if (!state.tmp.just_looking && !state.tmp.suppress_decorations && this.params && \"string\" === typeof str) {\n            var prePunct = \"\";\n            if (str) {\n                var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                prePunct = m[1];\n                str = m[2];\n            }\n            var postPunct = \"\";\n            if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                postPunct = str.slice(-1);\n                str = str.slice(0,-1);\n            }\n            return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        // AsciiDoc renders URLs automatically as links\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        var doiurl = str;\n        if (!str.match(/^https?:\\/\\//)) {\n            doiurl = \"https://doi.org/\" + str;\n        }\n        return doiurl + \"[\" + str + \"]\";\n    }\n};\n\n/**\n * Output specification for XSL-FO (Extensible Stylesheet\n * Language - Formatting Objects)\n *\n * See https://www.w3.org/TR/xsl11/#fo-section\n */\nCSL.Output.Formats.prototype.fo = {\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text.replace(/&/g, \"&#38;\")\n            .replace(/</g, \"&#60;\")\n            .replace(/>/g, \"&#62;\")\n            .replace(\"  \", \"&#160; \", \"g\")\n            .replace(CSL.SUPERSCRIPTS_REGEXP, function(aChar) {\n                return \"<fo:inline vertical-align=\\\"super\\\">\" + CSL.SUPERSCRIPTS[aChar] + \"</fo:inline>\";\n            });\n    },\n    \"bibstart\": \"\",\n    \"bibend\": \"\",\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-style/italic\": \"<fo:inline font-style=\\\"italic\\\">%%STRING%%</fo:inline>\",\n    \"@font-style/oblique\": \"<fo:inline font-style=\\\"oblique\\\">%%STRING%%</fo:inline>\",\n    \"@font-style/normal\": \"<fo:inline font-style=\\\"normal\\\">%%STRING%%</fo:inline>\",\n    \"@font-variant/small-caps\": \"<fo:inline font-variant=\\\"small-caps\\\">%%STRING%%</fo:inline>\",\n    \"@font-variant/normal\": \"<fo:inline font-variant=\\\"normal\\\">%%STRING%%</fo:inline>\",\n    \"@font-weight/bold\": \"<fo:inline font-weight=\\\"bold\\\">%%STRING%%</fo:inline>\",\n    \"@font-weight/normal\": \"<fo:inline font-weight=\\\"normal\\\">%%STRING%%</fo:inline>\",\n    \"@font-weight/light\": \"<fo:inline font-weight=\\\"lighter\\\">%%STRING%%</fo:inline>\",\n    \"@text-decoration/none\": \"<fo:inline text-decoration=\\\"none\\\">%%STRING%%</fo:inline>\",\n    \"@text-decoration/underline\": \"<fo:inline text-decoration=\\\"underline\\\">%%STRING%%</fo:inline>\",\n    \"@vertical-align/sup\": \"<fo:inline vertical-align=\\\"super\\\">%%STRING%%</fo:inline>\",\n    \"@vertical-align/sub\": \"<fo:inline vertical-align=\\\"sub\\\">%%STRING%%</fo:inline>\",\n    \"@vertical-align/baseline\": \"<fo:inline vertical-align=\\\"baseline\\\">%%STRING%%</fo:inline>\",\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    \"@cite/entry\": function (state, str) {\n        return state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n    },\n    \"@bibliography/entry\": function (state, str) {\n        var indent = \"\";\n        if (state.bibliography && state.bibliography.opt && state.bibliography.opt.hangingindent) {\n            var hi = state.bibliography.opt.hangingindent;\n            indent = \" start-indent=\\\"\" + hi +\"em\\\" text-indent=\\\"-\" + hi + \"em\\\"\";\n        }\n        var insert = \"\";\n        if (state.sys.embedBibliographyEntry) {\n            insert = state.sys.embedBibliographyEntry(this.item_id) + \"\\n\";\n        }\n        return \"<fo:block id=\\\"\" + this.system_id + \"\\\"\" + indent + \">\" + str + \"</fo:block>\\n\" + insert;\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n  <fo:block>\" + str + \"</fo:block>\\n\";\n    },\n    \"@display/left-margin\": function (state, str) {\n        return \"\\n  <fo:table table-layout=\\\"fixed\\\" width=\\\"100%\\\">\\n    \" +\n                \"<fo:table-column column-number=\\\"1\\\" column-width=\\\"$$$__COLUMN_WIDTH_1__$$$\\\"/>\\n    \" +\n                \"<fo:table-column column-number=\\\"2\\\" column-width=\\\"proportional-column-width(1)\\\"/>\\n    \" +\n                \"<fo:table-body>\\n      \" +\n                    \"<fo:table-row>\\n        \" +\n                        \"<fo:table-cell>\\n          \" +\n                            \"<fo:block>\" + str + \"</fo:block>\\n        \" +\n                        \"</fo:table-cell>\\n        \";\n    },\n    \"@display/right-inline\": function (state, str) {\n        return \"<fo:table-cell>\\n          \" +\n                \"<fo:block>\" + str + \"</fo:block>\\n        \" +\n            \"</fo:table-cell>\\n      \" +\n            \"</fo:table-row>\\n    \" +\n            \"</fo:table-body>\\n  \" +\n            \"</fo:table>\\n\";\n    },\n    \"@display/indent\": function (state, str) {\n        return \"<fo:block margin-left=\\\"2em\\\">\" + str + \"</fo:block>\\n\";\n    },\n    \"@showid/true\": function (state, str) {\n        if (!state.tmp.just_looking && !state.tmp.suppress_decorations && this.params && \"string\" === typeof str) {\n            var prePunct = \"\";\n            if (str) {\n                var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                prePunct = m[1];\n                str = m[2];\n            }\n            var postPunct = \"\";\n            if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                postPunct = str.slice(-1);\n                str = str.slice(0,-1);\n            }\n            return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        return \"<fo:basic-link external-destination=\\\"url('\" + str + \"')\\\">\" + str + \"</fo:basic-link>\";\n    },\n    \"@DOI/true\": function (state, str) {\n        var doiurl = str;\n        if (!str.match(/^https?:\\/\\//)) {\n            doiurl = \"https://doi.org/\" + str;\n        }\n        return \"<fo:basic-link external-destination=\\\"url('\" + doiurl + \"')\\\">\" + str + \"</fo:basic-link>\";\n    }\n};\n\n/**\n * LaTeX .bbl output.\n *\n * (Code contributed by Egon Willighagen, based on the prototype.text code.)\n */\nCSL.Output.Formats.prototype.latex = {\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text;\n    },\n    \"bibstart\": \"\\\\begin{thebibliography}{4}\",\n    \"bibend\": \"\\end{thebibliography}\",\n    \"@font-style/italic\": \"{\\\\em %%STRING%%}\",\n    \"@font-style/oblique\": false,\n    \"@font-style/normal\": false,\n    \"@font-variant/small-caps\": false,\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-variant/normal\": false,\n    \"@font-weight/bold\": \"{\\\\bf %%STRING%%}\",\n    \"@font-weight/normal\": false,\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": false,\n    \"@text-decoration/underline\": false,\n    \"@vertical-align/baseline\": false,\n    \"@vertical-align/sup\": false,\n    \"@vertical-align/sub\": false,\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            //\n            // Mostly right by being wrong (for apostrophes)\n            //\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    //\"@bibliography/body\": function (state,str){\n    //    return \"<div class=\\\"csl-bib-body\\\">\\n\"+str+\"</div>\";\n    //},\n    \"@cite/entry\": function (state, str) {\n\t\treturn state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function (state, str) {\n        return \"\\\\bibitem{\" + state.sys.embedBibliographyEntry(this.item_id) + \"}\\n\";\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n\"+str;\n    },\n    \"@display/left-margin\": function (state, str) {\n        return str;\n    },\n    \"@display/right-inline\": function (state, str) {\n        return str;\n    },\n    \"@display/indent\": function (state, str) {\n        return \"\\n    \"+str;\n    },\n    \"@showid/true\": function (state, str, cslid) {\n        return str;\n    },\n    \"@URL/true\": function (state, str) {\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        return str;\n    }\n};\n\nCSL.Output.Formats = new CSL.Output.Formats();\n\n/*global CSL: true */\n\n\n//\n// Time for a rewrite of this module.\n//\n// Simon has pointed out that list and hash behavior can\n// be obtained by ... just using a list and a hash.  This\n// is faster for batched operations, because sorting is\n// greatly optimized.  Since most of the interaction\n// with plugins at runtime will involve batches of\n// references, there will be solid gains if the current,\n// one-reference-at-a-time approach implemented here\n// can be replaced with something that leverages the native\n// sort method of the Array() type.\n//\n// That's going to take some redesign, but it will simplify\n// things in the long run, so it might as well happen now.\n//\n// We'll keep makeCitationCluster and makeBibliography as\n// simple methods that return a string.  Neither should\n// have any effect on internal state.  This will be a change\n// in behavior for makeCitationCluster.\n//\n// A new updateItems command will be introduced, to replace\n// insertItems.  It will be a simple list of IDs, in the\n// sequence of first reference in the document.\n//\n// The calling application should always invoke updateItems\n// before makeCitationCluster.\n//\n\n//\n// should allow batched registration of items by\n// key.  should behave as an update, with deletion\n// of items and the tainting of disambiguation\n// partner sets affected by a deletes and additions.\n//\n//\n// we'll need a reset method, to clear the decks\n// in the citation area and start over.\n\n/**\n * Registry of cited items.\n * <p>This is a persistent store of disambiguation and\n * sort order information relating to individual items\n * for which rendering is requested.  Item data is stored\n * in a hash, with the item key as hash key, for quick\n * retrieval.  A virtual sequence within the hashed store\n * is maintained on the fly as items are added to the\n * store, using <code>*_next</code> and <code>*_prev</code>\n * attributes on each item.  A separate hash of items\n * based on their undisambiguated cite form is\n * maintained, and the item id list and disambiguation\n * level for each set of disambiguation partners is shared\n * through the registry item.</p>\n * @class\n */\nCSL.Registry = function (state) {\n    this.debug = false;\n    this.state = state;\n    this.registry = {};\n    this.reflist = [];\n    this.refhash = {};\n    this.namereg = new CSL.Registry.NameReg(state);\n    this.citationreg = new CSL.Registry.CitationReg(state);\n    // See CSL.NameOutput.prototype.outputNames\n    // and CSL.Registry.prototype.doinserts\n    this.authorstrings = {};\n    \n    // for parallel delimiter support\n    this.masterMap = {};\n    \n    //\n    // shared scratch vars\n    this.mylist = [];\n    this.myhash = {};\n    this.deletes = [];\n    this.inserts = [];\n    this.uncited = {};\n    this.refreshes = {};\n    this.akeys = {};\n    this.oldseq = {};\n    this.return_data = {};\n    //\n    // each ambig is a list of the ids of other objects\n    // that have the same base-level rendering\n    this.ambigcites = {};\n    this.ambigresets = {};\n    this.sorter = new CSL.Registry.Comparifier(state, \"bibliography_sort\");\n    //this.modes = CSL.getModes.call(this.state);\n    //this.checkerator = new CSL.Checkerator();\n\n    this.getSortedIds = function () {\n        var ret = [];\n        for (var i = 0, ilen = this.reflist.length; i < ilen; i += 1) {\n            ret.push(\"\" + this.reflist[i].id);\n        }\n        return ret;\n    };\n\n    this.getSortedRegistryItems = function () {\n        var ret = [];\n        for (var i = 0, ilen = this.reflist.length; i < ilen; i += 1) {\n            ret.push(this.reflist[i]);\n        }\n        return ret;\n    };\n};\n\n//\n// Here's the sequence of operations to be performed on\n// update:\n//\n//  1.  (o) [init] Receive list as function argument, store as hash and as list.\n//  2.  (o) [init] Initialize refresh list.  Never needs sorting, only hash required.\n\n//  3.  (o) [dodeletes] Delete loop.\n//  3a. (o) [dodeletes] Delete names in items to be deleted from names reg.\n//  3b. (o) [dodeletes] Complement refreshes list with items affected by\n//      possible name changes.  We'll actually perform the refresh once\n//      all of the necessary data and parameters have been established\n//      in the registry.\n//  3c. (o) [dodeletes] Delete all items to be deleted from their disambig pools.\n//  3d. (o) [dodeletes] Delete all items in deletion list from hash.\n\n//  4.  (o) [doinserts] Insert loop.\n//  4a. (o) [doinserts] Retrieve entries for items to insert.\n//  4b. (o) [doinserts] Generate ambig key.\n//  4c. (o) [doinserts] Add names in items to be inserted to names reg\n//      (implicit in getAmbiguousCite).\n//  4d. (o) [doinserts] Record ambig pool key on akey list (used for updating further\n//      down the chain).\n//  4e. (o) [doinserts] Create registry token.\n//  4f. (o) [doinserts] Add item ID to hash.\n//  4g. (o) [doinserts] Set and record the base token to hold disambiguation\n//      results (\"disambig\" in the object above).\n//  5.  (o) [rebuildlist] Create \"new\" list of hash pointers, in the order given\n//          in the argument to the update function.\n//  6.  (o) [rebuildlist] Apply citation numbers to new list.\n//  7.  (o) [dorefreshes] Refresh items requiring update.\n\n\n\n//  5. (o) [delnames] Delete names in items to be deleted from names reg, and obtain IDs\n//         of other items that would be affected by changes around that surname.\n//  6. (o) [delnames] Complement delete and insert lists with items affected by\n//         possible name changes.\n//  7. (o) [delambigs] Delete all items to be deleted from their disambig pools.\n//  8. (o) [delhash] Delete all items in deletion list from hash.\n\n//  9. (o) [addtohash] Retrieve entries for items to insert.\n// 10. (o) [addtohash] Add items to be inserted to their disambig pools.\n// 11. (o) [addtohash] Add names in items to be inserted to names reg\n//         (implicit in getAmbiguousCite).\n// 12. (o) [addtohash] Create registry token for each item to be inserted.\n// 13. (o) [addtohash] Add items for insert to hash.\n\n// 14. (o) [buildlist] Create \"new\" list of hash pointers, in the order given in the argument\n//         to the update function.\n// 15. (o) [renumber] Apply citation numbers to new list.\n// 16. (o) [setdisambigs] Set disambiguation parameters on each inserted item token.\n// 17. (o) [setsortkeys] Set sort keys on each item token.\n// 18. (o) [sorttokens] Resort token list\n// 19. (o) [renumber] Reset citation numbers on list items\n//\n\nCSL.Registry.prototype.init = function (itemIDs, uncited_flag) {\n    var i, ilen;\n    this.oldseq = {};\n    //  1. Receive list as function argument, store as hash and as list.\n    //\n    // Result:\n    //   this.mylist: a list of all itemIDs of referenced items, cited and uncited.\n    //   this.myhash: a hash of index positions in this.mylist.\n    //   this.uncited: hash of uncited itemIDs.\n    //\n    // Proceed as follows.\n    //\n    if (uncited_flag) {\n        // If uncited_flag is non-nil, add any missing itemIDs to this.mylist\n        // from itemIDs input list, and set the itemIDs in itemIDs on this.uncited.\n        this.uncited = {};\n        for (var i=0,ilen=itemIDs.length;i<ilen; i += 1) {\n            if (!this.myhash[itemIDs[i]]) {\n                this.mylist.push(\"\" + itemIDs[i]);\n            }\n            this.uncited[itemIDs[i]] = true;\n            this.myhash[itemIDs[i]] = true;\n        }\n    } else {\n        // If uncited_flag is nil, remove duplicate itemIDs from itemIDs input\n        // list, set the result on this.mylist, and add missing itemIDs to\n        // this.mylist from itemIDs input list.\n        for (var key in this.uncited) {\n            itemIDs.push(key);\n        }\n        var myhash = {};\n        for (i=itemIDs.length-1;i>-1; i += -1) {\n            if (myhash[itemIDs[i]]) {\n                itemIDs = itemIDs.slice(0, i).concat(itemIDs.slice(i + 1));\n            } else {\n                myhash[itemIDs[i]] = true;\n            }\n        }\n        this.mylist = itemIDs;\n        this.myhash = myhash;\n    }\n    //\n    //  2. Initialize refresh list.  Never needs sorting, only hash required.\n    //\n    this.refreshes = {};\n    this.touched = {};\n    this.ambigsTouched = {};\n    this.ambigresets = {};\n};\n\nCSL.Registry.prototype.dopurge = function (myhash) {\n    // Remove any uncited items not in myhash\n    for (var i=this.mylist.length-1;i>-1;i+=-1) {\n        // Might not want to be quite this restrictive.\n        if (this.citationreg.citationsByItemId) {\n            if ((!this.citationreg.citationsByItemId || !this.citationreg.citationsByItemId[this.mylist[i]]) && !myhash[this.mylist[i]]) {\n                delete this.myhash[this.mylist[i]];\n                delete this.uncited[this.mylist[i]];\n                this.mylist = this.mylist.slice(0,i).concat(this.mylist.slice(i+1));\n            }\n        }\n    }\n    this.dodeletes(this.myhash);\n};\n\nCSL.Registry.prototype.dodeletes = function (myhash) {\n    var otheritems, key, ambig, pos, len, items, kkey, mypos, id;\n    if (\"string\" === typeof myhash) {\n        var key = myhash;\n        myhash = {};\n        myhash[key] = true;\n    }\n    //\n    //  3. Delete loop.\n    //\n    for (var key in this.registry) {\n        if (!myhash[key]) {\n            // skip items explicitly marked as uncited\n            if (this.uncited[key]) {\n                continue;\n            }\n            //\n            //  3a. Delete names in items to be deleted from names reg.\n            //\n            otheritems = this.namereg.delitems(key);\n            //\n            //  3b. Complement refreshes list with items affected by\n            //      possible name changes.  We'll actually perform the refresh once\n            //      all of the necessary data and parameters have been established\n            //      in the registry.\n            //\n            for (kkey in otheritems) {\n                this.refreshes[kkey] = true;\n            }\n            //\n            //  3c. Delete all items to be deleted from their disambig pools.\n            //\n            ambig = this.registry[key].ambig;\n            mypos = this.ambigcites[ambig].indexOf(key);\n            if (mypos > -1) {\n                items = this.ambigcites[ambig].slice();\n                this.ambigcites[ambig] = items.slice(0, mypos).concat(items.slice(mypos+1, items.length));\n                this.ambigresets[ambig] = this.ambigcites[ambig].length;\n            }\n            //\n            // XX. What we've missed is to provide an update of all\n            // items sharing the same ambig  += -1 the remaining items in\n            // ambigcites.  So let's do that here, just in case the\n            // names update above doesn't catch them all.\n            //\n            len = this.ambigcites[ambig].length;\n            for (pos = 0; pos < len; pos += 1) {\n                id = \"\" + this.ambigcites[ambig][pos];\n                this.refreshes[id] = true;\n            }\n            //\n            // 3d-0. Remove parallel id references and realign\n            // parallel ID refs.\n            //\n            if (this.registry[key].siblings) {\n                if (this.registry[key].siblings.length == 1) {\n                    var loneSiblingID = this.registry[key].siblings[0];\n                    if (this.registry[loneSiblingID].siblings) {\n                        this.registry[loneSiblingID].siblings.pop();\n                        this.registry[loneSiblingID].master = true;\n                        // this.registry[loneSiblingID].parallel = false;\n                    }\n                } else if (this.registry[key].siblings.length > 1) {\n                    var removeIDs = [key];\n                    if (this.registry[key].master) {\n                        var newmasterID = this.registry[key].siblings[0];\n                        var newmaster = this.registry[newmasterID];\n                        newmaster.master = true;\n                        // newmaster.parallel_delimiter is set externally, if at all\n                        // newmaster.parallel = false;\n                        removeIDs.push(newmasterID);\n                        // for (var k = 0, klen = this.registry[key].siblings.length; k < klen; k += 1) {\n                        //     this.registry[this.registry[key].siblings[k]].parallel = newmasterID;\n                        // }\n                    }\n                    var buffer = [];\n                    for (var k = this.registry[key].siblings.length - 1; k > -1; k += -1) {\n                        var siblingID = this.registry[key].siblings.pop();\n                        if (removeIDs.indexOf(siblingID) === -1) {\n                            buffer.push(siblingID);\n                        }\n                    }\n                    for (var k = buffer.length - 1; k > -1; k += -1) {\n                        this.registry[key].siblings.push(buffer[k]);\n                    }\n                }\n            }\n            //\n            // 3d-1. Remove item from reflist\n            for (var i=this.reflist.length-1;i>-1;i--) {\n                if (this.reflist[i].id === key) {\n                    this.reflist = this.reflist.slice(0, i).concat(this.reflist.slice(i+1));\n                }\n            }\n            //\n            //  3d. Delete all items in deletion list from hash.\n            //\n            delete this.registry[key];\n            delete this.refhash[key];\n\n            // For processCitationCluster()\n            this.return_data.bibchange = true;\n        }\n    }\n    // Disabled.  See formats.js for code.\n    // this.state.fun.decorate.items_delete( this.state.output[this.state.opt.mode].tmp, myhash );\n};\n\nCSL.Registry.prototype.doinserts = function (mylist) {\n    var item, Item, akey, newitem, abase, i, ilen;\n    if (\"string\" === typeof mylist) {\n        mylist = [mylist];\n    }\n    //\n    //  4. Insert loop.\n    //\n    for (var i = 0, ilen = mylist.length; i < ilen; i += 1) {\n        item = mylist[i];\n        if (!this.registry[item]) {\n            //\n            //  4a. Retrieve entries for items to insert.\n            //\n            Item = this.state.retrieveItem(item);\n\n            //\n            //  4b. Generate ambig key.\n            //\n            // AND\n            //\n            //  4c. Add names in items to be inserted to names reg\n            //      (implicit in getAmbiguousCite).\n            //\n            akey = CSL.getAmbiguousCite.call(this.state, Item);\n            this.ambigsTouched[akey] = true;\n            //\n            //  4d. Record ambig pool key on akey list (used for updating further\n            //      down the chain).\n            //\n            if (!Item.legislation_id) {\n                this.akeys[akey] = true;\n            }\n            //\n            //  4e. Create registry token.\n            //\n            newitem = {\n                \"id\": \"\" + item,\n                \"seq\": 0,\n                \"offset\": 0,\n                \"sortkeys\": false,\n                \"ambig\": false,\n                \"rendered\": false,\n                \"disambig\": false,\n                \"ref\": Item,\n                \"newItem\": true\n            };\n            //\n            //\n            //  4f. Add item ID to hash.\n            //\n            this.registry[item] = newitem;\n            //\n            //  4f(a). Add first reference note number\n            //         (this may be redundant)\n            if (this.citationreg.citationsByItemId && this.citationreg.citationsByItemId[item]) {\n                this.registry[item][\"first-reference-note-number\"] = this.citationreg.citationsByItemId[item][0].properties.noteIndex;\n            }\n\n            //\n            //  4g. Set and record the base token to hold disambiguation\n            //      results (\"disambig\" in the object above).\n            //\n            abase = CSL.getAmbigConfig.call(this.state);\n            this.registerAmbigToken(akey, item, abase);\n\n            //if (!this.ambigcites[akey]){\n            //    this.ambigcites[akey] = [];\n            //}\n            //CSL.debug(\"Run: \"+item+\"(\"+this.ambigcites[akey]+\")\");\n            //if (this.ambigcites[akey].indexOf(item) === -1){\n            //    CSL.debug(\"  Add: \"+item);\n            //    this.ambigcites[akey].push(item);\n            //}\n            //\n            //  4h. Make a note that this item needs its sort keys refreshed.\n            //\n            this.touched[item] = true;\n            // For processCitationCluster()\n            this.return_data.bibchange = true;\n        }\n    }\n    // Disabled.  See formats.js for code.\n    // this.state.fun.decorate.items_add( this.state.output[this.state.opt.mode].tmp, mylist );\n};\n\n/*\n// No longer required.\nCSL.Registry.prototype.douncited = function () {\n    var pos, len;\n    var cited_len = this.mylist.length - this.uncited.length;\n    for (pos = 0, len = cited_len; pos < len; pos += 1) {\n        this.registry[this.mylist[pos]].uncited = false;\n    }\n    for (pos = cited_len, len = this.mylist.length; pos < len; pos += 1) {\n        this.registry[this.mylist[pos]].uncited = true;\n    }\n};\n*/\n\nCSL.Registry.prototype.rebuildlist = function (nosort) {\n    var len, pos, item, Item;\n    //\n    //  5. Create \"new\" list of hash pointers, in the order given in the argument\n    //     to the update function.\n    //\n    //\n    // XXX Keep reflist in place.\n    //\n    if (!nosort) {\n        this.reflist_inserts = [];\n        //\n        //  6. Apply citation numbers to new list,\n        //     saving off old sequence numbers as we go.\n        //\n        // XXX Just memo inserts -- actual insert happens below, at last \"sort\"\n        //\n        len = this.mylist.length;\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            if (Item.newItem) {\n                this.reflist_inserts.push(Item);\n            }\n            this.oldseq[item] = this.registry[item].seq;\n            this.registry[item].seq = (pos + 1);\n        }\n    } else {\n        this.reflist = [];\n        len = this.mylist.length;\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            this.reflist.push(Item);\n            this.oldseq[item] = this.registry[item].seq;\n            this.registry[item].seq = (pos + 1);\n        }\n    }\n};\n\n/*\n * Okay, at this point we should have a numbered list\n * of registry tokens in the notional order requested,\n * with sequence numbers to reconstruct the ordering\n * if the list is remangled.  So far so good.\n */\n\nCSL.Registry.prototype.dorefreshes = function () {\n    var key, regtoken, Item, akey, abase;\n    //\n    //  7. Refresh items requiring update.\n    //\n    // It looks like we need to do four things on each cite for refresh:\n    // (1) Generate the akey for the cite.\n    // (2) Register it on the ambig token.\n    // (3) Register the akey in this.akeys\n    // (4) Register the item ID in this.touched\n    //\n    for (var key in this.refreshes) {\n        regtoken = this.registry[key];\n        if (!regtoken) {\n            continue;\n        }\n        regtoken.sortkeys = undefined;\n        Item = this.state.refetchItem(key);\n        var akey = regtoken.ambig;\n\n        if (\"undefined\" === typeof akey) {\n            this.state.tmp.disambig_settings = false;\n            akey = CSL.getAmbiguousCite.call(this.state, Item);\n            abase = CSL.getAmbigConfig.call(this.state);\n            this.registerAmbigToken(akey, key, abase);\n        }\n        for (var akkey in this.ambigresets) {\n            if (this.ambigresets[akkey] === 1) {\n                var loneKey = this.ambigcites[akey][0];\n                var Item = this.state.refetchItem(loneKey);\n                this.registry[loneKey].disambig = new CSL.AmbigConfig();\n                this.state.tmp.disambig_settings = false;\n                var akey = CSL.getAmbiguousCite.call(this.state, Item);\n                var abase = CSL.getAmbigConfig.call(this.state);\n                this.registerAmbigToken(akey, loneKey, abase);\n            }\n        }\n        this.state.tmp.taintedItemIDs[key] = true;\n        this.ambigsTouched[akey] = true;\n        if (!Item.legislation_id) {\n            this.akeys[akey] = true;\n        }\n        this.touched[key] = true;\n    }\n};\n\n/*\n * Main disambiguation  += -1 can everything for disambiguation be\n * crunched into this function?\n */\nCSL.Registry.prototype.setdisambigs = function () {\n    //\n    // Okay, more changes.  Here is where we resolve all disambiguation\n    // issues for cites touched by the update.  The this.ambigcites set is\n    // based on the complete short form of citations, and is the basis on\n    // which names are added and minimal adding of initials or given names\n    // is performed.\n    //\n\n    //\n    //  8.  Set disambiguation parameters on each inserted item token.\n    //\n    for (var akey in this.ambigsTouched) {\n        //\n        // Disambiguation is fully encapsulated.\n        // Disambiguator will run only if there are multiple\n        // items, and at least one disambiguation mode is\n        // in effect.\n        this.state.disambiguate.run(akey);\n    }\n    this.ambigsTouched = {};\n    this.akeys = {};\n};\n\n\n\nCSL.Registry.prototype.renumber = function () {\n    var len, pos, item;\n    //\n    // 19. Reset citation numbers on list items\n    //\n    if (this.state.bibliography_sort.opt.citation_number_sort_direction === CSL.DESCENDING) {\n        this.state.bibliography_sort.tmp.citation_number_map = {};\n    }\n    len = this.reflist.length;\n    for (pos = 0; pos < len; pos += 1) {\n        item = this.reflist[pos];\n        // save the overhead of rerenderings if citation-number is not\n        // used in the style.\n        item.seq = (pos + 1);\n        if (this.state.bibliography_sort.opt.citation_number_sort_direction === CSL.DESCENDING) {\n            this.state.bibliography_sort.tmp.citation_number_map[item.seq] = (this.reflist.length - item.seq + 1);\n        }\n        // update_mode is set to CSL.NUMERIC if citation-number is rendered\n        // in citations.\n        if (this.state.opt.update_mode === CSL.NUMERIC && item.seq != this.oldseq[item.id]) {\n            this.state.tmp.taintedItemIDs[item.id] = true;\n        }\n        if (item.seq != this.oldseq[item.id]) {\n            this.return_data.bibchange = true;\n        }\n    }\n};\n\nCSL.Registry.prototype.setsortkeys = function () {\n    var key;\n    //\n    // 17. Set sort keys on each item token.\n    //\n    for (var i = 0, ilen = this.mylist.length; i < ilen; i += 1) {\n        var key = this.mylist[i];\n        // The last of these conditions may create some thrashing on styles that do not require sorting.\n        if (this.touched[key] || this.state.tmp.taintedItemIDs[key] || !this.registry[key].sortkeys) {\n            this.registry[key].sortkeys = CSL.getSortKeys.call(this.state, this.state.retrieveItem(key), \"bibliography_sort\");\n        }\n    }\n};\n\nCSL.Registry.prototype._insertItem = function(element, array) {\n    array.splice(this._locationOf(element, array) + 1, 0, element);\n    return array;\n};\n\nCSL.Registry.prototype._locationOf = function(element, array, start, end) {\n    if (array.length === 0) {\n        return -1;\n    }\n    start = start || 0;\n    end = end || array.length;\n    var pivot = (start + end) >> 1;  // should be faster than dividing by 2\n    \n    var c = this.sorter.compareKeys(element, array[pivot]);\n    if (end - start <= 1) {\n        return c == -1 ? pivot - 1 : pivot;\n    }\n    switch (c) {\n        case -1: return this._locationOf(element, array, start, pivot);\n        case 0: return pivot;\n        case 1: return this._locationOf(element, array, pivot, end);\n    }\n};\n\nCSL.Registry.prototype.sorttokens = function (nosort) {\n    var len, item, Item, pos;\n    //\n    // 18. Resort token list.\n    //\n    if (!nosort) {\n        this.reflist_inserts = [];\n        len = this.mylist.length;\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            if (Item.newItem) {\n                this.reflist_inserts.push(Item);\n            }\n        }\n        // There is a thin possibility that tainted items in a sorted list\n        // will change position due to disambiguation. We cover for that here.\n        for (var key in this.state.tmp.taintedItemIDs) {\n            if (this.registry[key] && !this.registry[key].newItem) {\n                // Move tainted items from reflist to reflist_inserts\n                for (var i=this.reflist.length-1;i>-1;i--) {\n                    if (this.reflist[i].id === key) {\n                        this.reflist_inserts.push(this.reflist[i]);\n                        this.reflist = this.reflist.slice(0, i).concat(this.reflist.slice(i+1));\n                    }\n                }\n            }\n        }\n        for (var i=0,ilen=this.reflist_inserts.length;i<ilen;i++) {\n            var Item = this.reflist_inserts[i];\n            delete Item.newItem;\n            this.reflist = this._insertItem(Item, this.reflist);\n        }\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            this.registry[item].seq = (pos + 1);\n        }\n    }\n};\n\n/**\n * Compare two sort keys\n * <p>Nested, because keys are an array.</p>\n */\nCSL.Registry.Comparifier = function (state, keyset) {\n    var sort_directions, len, pos, compareKeys;\n    var sortCompare = CSL.getSortCompare.call(state, state.opt[\"default-locale-sort\"]);\n    sort_directions = state[keyset].opt.sort_directions;\n    this.compareKeys = function (a, b) {\n        len = a.sortkeys ? a.sortkeys.length : 0;\n        for (pos = 0; pos < len; pos += 1) {\n            //\n            // for ascending sort 1 uses 1, -1 uses -1.\n            // For descending sort, the values are reversed.\n            //\n            // Need to handle undefined values.  No way around it.\n            // So have to screen .localeCompare (which is also\n            // needed) from undefined values.  Everywhere, in all\n            // compares.\n            //\n            var cmp = 0;\n            if (a.sortkeys[pos] === b.sortkeys[pos]) {\n                cmp = 0;\n            } else if (\"undefined\" === typeof a.sortkeys[pos]) {\n                cmp = sort_directions[pos][1];\n            } else if (\"undefined\" === typeof b.sortkeys[pos]) {\n                cmp = sort_directions[pos][0];\n            } else {\n                // cmp = a.sortkeys[pos].localeCompare(b.sortkeys[pos]);\n                cmp = sortCompare(a.sortkeys[pos], b.sortkeys[pos]);\n            }\n            if (0 < cmp) {\n                return sort_directions[pos][1];\n            } else if (0 > cmp) {\n                return sort_directions[pos][0];\n            }\n        }\n        if (a.seq > b.seq) {\n            return 1;\n        } else if (a.seq < b.seq) {\n            return -1;\n        }\n        return 0;\n    };\n    compareKeys = this.compareKeys;\n    this.compareCompositeKeys = function (a, b) {\n        return compareKeys(a[1], b[1]);\n    };\n};\n\n\n/**\n * Compare two disambiguation tokens by their registry sort order\n * <p>Disambiguation lists need to be sorted this way, to\n * obtain the correct year-suffix when that's used.</p>\n */\nCSL.Registry.prototype.compareRegistryTokens = function (a, b) {\n    if (a.seq > b.seq) {\n        return 1;\n    } else if (a.seq < b.seq) {\n        return -1;\n    }\n    return 0;\n};\n\nCSL.Registry.prototype.registerAmbigToken = function (akey, id, ambig_config) {\n    //SNIP-START\n    if (!this.registry[id]) {\n        CSL.debug(\"Warning: unregistered item: itemID=(\"+id+\"), akey=(\"+akey+\")\");\n    }\n    //SNIP-END\n    // Taint if number of names to be included has changed\n    if (this.registry[id] && this.registry[id].disambig && this.registry[id].disambig.names) {\n        for (var i = 0, ilen = ambig_config.names.length; i < ilen; i += 1) {\n            var new_names_params = ambig_config.names[i];\n            var old_names_params = this.registry[id].disambig.names[i];\n            if (new_names_params !== old_names_params) {\n                this.state.tmp.taintedItemIDs[id] = true;\n            } else if (ambig_config.givens[i]) {\n                // Compare givenses only if the number of names is aligned.\n                for (var j=0,jlen=ambig_config.givens[i].length;j<jlen;j+=1) {\n                    var new_gnames_params = ambig_config.givens[i][j];\n                    var old_gnames_params = this.registry[id].disambig.givens[i][j];\n                    if (new_gnames_params !== old_gnames_params) {\n                        this.state.tmp.taintedItemIDs[id] = true;\n                    }\n                }\n            }\n        }\n    }\n\n    if (!this.ambigcites[akey]) {\n        this.ambigcites[akey] = [];\n    }\n    if (this.ambigcites[akey].indexOf(\"\" + id) === -1) {\n        this.ambigcites[akey].push(\"\" + id);\n    }\n    this.registry[id].ambig = akey;\n    this.registry[id].disambig = CSL.cloneAmbigConfig(ambig_config);\n};\n\n\n/**\n * Get the sort key of an item, without decorations\n * <p>This is used internally by the Registry.</p>\n */\nCSL.getSortKeys = function (Item, key_type) {\n    var area, root, extension, strip_prepositions, len, pos;\n    //SNIP-START\n    if (false) {\n        CSL.debug(\"KEY TYPE: \" + key_type);\n    }\n    //SNIP-END\n    area = this.tmp.area;\n    root = this.tmp.root;\n    extension = this.tmp.extension;\n    strip_prepositions = CSL.Util.Sort.strip_prepositions;\n    this.tmp.area = key_type;\n    // Gawdawful, this.\n    this.tmp.root = key_type.indexOf(\"_\") > -1 ? key_type.slice(0,-5) : key_type;\n    this.tmp.extension = \"_sort\";\n    this.tmp.disambig_override = true;\n    this.tmp.disambig_request = false;\n    this.tmp.suppress_decorations = true;\n    CSL.getCite.call(this, Item);\n    this.tmp.suppress_decorations = false;\n    this.tmp.disambig_override = false;\n    len = this[key_type].keys.length;\n    for (pos = 0; pos < len; pos += 1) {\n        this[key_type].keys[pos] = strip_prepositions(this[key_type].keys[pos]);\n    }\n    //SNIP-START\n    if (false) {\n        CSL.debug(\"sort keys (\" + key_type + \"): \" + this[key_type].keys);\n    }\n    //SNIP-END\n    \n    this.tmp.area = area;\n    this.tmp.root = root;\n    this.tmp.extension = extension;\n    return this[key_type].keys;\n};\n\n\n/*global CSL: true */\n\nCSL.Registry.NameReg = function (state) {\n    var pkey, ikey, skey, dagopt, gdropt, items, strip_periods, set_keys, evalname, delitems, addname, myitems;\n    this.state = state;\n    this.namereg = {};\n    this.nameind = {};\n    // used for restoring state following preview\n    this.nameindpkeys = {};\n    //\n    // family, initials form, fullname (with given stripped of periods)\n    //\n    // keys registered, indexed by ID\n    this.itemkeyreg = {};\n\n    strip_periods = function (str) {\n        if (!str) {\n            str = \"\";\n        }\n        return str.replace(/\\./g, \" \").replace(/\\s+/g, \" \").replace(/\\s+$/,\"\");\n    };\n\n    set_keys = function (state, itemid, nameobj) {\n        pkey = strip_periods(nameobj.family);\n        skey = strip_periods(nameobj.given);\n        // Drop lowercase suffixes (such as et al.) from given name field\n        // for disambiguation purposes.\n        var m = skey.match(/[,\\!]* ([^,]+)$/);\n        if (m && m[1] === m[1].toLowerCase()) {\n            skey = skey.replace(/[,\\!]* [^,]+$/, \"\");\n        }\n        // The %s terminator enables normal initialization behavior\n        // with non-Byzantine names.\n        ikey = CSL.Util.Names.initializeWith(state, skey, \"%s\");\n        if (state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\") {\n            pkey = \"\" + itemid + pkey;\n        }\n    };\n\n    evalname = function (item_id, nameobj, namenum, request_base, form, initials) {\n        var param;\n        // XXX THIS CAN NO LONGER HAPPEN\n        if (state.tmp.area.slice(0, 12) === \"bibliography\" && !form) {\n            if (\"string\" === typeof initials) {\n                return 1;\n            } else {\n                return 2;\n            }\n        }\n        var res = state.nameOutput.getName(nameobj, \"locale-translit\", true);\n        nameobj = res.name;\n        set_keys(this.state, \"\" + item_id, nameobj);\n        //\n        // possible options are:\n        //\n        // <option disambiguate-add-givenname value=\"true\"/> (a)\n        // <option disambiguate-add-givenname value=\"all-names\"/> (a)\n        // <option disambiguate-add-givenname value=\"all-names-with-initials\"/> (b)\n        // <option disambiguate-add-givenname value=\"primary-name\"/> (d)\n        // <option disambiguate-add-givenname value=\"primary-name-with-initials\"/> (e)\n        // <option disambiguate-add-givenname value=\"by-cite\"/> (g)\n        //\n        param = 2;\n        dagopt = state.opt[\"disambiguate-add-givenname\"];\n        gdropt = state.citation.opt[\"givenname-disambiguation-rule\"];\n        var gdropt_orig = gdropt;\n        if (gdropt === \"by-cite\") {\n            gdropt = \"all-names\";\n        }\n        //\n        // set initial value\n        //\n        if (\"short\" === form) {\n            param = 0;\n        } else if (\"string\" === typeof initials) {\n            param = 1;\n        }\n        //\n        // give literals a pass\n        if (\"undefined\" === typeof this.namereg[pkey] || \"undefined\" === typeof this.namereg[pkey].ikey[ikey]) {\n            return param;\n        }\n        //\n        // adjust value upward if appropriate -- only if running\n        // a non-names-global disambiguation strategy\n        //\n        if (gdropt_orig === \"by-cite\" && param <= request_base) {\n            //param = request_base;\n            return request_base;\n        }\n        if (!dagopt) {\n            return param;\n        }\n        if (\"string\" === typeof gdropt && gdropt.slice(0, 12) === \"primary-name\" && namenum > 0) {\n            return param;\n        }\n        //\n        // the last composite condition is for backward compatibility\n        //\n        if (!gdropt || gdropt === \"all-names\" || gdropt === \"primary-name\") {\n            if (this.namereg[pkey].count > 1) {\n                param = 1;\n            }\n            if ((this.namereg[pkey].ikey \n                 && this.namereg[pkey].ikey[ikey].count > 1)\n                || (this.namereg[pkey].count > 1 \n                    && \"string\" !== typeof initials)) {\n\n                param = 2;\n            }\n        } else if (gdropt === \"all-names-with-initials\" || gdropt === \"primary-name-with-initials\") {\n            if (this.namereg[pkey].count > 1) {\n                param = 1;\n            } else {\n                param = 0;\n            }\n        }\n        if (!state.registry.registry[item_id]) {\n            if (form == \"short\") {\n                return 0;\n            } else if (\"string\" == typeof initials) {\n                return 1;\n            }\n        } else {\n            return param;\n        }\n    };\n\n    //\n    // The operation of this function does not show up in the\n    // standard test suite, but it has been hand-tested with\n    // a print trace, and seems to work okay.\n    //\n    delitems = function (ids) {\n        var pos, len, posB, id, fullkey;\n        if (\"string\" === typeof ids || \"number\" === typeof ids) {\n            ids = [\"\" + ids];\n        }\n        // ret carries the IDs of other items using this name.\n        var ret = {};\n        len = ids.length;\n        for (pos = 0; pos < len; pos += 1) {\n            id = \"\" + ids[pos];\n            if (!this.nameind[id]) {\n                continue;\n            }\n            for (fullkey in this.nameind[id]) {\n                if (this.nameind[id].hasOwnProperty(fullkey)) {\n                    var key = fullkey.split(\"::\");\n                    pkey = key[0];\n                    ikey = key[1];\n                    skey = key[2];\n                    // Skip names that have been deleted already.\n                    // Needed to clear integration DisambiguateAddGivenname1.txt\n                    // and integration DisambiguateAddGivenname2.txt\n                    if (\"undefined\" === typeof this.namereg[pkey]) {\n                        continue;\n                    }\n\n                    // ????\n                    //posA = this.namereg[pkey].items.indexOf(posA);\n\n                    items = this.namereg[pkey].items;\n                    // This was really, really unperceptive. They key elements\n                    // have absolutely nothing to do with whether there was ever\n                    // a registration at each key level.\n                    if (skey && this.namereg[pkey].ikey[ikey] && this.namereg[pkey].ikey[ikey].skey[skey]) {\n                        myitems = this.namereg[pkey].ikey[ikey].skey[skey].items;\n                        posB = myitems.indexOf(\"\" + id);\n                        if (posB > -1) {\n                            this.namereg[pkey].ikey[ikey].skey[skey].items = myitems.slice(0, posB).concat(myitems.slice([(posB + 1)]));\n                        }\n                        if (this.namereg[pkey].ikey[ikey].skey[skey].items.length === 0) {\n                            delete this.namereg[pkey].ikey[ikey].skey[skey];\n                            this.namereg[pkey].ikey[ikey].count += -1;\n                            if (this.namereg[pkey].ikey[ikey].count < 2) {\n                                for (var i = 0, ilen = this.namereg[pkey].ikey[ikey].items.length; i < ilen; i += 1) {\n                                    state.tmp.taintedItemIDs[this.namereg[pkey].ikey[ikey].items[i]] = true;\n                                }\n                            }\n                        }\n                    }\n                    if (ikey && this.namereg[pkey].ikey[ikey]) {\n                        posB = this.namereg[pkey].ikey[ikey].items.indexOf(\"\" + id);\n                        if (posB > -1) {\n                            items = this.namereg[pkey].ikey[ikey].items.slice();\n                            this.namereg[pkey].ikey[ikey].items = items.slice(0, posB).concat(items.slice([posB + 1]));\n                        }\n                        if (this.namereg[pkey].ikey[ikey].items.length === 0) {\n                            delete this.namereg[pkey].ikey[ikey];\n                            this.namereg[pkey].count += -1;\n                            if (this.namereg[pkey].count < 2) {\n                                for (var i = 0, ilen = this.namereg[pkey].items.length; i < ilen; i += 1) {\n                                    state.tmp.taintedItemIDs[this.namereg[pkey].items[i]] = true;\n                                }\n                            }\n                        }\n                    }\n                    if (pkey) {\n                        posB = this.namereg[pkey].items.indexOf(\"\" + id);\n                        if (posB > -1) {\n                            items = this.namereg[pkey].items.slice();\n                            this.namereg[pkey].items = items.slice(0, posB).concat(items.slice([posB + 1], items.length));\n                        }\n                        if (this.namereg[pkey].items.length < 2) {\n                            delete this.namereg[pkey];\n                        }\n                    }\n                    delete this.nameind[id][fullkey];\n                }\n            }\n            delete this.nameind[id];\n            delete this.nameindpkeys[id];\n        }\n        return ret;\n    };\n    //\n    // Run ALL\n    // renderings with disambiguate-add-givenname set to a value\n    // with the by-cite behaviour, and then set the names-based\n    // expanded form when the final makeCitationCluster rendering\n    // is output.  This could be done with a single var set on\n    // the state object in the execution wrappers that run the\n    // style.\n    //\n    addname = function (item_id, nameobj, pos) {\n        var i, ilen;\n        var res = state.nameOutput.getName(nameobj, \"locale-translit\", true);\n        nameobj = res.name;\n\n        if (state.citation.opt[\"givenname-disambiguation-rule\"]\n            && state.citation.opt[\"givenname-disambiguation-rule\"].slice(0, 8) === \"primary-\"\n            && pos !== 0) {\n                return;\n        }\n        \n        // A hack. Safe if the name object is used only here, for disambiguation purposes.\n        if (state.opt[\"demote-non-dropping-particle\"] === \"never\" && nameobj[\"non-dropping-particle\"] && nameobj[\"family\"]) {\n            nameobj[\"family\"] = nameobj[\"non-dropping-particle\"] + \" \" + nameobj[\"family\"];\n        }\n        \n        //CSL.debug(\"INS\");\n        set_keys(this.state, \"\" + item_id, nameobj);\n        // pkey, ikey and skey should be stored in separate cascading objects.\n        // there should also be a kkey, on each, which holds the item ids using\n        // that form of the name.\n        //\n        // (later note: well, we seem to have slipped a notch here.\n        // Adding lists of IDs all over the place here makes no sense;\n        // the lists need to include _only_ the items currently rendered\n        // at the given level, and the place to do that is in evalname,\n        // and in delnames, not here.)\n        if (pkey) {\n            if (\"undefined\" === typeof this.namereg[pkey]) {\n                this.namereg[pkey] = {};\n                this.namereg[pkey].count = 0;\n                this.namereg[pkey].ikey = {};\n                this.namereg[pkey].items = [item_id];\n            } else if (this.namereg[pkey].items.indexOf(item_id) === -1) {\n                this.namereg[pkey].items.push(item_id);\n            }\n//            if (this.namereg[pkey].items.indexOf(item_id) === -1) {\n//                this.namereg[pkey].items.push(item_id);\n//            }\n        }\n        if (pkey && ikey) {\n            if (\"undefined\" === typeof this.namereg[pkey].ikey[ikey]) {\n                this.namereg[pkey].ikey[ikey] = {};\n                this.namereg[pkey].ikey[ikey].count = 0;\n                this.namereg[pkey].ikey[ikey].skey = {};\n                this.namereg[pkey].ikey[ikey].items = [item_id];\n                this.namereg[pkey].count += 1;\n                if (this.namereg[pkey].count === 2) {\n                    for (var i = 0, ilen = this.namereg[pkey].items.length; i < ilen; i += 1) {\n                        state.tmp.taintedItemIDs[this.namereg[pkey].items[i]] = true;\n                    }\n                }\n            } else if (this.namereg[pkey].ikey[ikey].items.indexOf(item_id) === -1) {\n                this.namereg[pkey].ikey[ikey].items.push(item_id);\n            }\n//            if (this.namereg[pkey].ikey[ikey].items.indexOf(item_id) === -1) {\n//                this.namereg[pkey].ikey[ikey].items.push(item_id);\n//            }\n        }\n        if (pkey && ikey && skey) {\n            if (\"undefined\" === typeof this.namereg[pkey].ikey[ikey].skey[skey]) {\n                this.namereg[pkey].ikey[ikey].skey[skey] = {};\n                this.namereg[pkey].ikey[ikey].skey[skey].items = [item_id];\n                this.namereg[pkey].ikey[ikey].count += 1;\n                if (this.namereg[pkey].ikey[ikey].count === 2) {\n                    for (var i = 0, ilen = this.namereg[pkey].ikey[ikey].items.length; i < ilen; i += 1) {\n                        state.tmp.taintedItemIDs[this.namereg[pkey].ikey[ikey].items[i]] = true;\n                    }\n                }\n            } else if (this.namereg[pkey].ikey[ikey].skey[skey].items.indexOf(item_id) === -1) {\n                this.namereg[pkey].ikey[ikey].skey[skey].items.push(item_id);\n            }\n//            if (this.namereg[pkey].ikey[ikey].skey[skey].items.indexOf(item_id) === -1) {\n//                this.namereg[pkey].ikey[ikey].skey[skey].items.push(item_id);\n//            }\n        }\n        if (\"undefined\" === typeof this.nameind[item_id]) {\n            this.nameind[item_id] = {};\n            this.nameindpkeys[item_id] = {};\n        }\n        //CSL.debug(\"INS-A: [\" + pkey + \"] [\" + ikey + \"] [\" + skey + \"]\");\n        if (pkey) {\n            this.nameind[item_id][pkey + \"::\" + ikey + \"::\" + skey] = true;\n            this.nameindpkeys[item_id][pkey] = this.namereg[pkey];\n        }\n        //CSL.debug(\"INS-B\");\n    };\n    this.addname = addname;\n    this.delitems = delitems;\n    this.evalname = evalname;\n};\n\n/*global CSL: true */\n\nCSL.Registry.CitationReg = function () {\n    this.citationById = {};\n    this.citationByIndex = [];\n};\n\n/*global CSL: true */\n\nCSL.Disambiguation = function (state) {\n    this.state = state;\n    this.sys = this.state.sys;\n    this.registry = state.registry.registry;\n    this.ambigcites = state.registry.ambigcites;\n    this.configModes();\n    this.debug = false;\n};\n\nCSL.Disambiguation.prototype.run = function(akey) {\n    if (!this.modes.length) {\n        return;\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"[A] === RUN ===\");\n    }\n    //SNIP-END\n    this.akey = akey;\n    if (this.initVars(akey)) {\n        this.runDisambig();\n    }\n\n};\n\nCSL.Disambiguation.prototype.runDisambig = function () {\n    var ismax;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[C] === runDisambig() ===\");\n    }\n    //SNIP-END\n    this.initGivens = true;\n    //\n    // Length of list may change during processing\n    while (this.lists.length) {\n        this.gnameset = 0;\n        this.gname = 0;\n        this.clashes = [1, 0];\n        // each list is scanned repeatedly until all\n        // items either succeed or ultimately fail.\n        while(this.lists[0][1].length) {\n            this.listpos = 0;\n            if (!this.base) {\n                this.base = this.lists[0][0];\n            }\n            ismax = this.incrementDisambig();\n            this.scanItems(this.lists[0]);\n            this.evalScan(ismax);\n        }\n        this.lists = this.lists.slice(1);\n    }\n};\n\nCSL.Disambiguation.prototype.scanItems = function (list) {\n    var pos, len, otherItem;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[2] === scanItems() ===\");\n    }\n    //SNIP-END\n\n    this.Item = list[1][0];\n    this.ItemCite = CSL.getAmbiguousCite.call(this.state, this.Item, this.base, true);\n\n    this.scanlist = list[1];\n    this.partners = [];\n    this.partners.push(this.Item);\n    this.nonpartners = [];\n    var clashes = 0;\n\n    for (var pos = 1, len = list[1].length; pos < len; pos += 1) {\n        otherItem = list[1][pos];\n        var otherItemCite = CSL.getAmbiguousCite.call(this.state, otherItem, this.base, true);\n        //SNIP-START\n        if (this.debug) {\n            if (pos > 1) {\n                print(\"  -----------\");\n            }\n        }\n        //SNIP-END\n        if (this.ItemCite === otherItemCite) {\n            //SNIP-START\n            if (this.debug) {\n                print(\"  [CLASH]--> \"+this.Item.id+\": \"+this.ItemCite);\n                print(\"             \"+otherItem.id+\": \"+otherItemCite);\n            }\n            //SNIP-END\n            clashes += 1;\n            this.partners.push(otherItem);\n        } else {\n            //SNIP-START\n            if (this.debug) {\n                print(\"  [clear]--> \"+this.Item.id+\": \"+this.ItemCite);\n                print(\"             \"+otherItem.id+\": \"+otherItemCite);\n            }\n            //SNIP-END\n            this.nonpartners.push(otherItem);\n        }\n    }\n    this.clashes[0] = this.clashes[1];\n    this.clashes[1] = clashes;\n};\n\nCSL.Disambiguation.prototype.evalScan = function (maxed) {\n    this[this.modes[this.modeindex]](maxed);\n    if (maxed) {\n        if (this.modeindex < this.modes.length - 1) {\n            this.modeindex += 1;\n        } else {\n            this.lists[this.listpos + 1] = [this.base, []];\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.disNames = function (ismax) {\n    var i, ilen;\n    \n    //SNIP-START\n    if (this.debug) {\n        print(\"[3] == disNames() ==\");\n        //print(\"       partners: \"+[this.partners[i].id for (i in this.partners)].join(\", \"));\n        //print(\"    nonpartners: \"+[this.nonpartners[i].id for (i in this.nonpartners)].join(\", \"));\n    }\n    //SNIP-END\n\n    // New design\n    // this.base is a forward-only counter. Values are never\n    // reduced, and the counter object is never overwritten.\n    // It is methodically pushed forward in single-unit increments\n    // in incrementDisambig() until disNames() wipes out the list.\n\n    // this.betterbase is cloned from this.base exactly once,\n    // at the start of a disambiguation run. Whenever an operation\n    // results in improvement, the just-incremented elements\n    // identified as this.base.names[this.gnameset] (number of\n    // names)and as this.base.givens[this.gnameset][this.gname]\n    // (level of given name) are copied from this.base.\n\n    // The this.base object is used to control disambiguation\n    // renderings. These will be more fully expanded than the final\n    // text, but the flip side of the fact that the extra data does\n    // not contribute anything to disambiguation is that leaving\n    // it in does no harm -- think of it as the Cold Dark Matter of\n    // disambiguation.\n\n    if (this.clashes[1] === 0 && this.nonpartners.length === 1) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [a]: lone partner, one nonpartner\");\n            print(\"  registering \"+this.partners[0].id+\" and \"+this.nonpartners[0].id);\n        }\n        //SNIP-END\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.nonpartners[0].id, this.betterbase);\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.partners[0].id, this.betterbase);\n        this.lists[this.listpos] = [this.betterbase, []];\n    } else if (this.clashes[1] === 0) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [b]: lone partner, unknown number of remaining nonpartners\");\n            print(\"  registering \"+this.partners[0].id);\n        }\n        //SNIP-END\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.partners[0].id, this.betterbase);\n        this.lists[this.listpos] = [this.betterbase, this.nonpartners];\n        if (this.nonpartners.length) {\n            this.initGivens = true;\n        }\n    } else if (this.nonpartners.length === 1) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [c]: lone nonpartner, unknown number of partners remaining\");\n            print(\"  registering \"+this.nonpartners[0].id);\n        }\n        //SNIP-END\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.nonpartners[0].id, this.betterbase);\n        //this.lists[this.listpos] = [this.betterbase, this.partners];\n        this.lists[this.listpos] = [this.betterbase, this.partners];\n    } else if (this.clashes[1] < this.clashes[0]) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [d]: better result, but no entries safe to register\");\n        }\n        //SNIP-END\n        this.lists[this.listpos] = [this.betterbase, this.partners];\n        this.lists.push([this.betterbase, this.nonpartners]);\n    } else {\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [e]: no improvement, and clashes remain\");\n        }\n        //SNIP-END\n        if (ismax) {\n            this.lists[this.listpos] = [this.betterbase, this.nonpartners];\n            this.lists.push([this.betterbase, this.partners]);\n            if (this.modeindex === this.modes.length - 1) {\n                //SNIP-START\n                if (this.debug) {\n                    print(\"     (registering clashing entries because we've run out of options)\");\n                }\n                //SNIP-END\n                for (var i = 0, ilen = this.partners.length; i < ilen; i += 1) {\n                    this.state.registry.registerAmbigToken(this.akey, \"\" + this.partners[i].id, this.betterbase);\n                }\n                this.lists[this.listpos] = [this.betterbase, []];\n            }\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.disExtraText = function () {\n    //SNIP-START\n    if (this.debug) {\n        print(\"[3] === disExtraText ==\");\n    }\n    //SNIP-END\n    \n    var done = false;\n\n    if (this.clashes[1] === 0 && this.nonpartners.length < 2) {\n        done = true;\n    }\n\n    // If first encounter in this cycle and multiple modes are\n    // available, decrement mode and reset base\n    if (!done && (!this.base.disambiguate || this.state.tmp.disambiguate_count !== this.state.tmp.disambiguate_maxMax)) {\n        // Rerun everything on each subcycle? This doesn't work currently.\n        //this.initVars(this.akey)\n        this.modeindex = 0;\n        this.base.disambiguate = this.state.tmp.disambiguate_count;\n        this.betterbase.disambiguate = this.state.tmp.disambiguate_count;\n        if (!this.base.disambiguate) {\n            // Evaluate here?\n            this.initGivens = true;\n            // If disambiguate is false set to true\n            this.base.disambiguate = 1;\n            // There may be changes\n            for (var i = 0, ilen = this.lists[this.listpos][1].length; i < ilen; i += 1) {\n                this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id] = true;\n            }\n        } else {\n            this.disNames();\n        }\n    } else if (done || this.state.tmp.disambiguate_count === this.state.tmp.disambiguate_maxMax) {\n        if (done || this.modeindex === this.modes.length - 1) {\n            // If this is the end, disambiguation failed.\n            // Discard disambiguate=true (?) and set parameters\n            var base = this.lists[this.listpos][0];\n            for (var i = 0, ilen = this.lists[this.listpos][1].length; i < ilen; i += 1) {\n                this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id] = true;\n                this.state.registry.registerAmbigToken(this.akey, \"\" + this.lists[this.listpos][1][i].id, base);\n            }\n            this.lists[this.listpos] = [this.betterbase, []];\n        } else {\n            // If this is followed by year-suffix, keep\n            // parameters and set disambiguate=true since it MIGHT\n            // include the date, needed for year-suffix.\n            // This may be a bit over-aggressive for cases in which the\n            // disambiguate condition does not add the date\n            this.modeindex = this.modes.length - 1;\n            var base = this.lists[this.listpos][0];\n            base.disambiguate = true;\n            for (var i = 0, ilen = this.lists[this.listpos][1].length; i < ilen; i += 1) {\n                // Always tainting here might be a little over-aggressive, but a taint may be required.\n                this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id] = true;\n                this.state.registry.registerAmbigToken(this.akey, \"\" + this.lists[this.listpos][1][i].id, base);\n            }\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.disYears = function () {\n    var pos, len, tokens, token;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[3] === disYears ==\");\n    }\n    //SNIP-END\n    tokens = [];\n    var base = this.lists[this.listpos][0];\n    if (this.clashes[1]) {\n        // That is, if the initial increment on the ambigs group returns no\n        // clashes, don't apply suffix. The condition is a necessary failsafe.\n\t\t// In original submission order\n\t\tfor (var i = 0, ilen = this.state.registry.mylist.length; i < ilen; i += 1) {\n\t\t\tvar origid = this.state.registry.mylist[i];\n\t\t\tfor (var j = 0, jlen = this.lists[this.listpos][1].length; j < jlen; j += 1) {\n\t\t\t\tvar token = this.lists[this.listpos][1][j];\n\t\t\t\t// Warning: token.id can be number. This should be fixed at a higher level in citeproc-js if poss.\n\t\t\t\tif (token.id == origid) {\n\t\t\t\t\ttokens.push(this.registry[token.id]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    }\n    tokens.sort(this.state.registry.sorter.compareKeys);\n    for (var pos = 0, len = tokens.length; pos < len; pos += 1) {\n        base.year_suffix = \"\"+pos;\n        var oldBase = this.state.registry.registry[tokens[pos].id].disambig;\n        this.state.registry.registerAmbigToken(this.akey, \"\" + tokens[pos].id, base);\n        if (CSL.ambigConfigDiff(oldBase,base)) {\n            this.state.tmp.taintedItemIDs[tokens[pos].id] = true;\n        }\n    }\n    this.lists[this.listpos] = [this.betterbase, []];\n};\n\nCSL.Disambiguation.prototype.incrementDisambig = function () {\n    //SNIP-START\n    if (this.debug) {\n        print(\"\\n[1] === incrementDisambig() ===\");\n    }\n    //SNIP-END\n    if (this.initGivens) {\n        this.initGivens = false;\n        return false;\n    }\n    var maxed = false;\n    var increment_names = true;\n    if (\"disNames\" === this.modes[this.modeindex]) {\n        // this.gnameset: the index pos of the current nameset\n        // this.gname: the index pos of the current name w/in the current nameset\n        \n        // Stages:\n        // - Increment givenname (optional)\n        // - Add a name (optional)\n        // - Move to next nameset\n\n        // Incrementing is done forward-only on this.base. Values\n        // that improve disambiguation results are copied to\n        // this.betterbase, which is used to set the disambig parameters\n        // in the processor registry.\n        \n\n        // Increment\n        // Max val is always true if a level is inactive.\n        increment_names = false;\n        if (\"number\" !== typeof this.givensMax) {\n            increment_names = true;\n        }\n        var increment_namesets = false;\n        if (\"number\" !== typeof this.namesMax) {\n            increment_namesets = true;\n        }\n        if (\"number\" === typeof this.givensMax) {\n            if (this.base.givens.length && this.base.givens[this.gnameset][this.gname] < this.givensMax) {\n                this.base.givens[this.gnameset][this.gname] += 1;\n            } else {\n                increment_names = true;\n            }\n        }\n        if (\"number\" === typeof this.namesMax \n            && increment_names) {\n            if (this.state.opt[\"disambiguate-add-names\"]) {\n                increment_namesets = false;\n                if (this.gname < this.namesMax) {\n                    this.base.names[this.gnameset] += 1;\n                    this.gname += 1;\n                } else {\n                    increment_namesets = true;\n                }\n            } else {\n                increment_namesets = true;\n            }\n        }\n        if (\"number\" === typeof this.namesetsMax && increment_namesets) {\n            if (this.gnameset < this.namesetsMax) {\n                this.gnameset += 1;\n                this.base.names[this.gnameset] = 1;\n                this.gname = 0;\n            }\n        }\n        //SNIP-START\n        if (this.debug) {\n            print(\"    ------------------\");\n            print(\"    incremented values\");\n            print(\"    ------------------\");\n            print(\"    | gnameset: \"+this.gnameset);\n            print(\"    | gname: \"+this.gname);\n            print(\"    | names value: \"+this.base.names[this.gnameset]);\n            if (this.base.givens.length) {\n                print(\"    | givens value: \"+this.base.givens[this.gnameset][this.gname]);\n            } else {\n                print(\"    | givens value: nil\");\n            }\n            print(\"    | namesetsMax: \"+this.namesetsMax);\n            print(\"    | namesMax: \"+this.namesMax);\n            print(\"    | givensMax: \"+this.givensMax);\n        }\n        //SNIP-END\n        if ((\"number\" !== typeof this.namesetsMax || this.namesetsMax === -1 || this.gnameset === this.namesetsMax)\n            && (!this.state.opt[\"disambiguate-add-names\"] || \"number\" !== typeof this.namesMax || this.gname === this.namesMax)\n            && (\"number\" != typeof this.givensMax || \"undefined\" === typeof this.base.givens[this.gnameset] || \"undefined\" === typeof this.base.givens[this.gnameset][this.gname] || this.base.givens[this.gnameset][this.gname] === this.givensMax)) {\n  \n\n            maxed = true;\n            //SNIP-START\n            if (this.debug) {\n                print(\"    MAXED\");\n            }\n            //SNIP-END\n        }\n    } else if (\"disExtraText\" === this.modes[this.modeindex]) {\n        this.base.disambiguate += 1;\n        this.betterbase.disambiguate += 1;\n    }\n    return maxed;\n};\n\nCSL.Disambiguation.prototype.initVars = function (akey) {\n    var i, ilen, myIds, myItemBundles, myItems;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[B] === initVars() ===\");\n    }\n    //SNIP-END\n    this.lists = [];\n    this.base = false;\n    this.betterbase = false;\n    this.akey = akey;\n\n    this.maxNamesByItemId = {};\n\n\n    myItemBundles = [];\n    myIds = this.ambigcites[akey];\n    if (!myIds || !myIds.length) {\n        return false;\n    }\n    var myItem = this.state.refetchItem(\"\" + myIds[0]);\n    this.getCiteData(myItem);\n    this.base = CSL.getAmbigConfig.call(this.state);\n    if (myIds && myIds.length > 1) {\n        myItemBundles.push([this.maxNamesByItemId[myItem.id], myItem]);\n        // Build a composite list of Items and associated\n        // max names. This is messy, but it's the only\n        // way to get the items sorted by the number of names\n        // to be disambiguated. If they are in descending order\n        // with name expansions, the processor will hang.\n        for (var i = 1, ilen = myIds.length; i < ilen; i += 1) {\n            myItem = this.state.refetchItem(\"\" + myIds[i]);\n            this.getCiteData(myItem, this.base);\n            myItemBundles.push([this.maxNamesByItemId[myItem.id], myItem]);\n        }\n        myItemBundles.sort(\n            function (a, b) {\n                if (a[0] > b[0]) {\n                    return 1;\n                } else if (a[0] < b[0]) {\n                    return -1;\n                } else {\n                    if (a[1].id > b[1].id) {\n                        return 1;\n                    } else if (a[1].id < b[1].id) {\n                        return -1;\n                    } else {\n                        return 0;\n                    }\n                }\n            }\n        );\n        myItems = [];\n        for (var i = 0, ilen = myItemBundles.length; i < ilen; i += 1) {\n            myItems.push(myItemBundles[i][1]);\n        }\n        this.lists.push([this.base, myItems]);\n        this.Item = this.lists[0][1][0];\n    } else {\n        this.Item = this.state.refetchItem(\"\" + myIds[0]);\n    }\n\n    this.modeindex = 0;\n    if (this.state.citation.opt[\"disambiguate-add-names\"] || true) {\n        this.namesMax = this.maxNamesByItemId[this.Item.id][0];\n    } else {\n        var namesMax = this.base.names[0];\n        for (var i=1,ilen=this.base.names.length;i<ilen;i+=1){\n            namesMax = Math.max(namesMax,this.base.names.names[i]);\n        }\n    }\n\n\n    this.padBase(this.base);\n    this.padBase(this.betterbase);\n    this.base.year_suffix = false;\n    this.base.disambiguate = false;\n    this.betterbase.year_suffix = false;\n    this.betterbase.disambiguate = false;\n    if (this.state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\"\n       && this.state.opt[\"disambiguate-add-givenname\"]) {\n        this.givensMax = 2;\n    }\n    return true;\n};\n\n\nCSL.Disambiguation.prototype.padBase = function (base) {\n    for (var i = 0, ilen = base.names.length; i < ilen; i += 1) {\n        if (!base.givens[i]) {\n            base.givens[i] = [];\n        }\n        for (var j=0,jlen=base.names[i];j<jlen;j+=1) {\n            if (!base.givens[i][j]) {\n                base.givens[i][j] = 0;\n            }\n        }\n    }\n};\n\n/**\n * Set available modes for disambiguation\n */\nCSL.Disambiguation.prototype.configModes = function () {\n    var dagopt, gdropt;\n    // Modes are function names prototyped to this instance.\n    this.modes = [];\n    dagopt = this.state.opt[\"disambiguate-add-givenname\"];\n    gdropt = this.state.citation.opt[\"givenname-disambiguation-rule\"];\n    if (this.state.opt['disambiguate-add-names'] || (dagopt && gdropt === \"by-cite\")) {\n        this.modes.push(\"disNames\");\n    }\n\n    if (this.state.opt.development_extensions.prioritize_disambiguate_condition) {\n        if (this.state.opt.has_disambiguate) {\n            this.modes.push(\"disExtraText\");\n        }\n        if (this.state.opt[\"disambiguate-add-year-suffix\"]) {\n            this.modes.push(\"disYears\");\n        }\n    } else {\n        if (this.state.opt[\"disambiguate-add-year-suffix\"]) {\n            this.modes.push(\"disYears\");\n        }\n        if (this.state.opt.has_disambiguate) {\n            this.modes.push(\"disExtraText\");\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.getCiteData = function(Item, base) {\n    // Initialize base if first set item seen\n    if (!this.maxNamesByItemId[Item.id]) {\n        CSL.getAmbiguousCite.call(this.state, Item, base);\n        base = CSL.getAmbigConfig.call(this.state);\n        this.maxNamesByItemId[Item.id] = CSL.getMaxVals.call(this.state);\n        this.state.registry.registry[Item.id].disambig.givens = this.state.tmp.disambig_settings.givens.slice();\n        // Slice the nested lists as well. Without this, disambiguate_YearSuffixFiftyTwoEntriesByCite fails.\n        for (var i=0,ilen=this.state.registry.registry[Item.id].disambig.givens.length;i<ilen;i+=1) {\n            this.state.registry.registry[Item.id].disambig.givens[i] = this.state.tmp.disambig_settings.givens[i].slice();\n        }\n        this.namesetsMax = this.state.registry.registry[Item.id].disambig.names.length - 1;\n        if (!this.base) {\n            this.base = base;\n            this.betterbase = CSL.cloneAmbigConfig(base);\n        }\n        if (base.names.length < this.base.names.length) {\n            // I don't know what would happen with discrepancies in the number\n            // of namesets rendered on items, so we use the fewer of the two\n            // and limit the other to that size.\n            this.base = base;\n        }\n        // Padding. Within namesets, we use the longer of the two throughout.\n        for (var i = 0, ilen = base.names.length; i < ilen; i += 1) {\n            if (base.names[i] > this.base.names[i]) {\n                // XXX The old must have been wrong surely. The new, I'm not sure.\n                //this.base.givens[i] = this.base.givens[i].concat(this.base.givens[i].slice(this.base.names[i]));\n                this.base.givens[i] = base.givens[i].slice();\n                this.base.names[i] = base.names[i];\n                this.betterbase.names = this.base.names.slice();\n                this.betterbase.givens = this.base.givens.slice();\n                this.padBase(this.base);\n                this.padBase(this.betterbase);\n            }\n        }\n        // This shouldn't be necessary\n        // getAmbiguousCite() should return a valid and complete\n        // givens segment under all conditions, but it does not\n        // do so for institution authors, so we clean up after it\n        // here.\n        // Relevant test: sort_ChicagoYearSuffix2\n        this.betterbase.givens = this.base.givens.slice();\n        for (var j = 0, jlen = this.base.givens.length; j < jlen; j += 1) {\n            this.betterbase.givens[j] = this.base.givens[j].slice();\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.captureStepToBase = function() {\n    // Be paranoid about the presence of givens\n    if (this.state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\"\n        && this.base.givens && this.base.givens.length) {\n        if (\"undefined\" !== typeof this.base.givens[this.gnameset][this.gname]) {\n            if (this.betterbase.givens.length < this.base.givens.length) {\n                this.betterbase.givens = JSON.parse(JSON.stringify(this.base.givens));\n            }\n            this.betterbase.givens[this.gnameset][this.gname] = this.base.givens[this.gnameset][this.gname];\n        }\n    }\n    this.betterbase.names[this.gnameset] = this.base.names[this.gnameset];\n};\n\nCSL.Engine.prototype.getJurisdictionList = function (jurisdiction) {\n    var jurisdictionList = [];\n    var jurisdictionElems = jurisdiction.split(\":\");\n    for (var j=jurisdictionElems.length;j>0;j--) {\n        var composedID = jurisdictionElems.slice(0,j).join(\":\");\n        jurisdictionList.push(composedID);\n        if (this.opt.jurisdiction_fallbacks[composedID]) {\n            var fallback = this.opt.jurisdiction_fallbacks[composedID];\n            jurisdictionList.push(fallback);\n        }\n    }\n    if (jurisdictionList.indexOf(\"us\") === -1) {\n        jurisdictionList.push(\"us\");\n    }\n    return jurisdictionList;\n};\n\nCSL.Engine.prototype.loadStyleModule = function (jurisdiction, xmlSource, skipFallback) {\n    var myFallback = null;\n    var macroCount = 0;\n    this.juris[jurisdiction] = {};\n    var myXml = CSL.setupXml(xmlSource);\n    myXml.addMissingNameNodes(myXml.dataObj);\n    myXml.addInstitutionNodes(myXml.dataObj);\n    myXml.insertPublisherAndPlace(myXml.dataObj);\n    myXml.flagDateMacros(myXml.dataObj);\n    var myNodes = myXml.getNodesByName(myXml.dataObj, \"law-module\");\n    for (var i=0,ilen=myNodes.length;i<ilen;i++) {\n        var myTypes = myXml.getAttributeValue(myNodes[i],\"types\");\n        if (myTypes) {\n            this.juris[jurisdiction].types = {};\n            myTypes =  myTypes.split(/\\s+/);\n            for (var j=0,jlen=myTypes.length;j<jlen;j++) {\n                this.juris[jurisdiction].types[myTypes[j]] = true;\n            }\n        }\n        if (!skipFallback) {\n            myFallback = myXml.getAttributeValue(myNodes[i],\"fallback\");\n            if (myFallback) {\n                if (jurisdiction !== \"us\") {\n                    this.opt.jurisdiction_fallbacks[jurisdiction] = myFallback;\n                }\n            }\n        }\n    }\n    var lang = this.opt.lang ? this.opt.lang : this.opt[\"default-locale\"][0];\n    CSL.SET_COURT_CLASSES(this, lang, myXml, myXml.dataObj);\n    \n    if (!this.juris[jurisdiction].types) {\n        this.juris[jurisdiction].types = CSL.MODULE_TYPES;\n    }\n    var myNodes = myXml.getNodesByName(myXml.dataObj, \"macro\");\n    for (var i=0,ilen=myNodes.length;i<ilen;i++) {\n        var myName = myXml.getAttributeValue(myNodes[i], \"name\");\n        if (!CSL.MODULE_MACROS[myName]) {\n            CSL.debug(\"CSL: skipping non-modular macro name \\\"\" + myName + \"\\\" in module context\");\n            continue;\n        }\n        macroCount++;\n        this.juris[jurisdiction][myName] = [];\n        // Must use the same XML parser for style and modules.\n        this.buildTokenLists(myNodes[i], this.juris[jurisdiction][myName]);\n        this.configureTokenList(this.juris[jurisdiction][myName]);\n    }\n    //if (macroCount < Object.keys(CSL.MODULE_MACROS).length) {\n    //    var missing = [];\n    //    throw \"CSL ERROR: Incomplete jurisdiction style module for: \" + jurisdiction;\n    //}\n    return myFallback;\n};\n\nCSL.Engine.prototype.retrieveAllStyleModules = function (jurisdictionList) {\n    var ret = {};\n    var preferences = this.locale[this.opt.lang].opts[\"jurisdiction-preference\"];\n    preferences = preferences ? preferences : [];\n    preferences = [\"\"].concat(preferences);\n    for (var i=preferences.length-1;i>-1;i--) {\n        var preference = preferences[i];\n        for (var j=0,jlen=jurisdictionList.length;j<jlen;j++) {\n            var jurisdiction = jurisdictionList[j];\n            // If we've \"seen\" it, we have it already, or we're not going to get it.\n            if (this.opt.jurisdictions_seen[jurisdiction]) {\n                continue;\n            }\n            // Try to get the module\n            var res = this.sys.retrieveStyleModule(jurisdiction, preference);\n            // If we fail and we've run out of preferences, mark as \"seen\"\n            // Otherwise mark as \"seen\" if we get something.\n            if ((!res && !preference) || res) {\n                this.opt.jurisdictions_seen[jurisdiction] = true;\n            }\n            // Don't memo unless get got style code.\n            if (!res) {\n                continue;\n            }\n            ret[jurisdiction] = res;\n        }\n    }\n    // Give 'em what we got.\n    return ret;\n};\n\nCSL.ParticleList = (function() {\n\tvar always_dropping_1 = [[[0,1], null]];\n\tvar always_dropping_3 = [[[0,3], null]];\n\tvar always_non_dropping_1 = [[null, [0,1]]];\n\tvar always_non_dropping_2 = [[null, [0,2]]];\n\tvar always_non_dropping_3 = [[null, [0,3]]];\n\tvar either_1 = [[null, [0,1]],[[0,1],null]];\n\tvar either_2 = [[null, [0,2]],[[0,2],null]];\n\tvar either_1_dropping_best = [[[0,1],null],[null, [0,1]]];\n\tvar either_2_dropping_best = [[[0,2],null],[null, [0,2]]];\n\tvar either_3_dropping_best = [[[0,3],null],[null, [0,3]]];\n\tvar non_dropping_2_alt_dropping_1_non_dropping_1 = [[null, [0,2]], [[0,1], [1,2]]];\n\tvar PARTICLES = [\n\t\t[\"'s\", always_non_dropping_1],\n\t\t[\"'s-\", always_non_dropping_1],\n\t\t[\"'t\", always_non_dropping_1],\n\t\t[\"a\", \talways_non_dropping_1],\n\t\t[\"aan 't\", always_non_dropping_2],\n\t\t[\"aan de\", always_non_dropping_2],\n\t\t[\"aan den\", always_non_dropping_2],\n\t\t[\"aan der\", always_non_dropping_2],\n\t\t[\"aan het\", always_non_dropping_2],\n\t\t[\"aan t\", always_non_dropping_2],\n\t\t[\"aan\", always_non_dropping_1],\n\t\t[\"ad-\", either_1],\n\t\t[\"adh-\", either_1],\n\t\t[\"af\", either_1],\n\t\t[\"al\", either_1],\n\t\t[\"al-\", either_1],\n\t\t[\"am de\", always_non_dropping_2],\n\t\t[\"am\", always_non_dropping_1],\n\t\t[\"an-\", either_1],\n\t\t[\"ar-\", either_1],\n\t\t[\"as-\", either_1],\n\t\t[\"ash-\", either_1],\n\t\t[\"at-\", either_1],\n\t\t[\"ath-\", either_1],\n\t\t[\"auf dem\", either_2_dropping_best],\n\t\t[\"auf den\", either_2_dropping_best],\n\t\t[\"auf der\", either_2_dropping_best],\n\t\t[\"auf ter\", always_non_dropping_2],\n\t\t[\"auf\", either_1_dropping_best],\n\t\t[\"aus 'm\", either_2_dropping_best],\n\t\t[\"aus dem\", either_2_dropping_best],\n\t\t[\"aus den\", either_2_dropping_best],\n\t\t[\"aus der\", either_2_dropping_best],\n\t\t[\"aus m\", either_2_dropping_best],\n\t\t[\"aus\", either_1_dropping_best],\n\t\t[\"aus'm\", either_2_dropping_best],\n\t\t[\"az-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"ben\", always_non_dropping_1],\n\t\t[\"bij 't\", always_non_dropping_2],\n\t\t[\"bij de\", always_non_dropping_2],\n\t\t[\"bij den\", always_non_dropping_2],\n\t\t[\"bij het\", always_non_dropping_2],\n\t\t[\"bij t\", always_non_dropping_2],\n\t\t[\"bij\", always_non_dropping_1],\n\t\t[\"bin\", always_non_dropping_1],\n\t\t[\"boven d\", always_non_dropping_2],\n\t\t[\"boven d'\", always_non_dropping_2],\n\t\t[\"d\", always_non_dropping_1],\n\t\t[\"d'\", either_1],\n\t\t[\"da\", either_1],\n\t\t[\"dal\", always_non_dropping_1],\n\t\t[\"dal'\", always_non_dropping_1],\n\t\t[\"dall'\", always_non_dropping_1],\n\t\t[\"dalla\", always_non_dropping_1],\n\t\t[\"das\", either_1],\n\t\t[\"de die le\", always_non_dropping_3],\n\t\t[\"de die\", always_non_dropping_2],\n\t\t[\"de l\", always_non_dropping_2],\n\t\t[\"de l'\", always_non_dropping_2],\n\t\t[\"de la\", non_dropping_2_alt_dropping_1_non_dropping_1],\n\t\t[\"de las\", non_dropping_2_alt_dropping_1_non_dropping_1],\n\t\t[\"de le\", always_non_dropping_2],\n\t\t[\"de li\", either_2],\n\t\t[\"de van der\", always_non_dropping_3],\n\t\t[\"de\", either_1],\n\t\t[\"de'\", either_1],\n\t\t[\"deca\", always_non_dropping_1],\n\t\t[\"degli\", either_1],\n\t\t[\"dei\", either_1],\n\t\t[\"del\", either_1],\n\t\t[\"dela\", always_dropping_1],\n\t\t[\"dell'\", either_1],\n\t\t[\"della\", either_1],\n\t\t[\"delle\", either_1],\n\t\t[\"dello\", either_1],\n\t\t[\"den\", either_1],\n\t\t[\"der\", either_1],\n\t\t[\"des\", either_1],\n\t\t[\"di\", either_1],\n\t\t[\"die le\", always_non_dropping_2],\n\t\t[\"do\", always_non_dropping_1],\n\t\t[\"don\", always_non_dropping_1],\n\t\t[\"dos\", either_1],\n\t\t[\"du\", either_1],\n\t\t[\"ed-\", either_1],\n\t\t[\"edh-\", either_1],\n\t\t[\"el\", either_1],\n\t\t[\"el-\", either_1],\n\t\t[\"en-\", either_1],\n\t\t[\"er-\", either_1],\n\t\t[\"es-\", either_1],\n\t\t[\"esh-\", either_1],\n\t\t[\"et-\", either_1],\n\t\t[\"eth-\", either_1],\n\t\t[\"ez-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"het\", always_non_dropping_1],\n\t\t[\"i\", always_non_dropping_1],\n\t\t[\"il\", always_dropping_1],\n\t\t[\"im\", always_non_dropping_1],\n\t\t[\"in 't\", always_non_dropping_2],\n\t\t[\"in de\", always_non_dropping_2],\n\t\t[\"in den\", always_non_dropping_2],\n\t\t[\"in der\", either_2],\n\t\t[\"in het\", always_non_dropping_2],\n\t\t[\"in t\", always_non_dropping_2],\n\t\t[\"in\", always_non_dropping_1],\n\t\t[\"l\", always_non_dropping_1],\n\t\t[\"l'\", always_non_dropping_1],\n\t\t[\"la\", always_non_dropping_1],\n\t\t[\"las\", always_non_dropping_1],\n\t\t[\"le\", always_non_dropping_1],\n\t\t[\"les\", either_1],\n\t\t[\"lo\", either_1],\n\t\t[\"los\", always_non_dropping_1],\n\t\t[\"lou\", always_non_dropping_1],\n\t\t[\"of\", always_non_dropping_1],\n\t\t[\"onder 't\", always_non_dropping_2],\n\t\t[\"onder de\", always_non_dropping_2],\n\t\t[\"onder den\", always_non_dropping_2],\n\t\t[\"onder het\", always_non_dropping_2],\n\t\t[\"onder t\", always_non_dropping_2],\n\t\t[\"onder\", always_non_dropping_1],\n\t\t[\"op 't\", always_non_dropping_2],\n\t\t[\"op de\", either_2],\n\t\t[\"op den\", always_non_dropping_2],\n\t\t[\"op der\", always_non_dropping_2],\n\t\t[\"op gen\", always_non_dropping_2],\n\t\t[\"op het\", always_non_dropping_2],\n\t\t[\"op t\", always_non_dropping_2],\n\t\t[\"op ten\", always_non_dropping_2],\n\t\t[\"op\", always_non_dropping_1],\n\t\t[\"over 't\", always_non_dropping_2],\n\t\t[\"over de\", always_non_dropping_2],\n\t\t[\"over den\", always_non_dropping_2],\n\t\t[\"over het\", always_non_dropping_2],\n\t\t[\"over t\", always_non_dropping_2],\n\t\t[\"over\", always_non_dropping_1],\n\t\t[\"s\", always_non_dropping_1],\n\t\t[\"s'\", always_non_dropping_1],\n\t\t[\"sen\", always_dropping_1],\n\t\t[\"t\", always_non_dropping_1],\n\t\t[\"te\", always_non_dropping_1],\n\t\t[\"ten\", always_non_dropping_1],\n\t\t[\"ter\", always_non_dropping_1],\n\t\t[\"tho\", always_non_dropping_1],\n\t\t[\"thoe\", always_non_dropping_1],\n\t\t[\"thor\", always_non_dropping_1],\n\t\t[\"to\", always_non_dropping_1],\n\t\t[\"toe\", always_non_dropping_1],\n\t\t[\"tot\", always_non_dropping_1],\n\t\t[\"uijt 't\", always_non_dropping_2],\n\t\t[\"uijt de\", always_non_dropping_2],\n\t\t[\"uijt den\", always_non_dropping_2],\n\t\t[\"uijt te de\", always_non_dropping_3],\n\t\t[\"uijt ten\", always_non_dropping_2],\n\t\t[\"uijt\", always_non_dropping_1],\n\t\t[\"uit 't\", always_non_dropping_2],\n\t\t[\"uit de\", always_non_dropping_2],\n\t\t[\"uit den\", always_non_dropping_2],\n\t\t[\"uit het\", always_non_dropping_2],\n\t\t[\"uit t\", always_non_dropping_2],\n\t\t[\"uit te de\", always_non_dropping_3],\n\t\t[\"uit ten\", always_non_dropping_2],\n\t\t[\"uit\", always_non_dropping_1],\n\t\t[\"unter\", always_non_dropping_1],\n\t\t[\"v\", always_non_dropping_1],\n\t\t[\"v.\", always_non_dropping_1],\n\t\t[\"v.d.\", always_non_dropping_1],\n\t\t[\"van 't\", always_non_dropping_2],\n\t\t[\"van de l\", always_non_dropping_3],\n\t\t[\"van de l'\", always_non_dropping_3],\n\t\t[\"van de\", always_non_dropping_2],\n\t\t[\"van de\", always_non_dropping_2],\n\t\t[\"van den\", always_non_dropping_2],\n\t\t[\"van der\", always_non_dropping_2],\n\t\t[\"van gen\", always_non_dropping_2],\n\t\t[\"van het\", always_non_dropping_2],\n\t\t[\"van la\", always_non_dropping_2],\n\t\t[\"van t\", always_non_dropping_2],\n\t\t[\"van ter\", always_non_dropping_2],\n\t\t[\"van van de\", always_non_dropping_3],\n\t\t[\"van\", either_1],\n\t\t[\"vander\", always_non_dropping_1],\n\t\t[\"vd\", always_non_dropping_1],\n\t\t[\"ver\", always_non_dropping_1],\n\t\t[\"vom und zum\", always_dropping_3],\n\t\t[\"vom\", either_1],\n\t\t[\"von 't\", always_non_dropping_2],\n\t\t[\"von dem\", either_2_dropping_best],\n\t\t[\"von den\", either_2_dropping_best],\n\t\t[\"von der\", either_2_dropping_best],\n\t\t[\"von t\", always_non_dropping_2],\n\t\t[\"von und zu\", either_3_dropping_best],\n\t\t[\"von zu\", either_2_dropping_best],\n\t\t[\"von\", either_1_dropping_best],\n\t\t[\"voor 't\", always_non_dropping_2],\n\t\t[\"voor de\", always_non_dropping_2],\n\t\t[\"voor den\", always_non_dropping_2],\n\t\t[\"voor in 't\", always_non_dropping_3],\n\t\t[\"voor in t\", always_non_dropping_3],\n\t\t[\"voor\", always_non_dropping_1],\n\t\t[\"vor der\", either_2_dropping_best],\n\t\t[\"vor\", either_1_dropping_best],\n\t\t[\"z\", always_dropping_1],\n\t\t[\"ze\", always_dropping_1],\n\t\t[\"zu\", either_1_dropping_best],\n\t\t[\"zum\", either_1],\n\t\t[\"zur\", either_1]\n\t];\n    return PARTICLES;\n}());\n\nCSL.parseParticles = (function(){\n    function splitParticles(nameValue, firstNameFlag, caseOverride) {\n\t\t// Parse particles out from name fields.\n\t\t// * nameValue (string) is the field content to be parsed.\n\t\t// * firstNameFlag (boolean) parse trailing particles\n\t\t//\t (default is to parse leading particles)\n\t\t// * caseOverride (boolean) include all but one word in particle set\n\t\t//\t (default is to include only words with lowercase first char)\n        //   [caseOverride is not used in this application]\n\t\t// Returns an array with:\n\t\t// * (boolean) flag indicating whether a particle was found\n\t\t// * (string) the name after removal of particles\n\t\t// * (array) the list of particles found\n\t\tvar origNameValue = nameValue;\n\t\tnameValue = caseOverride ? nameValue.toLowerCase() : nameValue;\n\t\tvar particleList = [];\n\t\tvar rex;\n        var hasParticle;\n\t\tif (firstNameFlag) {\n\t\t\tnameValue = nameValue.split(\"\").reverse().join(\"\");\n\t\t\trex = CSL.PARTICLE_GIVEN_REGEXP;\n\t\t} else {\n\t\t\trex = CSL.PARTICLE_FAMILY_REGEXP;\n\t\t}\n\t\tvar m = nameValue.match(rex);\n\t\twhile (m) {\n\t\t\tvar m1 = firstNameFlag ? m[1].split(\"\").reverse().join(\"\") : m[1];\n\t\t\tvar firstChar = m ? m1 : false;\n\t\t\tvar firstChar = firstChar ? m1.replace(/^[-\\'\\u02bb\\u2019\\s]*(.).*$/, \"$1\") : false;\n\t\t\thasParticle = firstChar ? firstChar.toUpperCase() !== firstChar : false;\n\t\t\tif (!hasParticle) {\n                break;\n            }\n\t\t\tif (firstNameFlag) {\n\t\t\t\tparticleList.push(origNameValue.slice(m1.length * -1));\n\t\t\t\torigNameValue = origNameValue.slice(0,m1.length * -1);\n\t\t\t} else {\n\t\t\t\tparticleList.push(origNameValue.slice(0,m1.length));\n\t\t\t\torigNameValue = origNameValue.slice(m1.length);\n\t\t\t}\n\t\t\t//particleList.push(m1);\n\t\t\tnameValue = m[2];\n\t\t\tm = nameValue.match(rex);\n\t\t}\n\t\tif (firstNameFlag) {\n\t\t\tnameValue = nameValue.split(\"\").reverse().join(\"\");\n\t\t\tparticleList.reverse();\n\t\t\tfor (var i=1,ilen=particleList.length;i<ilen;i++) {\n\t\t\t\tif (particleList[i].slice(0, 1) == \" \") {\n\t\t\t\t\tparticleList[i-1] += \" \";\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i=0,ilen=particleList.length;i<ilen;i++) {\n\t\t\t\tif (particleList[i].slice(0, 1) == \" \") {\n\t\t\t\t\tparticleList[i] = particleList[i].slice(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tnameValue = origNameValue.slice(0, nameValue.length);\n\t\t} else {\n\t\t\tnameValue = origNameValue.slice(nameValue.length * -1);\n\t\t}\n\t\treturn [hasParticle, nameValue, particleList];\n\t}\n    function trimLast(str) {\n        var lastChar = str.slice(-1);\n        str = str.trim();\n        if (lastChar === \" \" && [\"\\'\", \"\\u2019\"].indexOf(str.slice(-1)) > -1) {\n            str += \" \";\n        }\n        return str;\n    }\n    function parseSuffix(nameObj) {\n        if (!nameObj.suffix && nameObj.given) {\n            var m = nameObj.given.match(/(\\s*,!*\\s*)/);\n            if (m) {\n                var idx = nameObj.given.indexOf(m[1]);\n                var possible_suffix = nameObj.given.slice(idx + m[1].length);\n                var possible_comma = nameObj.given.slice(idx, idx + m[1].length).replace(/\\s*/g, \"\");\n                if (possible_suffix.replace(/\\./g, \"\") === 'et al' && !nameObj[\"dropping-particle\"]) {\n                    // This hack covers the case where \"et al.\" is explicitly used in the\n                    // authorship information of the work.\n                    nameObj[\"dropping-particle\"] = possible_suffix;\n                    nameObj[\"comma-dropping-particle\"] = \",\";\n                } else {\n                    if (possible_comma.length === 2) {\n                        nameObj[\"comma-suffix\"] = true;\n                    }\n                    nameObj.suffix = possible_suffix;\n                }\n                nameObj.given = nameObj.given.slice(0, idx);\n            }\n        }\n    }\n    return function(nameObj) {\n        // Extract and set non-dropping particle(s) from family name field\n        var res = splitParticles(nameObj.family);\n        var lastNameValue = res[1];\n        var lastParticleList = res[2];\n        nameObj.family = lastNameValue;\n        var nonDroppingParticle = trimLast(lastParticleList.join(\"\"));\n        if (nonDroppingParticle) {\n            nameObj['non-dropping-particle'] = nonDroppingParticle;\n        }\n        // Split off suffix first of all\n        parseSuffix(nameObj);\n        // Extract and set dropping particle(s) from given name field\n        var res = splitParticles(nameObj.given, true);\n        var firstNameValue = res[1];\n        var firstParticleList = res[2];\n        nameObj.given = firstNameValue;\n        var droppingParticle = firstParticleList.join(\"\").trim();\n        if (droppingParticle) {\n            nameObj['dropping-particle'] = droppingParticle;\n        }\n    };\n}());\n\n\nmodule.exports = CSL"],"names":["currentVersion","this","log","length","retrieveVersion","versnum","data","options","image","constructor","JSON","parse","slice","undo","number","retrieveLastVersion","save","push","stringify","_options","formats","types","styles","wrapperTypes","validateOutputOptions","TypeError","format","type","style","lang","append","prepend","includes","test","Error","validateOptions","output","maxChainLength","forceType","generateGraph","strict","target","defaultOptions","Object","assign","typeOf","thing","undefined","name","dataTypeOf","Array","isArray","applyGraph","entry","graph","_graph","index","findIndex","splice","removeGraph","logger","_output","level","scope","msg","_log","_levels","indexOf","_console","console","Console","process","stderr","dataTypes","unregExts","parseNativeTypes","input","dataType","every","matchType","typeList","predicate","extensions","addTypeParser","extends","extend","debug","object","parentTypeParser","hasTypeParser","prototype","hasOwnProperty","call","removeTypeParser","typeLists","keys","map","key","filter","list","forEach","listTypeParser","treeTypeParser","attachNode","children","typeMatcher","_defineProperty","obj","value","arg","hint","prim","Symbol","toPrimitive","res","String","Number","_toPrimitive","_toPropertyKey","defineProperty","enumerable","configurable","writable","TypeParser","validateDataType","validDataTypes","RangeError","validateParseType","RegExp","validateTokenList","tokenList","validatePropertyConstraint","propertyConstraint","validateElementConstraint","elementConstraint","validateExtends","validate","parseTokenList","token","split","trim","testTokens","trimInput","part","parsePropertyConstraint","concat","props","match","some","prop","parseElementConstraint","constraint","parsePredicate","bind","getCombinedPredicate","predicates","getDataType","DataParser","parser","async","FormatParser","parsers","parseType","typeParser","dataParser","parseAsync","asyncDataParser","validateFormat","ownKeys","e","r","t","getOwnPropertySymbols","o","getOwnPropertyDescriptor","apply","_objectSpread","arguments","getOwnPropertyDescriptors","defineProperties","NAME","NAME_LIST","DATE","TYPE","entryTypes","article","bill","book","broadcast","chapter","classic","collection","dataset","document","event","figure","graphic","hearing","interview","legal_case","legislation","manuscript","motion_picture","musical_score","pamphlet","patent","performance","periodical","personal_communication","post","regulation","report","review","software","song","speech","standard","thesis","treaty","webpage","fieldTypes","author","chair","compiler","composer","contributor","curator","director","editor","guest","host","interviewer","illustrator","narrator","organizer","performer","producer","recipient","translator","accessed","container","issued","submitted","categories","custom","id","language","journalAbbreviation","shortTitle","abstract","annote","archive","archive_collection","archive_location","authority","dimensions","division","DOI","edition","genre","ISBN","ISSN","issue","jurisdiction","keyword","locator","medium","note","page","PMCID","PMID","printing","publisher","references","scale","section","source","status","supplement","title","URL","version","volume","correctName","bestGuessConversions","literal","given","family","correctDateParts","dateParts","isNaN","parseInt","correctField","fieldName","fieldType","nameList","names","Boolean","correctNameList","date","dp","range","correctDate","correctType","parseFloat","toString","parseCsl","clean","field","correction","upgradeCsl","item","downgradeCsl","deepCopy","seen","Set","has","copy","add","delete","fetch","Headers","corsEnabled","location","userAgent","normaliseHeaders","headers","result","entries","from","header","toLowerCase","parseOpts","opts","reqOpts","accept","method","checkContentType","body","isJson","checkResponse","response","error","request","a","b","c","d","sameType","get","fetchFile","url","http","text","fetchFileAsync","then","setUserAgent","newUserAgent","prefix","Math","random","TokenStack","array","stack","current","getPatternText","pattern","getMatchCallback","matches","matchCallback","Function","tokensLeft","matchesSequence","sequence","join","consumeToken","inverse","spaced","consumeWhitespace","SyntaxError","optional","consume","min","consumeN","start","consumeSequence","max","Infinity","tokenMap","tokenFilter","consumed","set","args","remove","Grammar","rules","state","defaultState","mainRule","iterator","lexer","next","consumeRule","matchEndOfFile","matchToken","got","formatError","message","rule","pop","parsePropStatement","toSource","inputProp","outputProp","convert","condition","toTarget","when","createConditionEval","createConverter","Translator","CONVERT_TO_SOURCE","outputData","converted","cause","convertToSource","convertToTarget","CONVERT_TO_TARGET","ChainParser","iteration","iterate","typeInfo","outputs","reduce","last","count","element","end","chain","chainLink","chainAsync","catch","chainLinkAsync","asyncParsers","nativeParsers","flat","nativeAsyncParsers","Promise","all","dataAsync","hasDataParser","addDataParser","removeDataParser","listDataParser","formatParser","asyncData","util","getIds","addAsync","setAsync","getLabel","replace","label","getComparisonValue","num","compareProp","entryA","entryB","flip","sort","shift","getSortCallback","formatter","parsedOptions","styleType","styleFormat","newStyle","newType","formatOptions","template","_newOptions","createElement","tmp","innerHTML","firstChild","callback","promise","Cite","html","bibliographyContainer","listItem","dict","entryName","htmlDict","wr_start","wr_end","en_start","en_end","ul_start","ul_end","li_start","li_end","textDict","configs","ref","config","registers","indices","plugins","mainIndex","typeIndex","typePlugins","typePlugin","substituters","parseJSON","str","regex","subst","val","textContent","appendCommas","string","getJsonObject","src","getJsonValue","getJson","warn","ndjson","jQuery","HTMLElement","json","exports","default","_input","_interopRequireDefault","__esModule","_slicedToArray","arr","i","_arrayWithHoles","_i","_s","_e","_arr","_n","_d","done","err","_iterableToArrayLimit","minLen","_arrayLikeToArray","n","_unsupportedIterableToArray","_nonIterableRest","len","arr2","monthMap","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","dateRangeDelimiters","dateRangePattern","getMonth","monthName","parseIso8601","_date$match2","year","month","day","parseRfc2822","_date$match4","parseDateParts","epoch","Date","valueOf","getFullYear","getDate","parseEpoch","_date$match6","parseAmericanDay","reversePattern","_date$match8","_date$match10","parseDay","values","parseMonth","adBc","_adBc$slice2","parseYear","_default","rangeStart","rangeEnd","rangeStartAsRange","splitDateRange","raw","padStart","chr","delimiter","punctutationMatcher","getListMatcher","getSplittingRegex","matcher","flags","titleMatcher","suffixMatcher","particleMatcher","titleSplitter","suffixSplitter","particleSplitter","endSplitter","mid","parts","suffixMatch","exec","main","_start$match2","droppingParticle","suffix","_end$split$reverse2","reverse","nonDroppingParticle","nameObject","startParts","suffixParts","endParts","reversed","suffixPart","startPart","required","diacritics","commands","defaultStrings","acmcs","acta","cacm","ibmjrd","ibmsj","ieeese","ieeetc","ieeetcad","ipl","jacm","jcss","scp","sicomp","tocs","tods","tog","toms","toois","toplas","tcs","formattingEnvs","it","itshape","sl","slshape","em","bf","bfseries","sc","scshape","rm","sf","tt","formattingCommands","textit","textsl","emph","mkbibitalic","mkbibemph","textbf","strong","mkbibbold","textsc","textsuperscript","textsubscript","enquote","mkbibquote","textmd","textrm","textsf","texttt","textup","formatting","italics","bold","superscript","subscript","smallcaps","nocase","quotes","argumentCommands","ElsevierGlyph","glyph","fromCharCode","href","ligaturePattern","ligatures","mathScriptFormatting","sp","_","sb","mathrm","mathScripts","sentenceCaseLanguages","identifier","whitespace","comment","lineBreaks","junk","at","otherEntryType","dataEntryType","otherEntryContents","lbrace","dataEntryContents","comma","fields","hash","equals","quote","rbrace","quotedLiteral","bracedLiteral","delimiters","bibtexGrammar","Main","oldToken","Entry","openBrace","strings","properties","closeBrace","EntryBody","Field","Expression","ExpressionPart","QuoteString","BracketString","Text","reset","bibTxtRegex","parseBibTxtEntry","pairs","out","v","pair","constants","biblatex","bibtex","sentenceCase","useIdAsLabel","stopWords","unsafeChars","unicode","firstWord","normalize","find","word","months","LABEL","MONTHS","january","february","march","april","june","july","august","september","october","november","december","TYPE_KEYS","bathesis","mathesis","phdthesis","candthesis","techreport","resreport","datacd","audiocd","patentde","patenteu","patentfr","patentuk","patentus","patreq","patreqde","patreqeu","patreqfr","patrequk","patrequs","STANDARD_NUMBERS_PATTERN","Converters","PICK","parseDate","datePart","YEAR_MONTH","EPRINT","EVENT_TITLE","addon","HOW_PUBLISHED","howPublished","startsWith","KEYWORDS","safeId","formatLabel","NAMES","PAGES","pages","STANDARD_NUMBERS","STATUS","TITLE","subtitle","nonSpec","addendum","pagetotal","eprinttype","archiveprefix","S2ID","aliases","annotation","maintitle","booktitle","journaltitle","institution","organization","subtype","typeKey","sourceType","bookpagination","howpublished","school","subType","targetType","BOOK","BOOK_PART","COLLECTION","COLLECTION_PART","PROCEEDINGS","PROCEEDINGS_PART","PERIODICAL_PART","TITLE_MAP","mvbook","mvcollection","mvreference","mvproceedings","reference","proceedings","crossref","registry","parent","ids","xref","entryset","entrysubtype","execute","presort","related","relatedoptions","relatedstring","relatedtype","shortand","shortandintro","sortkey","bookauthor","targets","titleaddon","shorttitle","sorttitle","indextitle","indexsorttitle","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","sourceSymbolKeys","propertyIsEnumerable","_parse","spec","_format","_spec$convertToSource","getStringCase","toUpperCase","formatNameParts","piece","hyphenated","orderNamePieces","pieces","orderGiven","undecided","upperCase","unshift","orderNameParts","command","commandBegin","commandEnd","s","mathShift","stringLiteral","namesLiteral","and","hyphen","listLiteral","separatedLiteral","mathLiteral","script","flattenConsString","applyFormatting","valueGrammar","StringNames","Name","NamePiece","NameToken","StringList","StringSeparated","StringVerbatim","StringUri","uri","decodeURI","encodeURI","StringTitleCase","_this$state","partlyLowercase","protectCase","MathString","char","formatName","ligature","afterPunctuation","_this$state2","first","otherCharacters","rest","restLowerCase","Command","commandToken","func","arity","Env","EnclosedEnv","beginEnv","endEnv","singleLanguageIsEnglish","getMainRule","languages","option","isEnglish","getLexerState","line","col","requirements","problems","missing","problem","parseEntryValues","property","diacritic","UNSAFE_UNICODE","DIACRITIC_PATTERN","listDelimiters","separated","richTextMappings","sup","sub","escapeValue","subject","formatRichText","closingTags","tokens","formatSingleValue","valueType","listType","formatted","formatList","formatEntryValues","formatEntry","factory","mapper","bibtxt","locales","templates","proxied","for","getWrapperProxy","original","proxy","sys","wrapBibliographyEntry","postfix","system_id","Formats","retrieveLocale","locale","unnormalised","engines","items","store","engine","styleXml","retrieveItem","engineHash","updateItems","fetchEngine","setOutputFormat","getAffix","affix","prepareCiteItem","citeItem","prepareCitation","citation","citationItems","noteIndex","prepareCitations","context","bibliography","nosort","citeproc","sortedIds","makeBibliography","bibstart","bibend","bibBody","getPrefixedEntry","getAttributedEntry","asEntryArray","before","citationsPre","after","citationsPost","rebuildProcessorState","splits","always_dropping_1","always_non_dropping_1","always_non_dropping_2","always_non_dropping_3","either_1","either_2","either_1_dropping_best","either_2_dropping_best","non_dropping_2_alt_dropping_1_non_dropping_1","CSL","PROCESSOR_VERSION","dump","toLocaleUpperCase","lang_array","toLocaleLowerCase","LOCATOR_LABELS_REGEXP","STATUTE_SUBDIV_PLAIN_REGEX","STATUTE_SUBDIV_PLAIN_REGEX_FRONT","STATUTE_SUBDIV_STRINGS","STATUTE_SUBDIV_STRINGS_REVERSE","LOCATOR_LABELS_MAP","MODULE_MACROS","MODULE_TYPES","checkNestedBrace","opt","xclass","depth","update","lst","ilen","MULTI_FIELDS","LangPrefsMap","AbbreviationSegments","nickname","place","hereinafter","getAbbrevsDomain","country","domain","availableAbbrevDomains","globalDomainPreference","itemDomainPreference","j","FIELD_CATEGORY_REMAP","parseLocator","development_extensions","locator_date_and_revision","idx","raw_locator","m","fun","dateparser","parseDateToObject","normalizeLocaleStr","parseNoteFieldHacks","Item","validFieldsForType","allowDateOverride","elems","lines","NOTE_FIELDS_REGEXP","splt","jlen","NOTE_FIELD_REGEXP","offset","mm","DATE_VARIABLES","DateParser","parseDateToArray","isDateString","NAME_VARIABLES","parseParticles","checkPrefixSpaceAppend","test_prefix","test_char","ENDSWITH_ROMANESQUE_REGEXP","TERMINAL_PUNCTUATION","checkIgnorePredecessor","term_predecessor","checkSuffixSpacePrepend","STARTSWITH_ROMANESQUE_REGEXP","GENDERS","ERROR_NO_RENDERED_FORM","PREVIEW","ASSUME_ALL_ITEMS_REGISTERED","START","END","SINGLETON","SEEN","SUCCESSOR","SUCCESSOR_OF_SUCCESSOR","SUPPRESS","SINGULAR","PLURAL","LITERAL","BEFORE","AFTER","DESCENDING","ASCENDING","PRIMARY","SECONDARY","POSITION_FIRST","POSITION_SUBSEQUENT","POSITION_IBID","POSITION_IBID_WITH_LOCATOR","POSITION_CONTAINER_SUBSEQUENT","POSITION_MAP","POSITION_TEST_VARS","AREAS","CITE_FIELDS","SWAPPING_PUNCTUATION","NONE","NUMERIC","POSITION","TRIGRAPH","DATE_PARTS","DATE_PARTS_ALL","DATE_PARTS_INTERNAL","NAME_PARTS","DISAMBIGUATE_OPTIONS","GIVENNAME_DISAMBIGUATION_RULES","NAME_ATTRIBUTES","LOOSE","STRICT","TOLERANT","PREFIX_PUNCTUATION","SUFFIX_PUNCTUATION","NUMBER_REGEXP","NAME_INITIAL_REGEXP","ROMANESQUE_REGEXP","ROMANESQUE_NOT_REGEXP","ALL_ROMANESQUE_REGEXP","VIETNAMESE_SPECIALS","VIETNAMESE_NAMES","PARTICLE_GIVEN_REGEXP","PARTICLE_FAMILY_REGEXP","DISPLAY_CLASSES","CREATORS","NUMERIC_VARIABLES","VARIABLES_WITH_SHORT_FORM","TITLE_FIELD_SPLITS","seg","ret","demoteNoiseWords","fld","drop_or_demote","SKIP_WORDS","toEnd","extractTitleAndSubtitle","narrowSpaceLocale","narrowSpace","segments","split_container_title","langs","multi","_keys","short","vals","subjoin","tail","top","TITLE_SPLIT_REGEXP","matchfirst","force_short_title_casing_alignment","splitTitle","TITLE_SPLIT","implicit_short_title","punct","titlecaseSentenceOrNormal","mainTitle","subJoin","subTitle","Output","Formatters","sentence","uppercase_subtitles","getSafeEscape","area","callbacks","thin_non_breaking_space_html_hack","mode","txt","text_escape","FORMAT_KEY_SEQUENCE","INSTITUTION_KEYS","SUFFIX_CHARS","ROMAN_NUMERALS","LANGS","LANG_BASES","af","ar","bg","ca","cs","da","de","el","en","es","et","eu","fa","fi","fr","he","hr","hu","is","ja","km","ko","lt","lv","mn","nb","nl","nn","pl","pt","ro","ru","sk","sr","sv","th","tr","uk","vi","zh","SUPERSCRIPTS","SUPERSCRIPTS_REGEXP","UPDATE_GROUP_CONTEXT_CONDITION","valueTerm","use_context_condition","group_context","tip","termtxt","value_seen","just_did_number","decorations","EVALUATE_GROUP_CONDITION","testres","numbersOnly","locale_term","termStartAlpha","require_comma_on_symbol","force_suppress","not","SYS_OPTIONS","GET_COURT_CLASS","sortKey","cls","classType","SET_COURT_CLASSES","myxml","dataObj","nodes","getNodesByName","pos","numberofnodes","courtclass","attributes","courts","INIT_JURISDICTION_MACROS","macroName","retrieveStyleModule","jurisdictionList","getJurisdictionList","jurisdictions_seen","retrieveAllStyleModules","fallback","loadStyleModule","parallel","enable","Parallel","juris","XmlJSON","attrs","getStyleId","myjson","styleName","tagName","grandkids","nodename","attrname","content","namespace","getAttributeValue","getNodeValue","setAttributeOnNodeIdentifiedByNameAttribute","partname","deleteNodeByNameAttribute","deleteAttribute","setAttribute","attr","nodeCopy","clone","nameattrval","nodeNameIs","makeXml","jsonStringWalker","walkToObject","insertChildNodeAfter","node","datejson","insertPublisherAndPlace","useme","mustHaves","haveVarname","variable","isChildOfSubstitute","parents","myparents","addMissingNameNodes","addName","addInstitutionNodes","insertPos","k","klen","flagDateMacros","inspectDateMacros","stripXmlProcessingInstruction","xml","parseXml","_obj","_stack","_decodeHtmlEntities","numStr","_getAttribute","elem","rex","_getTagName","_castObjectFromOpeningTag","_getAttributes","_extractTextFromCompositeElement","_appendToChildren","processElement","_extendStackWithNewChildren","stylePos","stub","_listifyString","XmlDOM","DOMParser","parseFromString","contentType","xmldata","ActiveXObject","loadXML","XMLHttpRequest","open","encodeURIComponent","overrideMimeType","send","responseXML","marknote","Parser","hasAttributes","importNode","doc","srcElement","_importNode","allChildren","nodeType","newNode","nodeName","il","getAttribute","childNodes","appendChild","inst_doc","inst_node","getElementsByTagName","inst_part_node","institutionpart","ns","innerText","getAttributeName","TEXT_NODE","removeChild","removeAttribute","ownerDocument","cloneNode","datexml","replaceChild","group","skippers","twovars","child","subskippers","parentNode","nameslist","namelist","thenames","theinstitution","theinstitutionpart","thename","insertBefore","nextSibling","attrval","nameparts","thenode","setupXml","xmlObject","toXMLString","XmlE4X","getSortCompare","default_locale","stringCompare","strcmp","me","strcmp_opts","sensitivity","ignorePunctuation","numeric","stripPunct","bracketPreSort","localeCompare","ambigConfigDiff","ppos","llen","givens","disambiguate","year_suffix","cloneAmbigConfig","oldconfig","param","getAmbigConfig","disambig_request","disambig_settings","getMaxVals","names_max","mystack","getMinVal","tokenExec","maybenext","jump","succeed","fail","execs","expandMacro","macro_key_token","mkey","macro_nodes","end_of_macro","postponed_macro","sort_direction","Token","hasDate","macroid","cslXml","build","current_default_locale","extension","macro_stack","cslid","update_mode","Node","macro_name","mytarget","getMacroTarget","buildMacro","configureMacro","macros","text_node","root","makeBuilder","builder","configureTokenList","XmlToToken","tokentype","explicitTarget","var_stack","skip","setDecorations","Attributes","variables","hasVariable","epochPairs","epochYearByName","epochMatchStrings","epochMap","epochMatchString","epochSplitter","epochMatcher","kanjiMonthDay","kanjiYear","kanjiRange","rexString","rexDash","rexDashSlash","rexSlashDash","monthStrings","setOrderDayMonth","monthGuess","dayGuess","setOrderMonthDay","resetDateParserMonths","monthSets","monthAbbrevs","monthRexes","addDateParserMonths","abbrevLength","insert","extendedSets","jKey","kKey","monthRexStrs","convertDateObjectToArray","thedate","slicelen","convertDateObjectToString","_parseNumericDate","delim","suff","orig","slashPos","dashPos","yearIsNegative","slst","mmx","mmpos","rangeDelim","dateDelim","delimPos","delims","isRange","outer","circa","parseDateToString","Engine","forceLang","langspec","processor_version","csl_version","to","nextSource","nextKey","variableWrapper","VARIABLE_WRAPPER_PREPUNCT_REX","getAbbreviation","transform","Transform","setParseNames","Opt","Tmp","Build","Fun","configure","Configure","citation_sort","CitationSort","bibliography_sort","BibliographySort","Citation","Bibliography","intext","InText","Queue","dateput","main_title_from_short_title","csl_reverse_lookup_support","cslNodeId","setCslNodeIds","nodenames","setStyleAttributes","styleID","consolidate_legal_items","consolidate_container_items","expect_and_symbol_form","require_explicit_legal_case_title_short","force_jurisdiction","force_title_abbrev_fallback","localeResolve","best","sort_sep","localeConfigure","adjust","getOpt","Registry","area_nodes","buildTokenLists","configureTokenLists","Disambiguation","splice_delimiter","flipflopper","Util","FlipFlopper","setCloseQuotesArray","ordinalizer","init","long_ordinalizer","page_mangler","PageRangeMangler","getFunction","year_mangler","getTerm","close_quotes_array","node_stack","runStart","runEnd","runSingle","buildStyle","fixDateNode","dummy","term","form","plural","gender","forceDefaultLocale","getField","terms","cite_renders_content","dates","getVariable","varname","getDateNum","ItemField","forms","f","hashterm","dateparts_master","dateparts","pppos","lllen","refetchItems","refetchItem","ITERATION","loadedItemIDs","refhash","normalize_lang_keys_to_lowercase","ctype","creator","_key","multi_layout","field_hack","allow_field_hack_date_override","dateobj","raw_date_parsing","dateParseArray","legislation_id","elements","track_container_items","container_id","normalizedKey","isLegalType","normalizeAbbrevsKey","loadAbbreviation","abbrevs","taintedItemIDs","setOpt","inheritedAttributes","inheritOpt","parentname","defaultValue","parentValue","remapSectionVariable","inputList","sectionMasterLabel","space","setNumberLabels","shadow_numbers","firstword","firstlabel","substituteOne","substituteTwo","template2","Mode","params","passthrough","Doppeler","rexStr","stringMangler","matchRex","splitRex","tags","origStrings","normalDecorIsOrphan","blob","all_the_decor","use_param","layout_decorations","alldecor","getCitationLabel","getTrigraphParams","myname","authors","nameOutput","getName","skipWords","ilst","trigraph","decorate","getSortFunc","setLangTagsForCslSort","setLangTagsForCslTransliteration","setLangTagsForCslTranslation","setLangPrefsForCites","conv","clientSegment","citeprocSegment","supplements","sortval","translit","translat","setLangPrefsForCiteAffixes","affixList","affixes","citeAffixes","settings","setAutoVietnameseNamesOption","setAbbreviations","setSuppressTrailingPunctuation","suppressTrailingPunctuation","levelname","queue","empty","tokenstore","Stack","drip","blobs","getToken","mergeTokenStrings","base","modifier","base_token","modifier_token","addToken","newtok","pushFormats","popFormats","startTag","openLevel","endTag","closeLevel","curr","Blob","just_looking","tokname","notSerious","ignorePredecessor","noStripPeriods","useblob","element_trace","last_char_rendered","term_predecessor_name","in_cite_predecessor","blobPrefix","blobBlobs","strip_periods","punctuation_in_quote","processTags","myblobs","txt_esc","blobjr","use_suffix","use_prefix","blob_delimiter","count_offset_characters","offset_characters","new_locale","old_locale","first_blob","particle","blen","suppress_decorations","addtoret","numberSeen","UGLY_DELIMITER_SUPPRESS_HACK","successor_prefix","span_split","blobs_start","renderBlobs","blobs_end","clearlevel","in_cite","use_delim","checkNext","splice_prefix","doit","checkLast","strlen","str_blob","addme","range_prefix","suppress_splice_prefix","purgeEmptyBlobs","buf","punctInQuote","NO_SWAP_IN","NO_SWAP_OUT","LtoR_MAP","SWAP_IN","SWAP_OUT","PUNCT","PUNCT_OR_SPACE","RtoL_MAP","subkey","blobIsNumber","blobEndsInNumber","blobHasDecorations","includeQuotes","decorlist","blobHasDescendantQuotes","blobHasDescendantMergingPunctuation","parentChar","childChar","mergedChars","matchLastChar","mergeChars","First","Second","second","merge_right","FirstStrings","SecondStrings","firstChar","secondChar","cullRight","cullLeft","addRight","addLeft","merge","swapToTheLeft","swapToTheRight","upward","parentDecorations","parentStrings","childStrings","leftward","sibling","siblingChar","hasNumber","suffixAndPrefixMatch","suffixAndFieldMatch","downward","delimChar","childDecorations","childIsNumber","allowMigration","siblingStrings","fix","lastChar","quoteSwap","decoration","has_disambiguate","suppressedJurisdictions","persons","institutions","titles","journals","publishers","places","bib_mode","sort_citations","citation_number_slug","has_layout_locale","disable_duplicate_year_suppression","jurisdiction_fallbacks","locator_label_parse","clean_up_csl_flaws","wrap_url_and_doi","apply_citation_wrapper","strict_text_case_locales","spoof_institutional_affiliations","parse_names","hanging_indent_legacy_number","throw_on_empty","strict_inputs","prioritize_disambiguate_condition","legacy_institution_name_ordering","etal_min_etal_usefirst_hack","names_base","givens_base","namepart_decorations","namepart_type","can_substitute","element_rendered_ok","nameset_counter","term_intended","variable_attempt","variable_success","output_tip","label_form","parallel_first","parallel_last","parallel_delimiter_override","done_vars","tokenstore_stack","last_suffix_used","last_names_used","last_years_used","years_used","names_used","taintedCitationIDs","initialize_with","AmbigConfig","bib_sort_keys","cite_locales","cite_affixes","authority_stop_last","condition_counter","condition_lang_val_arr","condition_lang_counter_arr","Match","suffixator","Suffixator","romanizer","Romanizer","Ordinalizer","LongOrdinalizer","in_bibliography","in_style","layout_flag","names_variables","name_label","macro","substitute_level","names_level","render_nesting_level","render_seen","bibliography_key_pos","tests","srt","Comparifier","collapse","topdecor","layout_prefix","layout_suffix","layout_delimiter","sort_locales","max_number_of_names","sort_directions","citation_number_sort_direction","citation_number_secondary","previewCitationCluster","newMode","oldMode","citationID","processCitationCluster","appendCitationCluster","citationreg","citationByIndex","flag","preCitation","postCitation","nlen","noteCitations","textCitations","citationsInNote","oldCitationList","oldItemList","oldAmbigs","citation_errors","return_data","setCitationId","reflist","newCitationList","newItemIds","newItemIdsList","citationById","oldAkey","ambig","ambigcites","disambig","sortedItems","rerunAkeys","tryLabel","newitem","lastNotePos","citationsByItemId","citations","update_items","citation_number_sort","sortkeys","getSortKeys","grouped_sort","unsorted","authorstring_request","mydisambig","getAmbiguousCite","authorstring","authorstrings","compareCompositeKeys","lastauthor","thiskey","thisauthor","StartCitation","first_ref","last_ref","first_container_ref","onecitation","incitationid","incitationxloc","item_id","first_id","last_id","myxloc","mylocator","mylabel","l","oldlastid","oldlastxloc","oldvalue","position","oldCount","newCount","ibidme","suprame","prevCitation","prev","prev_locator","prev_label","curr_locator","thisCitation","old_last_id_offset","adjusted_offset","oldid","prevxloc","thisxloc","note_distance","process_CitationCluster","oldItemIds","rerunAkey","run","mycitation","citation_pos","citation_note_index","citation_id","firstChunk","getCitationCluster","secondChunk","infix","thirdChunk","makeCitationCluster","rawList","visualForm","oldTermSiblingLayer","non_parallel","parallel_last_override","parallel_delimiter_override_on_suppress","itemSupp","origSuppressDecorations","getCite","getSpliceDelimiter","last_locator","last_collapsed","have_collapsed","use_cite_group_delimiter","cite_group_delimiter","alt_affixes","objects","myparams","composite","compie","preceding_item","error_object","authorOnly","suppressAuthor","citation_prefix","last_primary_names_string","backref_index","abbrev_trimmer","QUASHES","use_layout_prefix","parasets","lastTitle","lastID","locatorInLastPosition","cite_index","hasPlaceholderTerm","itemID","citationItems_pos","error_code","precedingEndsInPeriodOrComma","currentStartsWithPeriodOrComma","spaceidx","citation_suffix","last_locale","wrapCitationEntry","last_chr","buffer","parallel_delimiter","preStr","sufStr","tmpobj","tmpstr","prevItemID","blockShadowNumberReset","areaOrig","probably_rendered_something","citeStart","name_node","NameOutput","citeEnd","bibliography_pos","bibliography_errors","disambiguate_count","disambiguate_maxMax","same_author_as_previous_cite","subsequent_author_substitute_ok","lastchr","disambig_override","disambig_restore","clear","has_done_year_suffix","last_cite_locale","first_name_string","cut_var","issued_date","renders_collection_number","bibsection","entry_ids","entry_strings","exclude_types","exclude_with_fields","exclude","getBibliographyEntries","maxoffset","hangingindent","include","anymatch","allmatch","bib_entry","topblobs","entry_item_ids","siblings","skips","entry_item_data","page_item_count","eval_string","eval_spec","eval_list","last_rendered_name","page_start","page_length","getSortedIds","processed_item_ids","consolidatedIDs","container_item_count","consolidate_containers","container_item_pos","select","quash","embedBibliographyEntry","master","parallel_and_not_last","last_expected_id","last_seen_id","force","direction","floor","uncitedItemIDs","doneIDs","itemIDs","pre","updateUncitedItems","restoreProcessorState","citationList","itemList","indexNumbers","citationIds","oldCitations","idList","rerun_ambigs","implicitUpdate","oldArea","oldRoot","oldExtension","ambigsTouched","dodeletes","myhash","doinserts","mylist","dorefreshes","rebuildlist","setsortkeys","setdisambigs","sorttokens","renumber","idHash","dopurge","langstr","defaultLocale","langlst","bare","generic","beShy","localexml","localeSet","localeLists","lang_in","lang_out","termname","styleopts","ord","foundLocale","style_options","jurispref","typenode","ordinals101","ordinals101_toggle","genderized_terms","genderform","termstub","ikey","gender_segments","form_segments","jkey","feminine","masculine","jurisdiction_preference","skip_words","getLocaleNames","preferredLocale","stylexml","extendLocaleList","localeList","normalizedLocale","localeIDs","sniffLocaleOnOneNodeName","nodeLocales","styleNode","nodeNames","choose","firstkey","date_obj","dpx","mypos","date_token","cloneToken","date_parts","date_variables","substituteStart","dateMacroAsSortKey","donesies","date_object","season_end","date_collapse_at","substituteEnd","first_date","value_end","real","invoked","precondition","bc","ad","ready","dcurr","date_variable","formatAndStrip","myform","Dates","last_string_output","monthnameid","myform_end","season","range_delimiter","has_year_suffix","NumericBlob","setFormatter","Conditions","TopNode","etal_node","etal_term","realGroup","label_form_override","label_capitalize_if_first_override","label_capitalize_if_first","reject","require","old_term_predecessor","variable_success_parent","label_static","set_parallel_delimiter_override","set_parallel_delimiter_override_on_suppress","LAST_TO_FIRST","parallel_last_to_first","publisher_lst","publisher_place_lst","publisherOutput","PublisherOutput","choose_start","if_start","any","itemItem","if_end","else_start","render","citationNumberIdx","isJurisLocatorLabel","hasRepeat","checkRepeats","info","suppress_repeats","SIBLING","ORPHAN","doneVar","else_end","choose_end","conditions","addMatch","matchCombine","addTest","locale_default","institution_delimiter","name_delimiter","and_term","and_prefix_single","and_prefix_multiple","and_suffix","single","multiple","has_institution","start_key","date_key","sort_key_flag","names_start_token","name_token","institution_token","names_end_token","single_text","citation_number_map","seq","padding","dateAsSortKey","getOutputFunction","varval","end_key","keystring","normalizeUnicode","evaluateLabel","section_form_override","capitalize_if_first","namevars","namelabels","name_flag","layout","prefix_token","suffix_token","tok","my_tok","setSuffix","topblob","using_display","locale_raw","cite_entry","locator_txt","suffix_txt","rendered_name","layout_locale_flag","choose_tok","build_layout_locale_flag","alternative","if_tok","oldItem","oldLang","abort_alternative","newItem","locale_list","gotlang","tryspec","deleteme","print","nameset_base","etal_spec","_first_creator_variable","_please_chop","requireMatch","nameset_offset","label_blob","labelVariable","checkCommonAuthor","common_term_match_fail","reinit","oldval","outputNames","variable_offset","family_decor","given_decor","getEtAlConfig","divideAndTransliterateNames","truncatePersonalNameLists","disambigNames","constrainNames","setEtAlParameters","setCommonTerm","renderAllNames","blob_list","institution_sets","varblob","joinPersonsAndInstitutions","freeters","joinInstitutionSets","joinFreetersAndInstitutionSets","_join","_applyLabels","common_term","namesToken","name_node_string","nameobjs","substring","Names","getRawName","author_title","_collapseAuthor","names_count","freeters_count","institutions_count","persons_count","_buildLabel","castLabel","myqueue","mystr","oldchars","isPerson","isInstitution","chopvar","_truncateNameList","etal_min","etal_use_first","limit","varnames","_normalizeVariableValue","_getFreeters","_getPersonsAndInstitutions","_checkNickname","has_affiliates","_clearValues","myLocalName","_purgeEmptyBlobs","joinPersons","tokenname","_joinEtAl","_joinEllipsis","_joinAnd","_getAfterInvertedName","finalJoin","prevBlob","isInverted","_getAndJoin","singleOrMultiple","_getToken","ellipsis","has_term","firstSet","secondSet","perfectMatch","_compareNamesets","vv","base_nameset","nameset","_imposeNameConstraints","display_names","discretionary_names_length","etal_use_last","sane","overlength","padBase","_runDisambigNames","myinitials","paramx","namereg","addname","evalname","use_initials","etal_style","etal_suffix","etal_prefix_single","etal_prefix_multiple","_setEtAlParameter","_renderNames","renderInstitutionNames","localesets","slot","primary","secondary","tertiary","slotnames","setRenderedName","_renderInstitutionName","long_style","short_style","institution_short","usedOrig","fixupInstitution","pri","sec","ter","_getShortStyle","_composeOneInstitutionPart","_getLongStyle","_renderOneInstitutionPart","primary_tok","secondary_tok","tertiary_tok","institutionblob","hasItalic","secondary_outer","tertiary_outer","nameBlob","_renderPersonalName","nameToken","_renderOnePersonalName","personblob","_isRomanesque","top_locale","dropping_particle","_droppingParticle","_familyName","non_dropping_particle","_nonDroppingParticle","givenInfo","_givenName","_nameSuffix","suffix_sep","romanesque","nbspace","merged","has_hyphenated_non_dropping_particle","hasJoiningPunctuation","initializationLevel","_normalizeNameInput","block_initialize","_parseName","_stripPeriods","decor_tok","ndp","defaultLevel","useLevel","formIsShort","initializeIsTurnedOn","hasInitializeWith","requestedLevel","gdropt","initializeWith","unInitialize","toSuffix","noparse","slotLocaleset","stopOrig","name_params","getStaticOrder","langTag","foundTag","langTags","getNameParams","transliterated","try_locale","name_as_sort_order","name_as_reverse_order","name_never_short","field_lang_bare","strname","listpos","longNameStr","shortNameStr","_quashChecks","abbrevKey","retShort","splitShort","_trimInstitution","trimmer","frag","refresh","static_ordering_val","quashCheck","subunits","use_first","stop_last","use_last","stop_first","ss","group_tok","varlist","clearVars","composeAndBlob","composeElements","composePublishers","joinPublishers","and_blob","no_delim","with_delim","myterm","theItem","processNumber","labelForm","labelDecorations","labelCapitalizeIfFirst","oldTmpRoot","ellipsis_term","ellipsis_prefix_single","ellipsis_prefix_multiple","ellipsis_suffix","name_labels","variables_real","names_flag","mywith","with_default_prefix","with_suffix","thewith","can_block_substitute","outputNumericField","langForItem","lang_sort_hold","substitute","if_singleton","firstoutput","specialdelimiter","group_start","group_end","abbrevfam","abbrfall","altvar","transfall","clonetoken","groupblob","prefixblob","valueblob","intext_sort","maketest","myitem","myvariable","trylabels","trylabel","trypositions","testSubsequentNear","testSubsequentNotNear","tryposition","mytype","isValid","rawNames","rawMultiNames","creatorParent","creatorChild","gotosleepability","labelVisibility","tryjurisdictions","maketests","trycountries","trydates","trydate","last_is_person","locale_data","sort_locale","localeMaster","localeServant","locale_bares","tryclasses","tryclass","retval","namevar","subunit_count","citeForm","vars","track_repeat","capitalize_if_first_override","text_case_normal","idxEnd","parallelMatchList","siblingRanges","currItem","nextItem","freshMatchList","seeAlso","tempMatchList","remainder","ididx","currVal","nextVal","currYear","nextYear","masterID","siblingID","none","nand","getCountryOrJurisdiction","quashCountry","getHumanForm","abbreviate","basevalue","family_var","use_field","preferredJurisdiction","myabbrev_family","abbrev","getFieldLocale","localeRex","getTextSubField","locale_type","use_default","usingOrig","stickyLongForm","breakMe","firstValue","fieldsToTry","h","hlen","variantMatch","hasVal","found_variant_ok","publisherCheck","category","abbreviation_fallback","alternative_varname","langPrefs","primary_locale","secondary_locale","tertiary_locale","oldLangArray","primaryPrefix","primaryUsedOrig","citeFormCheck","conditional","maxvals","minval","mother_token","textCase","DefaultFormatter","subnode","subchildren","display","lingo","isMacro","yr","macroFlag","exts","compareNamesets","punctlist","terminator","normalizeOnly","nameSplits","nameDoppel","mmm","doNormalize","doInitialize","notag","mergetag","tagstr","newstr","tagonly","isAbbrev","extra","imperial","substr","normalizeMonth","useSeason","ordinal","Sort","strip_prepositions","bib_first","nodetypes","variable_entry","noteNumber","firstReferenceNoteNumber","firstContainerReferenceNoteNumber","citationNumber","itemData","variableNames","bib_first_end","bib_other","substitution_name","subrule","dosub","substituted_variable","suffixes","trygenders","trygender","ordinfo","numstr","slist","N","X","ItemObject","realVariable","fullformAnd","symbolAnd","andRex","joinerMatchRex","joinerSplitRex","localeAnd","localeAmpersand","composeNumberInfo","origLabel","joiningSuffix","parsePosition","labelSuffix","fixNumericAndCount","currentLabelInfo","isEscapedHyphen","collapsible","mVal","mCurrentLabel","isCollapsible","fixLabelVisibility","groupStartPos","stripHyphenBackslash","setStyling","masterNode","masterStyling","masterLabel","newnode","styling","checkPage","fixupRangeDelimiter","rangeDelimiter","isNumeric","isPage","hasTerm","checkTerm","manglePageNumbers","currentInfo","fixRanges","lastHadRangeDelimiter","languageRole","localeType","normval","defaultLabel","jmrex","jsrex","embeddedLabel","normalizeFieldValue","fixupSubsections","slug","filteredOrigLabel","parseString","setSpaces","groupCount","lastVal","thisVal","setPluralsAndNumerics","setVariableParams","embeddedLabelForm","nums","tryStatic","lastLabelName","labelName","labelPlaceholderPos","numStyling","prefixLabelStyling","suffixLabelStyling","rangeType","rangerex","listify","expand","minimize","minimize_internal","chicago","begin","ret_func","hyphens","delimRex","rexm","rexlst","minchars","isyear","front","sniff","_nestingState","_nestingData","opener","closer","flipflop","localeOpenQuote","localeCloseQuote","localeOpenInnerQuote","localeCloseInnerQuote","_getNestingOpenerParams","openers","_nestingParams","_tagRex","closers","matchAll","splitAll","close","_pushNestingState","tag","fixtag","_tryOpen","_tryClose","TagReg","decor","_decor","allTheDecor","decorset","_apostropheForce","leadingSpace","doppel","forcedSpaces","_doppelString","quot","quoteFormSeen","apostrophe","tagInfo","failedTag","tagPos","forcedSpace","firstString","tagReg","latest","addStyling","newblob","newdecorset","_decorset","_olddecor","popStyling","_undoppelToQueue","tagDoppel","wordDoppel","_tagParams","_capitalise","_textcaseEngine","quoteParams","pushQuoteState","quoteState","prevPos","positions","tryOpen","tryClose","quoteFix","capitaliseWords","tagState","afterPunct","lastWordPos","quotePos","origChar","isFirst","lastWords","lastWord","words","skipWordsRex","lowercase","uppercase","followingTag","wordle","lcase","capitalize","aChar","prePunct","postPunct","doiurl","rtf","charCodeAt","asciidoc","fo","indent","hi","latex","NameReg","CitationReg","masterMap","deletes","inserts","uncited","refreshes","akeys","oldseq","ambigresets","sorter","getSortedRegistryItems","uncited_flag","touched","kkey","delitems","loneSiblingID","removeIDs","newmasterID","bibchange","akey","abase","registerAmbigToken","reflist_inserts","regtoken","akkey","loneKey","_insertItem","_locationOf","pivot","compareKeys","keyset","sortCompare","cmp","compareRegistryTokens","ambig_config","key_type","pkey","skey","dagopt","set_keys","myitems","nameind","nameindpkeys","itemkeyreg","itemid","nameobj","namenum","request_base","initials","gdropt_orig","posB","fullkey","configModes","modes","initVars","runDisambig","ismax","initGivens","lists","gnameset","gname","clashes","incrementDisambig","scanItems","evalScan","otherItem","ItemCite","scanlist","partners","nonpartners","otherItemCite","maxed","modeindex","disNames","captureStepToBase","betterbase","disExtraText","disYears","origid","oldBase","increment_names","givensMax","increment_namesets","namesMax","namesetsMax","myIds","myItemBundles","myItems","maxNamesByItemId","myItem","getCiteData","jurisdictionElems","composedID","xmlSource","skipFallback","myFallback","myXml","myNodes","myTypes","myName","preferences","preference","ParticleList","splitParticles","nameValue","firstNameFlag","caseOverride","origNameValue","hasParticle","particleList","m1","nameObj","lastNameValue","lastParticleList","possible_suffix","possible_comma","parseSuffix","firstNameValue","firstParticleList","module"],"sourceRoot":""}